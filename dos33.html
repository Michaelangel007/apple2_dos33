<!DOCTYPE html>
<html>
<title>Apple DOS 3.3C Source Code (Unified HTML and Annotated Version by Michael Pohoreski)</title>
<head>
    <style>
a {
    color: #F0F; /* Should never see magenta -- means link wasn't marked up propery */
    /* background-color:#F0F; */
}
/*
    There are 4 lights, er, links! *argh* There are 5 lights.

    f FUNC definition: Foo EQU *
    x FUNC reference:      JSR Foo
    d VAR  declaration Bar DFB 0 or Bar EQU $00
    v VAR  reference       LDA Bar
    e EQU  const       Foo EQU 1
*/
a.f { /* func name definition LABEL */
    color          : #46F  ; /* blue (baby blue) */
    text-decoration: none  ; /* remove underlink from func link */
    font-weight    : bold  ; /* default to bold for function names */
}
a.x { /* func name reference TARGET */
    color          : #24f  ; /* dark blue */
    text-decoration: none  ; /* remove underlink from data link */
    font-weight    : normal; /* remove bold */
}
a.d { /* var name definition LABEL*/
    color          : #0C0  ; /* green */
    text-decoration: none  ; /* remove underlink from data link */
    font-weight    : bold  ; /* make bold */
 /* font-style     : italic; /* optional italic for data */
}
a.v { /* var name reference OPERAND */
    color          : #080  ; /* dark green */
    text-decoration: none  ; /* remove underlink from data link */
    font-weight    : normal; /* remove bold */
}

.code { /* code snippet */
    background-color:#EEE; /* grey */
}
a.disk {
    background-color:#F00; /* red */
    color           :#FFF; /* white */
    text-decoration: none; /* remove underlink from data link */
    font-weight: normal;   /* remove bold */
}
/* Link to Macro Definition */
a.do { /* do macroname */
    color: #80F;           /* purple */
    text-decoration: none; /* remove underlink from data link */
    font-weight: normal;   /* remove bold */
}
a.dumb { /* How Not To Design a File System (HNTDAFS) or How Not To Design an Operating Systems (HNTDAOS) */
    color: #808; /* purple */
}
.e { /* const equ -- ROM address, i.e. $FCA8 */
    color          : #80F  ; /* 088 = dark green */
    text-decoration: none  ; /* remove underlink from data link */
    font-weight    : normal; /* remove bold */
}
.file {
    color: #088;           /* old filename red */
    text-decoration: none; /* remove underlink from data link */
    font-weight: normal;   /* remove bold */
}
.fixed { /* ACTIVE sticky header; See: .fixed, .sticky */
    /* Mandatory styles to make the active sticky work */
    background:  #FFF; /* if we don't have a background, this fixed header will be see through and overlap with holes */
    position  : fixed; /* force to be at top of page */

    /* Optional -- remaining styles should match the .sticky  header */
    text-align:   center;
    width     :     99%;
}
.indent2 { /* Indent 2.5% */
     padding-left:2.5%;
}
.indent5 { /* Indent 5% */
     padding-left:5%;
}
a.line { /* line number */
    color: #088; /* cyan */
    text-decoration: none; /* remove underlink from data link */
}
a.link { /* we link TO somthing -- source */
    color: #08F; /* Baby Blue */
}
.macro { /* macro line bg */
    background-color:#F4F4F4; /* was grey #EEE */
}
.magic { /* hard-coded magic number hack */
    color           :#FFF; /* white on */
    background-color:#F80; /* orange */
}
a.mem { /* *wastes* X bytes of memory */
    color           : #000;
    background-color: #FDE; /* light pink */
    text-decoration: none; /* remove underlink from data link */
}
.n { /* Dec, Hex, Number, Memory Address */
    color: #F80; /* Orange */
    font-weight: bold;
}
a.name { /* Link to Macro Label */
    color: #444;
    font-style: italic;
}
.note {
    background-color:#FF0; /* yellow */
}
a.page { /* Page Definition -- link comes here */
    color: #080; /* Green */
    text-decoration: none; /* remove underlink from data link */
}
a.section {
    color: #000;
    text-decoration: none; /* we are linking FROM something -- destination -- remove underlink from data link */
}
.sticky { /* POTENTIAL sticky header; See: .fixed, .sticky */
    /* Designate header as being a "sticky" header -- if it scrolls off the top of the page, it will "stick" to the top of the page until the next sticky header reaches it.
       NOTE:  This is not the ACTIVE sticky header -- see .fixed for that */
    /* Mandatory */
    background:     #FFF;
    position  : relative; /* when active will change parent div to be fixed */

    /* Optional -- remaining styles should also match the .active header */
    text-align:   center;
    width     :      99%;
}
.sticky.fixed { /* ACTIVE sticky */
    position: fixed;
    top     : 0;
    z-index : 1;
}
.sticky.fixed.absolute { /* For when two stickies are overlapping, this is the one above */
    position: absolute;
}
a.struct { /* *wastes* X bytes of struct */
    color           : #FFF;
    background-color: #F4C; /* dark pink */
    text-decoration: none; /* remove underlink from data link */
}
.toc { /* Table of Contents */
    list-style: none;
    margin-bottom: 0px;
}
.todo {
    background-color:#FF0; /* yellow */
}
a.ts { /* Track/Sector Definition -- link comes here */
    color          : #F00; /* red */
    text-decoration: none; /* remove underlink from data link */
    font-weight    : bold; /* make bold */
}
.warn {
    color: #F80; /* Orange */
}

b { /* Bold = Blue */
    color: #004; /* history: 080, 00F, 004 */
}
b.ts { /* Track/Sector */
    color: #F00;
    background-color: #F0F; /* */
}
/* 100% Saturation is too dark and over-powering. Lighten up to make it easier on the eyes. */
/* S: ~25%, V: 100%  */
.c00 { background-color:#Fbb; color: #000; } /* H:  0 #FFbfbf Red           */
.c01 { background-color:#Fdb; color: #000; } /* H: 30 #FFdfbf Orange        */
.c02 { background-color:#FFb; color: #000; } /* H: 60 #FFFFbf Yellow        */
.c03 { background-color:#dFb; color: #000; } /* H: 90 #dfFFbf Lime Green    */
.c04 { background-color:#bFb; color: #000; } /* H:120 #bfFFbf Green         */
.c05 { background-color:#bFd; color: #000; } /* H:150 #bfFFdf Emerald Green */
.c06 { background-color:#bFF; color: #000; } /* H:180 #bfFFFF Cyan          */
.c07 { background-color:#bdF; color: #000; } /* H:210 #bfdfFF Sky Blue      */
.c08 { background-color:#bbF; color: #000; } /* H:240 #bfbfFF Blue          */
.c09 { background-color:#dbF; color: #000; } /* H:270 #dfbfFF Purple        */
.c10 { background-color:#FbF; color: #000; } /* H:300 #FFbfFF Magenta       */
.c11 { background-color:#Fbd; color: #000; } /* H:330 #FFbfdf Pink          */

.c20 { background-color:#Fbb; color: #000; } /* H:  0 */
.c21 { background-color:#Fdb; color: #000; } /* H: 30 */
.c22 { background-color:#FFb; color: #000; } /* H: 60 */
.c23 { background-color:#dFb; color: #000; } /* H: 90 */
.c24 { background-color:#bFb; color: #000; } /* H:120 */
.c25 { background-color:#bFd; color: #000; } /* H:150 */
.c26 { background-color:#bFF; color: #000; } /* H:180 */
.c27 { background-color:#bdF; color: #000; } /* H:210 */
.c28 { background-color:#bbF; color: #000; } /* H:240 */
.c29 { background-color:#dbF; color: #000; } /* H:270 */
.c30 { background-color:#FbF; color: #000; } /* H:300 */
.c31 { background-color:#Fbd; color: #000; } /* H:330 */

/* S: 100% */
.c40 { background-color:#F00; color: #000; }
.c41 { background-color:#F80; color: #000; }
.c42 { background-color:#FF0; color: #000; }
.c43 { background-color:#0F0; color: #000; } /* #8F0 skip lime green -> green #0F0 */
.c44 { background-color:#0FF; color: #000; } /* #0F0 skip green      -> cyan  #0FF */
h1 {
    font-size: 200%;
}
h2 {
    font-size: 150%;
}
/*
After an hr there is a line of whitespace
    <div class="hr"><hr></div>
Solution: place <hr> on same line
*/
hr {
    margin: 1px 1px;
/*
#    padding: 0px;
#    margin:  0px;
#    margin-top:-1em
*/
}
hr.join { /* We have a double horizontal rule for new source files, use 0 padding on the bottom */
    margin: 0px 0px;
}
i { /* Italic = Green */
    color: #040; /* history: 00F, 080, 040 */
}
span.b { color: #080; font-weight: bold;  } /* Original bold   green */
span.i { color: #00F; font-style: italic; } /* Original italic blue  */
span.page {
    color: #080; /* green */
}
span.patch {
    background-color:#EEC; /* faded yellow */
}
.borders, .borders tr, .borders td {
    border: 1px solid;
    border-width: 1px;
    border-collapse: collapse;
    padding: 2px;
}
.borders th {
    background-color: #EEE;
    border: 1px solid;
}

/* Table nested inside table -- don't show left, right, bottom border edges */
.rows, .rows tr {
    border: 1px solid;
    border-collapse: collapse; /* seperate or collapse */
    border-left : 0px;
    border-right: 0px;
    border-bottom: 0px;
    padding: 0px;
    outline: none;
}
.rows td {
    border: 0px;
}
.commentmargin {
    z-index         :    1;
    position        :fixed;
    top             :  0px;
    right           :  0px;
    margin          :  0px;
    color           : #EEE;
}
.syntax {
    z-index         :    2;
    position        :fixed;
    top             :  0px;
    right           :  0px;
    color           : #000;
    background-color: #FFF;

    margin       : 1px 1px 1px 1px;
    border       : 1px solid;
    border-radius: 8px;
    padding      : 1px;
}

    </style>
</head>
<script>
// ========== Utility ==========
    // http://stackoverflow.com/questions/18953144/how-do-i-get-the-offset-top-value-of-an-element-without-using-jquery
    function js_offset( elem )
    {
        var de   = document.documentElement;
        var box  = elem.getBoundingClientRect();
        var top  = box.top  + window.pageYOffset - de.clientTop ;
        var left = box.left + window.pageXOffset - de.clientLeft;
        return { top: top, left: left };
    }

    function js_outerHeight( elem )
    {
        return elem.clientHeight;
    }
    // http://stackoverflow.com/questions/11193453/find-the-vertical-position-of-scrollbar-without-jquery
    function js_scrollTop() { return (window.pageYOffset !== undefined) ? window.pageYOffset : (document.documentElement || document.body.parentNode || document.body).scrollTop  }

    // *note* This SO is incorrect:
    //     http://stackoverflow.com/questions/31472754/wrap-a-around-div-without-jquery
    // type: 'div', 'a', etc.,
    function js_wrap( child, type  )
    {
        /*
            Before:                     After:
                biological_parent           biological_parent
                    child                       foster_parent
                                                    child
        */
        var biological = child.parentNode;
        var foster = document.createElement( type );
        biological.insertBefore( foster, child );

        // http://stackoverflow.com/questions/7555442/move-an-element-to-another-parent-after-changing-its-id
        foster.appendChild( child ); // move, not copy

        return child;
    }

    // ---------- Implementation ----------
    /*
        Requires 2 css styles

        .fixed    { position: fixed   ; background: #FFF; } // active sticky header
        .sticky   { position: relative; background: #FFF; } // designate this header as sticky

        <div class='sticky'> Header 1 </div>
        <div class='sticky'> Header 2 </div>
        <div class='sticky'> Header 3 </div>
    */
    // Inspired from: https://codepen.io/joeaugie/pen/RWbPzo
var StickyHeaders = (function() {

    var _aHeaders;

    var _onFadeTimer;
    var _onFadeTimeBegin = 0;
    var _onFadeTimeEnd = 0;
    var _onFadeTimeQuantum = 250;

    var _onScrollTimer;
    var _onScrollTimeQuantum = 2000; // milliseconds

    // Fade out sticky headers who have been taged with '.a == 0'
    var Fade = function( headers, alpha )
    {
        var nHeaders = headers.length;
        for( var i = 0; i < nHeaders; ++i )
            if(!headers[ i ].a)
                headers[ i ].e.style.opacity = "" + alpha;
    };

    var Init = function( stickyClassName )
    {
        _aHeaders = [];

        // iterate over each element of class 'stickyClassName' ("sticky")
        // http://stackoverflow.com/questions/5897122/accessing-elements-by-type-on-javascript
        var Stickies  = document.getElementsByClassName( stickyClassName ),
            nStickies = Stickies.length;

        for( var iSticky = 0; iSticky < nStickies; ++iSticky )
        {
            var div    = document.createElement( 'div' ),
                sticky = js_wrap( Stickies[ iSticky ], 'div' ),
                y      = js_offset( sticky ).top,
                h      = js_outerHeight( sticky ),
                data   = {
                    e: sticky, // injected parent that we will adjust styles on
                    h: h,      // original height
                    y: y,      // original position
                    a: 0       // =0 fade out, =1 (always) visible
                };
                _aHeaders.push( data ); // stash in array so when we scroll we can adjust ALL the sticky header's y position as needed

                sticky.parentNode.style.height = h + 'px';
        }

        console.log( "Sticky ClassName: ", stickyClassName );
        console.log( "Stickies found: ", _aHeaders.length );

        // Add callback when scrolling starts/stops
        window.onscroll = function()
        {
            if( _onFadeTimer )
                clearTimeout( _onFadeTimer )

            _onFadeTimeBegin = 0; // Don't update fading
            _onFadeTimeEnd   = 0;

            if( _onScrollTimer )
                clearTimeout( _onScrollTimer )

            Scroll( _aHeaders );

            // The problem with Sticky Headers is that they obscure the top of the page
            // causing whenever a user clicks on a link the scrolled page to be hidden underneath them.
            // The solution is to auto-hide the sticky header(s) after X milliseconds when scrolling stops.
            // http://stackoverflow.com/questions/3701311/event-when-user-stops-scrolling

            // There is no 'onScrollEnd' event
            // Create a timer and call that after X milliseconds
            _onScrollTimer = setTimeout( function() { onScrollEnd( _aHeaders ); }, _onScrollTimeQuantum );
        };

        _onFadeTimeBegin = 0;
        _onFadeTimeEnd   = 0;
        requestAnimationFrame( onFade ); // update() @ dynamic 60 fps
    };

    var Scroll = function( headers )
    {
        var top = js_scrollTop();

        var nHeaders = headers.length;
        for( var i = 0; i < nHeaders; ++i )
        {
            var sticky = headers[ i ].e,
                h      = headers[ i ].h,
                y      = headers[ i ].y;

            if (y <= top)
            {
                sticky.classList.add( "fixed" );
                headers[ i ].a = 0; // this sticky header needs to fade out

                // Handle case when 2 sticky headers are overlapping
                if( (i+1) < nHeaders )
                {
                    var next  = headers[ i+1 ].e,
                        below = headers[ i+1 ].y - h;
                    if (js_offset( next ).top >= below)
                    {
                        sticky.classList.add( "absolute" );
                        sticky.style.top = below + 'px';
                    }
                }
            } else {
                sticky.classList.remove( "fixed" );
                headers[ i ].a = 1; // never fade out this sticky header

                if (i > 0)
                {
                    var prev = headers[ i - 1 ].e;
                    if (top <= (y - h))
                    {
                        prev.classList.remove( "absolute" );
                        prev.removeAttribute( "style" );
                    }
                }
            }
        }
    };

    var onFade = function( elapsed ) // relative time
    {
        var now = new Date().getTime(); // absolute time
        if( now >= _onFadeTimeBegin && _onFadeTimeBegin )
        {
            var t = 0;

            if( now < _onFadeTimeEnd )
                t = (_onFadeTimeEnd - now) / _onFadeTimeQuantum;
            else
                _onFadeTimeBegin = 0;

            Fade( _aHeaders, t );
        }

        requestAnimationFrame( onFade );
    }

    // Hide all sticky headers
    var onScrollEnd = function( headers )
    {
        var now = new Date().getTime();

        _onFadeTimeBegin = now;
        _onFadeTimeEnd   = now + _onFadeTimeQuantum;

        onFade( now ); // Force redraw
    };

    return {
        Init: Init
    };
})();

    function onLoad()
    {
console.log( "Loading..." );
        StickyHeaders.Init( 'sticky' );
console.log( "done!" );
    }

    function onSyntaxChangeColor()
    {
console.log( "TODO: CSS Color" );
        setSyntaxButtons( false, true );
    }

    function onSyntaxChangeMono()
    {
console.log( "TODO: CSS Monochrome" );
        setSyntaxButtons( true, false );
    }

    function setSyntaxButtons( enableColor, enableMono )
    {
        var colo = document.getElementById( 'syntax_mono'  );
        var mono = document.getElementById( 'syntax_color' );
        colo.disabled = enableColor;
        mono.disabled = enableMono;
    }
</script>

<body onload='onLoad()'>
<div class='syntax' id='syntax'>
<i>Syntax Highlighting</i><br>
<button type='button' id='syntax_color' disabled onclick='onSyntaxChangeColor();'>Color     </button>
<button type='button' id='syntax_mono'           onclick='onSyntaxChangeMono ();'>Monochrome</button>
</div>
<!-- This unfortunately breaks the ability to click on links
that overflow into this region -->
<!--
<div class='commentmargin'>
<pre>                                                                            |
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
|
<pre>
</div>
-->
<h1>Apple DOS 3.3C Source Code (Unified HTML and Annotated Version)</h1>
<h1>0.0 Table of Contents</h1>
    <ul class="toc">
        <li>1.0 <a class='link' href='#Introduction'       >Introduction</a>                   </li>
        <li>2.0 <a class='link' href='#Listing'            >Assembly Source Code Listing</a>   </li>
        <li>3.0 <a class='link' href='#Symbols'            >Symbols</a>                        </li>
        <ul class="toc">
            <li>3.1 <a class='link' href='#Alphabetical'   >Symbols (Alphabetical)</a>         </li>
            <li>3.2 <a class='link' href='#Address'        >Symbols (Address)</a>              </li>
        </ul>
        <li>2.0 Miscellaneous Information               </li>
        <ul class="toc">
            <li>2.1 Statistics                          </li>
            <li>2.2 <a class='link' href='#ColorSrcFile'>Color-Coded Memory by Source File</a> </li>
            <li>2.3 <a class='link' href='#ColorHexDump'>Color-Coded Hex Dump</a>              </li>
        </ul>
        <li>3.0 <a class='link' href='#Inefficiencies'     >Inefficiencies</a>                 </li>
        <ul class="toc">
            <li>3.1 <a class='link' href='#WastedMemory'   >Wasted Memory</a>                  </li>
            <li>3.2 <a class='link' href='#WastedDisk'     >Wasted Disk Space</a>              </li>
            <li>3.3 <a class='link' href='#WastedSectors'  >Wasted Sectors</a>                 </li>
            <li>3.4 <a class='link' href='#BufferBloat'    >Buffer Bloat</a>                   </li>
        </ul>
        <li>4.0 <a class='link' href='#Acknowledgements'   >Acknowledgements</a>               </li>
    </ul>
<p>

<h1><a class='section' name='Introduction'>1.0 Introduction</a></h1>
<br>Transcribed and Annotated by Michael Pohoreski.
<br>Latest version on GitHub: <a class='link' href='http://htmlpreview.github.com/?https://github.com/Michaelangel007/apple2_dos33/blob/master/dos33.html'>dos33.html</a>
<p>
Numerous improvements have been made over the original DOS 3.3C assembly source code listing!
<p>
<ul>
  <li>Syntax Highlighting</li>
  <ul>
      <li>Linking all functions (blue) -- clicking on them will scroll to their declaration, </li>
      <li>Linking all variables (green) -- clicking on them will scroll to their declaration,</li>
      <li>All numbers (orange),                                       </li>
      <li>Inactive macro sections (gray)                              </li>
      <li>Options for color or monochrome syntax highlighting         </li>
  </ul>
  <li>Line numbers,                                                   </li>
  <li>Memory address and instruction opcodes,                         </li>
  <li>Cleaned up sloppy vertical alignment (such as (#) clock cycles),</li>
  <li>Unindented macro sections,                                      </li>
  <li>Snarky annotation commentary column,                            </li>
  <li>Entire source code is a single continuous page.                 </li>
</ul>
<p>
Header Format is:
<pre>
<hr><hr class='join'>=== <b class="file">FILENAME</b> - Description, Page <a class="page" name="page0">#</a>, <a class='ts'>Track/Sector</a> @ $offset, $<b class='n'>####</b> (Relocated address in high memory) ===<hr class='join'><hr>
</pre>

Line format is:
<pre>
Addr:## ## ##       L## LABEL       MNEMONIC        COMMENT                         Annotation
</pre>

<b>Legend:</b>
<p>
<div class='indent5'>
<table class='borders'>
    <tr>
        <td>Addr</td>
        <td>Address at assemble time</td>
    </tr>
    <tr>
        <td>## ## ##</td>
        <td>Opcode(s)</td>
    </tr>
    <tr>
        <td><a class='line'>L##</a></td>
        <td>Line number of source file</td>
    </tr>
    <tr>
        <td>LABEL</td>
        <td>All function names, variable names, branch target names, and references to Code and Data are color-coded:
<br><a class='f' >Function Definition</a>
<br><a class='d' >Data Definition</a>
<br><a class='do'>Macro Definition</a>
<br><a class='e' >Const Definition</a>
</td>
    </tr>
    <tr>
        <td>MNEMONIC</td>
        <td>Assembly language instruction
<br><a class='x'>Function Reference</a>
<br><a class='v'>Variable Reference</a>
<br><span class='n'>0-9</span>, <span class='n'>A-F</span>
</td>
    </tr>
    <tr>
        <td>COMMENT</td>
        <td>Official comment -- spelling mistakes and improper indentation are verbatim</td>
    </tr>
    <tr>
        <td>Annotation</td>
        <td style='padding:0px;'>Modern commentary by me.<br>
<br>
        <table width='100%'>
            <tr class="rows"><td style='width:15%'><a    class='dumb' >dumb        </a>   </td><td> How NOT to Design a File System, or <br> How NOT to Design an Operating System</td></tr>
            <tr class="rows"><td style='width:15%'><a    class='mem'  >wastes      </a>   </td><td># bytes wasted due to bad architecture or inefficient code</td></tr>
            <tr class="rows"><td style='width:15%'><a    class='disk' >disk        </a>   </td><td> Unitialized data, wasted sector  </td></tr>
            <tr class="rows"><td style='width:15%'><a    class='magic'>magic number</a>   </td><td> Hard-Coded constant that the reader is assumed to know what it means</td></tr>
            <tr class="rows"><td style='width:15%'><span class='todo' >TODO        </span></td><td> Unanswered question(s)           </td></tr>
            <tr class='rows'><td style='width:15%'><span class='code' >CODE        </span></td><td> Code snippet                     </td></tr>
        </table>
        </td>
    </tr>
    <tr>
        <td>Misc.</td>
        <td style='padding:0px;'>
            <table width='100%'>
                <tr class='rows'><td style='width:15%'><span class='macro'>MACRO       </span></td><td> Conditional code               </td></tr>
            </table>
        </td>
    </tr>
</table>
</div>

<p>
<b class='warn'>WARNING:</b> DOS 3.3 was written by an amateur.
 <i>Reading this source code will probably make you angry</i> at all the <a class='link' href='#VTOC'>dumb shit</a> it does.
 Look for all my <b>*sigh*</b> comments and
 <b><a class='dumb' href='#HNTDAFS1'>HNTDAFS</a></b> (How NOT to Design a File System) links.
 While knowing "<b>What To Do</b>" is important, knowing "<b>What NOT To Do</b>" is even <i>more</i> important.
 As they say, <span class="i">"Hindsight is 20/20."</span>

<p>
<hr>LEGAL CRAP<hr>
The <span class="i">intent</span> of providing this copyrighted source code is
 as a convenience for the curious as a <span class="b">means to learn</span>.
<p>
<span class="b">DISCLAIMER:</span> <b>YOU MAY NOT USE APPLE'S SOURCE CODE EXCEPT FOR LEARNING</b>
 else you face risking the wrath of Apple's lawyers.
 Since Apple <span class="i">has already previously released this source code</span>
 I'm assuming it is OK to provide a mirror of the information since I'm not presenting anything new
 (well, OK, my commentary, but you get the point) that isn't already publically available.
<p>
With that "legalese" out of the way ... enjoy the read!

<h1><a class='section' name='Listing'>2.0 Assembly Source Code Listing</a></h1>
<div class='sticky'><hr><hr class='join'>=== <a class='file' name='DOS33C'>DOS33C</a> - Master Source File, Page <a class="page" name="page39">39</a> ===<hr class='join'><hr></div>
<pre>
                    00001 001             SBTL "DOS3.3C w/APPEND fix, U/L case"
                    00002 002             LST  ON,VSYM
                    00003 003             MSB  OFF
                    00004 004 <a class="f" name="ORIGIN">ORIGIN      </a>EQU  $1B00
                    00005 005 <a class="do" name="DIAGMOD">DIAGMOD     </a>EQU  0
                    00006 006 <a class="do" name="DOS33B" >DOS33B      </a>EQU  1
                    00007 007 <a class="do" name="ULC"    >ULC         </a>EQU  0          ;1=ASM with lower case patch    ;Address .. Addr, Track/Sector(s)
                    00008 008             INCLUDE <a class="_c00 file" href="#RELOCTR">RELOCTR</a>,,2                              ; $1B00 .. $1C80, T0SA - T0SB
                    00009 009             INCLUDE <a class="_c01 file" href="#DOSINIT">DOSINIT</a>,,2                              ; $1C81 .. $1E80, T0SB - T0SD
                    00010 010             INCLUDE <a class="_c02 file" href="#DOSHOOK">DOSHOOK</a>,,2                              ; $1E81 .. $1FCC, T0SD - T0SE
                    00011 011             INCLUDE <a class="_c03 file" href="#CMDSCAN">CMDSCAN</a>,,2                              ; $1FCD .. $2192, T0SE - T1S0
                    00012 012             INCLUDE <a class="_c04 file" href="#XOPNCLS">XOPNCLS</a>,,2                              ; $2193 .. $2330, T1S0 - T1S2
                    00013 013             INCLUDE <a class="_c05 file" href="#XLODSAV">XLODSAV</a>,,2                              ; $2331 .. $250F, T1S2 - T1S4
                    00014 014             INCLUDE <a class="_c06 file" href="#XMISCMD">XMISCMD</a>,,2                              ; $2510 .. $26A7, T1S4 - T1S5
                    00015 015             INCLUDE <a class="_c07 file" href="#DOSGOER">DOSGOER</a>,,2                              ; $26A8 .. $27D3, T1S5 - T1S6
                    00016 016             INCLUDE <a class="_c08 file" href="#BLDFTAB">BLDFTAB</a>,,2                              ; $27D4 .. $2883, T1S6 - T1S7
                    00017 017             INCLUDE <a class="_c09 file" href="#CMDTBLS">CMDTBLS</a>,,2                              ; $2884 .. $2A4E, T1S7 - T1S9
                    00018 018             INCLUDE <a class="_c10 file" href="#FDOSENT">FDOSENT</a>,,2                              ; $2A4F .. $2B21, T1S9 - T1SA
                    00019 019             INCLUDE <a class="_c11 file" href="#FOPCLRW">FOPCLRW</a>,,2                              ; $2B22 .. $2CEE, T1SA - T1SB
                    00020 020             INCLUDE <a class="_c20 file" href="#FDELCAT">FDELCAT</a>,,2                              ; $2CEF .. $2E8D, T1SB - T1SD
                    00021 021             INCLUDE <a class="_c21 file" href="#FMTRWIO">FMTRWIO</a>,,2                              ; $2E8E .. $2FF6, T1SD - T1SE
                    00022 022             INCLUDE <a class="_c22 file" href="#FLOCNXB">FLOCNXB</a>,,2                              ; $2FF7 .. $31C8, T1SE - T2S0
                    00023 023             INCLUDE <a class="_c23 file" href="#FLOCSEC">FLOCSEC</a>,,2                              ; $31C9 .. $3396, T2S0 - T2S2
                    00024 024             INCLUDE <a class="_c24 file" href="#FVCBUFS">FVCBUFS</a>,,2                              ; $3397 .. $35FD, T2S2 - T2S4
                    00025 025             INLUCDE <a class="_c25 file" href="#BOOTLDR">BOOTLDR</a>,,2                              ; $35FE .. $37FF, T0S0 - T0S1
                    00026 026             INCLUDE <a class="_c26 file" href="#COREQUS">COREQUS</a>,,1                              ; n/a
                    00027 027             INCLUDE <a class="_c27 file" href="#PRENIBL">PRENIBL</a>,,1                              ; $3800 .. $3829, T0S2
                    00028 028             INCLUDE <a class="_c28 file" href="#WRITRTN">WRITRTN</a>,,1                              ; $382A .. $38C1, T0S2
                    00029 029             INCLUDE <a class="_c29 file" href="#POSTNRD">POSTNRD</a>,,1                              ; $38C2 .. $3943, T0S2 - T0S3
                    00030 030             INCLDUE <a class="_c30 file" href="#RDADSEK">RDADSEK</a>,,1                              ; $3944 .. $39FC, T0S3
                    00031 031             INCLUDE <a class="_c31 file" href="#MSWAITR">MSWAITR</a>,,1                              ; $39FD .. $3C55, T0S3 - T0S6
                    00032 032             INCLUDE <a class="_c40 file" href="#WRITADR">WRITADR</a>,,1                              ; $3C56 .. $3CFF, T0S6
                    00033 033             INCLUDE <a class="_c41 file" href="#RWTSONE">RWTSONE</a>,,1                              ; $3D00 .. $3DAA, T0S7
                    00034 034             INCLUDE <a class="_c42 file" href="#RWTSTWO">RWTSTWO</a>,,1                              ; $3DAB .. $3EAE, T0S7 - T0S8
                    00035 035             INCLUDE <a class="_c43 file" href="#FORMATR">FORMATR</a>,,1                              ; $3EAF .. $3FC7, T0S8 - T0S9
                    00036 036             INCLUDE <a class="_c44 file" href="#DOSPTCH">DOSPTCH</a>,,1                              ; $3FC8 .. $3FFF, T0S9
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="RELOCTR">RELOCTR</a> - Relocate DOS to high (48K) memory, Page <a class="page" name="page110">110</a>, <a class='ts' href='#T0SA'>T0SA</a>-<a class='ts' href='#T0SB'>T0SB</a>, $<span class='n'>1B00</span> .. $<span class='n'>1C80</span> (n/a) ===<hr class='join'><hr></div>
<pre>
                    00037 001             PAGE                                            ; === Page <a class='page' name='page110'>110</a> ===
                    00038 002 *****************************************************
                    00039 003 *                                                   *
                    00040 004 * (C) COPYRIGHT 1978,1980,1982 APPLE COMPUTER, INC. *
                    00041 005 *                                                   *
                    00042 006 *****************************************************
                    00043 007             SKP 2
                    00044 008 *********************************
                    00045 009 *                               *
                    00046 010 *  ADAPTED FOR MACRO EDASM BY   *
                    00047 011 *        JOHN ARKLEY            *
                    00048 012 *         DEC 1980              *
                    00049 013 *                               *
                    00050 014 *********************************
                    00051 015             SKP 2
                    00052 016 *********************************
                    00053 017 *                               *
                    00054 018 *  DOS 3.3 REVISION B PATCHES   *
                    00055 019 *   INSTALLED BY MARK HOUDE     *
                    00056 020 *          JUL 1982             *
                    00057 021 *                               *
                    00058 022 *********************************
                    00059 023             SKP 2
                    00060 024 *********************************
                    00061 025 *                               *
                    00062 026 *  DOS 3.3 REV B PATCHES VER 2  *
                    00063 027 *   INSTALLED BY FERN BACHMAN   *
                    00064 028 *          SEP 1982             *
                    00065 029 *                               *
                    00066 030 *********************************
                    00067 031             SKP 2
                    00068 032 *********************************
                    00069 033 *                               *
                    00070 034 *    DOS33C PATCHES (APPEND &amp;   *
                    00071 035 *     UPPER/LOWER CASE CHECK)   *
                    00072 036 *                               *
                    00073 037 *            BY                 *
                    00074 038 *        GUIL  BANKS            *
                    00075 039 *         1983                  *                           ; Note: Fixed EOL formatting in PDF
                    00076 040 *                               *
                    00077 041 *********************************
                    00078 042 ;
                    00079 043 ;EQUATES REQD TO FIND THINGS IN APPLE II
                    00080 044 ;
                    00081 045 <a class='f' name='SETVID'     >SETVID      </a>EQU $<span class='e'>FE93</span>                                       ; Monitor: 0 Ctrl-P
                    00082 046 <a class='f' name='SETKBD'     >SETKBD      </a>EQU $<span class='e'>FE89</span>                                       ; Monitor: 0 Ctrl-K
                    00083 047 <a class='d' name='PROMPT'     >PROMPT      </a>EQU $<span class='n'>33</span>         ; PROMPT CHAR
                    00084 048 <a class='d' name='OUTSW'      >OUTSW       </a>EQU $<span class='n'>36</span>         ; OUTPUT VECTOR SWITCH
                    00085 049 <a class='d' name='INSW'       >INSW        </a>EQU $<span class='n'>38</span>         ; INPUT VECTOR SWITCH
                    00086 050 <a class='d' name='ZPGWRK'     >ZPGWRK      </a>EQU $<span class='n'>40</span>         ; ZERO PAGE WORK CELL
                    00087 051 <a class='d' name='CNUM'       >CNUM        </a>EQU $<span class='n'>44</span>         ; CONVERTED NUMERIC             ; 16-bit input number
                    00088 052 <a class='d' name='LBUFF'      >LBUFF       </a>EQU $<span class='n'>200</span>        ; LINE BUFFER                   ; Keyboard buffer of 255 chars
                    00089 053 <a class='f' name='MULT'       >MULT        </a>EQU $<span class='e'>FB63</span>       ; MULT ROUTINE
<hr>                    00090 054 <a class='f' name='INPRT'      >INPRT       </a>EQU $<span class='e'>FE8B</span>       ; SET IN PORT                   ; === Page <a class="page" name="page111">111</a> ===
                    00091 055 <a class='f' name='OUTPTR'     >OUTPRT      </a>EQU $<span class='e'>FE95</span>       ; SET OUT PORT
                    00092 056 <a class='f' name='IBCHN'      >IBCHN       </a>EQU $<span class='e'>E836</span>       ; BASIC RUN                     ; Integer Basic
                    00093 057 <a class='d' name='IBLMEM'     >IBLMEM      </a>EQU $<span class='n'>4A</span>         ; BASIC LOW MEM                 ; Integer Basic
                    00094 058 <a class='d' name='IBHMEM'     >IBHMEM      </a>EQU $<span class='n'>4C</span>         ; INTEGER BASIC HIMEM           ; Integer Basic
                    00095 059 <a class='d' name='IBSOP'      >IBSOP       </a>EQU $<span class='n'>CA</span>         ; INTEGER BASIC START OF CGM    ; Integer Basic CGM ???
                    00096 060 <a class='f' name='IBBRK'      >IBBRK       </a>EQU $<span class='e'>E3E3</span>       ; BASIC BREAK                   ; Integer Basic
                    00097 061 <a class='f' name='IBGO'       >IBGO        </a>EQU $<span class='e'>E000</span>       ; BASIC ENTRY POINT             ; Integer Basic
                    00098 062 <a class='f' name='IBCONT'     >IBCONT      </a>EQU $<span class='e'>E003</span>       ; BASIC CONTINUE ENTRY POINT    ; Integer Basic
                    00099 063 <a class='d' name='IBSOV'      >IBSOV       </a>EQU $<span class='n'>CC</span>         ; BASIC START OF VARIABLES      ; Integer Basic
                    00100 064 <a class='d' name='ASSOP'      >ASSOP       </a>EQU $<span class='n'>67</span>         ; AS START OF PROGRAM           ; Applesoft Basic
                    00101 065 <a class='d' name='ASEOP'      >ASEOP       </a>EQU $<span class='n'>AF</span>         ; AS END OF PROGRAM             ; Applesoft Basic
                    00102 066 <a class='d' name='ASEOP2'     >ASEOP2      </a>EQU $<span class='n'>69</span>         ; AS END-OF PGM 2               ; Applesoft Basic
                    00103 067 <a class='d' name='ASHM1'      >ASHM1       </a>EQU $<span class='n'>73</span>         ; AS HIGH MEM 1                 ; Applesoft Basic
                    00104 068 <a class='d' name='ASHM2'      >ASHM2       </a>EQU $<span class='n'>6F</span>         ; AS HIGH MEM 2                 ; Applesoft Basic
                    00105 069 <a class='d' name='ASRNX'      >ASRNX       </a>EQU $<span class='n'>D6</span>         ;AS RUN-ONLY FLAG               ; Applesoft Basic
                    00106 070 <a class='d' name='ASONERR'    >ASONERR     </a>EQU $<span class='n'>D8</span>         ;AS ON-ERR GOTO FLAG            ; Applesoft Basic
                    00107 071 <a class='d' name='ASLMEM'     >ASLMEM      </a>EQU <a class='v' href='#ASSOP'>ASSOP</a>       ; AS LOW MEM                    ; Applesoft Basic
                    00108 072 <a class='f' name='ASBRK1'     >ASBRK1      </a>EQU $<span class='e'>D865</span>       ; AS ROM BREAK                  ; Applesoft Basic
                    00109 073 <a class='f' name='ASBRK2'     >ASBRK2      </a>EQU $<span class='n'>1067</span>       ; AS RAM BREAK                  ; Applesoft Basic
                    00110 074 <a class='f' name='ASCNTU1'    >ASCNTU1     </a>EQU $<span class='e'>D43C</span>                                       ; ROM entry point
                    00111 075 <a class='f' name='ASCNTU2'    >ASCNTU2     </a>EQU $<span class='n'>C3C</span>                                        ; RAM entry point
                    00112 076 <a class='f' name='ASRSEQ1'    >ASRSEQ1     </a>EQU $<span class='e'>D4F2</span>                                       ; ROM entry point
                    00113 077 <a class='f' name='ASRSEQ2'    >ASRSEQ2     </a>EQU $<span class='n'>CF2</span>                                        ; RAM entry point
                    00114 078 <a class='f' name='AITSTL'     >AITSTL      </a>EQU $<span class='e'>E000</span>       ; AS 1 IB TEST LOC              ; Applesoft Basic E000: JMP $F128
                    00115 079 <a class='e' name='ATSTV'      >ATSTV       </a>EQU $<span class='n'>4C</span>         ; AS TEST VALUE                 ; Applesoft Basic
                    00116 080 <a class='e' name='ITSTV'      >ITSTV       </a>EQU $<span class='n'>20</span>         ; IB TEST VALUE                 ; Integer Basic
                    00117 081 <a class='d' name='BOOTSL'     >BOOTSL      </a>EQU $<span class='n'>2E</span>         ; BOOT FROM SLOT                ; Slot from Boot
                    00118 082 <a class='d' name='ZPGFCB'     >ZPGFCB      </a>EQU $<span class='n'>42</span>         ; ZERO PAGE WORK CELL           ; File Control Block
                    00119 083 <a class='f' name='MONRST'     >MONRST      </a>EQU $<span class='e'>FF65</span>       ;MONITOR RESET ENTRY
                    00120 084 <a class='f' name='MONBRK'     >MONBRK      </a>EQU $<span class='e'>FA59</span>       ;MONITOR BREAK ENTRY
                    00121 085 <a class='f' name='IORTS'      >IORTS       </a>EQU $<span class='e'>FF58</span>       ;KNOWN RTS IN MONITOR ROM
                    00122 086 <a class='f' name='HOME'       >HOME        </a>EQU $<span class='e'>FC58</span>                                       ; cls(); Clear the text screen
                    00123 087 <a class='f' name='PRINT'      >PRINT       </a>EQU $<span class='e'>FDED</span>                                       ; putchar();
                    00124 088 <a class='f' name='GETKEY'     >GETKEY      </a>EQU $<span class='e'>FD0C</span>                                       ; getchar();
                    00125 089 <a class='f' name='INSDS2'     >INSDS2      </a>EQU $<span class='e'>F88E</span>                                       ; Instruction Disassembly Opcode Length
                    00126 090 <a class='d' name='LENGTH'     >LENGTH      </a>EQU $<span class='n'>2F</span>
                    00127 091 <a class='d' name='ZRSET'      >ZRSET       </a>EQU $<span class='n'>3F2</span>        ;NEW MONITOR ROM RESET VECTOR
                    00128 092 <a class='d' name='PWCNST'     >PWCNST      </a>EQU $<span class='n'>3F4</span>        ;NEW MONITOR ROM POWER UP CONSTANT
                    00129 093                 REP 40
                    00130 094 *
                    00131 095 *
                    00132 096             ORG <a class="x" href="#ORIGIN">ORIGIN</a>
                    00133 097 *
                    00134 098 *
                    00135 099             REP 40
                    00136 100             PAGE
1B00:4C 84 1D       00137 101 <a class='f' name='BEGIN'   >BEGIN       </a>JMP <a class='x' href='#DBINIT'>DBINIT</a>                                      ; === DOS loads @ $1B00 ===
                    00138 102 ;                                                           ; Loaded in at $38D4
                    00139 103 <a class='f' name='DOSREL'  >DOSREL      </a>EQU *                                           ; Called from File <a class='file' href='#BOOTLDR'>BOOTLDR</a>, Page <a class='page' href='#page12'>12</a>, Line #<a class='line' href='#BOOTLDR.298'>298</a>
                    00140 104 ;
                    00141 105 ; GET RELOCATION PARMS
                    00142 106 ;
                    00143 107 <a class="f" name="DR0"     >DR0         </a>EQU *
                    00144 108 <a class="d" name="LOC1"    >LOC1        </a>EQU $<span class='n'>26</span>                                         ; Monitor ROM GBASL = $26, Pointer to last HGR Byte plotted
1B03:A9 BF          00145 109             LDA #$<span class='n'>BF</span>        ; START AT BF00                 ; Top of 48K
1B05:85 41          00146 110             STA <a  class='v' href='#ZPGWRK' >ZPGWRK</a>+1    ; TO LOOK FOR                   ; ZPGWRK = MemTestAdr
1B07:A2 00          00147 111             LDX #<span class='n'>0</span>          ; HIGH RAM
1B09:86 40          00148 112             STX <a  class='v' href='#ZPGWRK' >ZPGWRK</a>
1B0B:A0 00          00149 113 <a class="f" name="DR0A"    >DR0A        </a>LDY #<span class='n'>0</span>          ; APPLE TEST
                    00150 114 <a class="f" name="DR1B"    >DR1B        </a>EQU *                                           ; unused label
1B0D:A1 40          00151 115             LDA (<a class='v' href='#ZPGWRK' >ZPGWRK</a>,X)
1B0F:85 26          00152 116             STA <a  class='v' href='#LOC1'   >LOC1</a>                                        ; LOC1 = MemTestVal
<hr>1B11:98             00153 117 <a class="f" name="DR1"         >DR1         </a>TYA                                             ; === Page <a class="page" name="page112">112</a> ===
1B12:45 26          00154 118             EOR <a  class='v' href="#LOC1"   >LOC1</a>
1B14:85 26          00155 119             STA <a  class='v' href="#LOC1"   >LOC1</a>
1B16:98             00156 120             TYA
1B17:41 40          00157 121             EOR (<a class='v' href="#ZPGWRK" >ZPGWRK</a>,X)
1B19:81 40          00158 122             STA (<a class='v' href="#ZPGWRK" >ZPGWRK</a>,X)
1B1B:C5 26          00159 123             CMP <a  class='v' href="#LOC1"   >LOC1</a>
1B1D:D0 05          00160 124             BNE <a  class='x' href="#DR1A"   >DR1A</a>                                        ; &darr;   /rant Crappy HTML name <span class='macro'>&amp;darr;</span> instead of simpler \v
1B1F:C8             00161 125             INY
1B20:D0 EF          00162 126             BNE <a  class='x' href="#DR1"    >DR1</a>                                         ; &uarr;   /rant Crappy HTML name <span class='macro'>&amp;uarr;</span> instead of simpler \^
1B22:F0 04          00163 127             BEQ <a  class='x' href="#DR2"    >DR2</a>         ; BR IF TOOK                    ; v
                    00164 128 <a class="f" name="DR1A"        >DR1A        </a>EQU *
1B24:C6 41          00165 129             DEC <a  class='v' href="#ZPGWRK" >ZPGWRK</a>+<span class='n'>1</span>    ; NOT RAM
1B26:D0 E3          00166 130             BNE <a  class='x' href="#DR0A"   >DR0A</a>        ; TRY NEXT PAGE                 ; ^
                    00167 131 ;
                    00168 132 <a class="f" name="DR2"         >DR2         </a>EQU *
                    00169 133 ;
1B28:A5 41          00170 134             LDA <a  class='v' href="#ZPGWRK" >ZPGWRK</a>+<span class='n'>1</span>    ;BEGIN PATCH TO INSURE   *****  ; note: '*****' is BEGIN_PATCH
1B2A:29 DF          00171 135             AND #$<span class='n'>DF</span>        ; PROPER HIGH MEMORY CHECK.
1B2C:85 43          00172 136             STA <a  class='v' href="#ZPGFCB" >ZPGFCB</a>+<span class='n'>1</span>    ;(DOS MASTER 3.1 CONTAINS
1B2E:86 42          00173 137             STX <a  class='v' href="#ZPGFCB" >ZPGFCB</a>      ; THIS ROUTINE STARTING AT LOCATION
1B30:A1 42          00174 138             LDA (<a class='v' href="#ZPGFCB" >ZPGFCB</a>,X)  ; $3540)
1B32:48             00175 139             PHA
1B33:85 26          00176 140             STA <a  class="v" href="#LOC1">LOC1</a>        ;SAVE TEST VALUE
1B35:98             00177 141 <a class="f" name="DR2A"        >DR2A        </a>TYA             ;(FIRST TIME Y=0)
1B36:45 26          00178 142             EOR <a  class="v" href="#LOC1"   >LOC1</a>        ;TEST EACH (ALLEDGED) MEMORY BYTE
1B38:85 26          00179 143             STA <a  class="v" href="#LOC1"   >LOC1</a>        ; 256 TIMES TO DETERMINE IF
1B3A:98             00180 144             TYA             ; IT IS REALLY GOOD MEMORY AND
1B3B:41 40          00181 145             EOR (<a class="v" href="#ZPGWRK">ZPGWRK</a>,X)  ; MIRRORED 8K LOWER IN RAM.
1B3D:81 42          00182 146             STA (<a class="v" href="#ZPGFCB">ZPGFCB</a>,X)
1B3F:C5 26          00183 147             CMP <a  class="v" href="#LOC1"   >LOC1</a>        ;DID IT PASS THIS TIME?
1B41:D0 09          00184 148             BNE <a  class="x" href="#DR2B"   >DR2B</a>        ; BYTE NOT MIRRORED, THEN GOOD MEMORY   ; *sigh* more crap code: S-L-O-W
1B43:C8             00185 149             INY             ;MAYBE IT WAS COINCIDENCE               ; Instead of testing *every* byte (256 times WTF!)
1B44:D0 EF          00186 150             BNE <a  class="x" href="#DR2A"   >DR2A</a>        ; BRANCH UNLESS IT'S MATCHED 256 TIMES  ; just test the last byte of every page
1B46:A4 43          00187 <a class='line' name='RELOCTR.151'>151</a>             LDY <a class="v" href="#ZPGFCB" >ZPGFCB</a>+<span class='n'>1</span>    ;HIMEM IS 8K LOWER THEN WAS             ;        Switch PLA, LDY, then BNE instead
1B48:68             00188 152             PLA             ;ORIGINALLY THOUGHT!                    ;        since ZPGFCB can never be on mem page $00
1B49:4C 51 1B       00189 <a class='line' name='RELOCTR.153'>153</a>             JMP <a class="x" href="#DR2C"   >DR2C</a>                                                ; <a class='mem' name='_1B49'>wastes</a> 1 byte with JMP instead of BNE. See Line #<a class='line' href='#RELOCTR.151'>151</a>
1B4C:68             00190 154 <a class="f" name="DR2B"        >DR2B        </a>PLA             ; ORIGINAL HIMEM PROVED GOOD
1B4D:81 42          00191 155             STA (<a class="v" href="#ZPGFCB">ZPGFCB</a>,X)  ;RESTORE BYTE ORIGINALLY MESSED WITH.
1B4F:A4 41          00192 156             LDY <a class="v" href="#ZPGWRK" >ZPGWRK</a>+<span class='n'>1</span>    ;END OF PATCH   *****           ; ***** = END_PATCH
1B51:C8             00193 157 <a class="f" name="DR2C"        >DR2C        </a>INY             ; NEW END OF DOS                ; Y = $BF
1B52:8C 7D 1C       00194 158             STY <a class="v" href="#NEPAGE">NEPAGE</a>
1B55:38             00195 159             SEC
1B56:98             00196 160             TYA
1B57:ED 7E 1C       00197 161             SBC <a class='v' href="#DOSLNG">DOSLNG</a>      ; MINUS DOS LENGTH
1B5A:8D 7C 1C       00198 162             STA <a class='v' href="#NSPAGE">NSPAGE</a>      ; IS NEW START OF DOS
1B5D:38             00199 163             SEC
1B5E:ED 7A 1C       00200 164             SBC <a class='v' href="#RSPAGE">RSPAGE</a>      ; MINUS OLD DOS START
1B61:F0 9D          00201 165             BEQ <a class='x' href="#BEGIN" >BEGIN</a>       ; (BREIF NO DELTA)              ; ^ Giving the benefit of doubt; NOT misspelt: BRanch Equal If ?
1B63:8D 7F 1C       00202 166             STA <a class='v' href="#DELTA" >DELTA</a>       ; IS DELTA
1B66:AD 7A 1C       00203 167             LDA <a class='v' href="#RSPAGE">RSPAGE</a>      ; RESET START PAGE TO NORMAL
1B69:8D 0D 1D       00204 168             STA <a class='v' href="#ASTART">ASTART</a>+<span class='n'>1</span>
                    00205 169 ;
1B6C:A9 1D          00206 170             LDA #&lt;<a class="x" href="#DBINIT">DBINIT</a>    ; RESET PI RTN TO NORMAL        ; PI = Post Init; @ boot defaults to us, our relocator: <a class='x' href='#DOSREL'>DOSREL</a>
1B6E:8D 49 37       00207 171             STA <a class="x" href="#DI3">DI3</a>+<span class='n'>2</span>
1B71:A9 84          00208 172             LDA #&gt;<a class="x" href="#DBINIT">DBINIT</a>
1B73:8D 48 37       00209 173             STA <a class="x" href="#DI3">DI3</a>+<span class='n'>1</span>
                    00210 174 ;
                    00211 175 ;RELOCATE ADR TABLES
                    00212 176 ;
<hr>1B76:A2 00          00213 177             LDX #<span class='n'>0</span>                                          ; === Page <a class="page" name="page113">113</a> ===
1B78:86 40          00214 178             STX <a class='v' href='#ZPGWRK'>ZPGWRK</a>
                    00215 179 <a class="f" name="DR3"         >DR3         </a>EQU *
1B7A:BD 29 1C       00216 180             LDA <a class='v' href='#ADRTAB'>ADRTAB</a>+<span class='n'>1</span>,X                                  ; [StartLo] If only we had an ($BC) LDY ADRTAB+1,X instruction ...
1B7D:A8             00217 <a class='line' name='RELOCTR.181'>181</a>             TAY                                             ; <a class='mem' name='_1B7D'>wastes</a> 1 byte; ... to skip this useless instruction.
1B7E:BD 2A 1C       00218 182             LDA <a class='v' href='#ADRTAB'>ADRTAB</a>+<span class='n'>2</span>,X                                  ; [StartHi]      Oh wait, we do! /rhetorical Who knew!
1B81:85 41          00219 183             STA <a class='v' href='#ZPGWRK'>ZPGWRK</a>+<span class='n'>1</span>                                    ;                Evident code quality to come. :-/
1B83:4C 93 1B       00220 <a class='line' name='RELOCTR.184'>184</a>             JMP <a class='x' href='#DR5'>DR5</a>                                         ; <a class='mem' name='_1B83'>wastes</a> 1 byte instead of BNE; skip low address ptr
                    00221 185 ;                                                           ; See software was bloated in the "good ol' days" too. :-(
                    00222 186 <a class="f" name="DR4"         >DR4         </a>EQU *
1B86:18             00223 187             CLC
1B87:B1 40          00224 188             LDA (<a class='v' href='#ZPGWRK'>ZPGWRK</a>),Y
1B89:6D 7F 1C       00225 189             ADC <a class='v' href='#DELTA'>DELTA</a>
1B8C:91 40          00226 190             STA (<a class='v' href='#ZPGWRK'>ZPGWRK</a>),Y
1B8E:C8             00227 191             INY                                             ; Line #<a class='line' href='#RELOCTR.203'>203</a>
1B8F:D) 02          00228 192             BNE <a class='x' href='#DR5'>DR5</a>
1B91:E6 41          00229 193             INC <a class='v' href='#ZPGWRK'>ZPGWRK</a>+<span class='n'>1</span>
1B93:C8             00230 194 <a class="f" name="DR5"         >DR5         </a>INY
1B94:D0 02          00231 195             BNE <a class='x' href='#DR6'>DR6</a>
1B96:E6 41          00232 196             INC <a class='v' href='#ZPGWRK'>ZPGWRK</a>+<span class='n'>1</span>
                    00233 197 ;
                    00234 198 <a class="f" name="DR6"         >DR6         </a>EQU *
1B98:A5 41          00235 199             LDA <a class='v' href='#ZPGWRK'>ZPGWRK</a>+<span class='n'>1</span>
1B9A:DD 2C 1C       00236 200             CMP <a class='v' href='#ADRTAB'>ADRTAB</a>+<span class='n'>4</span>,X                                  ; [EndHi] Crappy array offset, see comments starting on Line #<a class='line' href='#RELOCTR.286'>286</a>
1B9D:90 E7          00237 201             BCC <a class='x' href='#DR4'>DR4</a>
1B9F:98             00238 202             TYA
1BA0:DD 2B 1C       00239 <a class='line' name='RELOCTR.203'>203</a>             CMP <a class='v' href='#ADRTAB'>ADRTAB</a>+<span class='n'>3</span>,X                                  ; [EndLo]
1BA3:90 E1          00240 204             BCC <a class='x' href='#DR4'>DR4</a>
                    00241 205 ;
1BA5:8A             00242 206             TXA
1BA6:18             00243 207             CLC
1BA7:69 04          00244 208             ADC #<span class='n'>4</span>                                          ; 4 bytes per entry: {StartAdr,EndAdr}
1BA9:AA             00245 209             TAX
1BAA:EC 28 1C       00246 <a class='line' name='RELOCTR.210'>210</a>             CPX <a class='v' href='#ADRTAB'>ADRTAB</a>                                      ; Done all bytes?
1BAD:90 CB          00247 211             BCC <a class='x' href='#DR3'>DR3</a>
                    00248 212             PAGE
                    00249 213 ;
                    00250 214 ;RELOCATE CODE
                    00251 215 ;
1BAF:A2 00          00252 216             LDX #<span class='n'>0</span>
1BB1:8E 9C 33       00253 217 <a class="f" name="DR7"         >DR7         </a>STX <a class="v" href="#TEMP1">TEMP1</a>
                    00254 218 ;
1BB4:BD 5A 1C       00255 219             LDA <a class="v" href="#CDETAB">CDETAB</a>+<span class='n'>1</span>,X  ; GET A START OF CODE ADR
1BB7:85 40          00256 220             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>      ; PUT IN ZPG
1BB9:BD 5B 1C       00257 221             LDA <a class="v" href="#CDTAB" >CDETAB</a>+<span class='n'>2</span>,X
1BBC:85 41          00258 222             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>+<span class='n'>1</span>
                    00259 223 ;
1BBE:A2 00          00260 224 <a class="f" name="DR8"         >DR8         </a>LDX #<span class='n'>0</span>          ; GET OP CODE
1BC0:A1 40          00261 225             LDA (<a class="v" href="#ZPGWRK">ZPGWRK</a>,X)  ; GO FIND OUT HOW LONG          ; Since we don't have a linker, interesting hack of using
1BC2:20 8E F8       00262 226             JSR <a class="x" href="#INSDS2">INSDS2</a>                                      ; monitor ROM to get instruction opcode length
                    00263 227 ;
1BC5:A4 2F          00264 228             LDY <a  class="v" href="#LENGTH">LENGTH</a>      ; GET HOW LONG                  ; crappy var name -- length of what?? Oh OPCODE_LEN
1BC7:C0 02          00265 229             CPY #<span class='n'>2</span>          ; IF IT AIN'T                   ; *sigh* #3-1 is clearer since zero based
1BC9:D0 11          00266 230             BNE <a  class="x" href="#DR9"   >DR9</a>         ; 3 THEN DON'T RELOC            ; 300:A9 20 20 8E F8 A5 2F 09 30 4C ED FD
1BCB:B1 40          00267 231             LDA (<a class="v" href="#ZPGWRK">ZPGWRK</a>),Y  ; GET PAGE FROM INST
1BCD:CD 7A 1C       00268 232             CMP <a  class="v" href="#RSPAGE">RSPAGE</a>      ; IF PAGE &lt; REL START
1BD0:90 0A          00269 233             BCC <a  class="x" href="#DR9"   >DR9</a>         ; THEN  IGNOR
1BD2:CD 7B 1C       00270 234             CMP <a  class="v" href="#REPAGE">REPAGE</a>      ; IF PAGE &gt;= REL END
1BD5:B0 05          00271 235             BCS <a  class="x" href="#DR9"   >DR9</a>         ; THEN IGNORE
1BD7:6D 7F 1C       00272 236             ADC <a class="v" href="#DELTA">DELTA</a>       ; ELSE ADD DELTA
1BDA:91 40          00273 237             STA (<a class="v" href="#ZPGWRK">ZPGWRK</a>),Y  ; TO RELOCATE
                    00274 238 ;
1BDC:38             00275 239 <a class="f" name="DR9"         >DR9         </a>SEC
<hr>1BDD:A5 2F          00276 240             LDA <a class="v" href="#LENGTH">LENGTH</a>      ; ADD LENGTH                    ; === Page <a class='page' name='page114'>114</a> ===
1BDF:65 40          00277 241             ADC <a class="v" href="#ZPGWRK">ZPGWRK</a>      ; TO PC
1BE1:95 40          00278 242             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>
1BE3:A9 00          00279 243             LDA #<span class='n'>0</span>
1BE5:65 41          00280 244             ADC <a class="v" href="#ZPGWRK">ZPGWRK</a>+<span class='n'>1</span>
1BE7:85 41          00281 245             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>+<span class='n'>1</span>
                    00282 246 ;
1BE9:AE 9C 33       00283 247             LDX <a class="v" href="#TEMP1">TEMP1</a>       ; CHECK FOR END
1BEC:DD 5D 1C       00284 248             CMP <a class="v" href="#CDETAB">CDETAB</a>+<span class='n'>4</span>,X  ; OF CODE SEGMENT
1BEF:90 CD          00285 249             BCC <a class="x" href="#DR8">DR8</a>         ; BR NOT END
1BF1:A5 40          00286 250             LDA <a class="v" href="#ZPGWRK">ZPGWRK</a>
1BF3:DD 5C 1C       00287 251             CMP <a class="v" href="#CDTAB">CDETAB</a>+<span class='n'>3</span>,X
1BF6:90 C6          00288 252             BCC <a class="x" href="#DR8">DR8</a>         ; BR NOT END
                    00289 253 ;
1BF8:8A             00290 254             TXA
1BF9:18             00291 255             CLC
1BFA:69 04          00292 256             ADC #<span class='n'>04</span>         ; INCREMENT TABLE INDEX
1BFC:AA             00293 257             TAX
1BFD:EC 59 1C       00294 258             CPX <a class="x" href="#CDETAB">CDETAB</a>      ; DONE
1C00:90 AF          00295 259             BCC <a class="x" href="#DR7">DR7</a>         ; BR IF NOT                     ; === <a class='ts' href='#T0SB'>T0SB</a> ===
                    00296 260 ;
                    00297 261             PAGE
                    00298 262 ;
                    00299 263 ;MOVE TO RELOCATED CODE
                    00300 264 ;
1C02:A9 3F          00301 265             LDA #&lt;<a class="v" href="#ENDOFDOS">ENDOFDOS</a>-$80
1C04:85 41          00302 266             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>+<span class='n'>1</span>    ; ZPGWRK=FROM
1C06:AC 7D 1C       00303 267             LDY <a class="v" href="#NEPAGE">NEPAGE</a>
1C09:88             00304 268             DEY
1C0A:84 43          00305 269             STY <a class="v" href="#ZPGFCB">ZPGFCB</a>+<span class='n'>1</span>    ; ZPGFCB = TOO
1C0C:A9 00          00306 <a class='line' name='RELOCTR.270'>270</a>             LDA #<span class='n'>0</span>                                          ; /sarcasm If only we had a LDY #0 instruction ...
1C0E:85 40          00307 271             STA <a class="v" href="#ZPGWRK">ZPGWRK</a>
1C10:85 42          00308 272             STA <a class="v" href="#ZPGFCB">ZPGFCB</a>
1C12:A8             00309 <a class='line' name='RELOCTR.273'>273</a>             TAY                                             ; <a class='mem' name='_1C12'>wastes</a> 1 byte; ... to remove this one. See Line #<a class='line' href='#RELOCTR.270'>270</a>
                    00310 274 ;
1C13:B1 40          00311 275 <a class="f" name="DR10"       id="DR10"       >DR10        </a>LDA (<a class="v" href="#ZPGWRK">ZPGWRK</a>),Y  ; BYTE FROM
1C15:91 42          00312 276             STA (<a class="v" href="#ZPGFCB">ZPGFCB</a>),Y  ; BYTE  TO
1C17:C8             00313 277             INY             ; INCREMENT                     ; /sarcasm No shit, Sherlock
1C18:D0 F9          00314 278             BNE <a class="x" href="#DR10">DR10</a>        ; BR NOT FULL PAGE
1C1A:CE 80 1C       00315 279             DEC <a class="v" href="#DPGCNT">DPGCNT</a>      ; DECREMENT PAGE CNT
1C1D:F0 06          00316 280             BEQ <a class="x" href="#DR11"  >DR11</a>        ; BR IF DONE
1C1F:C6 41          00317 281             DEC <a class="v" href="#ZPGWRK">ZPGWRK</a>+<span class='n'>1</span>    ; INC FROM PAGE
1C21:C6 43          00318 282             DEC <a class="v" href="#ZPGFCB">ZPGFCB</a>+<span class='n'>1</span>    ; INC TOO PAGE
1C23:D0 EE          00319 283             BNE <a class="x" href="#DR10">DR10</a>        ; MOVE PAGE
                    00320 284 ;
1C25:4C 54 1E       00321 285 <a class="f" name="DR11" id="DR11"       >DR11        </a>JMP <a class="x" href="#DBVECT">DBVECT</a>+<span class='n'>3</span>    ; DONE                          ; <a class="file" href="#DOSINIT">DOSINIT</a>, Page <a class="page" href="#page51">51</a> -&gt; JMP <a class="x" href="#DBINIT">DBINIT</a>
                    00322 <a class='line' name='RELOCTR.286'>286</a>             PAGE
                                                                                          ; This is <b>really crappy table formatting</b> due to 2 reasons:
                                                                                          ; 1) A redundant +1 offset is needed for "almost all"(*) offsets in code
                                                                                          ;    since the length of the array doesn't have its own label:
                                                                                          ;
                                                                                          ;        ADRTABLEN DFB 9*4      ; <b>Poor Solution</b>: but better then original
                                                                                          ;
                                                                                          ; (*) "almost all" means all except one when the length IS checked on Line #<a class='line' href='#RELOCTR.210'>210</a>
                                                                                          ;
                                                                                          ; 2) The start and end address are not on a single line
                                                                                          ;    with <i>no visual indicators</i> to tell what is the start or end address
                                                                                          ;    This makes it extremely hard to tell which addresses belong to
                                                                                          ;    which entry.  I've added the array offset [#] to make the original code
                                                                                          ;    more readable.
                                                                                          ;    <b>Better Solution</b>: Place each <b>entry</b> on a single line
                                                                                          ;    along with the correct half-open range interval notation [,)
                                                                                          ;    then each block of memory to relocate becomes very crystal clear:
                                                                                          ;
                                                                                          ;        ;         [Start, End)
                                                                                          ;        ADRTAB  DW SAT1 , EAT1
                                                                                          ;                DW RUN  , RUN
                                                                                          ;                DW IBVT , IBVT
                                                                                          ;                DW AS1VT, AS1VT
                                                                                          ;
                                                                                          ;    <b>Best Solution</b>: Even better would be to use <i>two labels</i>
                                                                                          ;    offset by two bytes to simulate two struct member variables:
                                                                                          ;
                                                                                          ;        ADRTABS DW SAT1        ; Start Address
                                                                                          ;        ADRTABE DW        EAT  ; End Address
                                                                                          ;                DW RUN  , RUN
                                                                                          ;                DW IBVT , IBVT
                                                                                          ;                DW AS1VT, AS1VT
                                                                                          ;
                                                                                          ;    While the second's line formatting, ADRTABE, is a little unorthodox
                                                                                          ;    using dual labels makes the array offsets obvious compared to
                                                                                          ;    the original non-descript code:
                                                                                          ;
                                                                                          ;        LDY ADRTABS+0,X    ; lo byte of start address; was LDA ADRTAB+1,X
                                                                                          ;        LDA ADRTABS+1,X    ; hi byte of start address; was LDA ADRTAB+2,X
                                                                                          ;        CMP ADRTABE+1,X    ; hi byte of end   address; was CMP ADRTAB+4,X
                                                                                          ;        CMP ADRTABE+0,X    ; lo byte of end   address; was CMP ADRTAB+3,X
                                                                                          ;
1C28:24             00323 287 <a class='d' name='ADRTAB'     id='ADRTAB'     >ADRTAB      </a>DFB <span class='n'>9</span>*<span class='n'>4</span>                                         ; <a class='magic' name='_1C28'>magic number</a> <i>Really?!</i> We can't do <span class='macro'>ADRTAB_LEN DFB ADRTAB_END - ADRTAB_START</span> ???
1C29:00 1D          00324 288             DW  <a class="v" href="#SAT1"  >SAT1   </a>                                     ; [0] Start Address Table 1 in <a class="x" href="#DOSINIT">DOSINIT</a>
1C2B:56 1D          00325 289             DW  <a class="v" href="#EAT1"  >EAT1   </a>                                     ;     End   Address Table 1
                                                                                          ;     <a class='mem' name='_1C2D'>wastes</a> 4 bytes due to non-contiguous memory
                                                                                          ;     $1D56, $1D57 = <a class='v' href='#CHAIN' >CHAIN</a>
                                                                                          ;     Solution would be to add our own stub of 3 bytes
                                                                                          ;         DOS_CHAIN_IB: JMP $E836
1C2D:58 1D          00326 <a class='line' name='RELOCTR.290'>290</a>             DW  <a class="v" href="#RUN"   >RUN    </a>                                     ; [1] Allowing us to remove 4 bytes from the table: end[0], start[1]
1C2F:5A 1D          00327 291             DW  <a class="v" href="#RUN"   >RUN</a>+<span class='n'>2</span>                                       ;     Further optimization would remove 10 bytes (5 entries)
1C31:64 1D          00328 <a class='line' name='RELOCTR.292'>292</a>             DW  <a class="v" href="#IBVT"  >IBVT</a>+<span class='n'>2</span>                                      ; [2] Integer Basic Vector Table
1C33:66 1D          00329 293             DW  <a class="v" href="#IBVT"  >IBVT</a>+<span class='n'>4</span>                                      ;
1C35:6C 1D          00330 <a class='line' name='RELOCTR.294'>294</a>             DW  <a class="v" href="#AS1VT" >AS1VT  </a>                                     ; [3] Applesoft (ROM) Vector Table
1C37:70 1D          00331 295             DW  <a class="v" href="#AS1VT" >AS1VT</a>+<span class='n'>4</span>
1C39:78 1D          00332 <a class='line' name='RELOCTR.296'>296</a>             DW  <a class="v" href="#AS2VT" >AS2VT  </a>                                     ; [4] Applesoft (RAM) Vector Table
1C3B:7C 1D          00333 297             DW  <a class="v" href="#AS2VT" >AS2VT</a>+<span class='n'>4</span>
1C3D:7E 1D          00334 <a class='line' name='RELOCTR.298'>298</a>             DW  <a class="v" href="#AS2VT" >AS2VT</a>+<span class='n'>6</span>                                     ; [5] Applesoft (RAM) Vetor Table
1C3F:80 1D          00335 299             DW  <a class="v" href="#AS2VT" >AS2VT</a>+<span class='n'>8</span>
1C41:C1 2A          00336 300             DW  <a class="v" href="#SAT2"  >SAT2   </a>                                     ; [6] Start Address Table 2 in <a class="x" href="#FDOSENT">FDOSENT</a>
1C43:FD 2A          00337 301             DW  <a class="v" href="#EAT2"  >EAT2   </a>
1C45:E4 37          00338 302             DW  <a class="v" href="#BAIOB" >BAIOB  </a>                                     ; [7]
<hr>1C47:E8 37          00339 303             DW  <a class="v" href="#">ADOSLD</a>+<span class='n'>2</span>                                    ; === Page <a class="page" name="page115">115</a> ===
1C49:EE 37          00340 304             DW  <a class="v" href="#IBDCTP">IBDCTP </a>                                     ; [8]
1C4B:F0 37          00341 305             DW  <a class="v" href="#IBDCTP">IBDCTP</a>+<span class='n'>2</span>
1C4D:00 00 00 00    00342 <a class='line' name='RELOCTR.306'>306</a>             DFB <span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>                                     ; <a class='mem' name="_1C4D">wastes</a> 12 bytes -- never referenced !
1C51:00 00 00 00    00343 307             DFB <span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>
1C55:00 00 00 00    00344 308             DFB <span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>,<span class='n'>0</span>
                    00345 309 <a class="d"    name="CDETAB"     id="CDETAB"     >CDETAB      </a>EQU *                                           ; 1C59:1C = v1980, 20 = v1983
1C59:20             00346 310             DFB <span class='n'>8</span>*<span class='n'>4</span>                                         ; <a class='magic' name='_1C28'>magic number</a> <i>Really?!</i> We can't do <span class='macro'>CDETAB_LEN DFB CDETAB_END - CDETAB_START</span> ???
1C5A:84 1D          00347 311             DW  <a class="x" href="#SC1"   >SC1   </a>                                      ; [0]
1C5C:84 28          00348 312             DW  <a class="x" href="#EC1"   >EC1   </a>
1C5E:FD 2A          00349 313             DW  <a class="x" href="#SC2"   >SC2   </a>                                      ; [1]
1C60:97 33          00350 314             DW  <a class="x" href="#EC2"   >EC2   </a>
1C62:5D 36          00351 315             DW  <a class="x" href="#SC3"   >SC3   </a>                                      ; [2]
1C64:E0 37          00352 316             DW  <a class="x" href="#EC3"   >EC3   </a>
1C66:56 3C          00353 317             DW  <a class="x" href="#SWADR1">SWADR1</a>                                      ; [3]
1C68:DF 3C          00354 318             DW  <a class="x" href="#EWADR1">EWADR1</a>
1C6A:00 38          00355 319             DW  <a class="x" href="#ASC1"  >ASC1  </a>                                      ; [4]
1C6C:11 3A          00356 320             DW  <a class="x" href="#AEC1"  >AEC1  </a>
1C6E:69 3A          00357 321             DW  <a class="x" href="#PSC1"  >PSC1  </a>                                      ; [5]
1C70:94 3A          00358 322             DW  <a class="x" href="#PEC1"  >PEC1  </a>
1C72:00 3D          00359 323             DW  <a class="x" href="#ASC2"  >ASC2  </a>                                      ; [6]
1C74:A8 3F          00360 324             DW  <a class="x" href="#AEC2"  >AEC2  </a>
1C76:C8 3F          00361 325             DW  <a class="x" href="#SDP1"  >SDP1  </a>                                      ; [7] Start Dos Patch
1C78:FF 3F          00362 326             DW  <a class="x" href="#EDP1"  >EDP1  </a>                                      ;     End   Dos Patch
1C7A:1D             00363 327 <a class="d" name="RSPAGE"     id="RSPAGE"     >RSPAGE      </a>DFB &lt;<a class="v" href="#START"   >START</a>                                      ; (Source) Relocation Start Page $1D00
1C7B:40             00364 328 <a class="d" name="REPAGE"     id="REPAGE"     >REPAGE      </a>DFB &lt;<a class="v" href="#ENDOFDOS">ENDOFDOS</a>                                   ; (Source) Relocation End+1 Page $4000, <a class='mem' name="_1C7B">wastes</a> 1 bytes; See <a class='v' href='#AEND'>AEND</a>
                    00365 329 ;
1C7C:00             00366 330 <a class="d" name="NSPAGE"     id="NSPAGE"     >NSPAGE      </a>DFB <span class='n'>0</span>
1C7D:00             00367 331 <a class="d" name="NEPAGE"     id="NEPAGE"     >NEPAGE      </a>DFB <span class='n'>0</span>
                    00368 332 ;
1C7E:23             00369 333 <a class="d" name="DOSLNG"     id="DOSLNG"     >DOSLNG      </a>DFB &lt;<a class="v" href="#ENDOFDOS">ENDOFDOS</a>-<a class="v" href="#START">START</a>
                    00370 334 ;
1C7F:00             00371 335 <a class="d" name="DELTA"      id="DELTA"      >DELTA       </a>DFB <span class='n'>0</span>
1C80:23             00372 336 <a class="d" name="DPGCNT"     id="DPGCNT"     >DPGCNT      </a>DFB &lt;<a class="v" href="#ENDOFDOS">ENDOFDOS</a>-<a class="v" href="#START">START</a>
                    00373 337             PAGE
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="DOSINIT">DOSINIT</a> - Command Tables and Interpreter, Page <a class="page" name="page48">48</a>, <a class='ts' href='#T0SB'>T0SB</a> - <a class='ts' href='#T0SD'>T0SD</a>, $<span class='n'>9C81</span> .. $<span class='n'>9E80</span> ===<hr class='join'><hr></div>
<pre>
                    001 <a class="d" name="HEREL"    >HEREL       </a>HEREL       EQU &gt;*                              ; === Page <a class='page' name='page48'>48</a> ===
                    002 <a class="d" name="REMDR"    >REMDR       </a>REMDR       EQU 256-<a class="v" href="#HEREL">HEREL</a>
1C81:FC FD FD       <a class='line' name='DOSINIT.103'>003</a>             ORG *+<a class="v" href="#REMDR">REMDR</a>                                     ; <a class='disk' name='_1C81'>disk</a> wastes 127 bytes padding to end of sector
1C84:FD FC FD FC                                                                    ; Technically only 82 bytes ($1CD3-$1C81 = $52) are wasted
1C88:FC FC FE FE                                                                    ; but <span class="macro">FTAB DW *-45</span> is sloppy code
1C8C:FC FE FC FC                                                                    ; Why isn't this "allocated" at run-time?
1C90:FD FE FC FF                                                                    ; Meaning this should be placed <b>after</b> ALL the code.
1C94:FC FD FC FC                                                                    ; See: <a class='dumb' href="#WastedDisk">Wasted Disk Space</a>
1C98:FC FF FC FF
1C9C:FC FE FF FF
1CA0:FF FF FD FE
1CA4:FC FD FC FC
1CA8:FC FC FD FC
1CAC:FE FE FE FC
1CB0:FD FF FC FC
1CB4:FC FE FC FD
1CB8:FC FC FC FE
1CBC:FC FD FC FC
1CC0:FC FD FC FD
1CC4:FD FC FC FC
1CC8:FD FD FC FE                                                                    ; ECLOSE, EDEL, EPOS, RWPOSN, CLOSFILE call 
1CCC:FC FC FE FC                                                                    ;   <a class="x" href="#FILSRC">FILSRC</a> (File Search)
1CD0:FC FD FD FC                                                                    ; [00] $1CD3 ($9CD3) Used by <a class="x" href="#TSINIT">TSINIT</a>, init @ Line #<a class='line' href='#BLDFTAB.036'>036</a>
1CD4:FF FE FC FC
1CD8:FC FC FD FC
1CDC:FD FE FC FC
1CE0:FD FC FF FC
1CE4:FE FF FF FF
1CE8:FD FC FE FE                                                                    ; See init @ <a class="x" href="#BFT1">BFT1</a>, Line #<a class='line' href='#BLDFTAB.041'>041</a>
1CEC:FC FC FE FC                                                                    ; [1E] $1CF1 ($9CF1): $9CA6 (buf1 ptr)
1CF0:FC FE FC FE                                                                    ; [20] $1CF3 ($9CF3): $9BA6 (buf2 ptr)
1CF4:FC FE FE FC                                                                    : [22] $1CF5 ($9CF5): $9AA6 (buf3 ptr)
1CF8:FE FE FC FC                                                                    ; $1CF8 Use by <a class="x" href="#TSNXT">TSNXT</a>
1CFC:FE FC FD FD
                    004 ;
                    005 ;RELOCATION TABLES
                    006 ;
                    007 <a class="d" name="START"      >START       </a>EQU *
                    008 <a class="d" name="SAT1"       >SAT1        </a>EQU *                                           ; Start Address Table 1 of relocation
1D00:D3 1C          009 <a class="d" name="FTAB"       >FTAB        </a>DW *-<span class='n'>45</span>                                         ; === <a class='ts' href='#T0SC'>T0SC</a> === $1CD3; Really?! Couldn't do <span class='code'>FTAB DS 45, 0</span>
1D02:81 1E          010 <a class="d" name="CINA"       >CINA        </a>DW <a class='x' href='#CHRIN' >CHRIN </a>
1D04:BD 1E          011 <a class="d" name="COUTA"      >COUTA       </a>DW <a class='x' href='#CHROUT'>CHROUT</a>
1D06:75 2A          012 <a class="d" name="FN1ADR"     >FN1ADR      </a>DW <a class='v' href='#FNAME1'>FNAME1</a>
1D08:93 2A          013 <a class="d" name="FN2ADR"     >FN2ADR      </a>DW <a class='v' href='#FNAME2'>FNAME2</a>
1D0A:60 2A          014 <a class="d" name="SVBLA"      >SVBLA       </a>DW <a class='v' href='#SVBL'  >SVBL  </a>
1D0C:00 1B          015 <a class="d" name="ASTART"     >ASTART      </a>DW <a class='x' href="#BEGIN" >BEGIN </a>
1D0E:BB 35          016 <a class="d" name="CCBADR"     >CCBADR      </a>DW <a class='v' href='#CCB'   >CCB   </a>
                    017 ;
                    018 <a class='d' name='OUTSVT'>OUTSVT      </a>EQU *           ; CHAR OUTPUT STATE VECTOR TABLE
1D10:EA 1E          019             DW <a class='x' href='#COS0'>COS0</a>-<span class='n'>1</span>
1D12:11 1F          020             DW <a class='x' href='#COS1'>COS1</a>-<span class='n'>1</span>
1D14:22 1F          021             DW <a class='x' href='#COS2'>COS2</a>-<span class='n'>1</span>
1D16:2E 1F          022             DW <a class='x' href='#COS3'>COS3</a>-<span class='n'>1</span>
1D18:51 1F          023             DW <a class='x' href='#COS4'>COS4</a>-<span class='n'>1</span>
1D1A:60 1F          024             DW <a class='x' href='#COS5'>COS5</a>-<span class='n'>1</span>
1D1C:70 1F          025             DW <a class='x' href='#COS6'>COS6</a>-<span class='n'>1</span>
                    026 ;COMMAND EXECUTION TABLE
                    027 <a class='d' name='CMDETB'>CMDETB      </a>EQU *                                           ; /sarcasm Yay for shitty 5 &amp; 6 letter var names!
1D1E:4E 25          028             DW <a class='x' href='#EINIT' >EINIT</a>-<span class='n'>1</span>                                      ; [0] Stupid 6502 design for RTS instruction forces <span class="macro">-1</span> for func jump table
1D20:12 24          029             DW <a class='x' href='#ELOAD' >ELOAD</a>-<span class='n'>1</span>                                      ; [1]
1D22:96 23          030             DW <a class='x' href='#ESAVE '>ESAVE</a>-<span class='n'>1</span>                                      ; [2]
1D24:D0 24          031             DW <a class='x' href='#ERUN'  >ERUN</a>-<span class='n'>1</span>                                       ; [3]
1D26:EF 24          032             DW <a class='x' href='#ECHAIN'>ECHAIN</a>-<span class='n'>1</span>                                     ; [4]
1D28:62 22          033             DW <a class='x' href='#EDEL'  >EDEL</a>-<span class='n'>1</span>                                       ; [5]
1D2A:70 22          034             DW <a class='x' href='#ELOCK' >ELOCK</a>-<span class='n'>1</span>                                      ; [6]
1D2C:74 22          035             DW <a class='x' href='#EUNLK' >EUNLK</a>-<span class='n'>1</span>                                      ; [7] /sarcasm Oh, noes! That 'OC' in 'unl<b>OC</b>k' is too much work to type!
1D2E:E9 22          036             DW <a class='x' href='#ECLOSE'>ECLOSE</a>-<span class='n'>1</span>                                     ; [8]
1D30:1A 25          037             DW <a class='x' href='#EREAD' >EREAD</a>-<span class='n'>1</span>                                      ; [9]
1D32:C5 25          038             DW <a class='x' href='#EEXEC' >EEXEC</a>-<span class='n'>1</span>                                      ; [A]
1D34:0F 25          039             DW <a class='x' href='#EWRITE'>EWRITE</a>-<span class='n'>1</span>                                     ; [B]
1D36:DC 25          040             DW <a class='x' href='#EPOS'  >EPOS</a>-<span class='n'>1</span>                                       ; [C]
1D38:A2 22          041             DW <a class='x' href='#EOPEN' >EOPEN</a>-<span class='n'>1</span>                                      ; [D]
1D3A:97 22          042             DW <a class='x' href='#EAPND' >EAPND</a>-<span class='n'>1</span>                                      ; [E]
1D3C:80 22          043             DW <a class='x' href='#EREN'  >EREN</a>-<span class='n'>1</span>                                       ; [F]
1D3E:6D 25          044             DW <a class='x' href='#ECAT'  >ECAT</a>-<span class='n'>1</span>                                       ;[10]
1D40:32 22          045             DW <a class='x' href='#EMON'  >EMON</a>-<span class='n'>1</span>                                       ;[11]
1D42:3C 22          046             DW <a class='x' href='#ENOMON'>ENOMON</a>-<span class='n'>1</span>                                     ;[12]
1D44:28 22          047             DW <a class='x' href='#EPR'   >EPR</a>-<span class='n'>1</span>                                        ;[13]
1D46:2D 22          048             DW <a class='x' href='#EIN'   >EIN</a>-<span class='n'>1</span>                                        ;[14]
1D48:50 22          049             DW <a class='x' href='#EMAXF' >EMAXF</a>-<span class='n'>1</span>                                      ;[15]
1D4A:79 25          050             DW <a class='x' href='#EAS'   >EAS</a>-<span class='n'>1</span>                                        ;[16]
1D4C:9D 25          051             DW <a class='x' href='#EINT'  >EINT</a>-<span class='n'>1</span>                                       ;[17]
1D4E:30 23          052             DW <a class='x' href='#EBSV'  >EBSV</a>-<span class='n'>1</span>                                       ;[18] *sigh* EBSAVE - I'm sorry, we blew our key budget for 'A'
1D50:5C 23          053             DW <a class='x' href='#EBLD'  >EBLD</a>-<span class='n'>1</span>                                       ;[19] *sigh* EBLOAD - and also 'O'
<hr>1D52:8D 23          054             DW <a class='x' href='#EBRUN'>EBRUN</a>-<span class='n'>1</span>                                      ;[1A] === Page <a class="page" name="page49">49</a> ===
1D54:7C 22          055             DW <a class='x' href='#EVAR'  >EVAR</a>-<span class='n'>1</span>                                       ;[1B] last byte relocated in Entry [<a class='line' href='#RELOCTR.292'>0</a>] <a class='v' href='#ADRTAB'>ADRTAB</a>
                    056 <a class='d' name='EAT1'>EAT1        </a>EQU *                                           ; End Address Table 1
                    057             PAGE
                    058 ;                                                           ; *note* Annotating [-] to mean <i>addresss is not relocated</i> in <a class='v' href='#ADRTAB'>ADRTAB</a>
                    059 ;NON-RELOCATING ADRS
                    060 ;                                                           ; Using <b>a</b>,b,c,d,e,f for abbreviated field names in IBASVT
                    061 <a class='d' name='IBASVT'>IBASVT      </a>EQU *                                           ; <i>ACTIVE</i> table but <a class='mem' name='_1D56'>waste</a> disk space (12 bytes @ $56) storing it!
1D56:36 E8          062 <a class='d' name='CHAIN' >CHAIN       </a>DW <a class='x' href='#IBCHN' >IBCHN </a>                                       ;<b>a</b>[-] Really? Forces <i>another</i> table entry [1] in <a class='v' href='#ADRTAB'>ADRTAB</a>
1D58:E5 24          063 <a class='d' name='RUN'   >RUN         </a>DW <a class='x' href='#IBRUN' >IBRUN </a>                                       ;b[<a class='line' href='#RELOCTR.290'>1</a>] Repeat after me: You **group**
1D5A:E3 E3          064 <a class='d' name='BREAK' >BREAK       </a>DW <a class='x' href='#IBBRK' >IBBRK </a>                                       ;c[-]     CONST data together THEN
1D5C:00 E0          065 <a class='d' name='GO'    >GO          </a>DW <a class='x' href='#IBGO'  >IBGO  </a>                                       ;d[-]     VARIABLE data together
1D5E:03 E0          066 <a class='d' name='CONT'  >CONT        </a>DW <a class='x' href='#IBCONT'>IBCONT</a>       ; BASIC CONT ENTRY POINT        ;e[-] You (almost) *never* interleave them
1D60:00 00          067 <a class='d' name='ASEQ'  >ASEQ        </a>DW <span class='n'>0</span>                                            ;f    that just leads to data+code bloat
                                                                                    ; *sigh* Too lazy to add a single empty ';' line seperator before IBVT ???
                                                                                    ; Intentionally adding an empty line as a spacer to improve readability *<b>shock</b>*
                                                                                    ;
                                                                                    ; *<span class='note'>note</span>* IBVT, AS1VT, and AS2VT are Read-Only (after being relocated to high mem.)
1D62:36 E8          068 <a class='d' name='IBVT'     >IBVT        </a>DW <a class='x' href='#IBCHN'>IBCHN</a>                                        ;<b>a</b>[-] Integer Basic Vector Table
1D64:E5 24          069             DW <a class='x' href='#IBRUN' >IBRUN </a>                                       ;b[<a class='line' href='#RELOCTR.292'>2</a>]
1D66:E3 E3          070             DW <a class='x' href='#IBBRK' >IBBRK </a>                                       ;c[-]
1D68:00 E0          071             DW <a class='x' href='#IBGO'  >IBGO  </a>                                       ;d[-]
1D6A:03 E0          072             DW <a class='x' href='#IBCONT'>IBCONT</a>                                       ;e[-]
                    073 <a class='d' name='IBVTL'    >IBVTL       </a>EQU *-<a class='v' href='#IBVT'>IBVT</a>                                      ; Length = $A bytes so we don't over-write ASEQ
                    074 ;                                                           ;     /sarcasm Because it is obvious
1D6C:FC 24          075 <a class="d" name="AS1VT"    >AS1VT       </a>DW <a class='x' href='#ASRUN1'>ASRUN1</a>                                       ;<b>a</b>[<a class='line' href='#RELOCTR.294'>3</a>]   1 = ROM, and
1D6E:FC 24          076             DW <a class='x' href='#ASRUN1' >ASRUN1 </a>                                      ;b[3]   2 = RAM, right?
1D70:65 D8          077             DW <a class='x' href='#ASBRK1' >ASBRK1 </a>                                      ;c[-]   ASCNTU1 (Continue) <a class='link' href='http://www.txbobsc.com/scsc/scdocumentor/D365.html'>S-C DocuMentor $D365</a>
1D72:00 E0          078             DW <a class='x' href='#IBGO'   >IBGO   </a>                                      ;d[-]   ASRSEQ1 (ResetQ???)
1D74:3C D4          079             DW <a class='x' href='#ASCNTU1'>ASCNTU1</a>                                      ;e[-] Why not IBCONT??? $E003: JMP $D43C ; Applesoft (Warm) <a class='link' href='http://jamtronix.com/files/applesoft.html#RESTART'  >RESTART</a> 
1D76:F2 D4          080             DW <a class='x' href='#ASRSEQ1'>ASRSEQ1</a>                                      ;f[-] Applesoft <a class='link' href='http://jamtronix.com/files/applesoft.html#FIX.LINKS'>FIX.LINKS</a>
                    081 <a class="d" name="AS1VTL"   >AS1VTL      </a>EQU *-<a class='v' href='#AS1VT'>AS1VT</a>
                    082 ;                                                           ; Copied into <a class="v" href="#IBASVT">IBASVT</a> via INIT_AS_RAM, oh wait, <a class='x' href='#INITC'>INITC</a>
1D78:06 25          083 <a class="d" name="AS2VT"    >AS2VT       </a>DW <a class="x" href="#ASRUN2">ASRUN2</a>                                       ;<b>a</b>[<a class='line' href='#RELOCTR.296'>4</a>] <a class='mem' name='_1D78'>wastes</a> 12 bytes on Apple ][+ or newer
1D7A:06 25          084             DW <a class="x" href="#ASRUN2" >ASRUN2 </a>                                      ;b[4] Type 2: AppleSoft in RAM Vector Table (early Apple 1 or ][ ???)
1D7C:67 10          085             DW <a class="x" href="#ASBRK2" >ASBRK2 </a>                                      ;c[-]
1D7E:84 1D          086             DW <a class="x" href="#DBINIT" >DBINIT </a>                                      ;d[<a class='line' href='#RELOCTR.298'>5</a>]
1D80:3C 0C          087             DW <a class="x" href="#ASCNTU2">ASCNTU2</a>                                      ;e    Continue (Warm Restart) and R*s*E*q ???
1D82:F2 0C          088             DW <a class="x" href="#ASRSEQ2">ASRSEQ2</a>                                      ;f    See Applesoft source Line #70 <a class='link' href='https://github.com/mist64/msbasic/blob/master/program.s#L70'>RESTART</a> and Line #270 <a class='link' href='https://github.com/mist64/msbasic/blob/master/program.s#L270'>FIX LINKS</a>
                    089 <a class="d" name="AS2VTL"   >AS2VTL      </a>EQU *-<a class="v" href="#AS2VT">AS2VT</a>
                    090             PAGE
                    091 ;
                    092 ; DOS BASIC INTERPRETER - INITIAL ENTRY
                    093 ;
                    094 <a class='f' name='SC1'      >SC1         </a>EQU *                                           ; Start Relocate Code 1
                    095 <a class='f' name='DBINIT'   >DBINIT      </a>EQU *                     ; DB = Dos Basic
1D84:AD E9 37       096             LDA <a class='v' href='#IBSLOT'>IBSLOT</a>      ; GET BOOT SLOT
1D87:4A             097             LSR A                                           ; /sarcasm Gee, maybe we wouldn't even <i>need</i> the next comment
1D88:4A             098             LSR A                                           ;          if we <b>used good variable names</b> such as CUR_SLOTx16
1D89:4A             099             LSR A                                           ;          but who would want that? Isn't it <i>obvious</i> that
1D8A:4A             100             LSR A                                           ;          CS means Current Slot * 16 !?
1D8B:8D 6A 2A       101             STA <a class='v' href='#CS'>CS</a>          ; SET AS CUURENT SLOT           ; *spelling* CURRENT
1D8E:AD EA 37       102             LDA <a class='v' href='#IBDRVN'>IBDRVN</a>      ; GET BOOT DRIVE NUMBER
1D91:8D 68 2A       <a class='line' name='DOSINIT.103'>103</a>             STA <a class='v' href='#CD'>CD</a>          ; SET AS CURRENT DRIVE
1D94:AD 00 E0       104             LDA <a class='v' href='#AITSTL'>AITSTL</a>      ; GET APPLESOFT/IB TEST         ; ATSTV= $4C, E000:4C = JMP $abs; Applesoft
1D97:49 20          105             EOR #<a class='v' href='#ITSTV'>ITSTV</a>      ; IF AS THEN
1D99:D0 11          106             BNE <a class='x' href='#IAS1'>IAS1</a>        ; GO TO AS INIT                 ;
                    107 ;                           ; ELSE INIT FOR IB
1D9B:8D B6 2A       108             STA <a class='v' href='#ASIBSW'>ASIBSW</a>      ; SET SW FOR IB                 ; <a class='magic' name='_1D9C'>magic number</a> BASIC_TYPE_INTEGER = $00
                                                                                    ;        30 = $1D9E .. $1DBB
                                                                                    ;        -5 = Don't count opcodes at Lines #117,118
                                                                                    ;       -18 = Replacement code at Line <a class='link' href='#DOSINIT.118.Solution'>118 Solution</a>
                                                                                    ;       ===
1D9E:A2 0A          <a class='line' name='DOSINIT.109'>109</a>             LDX #<a class='v' href='#IBVTL'>IBVTL</a>      ; GET IB VT LENGTH              ; <a class='mem' name='_1D9E'>wastes</a>  7 bytes
1DA0:BD 61 1D       110 <a class='f' name='IIB1'     >IIB1        </a>LDA <a class='v' href='#IBVT'>IBVT</a>-<span class='n'>1</span>,X    ; MOVE IB ADDR                  ; <b>Problem</b>: *sigh* due to IBVTL=$A != AS1VTL=$C
1DA3:9D 55 1D       111             STA <a class='v' href='#IBASVT'>IBASVT</a>-<span class='n'>1</span>,X                                  ;           we end up with <i>duplicate code</i> (**9 times**, er, 3 times!) to
1DA6:CA             112             DEX                                             ;           copy the BASIC Vector Table! (An array of function pointers)
1DA7:D0 F7          113             BNE <a class='x' href='#IIB1'>IIB1</a>                                        ;
1DA9:4C BC 1D       114             JMP <a class='x' href='#INITAA'>INITAA</a>                                      ; normally <a class='mem' name='#_1DA9'>wastes</a> 1 byte, BEQ INITAA; but see bigger optimization on Line #<a class='line' href='#DOSINIT.109'>109</a>
                    115 ;
                    116 <a class='f' name='IAS1'     >IAS1        </a>EQU *                                           ; IAS1 = Init Applesoft ROM; /cynical "<i>There will be a test</i>"
<hr>1DAC:A9 40          117             LDA #$<span class='n'>40</span>        ; INDICATE ROM APPLESOFT        ; === Page <a class='page' name='page50'>50</a> === <a class='magic' name='_1DAD'>magic number</a> BASIC_TYPE_APPLESOFT_ROM = $40
1DAE:8D B6 2A       118             STA <a class='v' href='#ASIBSW'>ASIBSW</a>                                      ; <b><a class='section' name='DOSINIT.118.Solution'>Solution</a></b>:
                                                                                    ;   a) Lines 117-118 should be moved <i>after</i> Line #<a class='line' href='#DOSINIT.103'>103</a> to <b>anticipate the common case</b>,
                                                                                    ;   b) This is one of those <b>rare times</b> where we <b>padd IBVT</b>
                                                                                    ;      (with 2 bytes data on the end)
                                                                                    ;      to make IBVT, AS1VT, and AS2VT all the <b>same length</b>
                                                                                    ;
                                                                                    ;                  Table  SourceOffset  Instructios
                                                                                    ;                  IBVT   #$00          #IBVT -IBVT
                                                                                    ;                  AS1VT  #$0C          #AS1VT-IBVT
                                                                                    ;                  AS2VT  #$1E          #AS2VT-IBVT
                                                                                    ;
                                                                                    ; AA       109     TAX                  ; X = SourceOffset #$00 = IBVT
                                                                                    ; 2C               DB  $2C              ; BIT $abs to skip next instruction
                                                                                    ;
                                                                                    ; A2 0C    IAS1    LDX #AS1VT-IBVTL     ;     SourceOffset $C = AS1VT 
1DB1:A2 0C          119             LDX #<a class='v' href='#AS1VTL'>AS1VTL</a>                                     ; A0 00            LDY #0               ; Y = DestOffset = BytesCopied
1DB3:BD 6B 1D       120 <a class='f' name='IAS1A'    >IAS1A       </a>LDA <a class='v' href='#AS1VT'>AS1VT</a>-<span class='n'>1</span>,X   ; MOVE ROM AS ADRS              ; BD 62 1D 1AS1A   LDA IBVT,X           ; X = $0, $C, or $18 to start 
1DB6:9D 55 1D       121             STA <a class='v' href='#IBASVT'>IBASVT</a>-<span class='n'>1</span>,X                                  ; 99 56 1D         STA IBASVT,Y                                       
1DB9:CA             122             DEX                                             ; E8               INX                                                
1DBA:D0 F7          123             BNE <a class='x' href='#IAS1A'>IAS1A</a>                                       ; C8               INY                                                
                                                                                    ; C0 0C            CPY #C                                             
                                                                                    ; D0 F4            BNE copy                                           
                    124 ;
                    125 <a class='f' name='INITAA'   >INITAA      </a>EQU                                             ; /sarcasm Hey, we need a new label inbetween INITA, and INITB
1DBC:38             126             SEC             ; INDICATE INIT                 ;          I know, let's call it crappy "INITAA" instead of DoneCopyBasicVectors
1DBD:B0 12          127             BCS <a class='x' href='#INITA'>INITA</a>                                       ; &darr; (always) (*note* Intentional next empty line spacer for readability)
                                                                                    ;
1DBF:AD 62 2A       128 <a class='f' name='DBRST'>DBRST       </a>LDA <a class='v' href='#ASIBSW'>ASIBSW</a>      ;GET APPLESOFT/INITGER BASIC FLAG   ; *spelling* INTEGER; DBRST = DosBasicReset
1DC2:D0 04          129             BNE <a class='x' href='#INITA1'>INITA1</a>      ;BRANCH IF NOT INITGER BASIC        ; *spelling* INTEGER
1DC4:A9 20          130             LDA #<a class='v' href='#ITSTV'>ITSTV</a>      ;GET INTIGER TEST VALUE AND GO SET  ; *spelling* INTEGER
1DC6:D0 05          131             BNE <a class='x' href='#INITA2'>INITA2</a>      ; ROM SWITCH TO 'IB'. (BRANCH ALWAYS)
1DC8:0A             132 <a class='f' name='INITA1'   >INITA1      </a>ASL A           ;TEST FOR ROM APPLESOFT         ; $40 = Applesoft RAM
1DC9:10 05          133             BPL <a class='x' href='#INITA3'>INITA3</a>      ;BRANCH IF RAM VERSION          ; /cynical <b>Test time!</b> INITA3 referes to InitApplesoftRAM or InitApplesoftROM ?
1DCB:A9 4C          134             LDA #<a class='v' href='#ATSTV'    >ATSTV</a>      ;GET APPLESOFT TEST VALUE AND GO SET
1DCD:20 B2 25       135 <a class='f' name='INITA2'   >INITA2      </a>JSR <a class='x' href='#SWTST'>SWTST</a>       ;GO SELECT PROPER ROM BASIC.    ; more crappy naming: _which_ Switch Test
1DD0:18             136 <a class='f' name='INITA3'   >INITA3      </a>CLC
                    137 ;
                    138 <a class='f' name='INITA'    >INITA       </a>EQU *
1DD1:08             139             PHP             ;SAVE INIT/RESET
1DD2:20 51 28       140             JSR <a class='x' href='#MVCSW'>MVCSW</a>       ; GO MOVE CHAR SWITCH
1DD5:A9 00          141             LDA #<span class='n'>0</span>          ; CLR MONITOR MODES             ; MON C,I,O
1DD7:8D 5E 2A       142             STA <a class='v' href='#MONMOD'   >MONMOD</a>
                    143 ;
1DDA:8D 52 2A       144             STA <a class='v' href='#OSTATE'   >OSTATE</a>      ; CLEAR OUTSTATE AND EXECUTE STATE  ; what happened to STA ESTATE ??
1DDD:28             145             PLP             ; GET INIT/RESET
1DDE:6A             146             ROR A           ; SHIFT CARRY TO MSB            ; /sarcasm Gee, if only we could understand 6502 instructions, $00 = Reset, $80 = Init
1DDF:8D 51 2A       147             STA <a class='v' href='#ISTATE'>ISTATE</a>      ; SAVE INSTATE                  ; Frak-You Captain Obvious with a STA IN_STATE
1DE2:30 03          148             BMI <a class='x' href='#INITB' >INITB</a>       ; BR IF INIT
1DE4:6C 5E 1D       149             JMP (<a class='v' href='#CONT' >CONT</a>)      ; GO TO CONTINUE ENTRY          ; No Shit, Sherlock; _what_ is the difference between CONT and GO ???
1DE7:6C 5C 1D       150 <a class='f' name='INITB'    >INITB       </a>JMP (<a class='v' href='#GO'>GO</a>)        ; GO TO GO ENTRY                ;
                    151             PAGE
                    152 <a class='f' name='INITC'    >INITC       </a>EQU *                                           ; Called by <a class='x' href='#CHIN0'>CHIN0</a>
1DEA:0A             153             ASL A           ; OF ISTATE NOT ON
1DEB:10 19          154             BPL <a class='x' href='#INITD' >INITD</a>       ; THEN NOT RAM AS               ; 
1DED:8D 62 2A       155             STA <a class='v' href='#ASIBSW'>ASIBSW</a>      ; SET RAM AS
1DF0:A2 0C          156             LDX #<a class='v' href='#AS2VTL'>AS2VTL</a>                                     ; more duplicate code, we should <span class='macro'>LDA #AS2VT-IBVT</span> and JSR <a class='link' href='#DOSINIT.118.Solution'>118 Solution</a> (make a subroutine)
1DF2:BD 77 1D       157 <a class='f' name='IAS2A'    >IAS2A       </a>LDA <a class='v' href='#AS2VT'>AS2VT</a>-<span class='n'>1</span>,X   ; MOVE RAM AS ADRS              ; <a class='mem' name='_'>wastes</a> 6 bytes, (9 - 3 for JSR SOLUTION.118)</a>
1DF5:9D 55 1D       158             STA <a class='v' href='#IBASVT'>IBASVT</a>-<span class='n'>1</span>,X                                  ;        When you see the <b>same block of code</b> your <i>spidey sense</i> should be tingling:
1DF8:CA             159             DEX                                             ;        Is there a way to refactor this common code?
1DF9:D0 F7          160             BNE <a class='x' href='#IAS2A'>IAS2A</a>
1DFB:A2 1D          161             LDX #<span class='n'>29</span>                                         ; <a class='magic' name='_1DFC'>magic number</a> <i>better</i>: 30-1, <b>best</b>: FILENAME_MAX-1
1DFD:BD 93 2A       162 <a class='f' name='IAS2B'    >IAS2B       </a>LDA <a class='v' href='#FNAME2'>FNAME2</a>,X
1E00:9D 75 2A       163             STA <a class='v' href='#FNAME1'>FNAME1</a>,X                                    ; === <a class='ts' href='#T0SD'>T0SD</a> ===
1E03:CA             164             DEX
1E04:10 F7          165             BPL <a class='x' href='#IAS2B'>IAS2B</a>
                    166 ;
                    167 <a class='f' name='INITD'    >INITD       </a>EQU *
1E06:AD B1 2A       168             LDA <a class='v' href='#DFNFTS'>DFNFTS</a>      ; GO BUILD FILE TABS
1E09:8D 57 2A       169             STA <a class='v' href='#CNFTBS'>CNFTBS</a>      ; AND SET MEM BOUNDS
1E0C:20 D4 27       170             JSR <a class='x' href='#BLDFTB'>BLDFTB</a>
1E0F:AD B3 2A       171             LDA <a class='v' href='#ESTATE'>ESTATE</a>      ; GET EXEC STATE
1E12:F0 09          172             BEQ <a class='x' href='#INITZ' >INITZ</a>       ; BR IF NOT EXECUTE
1E14:48             173             PHA             ; SVE CHAR                      ; *spelling* SAVE
1E15:20 9D 26       174             JSR <a class='x' href='#MVEFTA'>MVEFTA</a>      ; GO MOVE EX FILE TAB ADR TO ZP
1E18:68             175             PLA
1E19:A0 00          176             LDA #<span class='n'>0</span>
1E1B:91 40          177             STA (<a class='v' href='#ZPGWRK'>ZPGWRK</a>),Y                                  ; Oh, we're still around?
                    178 <a class='f' name='INITZ'    >INITZ       </a>EQU *
<hr>1E1D:20 5B 27       179             JSR <a class='x' href='#CLRSTS'>CLRSTS</a>      ; SET IN AND OUT STATES TO ZERO ; === Page <a class='page' name='page51'>51</a> === ClearStates
1E20:AD 5F 2A       180             LDA <a class='v' href='#CMDNO'>CMDNO</a>       ; IF NOT BOOT (DUPLICATED FROM LINES 4540, 4550)
1E23:D0 20          181             BNE <a class='x' href='#INITF'>INITF</a>       ; THEN DONE
1E25:A2 2F          182             LDX #<a class='v' href='#IFBL'>IFBL</a>
1E27:BD 51 1E       183 <a class='f' name='INITE'    >INITE       </a>LDA <a class='x' href='#DBVECT'>DBVECT</a>,X    ; MOVE RESTART VECTORS
1E2A:9D D0 03       184             STA $<span class='n'>3D0</span>,X                                                          ; <a class='magic' name='_1E2B'>magic number</a>
1E2D:CA             185             DEX
1E2E:10 F7          186             BPL <a class='x' href='#INITE'>INITE</a>
1E30:AD 53 1E       187             LDA <a class='x' href='#DBVECT'>DBVECT</a>+<span class='n'>2</span>    ;SET RESET VECTORS FOR NEW MONITOR.                 ;    WTF is the point of even using a table
1E33:8D F3 03       188             STA <a class='v' href='#ZRSET'>ZRSET</a>+<span class='n'>1</span>     ;NOTE: THESE ARE NOT NORMALLY USED AND              ;    if you're just going to ignore part of it???
1E36:49 A5          189             EOR #$<span class='n'>A5</span>        ; ARE ONLY SET ONCE ON BOOT                         ;    <a class='magic' name='_1E37'>magic number</a> F800.S Ctrl-Reset Powered Up
1E38:8D F4 03       190             STA <a class='v' href='#PWCNST'>PWCNST</a>      ;POWER UP CONSTANT=COMPLIMENT OF HI RESET VECTOR.   ;                        <b>Checksum</b> <i>not</i> constant
1E3B:AD 52 1E       <a class='line' name='DOSINIT.191'>191</a>             LDA <a class='x' href='#DBVECT'>DBVECT</a>+<span class='n'>1</span>    ;SET LOW VECTOR ADDRESS.                            ;[.. <a class='mem' name='_1E3B'>wastes</a> 6 bytes due to Line #<a class='line' href='DOSINIT.221'>221</a> Clusterfrak
1E3E:8D F2 03       192             STA <a class='v' href='#ZRSET'>ZRSET</a>       ;NOW APPLE RESET WILL KEEP DOS IN I/O LOOP          ; ..]            
1E41:A9 06          193             LDA #<span class='n'>6</span>          ;INIDICATE RUN                                      ; <a class='magic' name='_1E42'>magic number</a> <span class='todo'>TODO</span> 
1E43:D0 05          194             BNE <a class='x' href='#INITF1'>INITF1</a>      ;LOAD AND RUN THE 'HELLO' PROGRAM                   ; &darr; (always) 
                    195 ;
                    196 <a class='f' name='INITF'    >INITF       </a>EQU *
1E45:AD 62 2A       197 <!--                           -->            LDA <a class='v' href='#SVCMD'>SVCMD</a>
1E48:F0 06          198 <!--                           -->            BEQ <a class='x' href='#INITG'>INITG</a>
1E4A:8d 5F 2A       199 <a class='f' name='INITF1'   >INITF1      </a>STA CMDNO
1E4D:4C 80 21       200 <!--                           -->            JMP <a class='x' href='#CMDGO1'>CMDGO1</a>
                    201 <a class='f' name='INITG'    >INITG       </a>EQU *
1E50:60             202 <!--                           -->            RTS
                    203 ;
                    204 <a class='d' name='IFB'      >IFB         </a>EQU *                                           ; --- Copied to $3D0 ---
1E51:4C BF 1D       205 <a class='f' name='DBVECT'   >DBVECT      </a>JMP <a class='x' href='#DBRST'>DBRST</a>                                       ; $3D0: JMP $9DBF DOS Warm RESET
1E54:4C 84 1D       206 <!--                           -->            JMP <a class='x' href='#DBINIT' >DBINIT</a>                                      ; $3D3: JMP $9D84 DOS Cold RESET
1E57:4C FD 2A       207 <!--                           -->            JMP <a class='x' href='#USERENT'>USERENT</a> ;USER EXTERNAL ENTRY TO FILE MANAGER; $3D6: JMP $AAFD FM   (File Manager)
1E5A:4C B5 37       208 <!--                           -->            JMP <a class='x' href='#DISKIO '>DISKIO</a>                                      ; $3D9: JMP $B7B5 RWTS (ReadWriteTrackSector)
                    209 <a class='f' name='CCBLDR'   >CCBLDR      </a>EQU *                                           ; $3DC: GetParamFM (AY = $B5BB, CCB = Command Control Block)
1E5D:AD 0F 1D       210 <!--                           -->            LDA <a class='v' href='#CCBADR'>CCBADR</a>+<span class='n'>1</span>
1E60:AC 0E 1D       211 <!--                           -->            LDY <a class='v' href='#CCBADR'>CCBADR</a>
1E63:60             212 <!--                           -->            RTS
                    213 <a class='f' name='IOBLDR'   >IOBLDR      </a>EQU *                                           ; $3E3: GetParamRWTS (AY = $B7E8, )
1E64:AD C2 2A       214             LDA <a class='v' href='#AIOB'  >AIOB</a>+<span class='n'>1</span>
1E67:AC C1 2A       215             LDY <a class='v' href='#AIOB'  >AIOB</a>
1E6A:60             216             RTS
1E6B:4C 51 28       217             JMP <a class='x' href='#MVCSW' >MVCSW</a>                                       ; $3EA: Set CIN/COUT to DOS
1E6E:EA             218             NOP
1E6F:EA             219             NOP
1E70:4C 59 FA       220             JMP <a class='e' href='#MONBRK'>MONBRK</a>                                      ; $3EF: JMP $FA59 Autostart BRK handler
1E73:4C 65 FF       <a class='line' name='DOSINIT.221'>221</a>             JMP <a class='e' href='#MONRST'>MONRST</a>                                      ; $3F2: $9DBF,$38 Control-Reset - Why not <span class='code'>DW DBRST</span>, <span class='code'>DB $#&gt;DBRST ^ $A5</span> ??? Line #<a class='line' href='#DOSINIT.191'>191</a>
1E76:4C 58 FF       222             JMP <a class='e' href='#IORTS' >IORTS</a>                                       ; $3F5: JMP $FF58 Ampersand handler
1E79:4C 65 FF       223             JMP <a class='e' href='#MONRST'>MONRST</a>                                      ; $3F8: JMP $FF65 Ctrl-Y handler
1E7C:4C 65 FF       224             JMP <a class='e' href='#MONRST'>MONRST</a>                                      ; $3FB: JMP $FF65 NMI handler
1E7F:65 FF          225             DW <a  class='e' href='#MONRST'>MONRST</a>                                       ; $3FE: dw  $FF65 IRQ vector
                    226 <a class='d' name='IFBL'     >IFBL        </a>EQU *-<a class='v' href='#IFB'>IFB</a>-<span class='n'>1</span>                                     ; IFB_Length
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="DOSHOOK">DOSHOOK</a> - Input / Output Vector, Pages <a class="page" name="page44">44</a> - 47, <a class='ts' href='#T0SD'>T0SD</a> - <a class='ts' href='#T0SE'>T0SE</a>, $<span class='n'>9E81</span> .. $<span class='n'>9FCC</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ;CHRIN - CHAR RCVD VIA IN SWITCH
                    004 ;
                    005 <a class='f' name='CHRIN'    >CHRIN       </a>EQU *
1E81:20 D1 1E       006             JSR <a  class='x' href='#SVREGS'>SVREGS</a>      ;
1E84:AD 51 2A       007             LDA <a  class='v' href='#ISTATE'>ISTATE</a>      ; IF NOT DISKIN
1E87:F0 15          008             BEQ <a  class='x' href='#CHIN1'>CHIN1</a>       ; THEN BRANCH, ELSE
1E89:48             009             PHA             ;SAVE ISTATE
1E8A:AD 5C 2A       010             LDA <a  class='v' href='#SVA'>SVA</a>
1E8D:91 28          011             STA ($<span class='n'>28</span>),Y     ;REPLACE CURSOR                 ; <a class='magic' name='_1E8E'>magic number</a> /sarcasm If only F800.S ROM defined BASL EQU $28
1E8F:68             012             PLA             ;GET ISTATE AGAIN
1E90:30 03          013             BMI <a  class='x' href='#CHIN0'>CHIN0</a>       ;BRANCH IF NOT 'READ' FROM DISK
1E92:4C 26 26       014             JMP <a  class='x' href='#ICFD'>ICFD</a>        ; AND GET CHAR FROM DISK
1E95:20 EA 1D       015 <a class='f' name='CHIN0'    >CHIN0       </a>JSR <a class='x' href='#INITC'>INITC</a>
1E98:A4 24          016             LDY $<span class='n'>24</span>         ;GET CURSOR HORIZ               ; <a class='magic' name='_1E98'>magic number</a> /sarcasm If only F800.S ROM defined CH EQU $24
1E9A:A9 60          017             LDA #$<span class='n'>60</span>        ;RESTORE A FLASHING CURSOR      ; #' ' + FLASH ; INVERSE = $00..$3F, FLASH = $40..$7F, NORMAL = $80..FF
1E9C:91 28          018             STA ($<span class='n'>28</span>),Y     ; TO PROMPT USER                ; <a class='magic' name='_1E9C'>magic number</a>
                    019 <a class='f' name='CHIN1'    >CHIN1       </a>EQU *
1E9E:AD B3 2A       020             LDA <a  class='v' href='#ESTATE'>ESTATE</a>
1EA1:F0 03          021             BEQ <a  class='x' href='#CHIN2'>CHIN2</a>
1EA3:20 82 26       022             JSR <a  class='x' href='#NXTEXC'>NXTEXC</a>      ;RETURNS TO HERE ONLY WHEN 'EXEC' IS EXHAUSTED

                    023 <a class='f' name='CHIN2'    >CHIN2       </a>EQU *
1EA6:A9 03          024             LDA #<span class='n'>3</span>          ; SET OUT CHAR                   ; <a class='magic' name='_1EA6'>magic number</a> COS_INPUT_ECHO = 3
1EA8:8D 52 2A       025             STA OSTATE      ; STATE TO INPUT ECHO
                    026             JSR LDREGS
                    027             JSR GETIN
                    028             STA SVA         ; SAVE CHAR &amp; INDEX
                    029             STX SVX
                    030             JMP ORTN
                    031 ;
                    032 <a class='f' name='GETIN'    >GETIN       </a>JMP (<a class='v' href='#INSW'>INSW</a>)
                    033 ;
                    034 ;CHROUT - CHAR RCVD VIA OUTPUT SWITCH
                    035 ;
                    036 <a class='f' name='CHROUT'   >CHROUT      </a>EQU *
                    037             JSR SVREGS      ; SAVE REGS
                    038 ;
                    039             LDA OSTATE      ; GET OUT SPARE
                    040             ASL A
                    041             TAX
                    042             LDA OUTSVT1+<span class='n'>1</span>,X ; GET ROUTINE ADR
                    043             PHA
                    044             LDA OUTSVT+<span class='n'>1</span>,X
                    045             PHA
                    046             LDA SVA
1ED0:60             047             RTS             ; GO TO ROUTINE
                    048 ;
                    049 ;SVREGS - SAVE REGS WHILE PROCESSING CHARS
                    050 ;
                    051 <a class='f' name='SVREGS'   >SVREGS      </a>EQU *
1ED1:8D 5C 2A       052             STA SVA         ; SAVE ACU                      ; Captain Obvious to the rescue!
<hr>                    053 <a class='f' name='SVRGSA'   >SVRGSA      </a>EQU *                                           ; === Page <a class='page' name='page45'>45</a> === SaveRegsA, uh, NO, SaveRegsXY, we _already_ saved A
1ED4:8D 5A 2A       054             STX SVX         ; SAVE X                        ; Good variable naming, SAVEX, SAVEY
1ED7:8C 5B 2A       055             STY SVY         ; SAVE Y                        ; negates the need for these useless comments
1EDA:BA             056             TSX             ;SAVE STACK POINTER
1EDB:E8             057             INX
1EDC:E8             058             INX             ;ADJUST IT TO ORIGINAL
1EDD:8E 59 2A       059             STX SVSTK
1EE0:A2 03          060             LDX #<span class='n'>3</span>          ; SET FOR FOUR BYTE MOVE        ; /sarcasm If only we could read assembly ...
1EE2:BD 53 2A       061 <a class='f' name='SVRB'     >SVRB        </a>LDA SVOUTS,X    ; MOVE SAVED OUT AND IN SW      ; Save RB??? <span class='todo'>TOOD</span>
1EE5:95 36          062             STA OUTSW,X     ; TO APPLE OUT/IN SW
1EE7:CA             063             DEX
1EE8:10 F8          064             BPL SVRB
1EEA:60             065             RTS             ; DONE                          ; Can someone please put Captain Obvious out of _our_ misery?
                    066             PAGE
                    067 ;
                    068 ; COS0 - 1ST CHAR OF PRINTED OUTPUT LINE
                    069 ;CHECK FOR  CNTL-D                                          ; "<i>You say CNTL-D, I say CTRL-D</i>"
                    070 ;                                                           ; We're <b>both</b> inconsistently dropping <i>a consonant</i>: CoNTRoL
                    071 <a class='f' name='COS0'     >COS0        </a>EQU *
1EEB:AE B7 2A       072             LDX RSTATE      ;FIRST CHECK FOR 'AFTER APSFT RELOC'
1EEE:F0 03          073             BEQ <a class='x' href='#COS00'>COS00</a>       ;BRANCH IF NOT                  ; <b>Really?!</b> You couldn't use COS0A and COS0B like you do for the <i>other</i> states??
                                                                                    ; COS0 &amp; COS00 are <b>crap function names</b>; they are WAY too easy to mis-read/type
1EF0:4C 78 1F       074             JMP COS7                                        ; <a class='mem' name='_'>wastes</a> 3 bytes, but since $1F78-$1EF0 &gt; $80 
                                                                                    ; <span clas='todo'>TODO</span> We need to move <a class='x' href='#COS5'>COS5</a>..<a class='x' href='#COS7'>COS7</a> <b>before</b> <a class='x' href='#COS0'>COS0</a>; change Line #<a class='line' href='#DOSHOOK.074'>74</a> to BNE COS7
1EF3:AE 51 2A       075 <a class='f' name='COS00'    >COS00       </a>LDX ISTATE      ;IS IN STATE NOT ZERO           ; I'm serious, someone <i>please</i> shoot Captain Obvious
1EF6:F0 08          076             BEQ COS01                                       ; 
1EF8:C9 BF          077             CMP #'?'+$<span class='n'>80</span>    ; THEN IS THIS ?
1EFA:F0 75          078             BEQ COS6        ; THEN PRINT ONLY IF MONITOR
1EFC:C5 33          079             CMP PROMPT
1EFE:F0 27          080             BEQ COS2A
                    081 <a class='f' name='COS01'    >COS01       </a>EQU *                                           ; === <a class='ts' href='#T0SE'>T0SE</a> ===
1F00:A2 02          082             LDX #<span class='n'>2</span>                                          ; <a class='magic' name='_1F01'>magic number</a>
1F02:8E 52 2A       083             STX OSTATE
1F05:CD B2 2A       084             CMP CCHAR       ; IF NOT CNTL-D
1F08:D0 19          085             BNE COS2        ; THEN GO TO STATE 2
1F0A:CA             086             DEX
1F0B:8E 52 2A       087             STX OSTATE      ; ELSE STATE=1
1F0E:CA             088             DEX
1F0F:8E 5D 2A       089             STX LBUFD       ; AND LBUFD=0
                    090 ;
                    091 ;COS1 - ACCUMULATE CMD FROM PRINTED OUTPUT
                    092 ;
                    093 <a class='f' name='COS1'     >COS1        </a>EQU *
1F12:AE 5D 2A       094             LDX LBUFD       ; GET LINE BUFF DISPL
1F15:9D 00 02       095 <a class='f' name='COS1A'    >COS1A       </a>STA LBUFF,X     ; PUT CHAR IN BUFF
1F18:E8             096             INX             ; INCR PTR
1F19:8E FD 2A       097             STX LBUFD       ; SAVE PTR
1F1C:C9 8D          098             CMP #$<span class='n'>8D</span>        ; WAS THIS A CR                 ; <a class='magic' name='_1F1D'>magic number</a>
1F1E:D0 75          099             BNE CMDRTN      ; IF NOT THEN PR CHAR
                    100 ;
1F20:4C CD 1F       101             JMP SCNCMD      ; GO SCAN COMMAND
                    102 ;
                    103 ;COS2 - PRINTED OUTPUT, NOT FIRST CHAR
                    104 ;
                    105 <a class='f' name='COS2'     >COS2        </a>EQU *
1F23:C9 8D          106             CMP #$<span class='n'>8D</span>        ; IS IT A CR                    ; <a class='magic' name='_1F24'>magic number</a>
1F25:D0 7D          107             BNE PRRTN       ; BR IF NOT
1F27:A2 00          108 <a class='f' name='COS2A'    >COS2A       </a>LDX #<span class='n'>0</span>          ; SET FOR POSSIBLE C-D NEXT     ; C-D = Control-D <a class='magic' name='_1F28'>magic number</a> COS_STATE_FIRST_CONTROL_D = 0
1F29:8E 52 2A       109             STX OSTATE      ; NEXT STATE
1F2C:4C A4 1F       110             JMP PRRTN       ; GO PRINT CHAR                 ; <a class='mem' name='_1F2C'>wastes</a> 1 byte, $1F83 - $1F2C = $57, <span class='code'>BEQ PRRTN</span>
                    111             PAGE
                    112 ;
                    113 ;COS3 - KEY IN ECHO PRINT
                    114 ;
                    115 <a class='f' name='COS3'     >COS3        </a>EQU *
<hr>1F2F:A2 00          116 <!--                       -->            LDX #<span class='n'>0</span>                                          ; === Page <a class='page' name='page46'>46</a> === <a class='magic' name='_1F30'>magic number</a> COS_STATE_0
1F31:8E 52 2A       117 <!--                       -->            STX OSTATE      ; RESET OUT STATE
1F34:C9 8D          118 <!--                       -->            CMP #$<span class='n'>8D</span>        ; IS IT CR
1F36:F0 07          119 <!--                       -->            BEQ COS3A       ; IF CR THEN CMD CHECK
1F38:AD B3 2A       120 <a class='f' name='COS3B'    >COS3B       </a>LDA ESTATE      ; ELSE: IF NOT EXECUTE
1F3B:F0 67          121 <!--                       -->            BEQ PRRTN       ; THEN PRINT CHAR
1F3D:D0 5E          122 <!--                       -->            BNE DRTNI       ; ELSE: PRINT IF MON INPUT      ; Data Return In
1F3F:48             123 <a class='f' name='COS3A'    >COS3A       </a>PHA             ;SAVE CARRAGE RETURN
1F40:38             124 <!--                       -->            SEC             ;ANTICIPATE EXEC FILE INPUT.
1F41:AD B3 2A       125 <!--                       -->            LDA ESTATE      ;CHECK EXEC FLAG
1F44:D0 03          126 <!--                       -->            BNE COS3C       ;BR IF WAS INPUT FROM EXEC.
1F46:20 5E 26       127 <!--                       -->            JSR TSTRUN      ;GO TEST FOR RUN MODE.
1F49:68             128 <a class='f' name='COS01'    >COS3C       </a>PLA
1F4A:90 EC          129 <!--                       -->            BCC COS3B       ;IGNORE INPUT IF RUNNING.
1F4C:AE 5A 2A       130 <!--                       -->            LDX SVX         ; GET LINE INDEX
1F4F:4C 15 1F       131 <!--                       -->            JMP COS1A                                       ; <span class='todo'>TODO</span> Can this ever be zero??
                    132 ;
                    133 ;COS4 - DISK OUTPUT MODE
                    134 ;
                    135 <a class='f' name='COS4'     >COS4        </a>EQU *
1F52:C9 8D          136             CMP #$<span class='n'>8D</span>        ; IS IT CR
1F54:D0 05          137             BNE COS4A       ; BR IF NOT CR
1F56:A9 05          138             LDA #5          ; SET STATE FOR CNTL-D
1F58:8D 52 2A       139             STA OSTATE      ; EXAMINE
1F5B:20 0E 26       140 <a class='f' name='COS4A'    >COS4A       </a>JSR OCTD        ; GO OUTPUT CJHAR TO DISK       ; *spelling* Char
1F5E:4C 99 1F       141             JMP DRTNO       ; GO TO DATA RETURN (OUT)
                    142 ;
                    143 ;COS5 - DISK OUTPUT MODE - 1ST CHAR
                    144 ;
                    145 <a class='f' name='COS5'     >COS5        </a>EQU *
1F61:CD B2 2A       146             CMP CCHAR       ; IS IT CNTL D
1F64:F0 85          147             BEQ COS0        ; BR IF CNTL- D
1F66:C9 8A          148             CMP #$<span class='n'>8A</span>        ; LINE FEED?
1F68:F0 F1          149             BEQ COS4A
1F6A:A2 04          150             LDX #<span class='n'>4</span>
1F6C:8E 52 2A       151             STX OSTATE      ; SET NEW OUT STATE             ; No Shit Sherlock, *what* is State 4 ??
1F6F:D0 E1          152             BNE COS4        ; BR IF NOT CNTL D              ; &uarr; (always) <a class='mem' name='_'>wastes</a> 2 bytes, move COS5 before COS4 and remove this branch
                    153 ;
                    154 ;COS6 - DISK INPUT ECHO
                    155 ;
1F71:A9 00          156 <a class='f' name='COS6'     >COS6        </a>LDA #<span class='n'>0</span>
1F73:8D 52 2A       157             STA OSTATE      ; RESET OUT STATE = 0
1F76:F0 25          158             BEQ DRTNI       ; GO TO DATA IN RETURN
                    159 ;
                    160 ; COS7 - SPECIAL FOR RECOVER FROM AS ROM/RAM RELOC.
                    161 ;
1F78:A9 00          162 <a class='f' name='COS7'     >COS7        </a>LDA #<span class='n'>0</span>          ; RESET RELOC STATE
1F7A:8D B7 2A       163             STA RSTATE
1F7D:20 51 28       164             JSR MVCSW       ;FOR COMPATABILITY ON REENTRY
1F80:4C DC 24       165             JMP ERUN1
                    166             PAGE
                    167 ;
                    168 ;PRRTN - PRINT CHAR RETURN
                    169 ;
                    170 ;
                    171 ; CMDRTN - PRINT CHAR IF MONITOR CMBS MODE                  ; <span class='todo'>TODO</span> CMBS ???
                    172 ; DRTNO - PRINT CHAR IF MONITOR DATA OUT
                    173 ; DRTNI - PRINT CHAR IF MONITOR DATA IN
                    174 ;
                    175 <a class='f' name='CERTN'    >CERTN       </a>EQU *
1F83:AD 00 02       176             LDA LBUFF       ; CHECK FOR PRINTED COMMAND
1F86:CD B2 2A       177             CMP CCHAR
1F89:F0 0A          178             BEQ CMDRTN      ; IF PC THEN NO RESET X REG
<hr>1F8B:A9 8D          179             LDA #$<span class='n'>8D</span>        ; CARRAGE RETURN                ; === Page <a class='page' name='page47'>47</a> === <a class='magic' name='_1F8C'>magic number</a> KEY_CR
                    180             STA <a class='v' href='#LBUFF'>LBUFF</a>       ; TO OUT BUFFER
                    181             LDX #<span class='n'>0</span>          ; RESET TO SOL                  ; StartOfLine
                    182             STX <a class='v' href='#SVX'>SVX</a>
                    <a class='line' name='DOSHOOK.183'>183</a> <a class='f' name='CMDRTN'   >CMDRTN      </a>LDA #<a class='e' href='#MC'>MC</a>
                    184             BNE <a class='x' href='#MODECK'>MODECK</a>                                      ; &darr; (always)
                    <a class='line' name='DOSHOOK.185'>185</a> <a class='f' name='DRTNO'    >DRTNO       </a>LDA #<a class='e' href='#MO'>MO</a>                                         ; Data Return Out
                    186             BNE <a class='x' href='#MODECK'>MODECK</a>                                      ; &darr; (always)
                    <a class='line' name='DOSHOOK.187'>187</a> <a class='f' name='DRTNI'    >DRTNI       </a>LDA #<a class='e' href='#MI'>MI</a>                                         ; Data Return In
                    188 ;
                    189 <a class='f' name='MODECK'   >MODECK      </a>EQU *                                           ; ModeCheck common entry
                    190             AND <a class='v' href='#MONMOD'>MONMOD</a>      ; AND WITH MODE
                    191             BEQ <a class='x' href='#ORTN'>ORTN</a>        ; BR IF NOT PRINT
                    192 <a class='f' name='PRRTN'    >PRRNT       </a>JSR <a class='x' href='#LDREGS'>LDREGS</a>
                    193             JSR <a class='x' href='#ORTN1'>ORTN1</a>
                    194             STA <a class='v' href='#SVA'>SVA</a>         ;SAVE REGISTERS
                    195             STY <a class='v' href='#SVY'>SVY</a>
                    196             STX <a class='v' href='#SVX'>SVX</a>
                    197 ;
                    198 <a class='f' name='ORTN'     >ORTN        </a>EQU *
                    199             JSR <a class='x' href='#MVCSW'>MVCSW</a>       ; GO MOVE CHAR I/O SWITCH
                    200             LDX <a class='v' href='#SVSTK'>SVSTK</a>       ;RESTORE ORIGINAL STACK POINTER (YEEECH!)   ; /sarcasm And yet you're still futzing with the Stack Pointer
                    201             TXS
                    202 <a class='f' name='LDREGS'   >LDREGS      </a>EQU *
                    203             LDA <a class='v' href='#SVA'>SVA</a>         ; ACU                           ; Captain Obvious  SAVE_A
                    204             LDY <a class='v' href='#SVY'>SVY</a>         ; Y                             ; is working       SAVE_Y
                    205             LDX <a class='v' href='#SVX'>SVX</a>         ; X                             ; overtime today   SAVE_X
                    206             SEC             ;(FOR 'ESC' SCREEN FUNCTIONS)
                    207             RTS             ; BY PASS PRINT
                    208 ;
                    209 <a class='f' name='ORTN1'    >ORTN1       </a>JMP (<a class='v' href='#OUTSW'>OUTSW</a>)
                    210 ;
                    211 ; PRRIF - PRINT CR IF MON CMDS
                    212 ;
                    213 <a class='f' name='PRCRIF'   >PRCRIF      </a>EQU *
1FC8:A9 8D          214             LDA #$<span class='n'>8D</span>        ; ELSE PRINT CR                 ; <a class='magic' name='_1FC9'>magic number</a> KEY_CR
1FCA:4C C5 1F       215             JMP ORTN1                                       ; <a class='mem' href='_1FCA'>wastes</a> 1 byte; BNE ORTN1
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="CMDSCAN">CMDSCAN</a> - Scan for commands, Page <a class="page" page="page16">16</a>, <a class='ts' href='#T0SE'>T0SE</a> - <a class='ts' href='#T1S0'>T1S0</a>, $<span class='n'>9FCD</span> .. $<span class='n'>A192</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ; SCNCMD - SCAN A COMMAND
                    004 ;
                    005 <a class="f" name="SCNCMD"      >SCNCMD      </a>EQU *
                    006     DO <a class='do' href='#ULC'>ULC</a><span class='macro'>
                    007             LDX #<span class='n'>0</span>          ;Init X for lower case check    
                    008             JSR UPRCASE     ;Go check                       </span>
                    009     ELSE
1FCD:A0 FF          010             LDY #$<span class='n'>FF</span>        ;Set CMDNO to -1                
1FCF:8C 5F 2A       011             STY CMDNO                                       
                    012     FIN
1FD2:C8             013             INY             ; INCR TABLE INDEX
1FD3:8C 62 2A       014             STY SVCMD
                    015 <a class="f" name='SC0'         >SC0         </a>EQU *
1FD6:EE 5F 2A       016             INC CMDNO       ; INCR CMD NO                   ; Thanks Captain Obvious
1FD9:A2 00          017             LDX #<span class='n'>0</span>          ; RESET LINE INDEX TO 0
1FDB:08             018             PHP             ; SAVE EQ STATUS
1FDC:BD 00 02       019             LDA LBUFF,X     ; GET 1ST LINE  CHAR
1FDF:CD B2 2A       020             CMP CCHAR       ; IS IT CONTROL D
1FE2:D0 01          021             BNE SC0A        ; BR /IF NOT
1FE4:E8             022             INX             ; INCR OVER CNTLD
1FE5:8E 5D 2A       023 <a class='f' name='SC0A'        >SC0A        </a>STX LBUFD
                    024 ;
                    025 <a class='f' name='SC1X'        >SC1X        </a>EQU *
1FE8:20 A4 21       026             JSR GNBC        ; GET NON BLANK INPUT CHAR
1FEB:29 7F          027             AND #$<span class='n'>7F</span>        ; MSB OF CHAR OFF
1FED:59 84 28       028             EOR CMDNTB,Y    ; EOR WITH INPUT
1FF0:C8             029             INY             ; INCREMENT TABLE INDEX
1FF1:0A             030             ASL A           ; IF MSB OF EOR RESULT ON
1FF2:F0 02          031             BEQ SC1A        ; IF RESULT NOT NOW ZERO
1FF4:68             032             PLA             ; THEN INPUT DOES NOT
1FF5:08             033             PHP             ; EQUAL ENTRY
1FF6:90 F0          034 <a class='f' name='SC1A'        >SC1A        </a>BCC SC1X        ; LOOP FOR END OF ENTRY
                    035 ;
1FF8:28             036             PLP             ; IF INPUT EQUALS END           ;
1FF9:F0 20          037             BEQ SYNTAX      ; THEN GO SYNTAX
                    038 ;
1FFB:B9 84 A8       039             LDA CMDNTB,Y    ; IF NEXT TABLE CHAR NOT ZERO
1FFE:D0 D6          040             BNE SC0         ; THENSCANTHE NEXT TABLE ENTRY  ; /sarcasm whoneedsspacesanyways
                    041 <a class='f' name='CNF'         >CNF         </a>EQU *           ; COMMAND NOT FOUND
2000:AD 00 02       042             LDA LBUFF       ; LINE IS A CNOTROL-D           ; *spelling* Control-D
2003:CD B2 2A       043             CMP CCHAR       ; THEN THIS IS A
2006:F0 03          044             BEQ CNF1        ; POSSIBLE SYNTAX ERROR, ELSE 
2008:4C A4 1F       045             JMP PRRTN       ; ITS A BASIC INPUT LINE
                    046 <a class='f' name='CNF1'        >CNF1        </a>EQU *
200B:AD 01 02       047             LDA LBUFF+<span class='n'>1</span>     ; GET NEXT CHAR
200E:C9 8D          048             CMP #$<span class='n'>8D</span>        ; IS IT A CR                    ; <a class='magic' name='_200F'>magic number</a> KEY_CR
2010:D0 06          049             BNE CSERR       ; BR IF CR
2012:20 5B 27       050             JSR CLRSTS      ; CLEAR THE STATES
2015:4C 95 1F       051             JMP CMDRTN      ; CNTL-D ONLY
                    052 ;
2018:4C C4 26       053 <a class='f' name='CSERR'       >CSERR       </a>JMP ESYNTX
<hr>                    054             PAGE                                            ; === Page <a class='page' name='page17'>17</a> ===
                    055 ;
                    056 ; SYNTAX - FIGURE OUT WHAT WE GOT HERE 
                    057 ;
                    058 <a class='f' name='SYNTAX'      >SYNTAX      </a>EQU *
201B:0E 5F 2A       059             ASL CMDNO
201E:AC 5F 2A       060             LDY CMDNO
2021:20 5E 26       061             JSR TSTRUN
2024:90 0C          062             BCC SYN1
2026:A9 02          063             LDA #RNONLY
2028:39 09 29       064             AND CMDSTB,Y
202B:F0 05          065             BEQ SYN1
202D:A9 0F          066             LDA #$<span class='n'>F</span>                                         ; <a class='magic' name='_202E'>magic number</a> ERR_NOT_DIRECT
202F:4C D2 26       067             JMP ERROR
2032:C0 06          068 <a class='f' name='SYN1'        >SYN1        </a>CPY #<span class='n'>6</span>                                          ; <a class='magic' name='_2033'>magic number</a> <span class='todo'>TODO</span> CMD_RUN
2034:D0 02          069             BNE SYN1A
2036:84 33          070             STY PROMPT      ; CHANGE PROMPT TO INSURE APPLESOFT RUN DETECT.
2038:A9 20          071 <a class='f' name='SYN1A'       >SYN1A       </a>LDA #FN1
203A:39 09 29       072             AND CMDSTB,Y
203D:F0 61          073             BEQ SN10
203F:20 95 20       074             JSR CLRFNS
2042:08             075             PHP             ; SAVE EQ STATUS
                    076 ;
                    077 <a class='f' name='SN2'         >SN2         </a>EQU *
2043:20 A4 21       078             JSR GNBC        ; GET NON BLANK CHAR
2046:F0 1E          079             BEQ SN6         ; BR IF CR OR COMMA
2048:0A             080             ASL A           ; TEST FOR ALPHA
2049:90 05          081             BCC SN2A        ; BR IF ALPHA
204B:30 03          082             BMI SN2A        ; BR IF APLHA
204D:4C 00 20       083             JMP CNF         ; LURCH IF NOT ALPHA
2050:6A             084 SN2A        ROR A           ; RESTORE BITS
2051:4C 59 20       085             JMP SN4         ; AWAY WE GO
2054:20 93 21       086 SN3         JSR GNXTC       ; GO GET NEXT CHAR              ; GetNextChar
2057:F0 0D          087             BEQ SN6         ; BR IF COMMA OR CR
2059:99 75 2A       088 SN4         STA FNAME1,Y    ; PUT INTO FILENAME
205C:C8             089             INY             ; INC FN INDEX                  ; Total filenames length &lt; 60 ?
205D:C0 3C          090             CPY #<span class='n'>60</span>         ; ATFN CHAR LIMIT               ; At Filename Character Limit <span class='todo'>TODO</span> What triggers this?
205F:90 F3          091             BCC SN3         ; BR IF NOT
2061:20 93 21       092 SN5         JSR GNXTC       ; LOOP UNTIL CR OR COMMA
2064:D0 FB          093             BNE SN5
                    094 ;
2066:28             095 SN6         PLP             ; WAS THIS FN2 L OO             ; <span class='todo'>TODO</span> Was this filename 2 _length_ _ok_???
2067:D0 0F          096             BNE SN7         ; BR IF IT WAS
                    097 ;
2069:AC 5F 2A       098             LDY CMDNO
206C:A9 10          099             LDA #FN2
206E:39 09 29       100             AND CMDSTB,Y    ; IF FN2 NOT REQD THEN
2071:F0 0C          101             BEQ SN8         ; BRANCH
                    102 ;
2073:A0 1E          103             LDY #<span class='n'>30</span>         ; SET FN2 INDEX                 ; @filename2[0] <a class='magic' name='_2074'>magic number</a> MAX_FILENAME_LEN
2075:08             104             PHP             ; INDICATE FN2 SEEK
2076:D0 CB          105             BNE SN2         ; GO LOOK FOR FN2
                    106 ;
2078:AD 93 2A       107 SN7         LDA FNAME2      ; IF 1ST CHAR OF
207B:C9 A0          108             CMP #$<span class='n'>A0</span>        ; FN2 IS BLANK THEN
207D:F0 13          109             BEQ SERR1       ; SYNTAX ERROR
                    110 ;
207F:AD 75 2A       111 SN8         LDA FNAME1      ; IF 1ST CHAR OF
2082:C9 A0          112             CMP #$<span class='n'>A0</span>        ; FN1 IS NOT BLANK
2084:D0 4B          113             BNE SOPTS       ; THEN GO LOOK FOR OPTIONS
                    114 ;
2086:AC 5F 2A       115             LDY CMDNO
<hr>2089:A9 C0          116             LDA #NPB+NPE    ; IF CMD MUST HAVE FILENAME     ; === Page <a class='page' name='page18'>18</a> ===
208B:39 09 29       117             AND CMDSTB,Y    ; THEN
208E:F0 02          118             BEQ SERR1       ; THIS IS ERROR, ELSE
                    119 ;
2090:10 3F          120             BPL SOPTS       ; ITS EXCUTABLE WITHOUT         ; *spelling* Executable
                    121 ;
2092:4C 00 20       122 SERR1       JMP CNF
                    123 ;
                    124 CLRFNS      EQU *
2095:A0 3C          125             LDY #<span class='n'>60</span>                                         ; <a class='magic' name='_2096'>magic number</a> MAX_FILENAME_LEN * 2
                    126 CLRFNA      EQU *
2097:A9 A0          127             LDA #$<span class='n'>A0</span>
2099:99 74 2A       128 SN1         STA <a class='v' href='#FNAME1'>FNAME1</a>-<span class='n'>1</span>,Y  ; CLEAR FN1, FN2                ; *sigh* instead of -1 offset, <span class='code'>LDY #2*MAX_FILENAME_LEN-1</span>
209C:88             129             DEY
209D:D0 FA          130             BNE SN1
209F:60             131             RTS
                    132             PAGE
                    133 SN10        EQU *           ; FILE NAMES NOT REQD
20A0:8D 75 2A       134             STA FNAME1
20A3:A9 0C          135             LDA #NUM1+NUM2  ; IF NEITHER NUM1
20A5:39 09 29       136             AND CMDSTB,Y    ; OR NUM2 IS REQD
20A8:F0 27          137             BEQ SOPTS       ; THEN GO LOOK AT OPTIONS
                    138 ;
20AA:20 B9 21       139             JSR GETNUM      ; GO GET NUMERICS
20AD:B0 1F          140             BCS SERR2
                    141 ;
20AF:A8             142             TAY             ; IF HIGH DIGIT NOT
20B0:D0 17          143             BNE SERR3       ; ZERO THEN BAD
                    144 ;
20B2:E0 11          145             CPX #<span class='n'>17</span>         ; IF LOW DIGIT GT 16
20B4:B0 13          146             BCS SERR3       ; THEN BAD
                    147 ;
20B6:AC 5F 2A       148             LDY CMDNO
20B9:A9 08          149             LDA #NUM1
20BB:39 09 29       150             AND CMDSTB,Y    ; IF WE WANT NUM2
20BE:F0 06          151             BEQ SN11
                    152 ;
20C0:E0 08          153             CPX #<span class='n'>8 </span>         ; IF NUM2&gt;1
20C2:B0 CE          154             BCS SERR1       ; THEN ERROR, ELSE
20C4:90 0B          155             BCC SOPTS       ; GO SCAN OPTIONS
                    156 ;
                    157 SN11        EQU *
20C6:8A             158             TXA             ; IF NUM1=0
20C7:D0 08          159             BNE SOPTS       ; THEN ERROR, ELSE GET OPTIONS
                    160 ;
20C9:A9 02          161 SERR3       LDA #<span class='n'>2</span>          ;RANGE ERROR!                   ; <a class='magic' name='_20CA'>magic number</a>
20CB:4C D2 26       162             JMP ERROR
20CE:4C C4 26       163 SERR2       JMP ESYNTX      ;DISK CMD SYNTAX ERROR
                    164 ;
                    165 PAGE
                    166 ;
                    167 ; SOPTS - LOOK FOR SYNTAX OPTIONS
                    168 ;
                    169 SOPTS       EQU *
20D1:A9 00          170             LDA #<span class='n'>0</span>
20D3:8D 65 2A       171             STA <a class='v' href='#INOPTS'>INOPTS</a>      ; CLEAR INPUT OPTIONS
20D6:8D 74 2A       172             STA <a class='v' href='#IMBITS'>IMBITS</a>
20D9:8D 66 2A       173             STA <a class='v' href='#CV'>CV</a>          ;DEFAULT VOLUME=0
20DC:8D 6C 1A       174             STA <a class='v' href='#CL'>CL</a>
20DF:8D 6D 2A       175             STA <a class='v' href='#CL'>CL</a>+<span class='n'>1</span>
20E2:20 DC 3F       <a class='line' name='CMDSCAN.176'>176</a>             JSR <a class='x' href='#CLRBYTE'>CLRBYTE</a>     ;PATCH FOR BYTE PARAMETER (WAS STA TEMP1A)
20E5:AD 5D 2A       177             LDA <a class='v' href='#LBUFD'>LBUFD</a>       ; SET PASS 1
<hr>                    178 ;                                                           ; === Page <a class='page' name='page19'>19</a> ===
20E8:20 A4 21       179 <a class='f' name='SP1'    >SP1         </a>JSR GNBC        ; GO GET NON-BLANK CHAR
20EB:D0 1F          180             BNE SP2         ; BR IF NOT COMMA OR CR
20ED:C9 8D          181             CMP #$<span class='n'>8D</span>        ; IF CHAR IS COMMA              ; <a class='magic' name='_20EE'>magic number</a> KEY_CR
20EF:D0 F7          182             BNE SP1         ; THEN GO GET CHAR
                    183 ;
20F1:AE 5F 2A       184             LDX CMDNO       ; OPTIONS INPUT = I
20F4:AD 65 2A       185             LDA INOPTS      ; ALLOW OPTS = A
20F7:1D 0A 29       186             ORA CMDSTB+<span class='n'>1</span>,X  ; IF (A OR I)
20FA:5D 0A 29       187             EOR CMDSTB+<span class='n'>1</span>,X  XOR A NOT =0 THEN
20FD:D0 93          188             BNE SERR1       ; WE HAVE UNALLOWED OPTIONS
                    189 ;
20FE:AE 62 2A       190             LDX TEMP1A      ; IF THIS IS PASS2              ; === <a class='ts' name='T1S0'>T1S0</a> ===
2102:F0 76          191             BEQ CMDGO       ; THEN DONE,
2104:8D 63 2A       192             STA TEMP1A      ; ELSE SET PASS
2107:8E 5D 2A       193             STX LBUFD       ; RESTORE LBUFD AND
210A:D0 DC          194             BNE SP1         ; GO DO PASS 2
                    195 ;
210C:A2 0A          196 <a class='f' name='SP2'    >SP2         </a>LDX #OPT1L      ; COMPARE CHAR HAVE WITH
210E:DD 40 29       197 <a class='f' name='SP3'    >SP3         </a>CMP OPTAB1-<span class='n'>1</span>,X  ; CHARS IN OPT TABLE
2111:F0 F5          198             BEQ <a class='x' href='#SP4'>SP4</a>         ; IF FOUND CONTINUE,
2113:CA             199             DEX             
2114:D0 F8          200             BNE <a class='x' href='#SP3'>SP3</a>         ; IF NOT FOUND
2116:F0 B6          201 <a class='f' name='SERR2A' >SERR2A      </a>BEQ <a class='x' href='#SERR2'>SERR2</a>       ; THEN SYNTAX ERROR
                    202 ;
2118:BD 4A 29       203 <a class='f' name='SP4'    >SP4         </a>LDA <a class='v' href='#OPTAB2'>OPTAB2</a>-<span class='n'>1</span>,X  ; IF CORRESPONDING OP TAB 2 IS
211B:30 47          <a class='line' name='CMDSCAN.204'>204</a>             BMI SP8         ; MINUS THEN IT MONITOR BITS    ; C,I,O were all flagged with +$80, see <a class='v' href='#OPTAB2'>OPTAB2</a>
211D:0D 65 2A       205             ORA INOPTS      
2120:8D 65 2A       206             STA INOPTS      
2123:CA             207             DEX             
                    208 ;
2124:8E 64 2A       209             STX  TEMP2A     ; ELSE A NUMERIC MUST FOLLOW
2127:20 B9 21       210             JSR  GETNUM     ; FOLLOW
212A:B0 A2          211             BCS  SERR2      
                    212 ;
212C:AD 64 2A       213             LDA TEMP2A      ; GET IOTION NUMBER
212F:0A             214             ASL A           ; MULT BY 4
2130:0A             215             ASL A           
2131:A8             216             TAY             
                    217 ;                                                           ; Compare 16-bit cnum &gt;= low, cnum &lt; max
2132:A5 45          218             LDA <a class='v' href='#CNUM'  >CNUM</a>+<span class='n'>1</span>      ; IF RESULT NUM HI IS           ; +1 = cnum.hi; is cnum &lt; 256 ? i.e. only 8-bit
2134:D0 09          219             BNE <a class='x' href='#SP5'   >SP5</a>         ; GT 0, THEN GT LOW RANGE
2136:A5 44          220             LDA <a class='v' href='#CNUM'  >CNUM</a>        ; TEST RESULT LOW               ; +0 = cnum.low &lt;
2138:D9 55 29       221             CMP <a class='v' href='#OPTAB3'>OPTAB3</a>,Y    ; WITH LOW RANGE (LOW)          ; +0 = OptValMin[x].Lo ?
213B:90 8C          222             BCC <a class='x' href='#SERR3' >SERR3</a>       ; BR IF RESULT &lt; LR
213D:A5 45          223             LDA <a class='v' href='#CNUM'  >CNUM</a>+<span class='n'>1</span>                                      ; +1 = cnum.hi &lt;
213F:D9 58 29       224 <a class='f' name='SP5'     >SP5         </a>CMP <a class='v' href='#OPTAB3'>OPTAB3</a>+<span class='n'>3</span>,Y                                  ; +3 = OptValMax[x].Hi ?
2142:90 0B          225             BCC <a class='x' href='#SP6'   >SP6</a>         ; BR IF LESS
2144:D0 83          226 <a class='f' name='SERR3A'  >SERR3A      </a>BNE <a class='x' href='#SERR3'>SERR3</a>       ; BR IF GREATER
2146:A5 44          227             LDA <a class='v' href='#CNUM'  >CNUM</a>        
2148:D9 57 29       228             CMP <a class='v' href='#OPTAB3'>OPTAB3</a>+<span class='n'>2</span>,Y                                  ; +2 = OptValMax[x].Lo
214B:90 02          229             BCC <a class='x' href='#SP6'   >SP6</a>         ; BR IF LESS
214D:D0 F5          230             BNE <a class='x' href='#SERR3A'>SERR3A</a>      ; BR IF GREATER
                    231 ;
214F:AD 63 2A       232 <a class='f' name='SP6'    >SP6         </a>LDA <a class='v' href='#TEMP1A'>TEMP1A</a>      ; IF PASS 1, THEN
2152:D0 94          233             BNE <a class='x' href='#SP1'   >SP1</a>         ; DONT STORE RESULT
2154:98             234             TYA             
2155:4A             235             LSR A           
2156:A8             236             TAY             
                    237 ;
2157:A5 45          238             LDA <a class='v' href='#CNUM'>CNUM</a>+<span class='n'>1</span>      ; STORE THE RESULT
2159:99 67 2A       <a class='line' name='CMDSCAN.239'>239</a>             STA <a class='v' href='#CUROPT'>CUROPT</a>+<span class='n'>1</span>,Y
215C:A5 44          240             LDA <a class='v' href='#CNUM'>CNUM</a>
<hr>215E:99 66 2A       241             STA <a class='v' href='#CUROPT'>CUROPT</a>,Y                                    ; === Page <a class='page' name='page20'>20</a> ===
2161:4C E8 20       242 <a class='f' name='SP7'    >SP7         </a>JMP <a class='x' href='#SP1'>SP1</a>         ; GO FOR NEXT OPT
                    243 ;
                    244 <a class='f' name='SP8'    >SP8         </a>EQU *           ; MONITOR REQ                   ; Have 'C', 'I', or 'O'
2164:48             245             PHA             ; SAVE TYPE REQ
2165:A9 80          246             LDA #<a class='e' href='#CIO'>CIO</a>        ; SET OPTION OF CIO
2167:0D 65 2A       247             ORA <a class='v' href='#INOPTS'>INOPTS</a>
216A:8D 65 2A       248             STA <a class='v' href='#INOPTS'>INOPTS</a>
216D:68             249             PLA             ; RESTOERE REQ
216E:29 7F          250             AND #$<span class='n'>7F</span>        ; CLEAR CIO                     ; <a class='magic' name='_216F'>magic number</a> Why not ~<a class='e' href='#CIO'>CIO</a> ? Crappy tool (assembler)??
2170:0D 74 2A       251             ORA <a class='v' href='#IMBITS'>IMBITS</a>      ; OR WITH PREV IMBITS
2173:8D 74 2A       252             STA <a class='v' href='#IMBITS'>IMBITS</a>
2176:D0 E9          253             BNE <a class='x' href='#SP7'>SP7</a>         ; GO FOR NEXT
                    254 ;
2178:F0 9C          255             BEQ <a class='x' href='#SERR2A'>SERR2A</a>      ;BRANCH ALWAYS
                    256 ;
217A:20 80 21       257 <a class="f" name="CMDGO"  >CMDGO       </a>JSR <a class="x" href="#CMDGO1">CMDGO1</a>      ; CMDGO - EXECUTE COMMAND
217D:4C 83 1F       258             JMP <a class="x" href="#CERTN">CERTN</a>
                    259 ;
                    260 <a class="f" name="CMDGO1">CMDGO1      </a>EQU *
2180:20 5B 27       261             JSR <a class="x" href="#CLRSTS">CLRSTS</a>                                      ; Clear States
2183:20 AE 21       262             JSR <a class="x" href="#CLRCCB">CLRCCB</a>      ; GO CLEAR CCB                  ; /sarcasm I never would have guessed
                    263 <a class="f" name="ECMD"   >ECMD        </a>EQU *
2186:AD 5F 2A       <a class='line' name='CMDSCAN.264'>264</a>             LDA <a class="v" href="#CMDNO">CMDNO</a>       ; COMMAND NO                    ; <i>Think, McFly!</i>
2189:AA             265             TAX             ; IS CMD EXEC TAB INDEX         ; <a class='mem' name='_2189'>wastes</a> 1 byte /sarcasm If only we had <span class='code'>LDX CMDNO</span> on Line #<a class='line' href='#CMDSCAN.264'>264</a>
218A:BD 1F 1D       266             LDA <a class='v' href='#CMDETB'>CMDETB</a>+<span class='n'>1</span>,X  ; GET CMD ADR                   ;[..
218D:48             267             PHA             ; ONTO STACK                    ; ..
218E:BD 1E 1D       268             LDA <a class='v' href='#CMDETB'>CMDETB</a>,X                                    ; ..
2191:48             269             PHA                                             ; ..
2192:60             270             RTS             ; AND GOTO COMMAND              ; ..] classic technique of 6502 jump table, use RTS to "call" the function pointer
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="XOPNCLS">XOPNCLS</a> - Execute Open / Close, Pages <a class="page" name='page150'>150</a> - 154, <a class='ts' href='#T1S0'>T1S0</a> - <a class='ts' href='#T1S2'>T1S2</a>, $<span class='n'>A193</span> .. $<span class='n'>A330</span>  ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;                                                           ; Setup: LineLength (current char offset in Line Buffer to process)
                    003 ; GNXTC - GET NEXT CHAR                                     ; In   : n/a
                    004 ;                                                           ; Out  : A=char in LineBuffer, (X=LineLength if CR else X=LineLength+1)
                    005 <a class='f' name='GNXTC'    >GNXTC       </a>EQU *                                           ;        Z=1 if CR or COMMA, else Z=0
2193:AE 5D 2A       006             LDX <a class="v" href="#LBUFD">LBUFD</a>
2196:BD 00 02       007             LDA LFUFF,X     ; GET NEXT CHAR AND IF          ; char c = LineBuffer[ LineLength ];
2199:C9 8D          008             CMP #$<span class='n'>8D</span>        ; IS IT A CR                    ; gEqual = (c == '\r');
219B:F0 06          009             BEQ GNXTCR      ; THEN RETURN WITHOUT           ; if( gEqual )
219D:E8             010             INX             ; INCR TO NEXT CHAR             ;     return c;
219E:8E 5D 2A       011             STX LBUFD                                       ; LineLength++;
21A1:C9 AC          012             CMP #','+$<span class='n'>80</span>    ; TEST FOR COMMA                ; gEqual = (c == ',');
21A3:60             013 <a class='f' name='GNXTCR'   >GNXTCR      </a>RTS                                             ; return c;
                    014 ;
                    015 ; GNBC - GET NON BLANK CHAR
                    016 ;
                    017 <a class='f' name='GNBC'     >GNBC        </a>EQU *                                           ; char c;
21A4:20 93 21       018             JSR GNXTC       ; GO GET NEXT CHAR              ; do {
21A7:F0 FA          019             BEQ GNXTCR      ; BR IF COMMA OR CR             ;     c = GetNextChar();
21A9:C9 A0          020             CMP #$<span class='n'>A0</span>        ; IS IT BLANK                   ;     if (gEqual) break;
21AB:F0 F7          021             BEQ GNBC        ; BR IF BLANK                   ; } while (c == ' ');
21AD:60             022             RTS             ; DONE                          ; o7 Captain Obvious
                    023 ;
                    024 ; CLRCCB - CLEAR CCB
                    025 ;
                    026 <a class='f' name='CLRCCB'   >CLRCCB      </a>EQU *
21AE:A9 00          027             LDA #<span class='n'>0</span>
21B0:A0 16          028             LDY #CCBLEN     ; CCBLENGTH
21B2:99 BA 35       029 <a class='f' name='CLC1'     >CLC1        </a>STA CCB-<span class='n'>1</span>,Y     ; CLEAR BYTE
21B5:88             030             DEY
21B6:D0 FA          031             BNE CLC1
21B8:60             032             RTS
                    033             PAGE
                    034 ;
                    035 ; GETNUM - CONVERT ASCII INPUT TO NUMERIC
                    036 ;
                    037 <a class='f' name='GETNUM'   >GETNUM      </a>EQU *                                           ; cnum = atoi();
21B9:A9 00          038             LDA #<span class='n'>0</span>          ; CLEAR WORK AREA
21BB:85 44          039             STA CNUM
21BD:85 45          040             STA CNUM+<span class='n'>1</span>
21BF:20 A4 21       041             JSR GNBC                                        ; GetNonBlankChar()
21C2:08             042             PHP                                             ; need to save flags since testing for hex num nukes them
21C3:C9 A4          043             CMP #$<span class='n'>A4</span>                                        ; <a class='magic' name='_21C4'>magic number</a> #'$'+$80 (improvement), CHAR_DOLLAR (better), or OPT_NUM_HEX (best)
21C5:F0 3C          044             BEQ HEXNUM                                      ; &darr; $2203
21C7:28             045             PLP
21C8:4C CE 21       046             JMP GN2A                                        ; <a class='mem' name='_'>wastes</a> 1 byte, <span class='code'>BMI GN2A</span>
                    047 ;
21CB:20 A4 21       048 <a class='f' name='GN2'      >GN2         </a>JSR GNBC        ; GET NEXT NON BLANK
                    049 <a class='f' name='GN2A'     >GN2A        </a>EQU *
21CE:D0 06          050             BNE <a class='x' href='#GN3'>GN3</a>         ; BR NOT COMMA OR CR
21D0:A6 44          051             LDX CNUM        ; X=RESULT LOW
21D2:A5 45          052             LDA CNUM+<span class='n'>1</span>      ; Y=RESULT HI                   ; *sigh* *spelling* A=Result Hi as Y isn't even used!
21D4:18             053             CLC
<hr>21D5:60             054             RTS             ; DONE                          ; === Page <a class='page' name='page151'>151</a> === o7 Captain Obvious
                    055 ;
21D6:38             056 <a class='f' name='GN3'      >GN3         </a>SEC                                             ; GetDigit
21D7:E9 B0          057             SBC #$B0        ; SUBTRACT ASCII 0              ; <i>You keep using this word <b>ASCII</b>, it doesn't mean what you think it means.</i>, #'0'+$80
21D9:30 21          058             BMI GN4         ; BR IF NOT SUM
21DB:C9 0A          059             CMP #<span class='n'>10</span>
21DD:B0 1D          060             BCS GN4         ; BR IF NOT NUM
21DF:20 FE 21       061             JSR GN5         ; OLD*2                         ; <b>Test Time</b>: 1. Describe what GN5 does without looking at the code.
21E2:65 44          062             ADC CNUM        ; PLUS NEW                      ;            2. Describe what MUL2CNUM does.
21E4:AA             063             TAX                                             ; n*10 = n*8 + n*2
21E5:A9 00          064             LDA #<span class='n'>0</span>
21E7:65 45          065             ADC CNUM+<span class='n'>1</span>
21E9:A8             066             TAY
21EA:20 FE 21       067             JSR GN5         ; OLD*4
21ED:20 FE 21       068             JSR GN5         ; OLD*8
21F0:8A             069             TXA             ; OLD*8 + OLD*2 + NEW
21F1:65 44          070             ADC CNUM
21F3:85 44          071             STA CNUM        ; =OLD*10 + NEW
21F5:98             072             TYA
21F6:65 45          073             ADC CNUM+<span class='n'>1</span>
21F8:85 45          074             STA CNUM+<span class='n'>1</span>
21FA:90 CF          075             BCC GN2
                    076 ;
                    077 <a class='f' name='GN4'      >GN5         </a>EQU *
21FC:38             078             SEC
21FD:60             079             RTS             ; DONE
                    080 <a class='f' name='GN5'      >GN5         </a>EQU *
21FE:06 44          081             ASL CNUM        ; CNUM * 2
2200:26 45          082             ROL CNUM+<span class='n'>1</span>                                      ; === <a class='ts' name='T1S1'>T1S1</a> ===
2202:60             083             RTS
                    084             PAGE
                    085 ;
                    086 <a class='f' name='HEXNUM'   >HEXNUM      </a>EQU *
2203:28             087             PLP
                    088 <a class='f' name='HN0'      >HN0         </a>EQU *
2204:20 A4 21       089             JSR GNBC        ; GO GET CHAR
2207:F0 C5          090             BEQ GN2A        ; BR IF CR OR COMMA
                    091 ;
2209:38             092             SEC
220A:E9 B0          093             SBC #$B0        ; CHAR - ASCII0                 ; ASCII is 7-bit, not 8-bit, SBC #'0'+$80
220C:30 EE          094             BMI GN4         ; BR IF LT0                     ; signed c = GetNextLineBufferChar()
220E:C9 0A          095             CMP #<span class='n'>10</span>         ; IS IT LT10                    ; if ((c - '0') &lt; 0) return;
2210:90 08          096             BCC HN1         ; BR IF LT                      ; if (c &gt;= 10) c -= ('A' -'9');
2212:E9 07          097             SBC #$<span class='n'>7</span>         ; SUB 7 FOR ASCII A             ; <a class='magic' name='_2213'>magic number</a> 7 = ('A' -'9')
2214:30 E6          098             BMI GN4         ; BR IF LT A
2216:C9 10          099             CMP #<span class='n'>16</span>         ; TEST GT 15
2218:B0 E2          100             BCS GN4         ; BR GT 15                      ; A = digit = 0..F
221A:A2 04          101 <a class='f' name='HN1'      >HN1         </a>LDX #<span class='n'>4</span>                                          ; CNUM &lt;&lt;= 4; // shift left one nibble
221C:20 FE 21       102 <a class='f' name='HN2'      >HN2         </a>JSR GN5         ; OLD*16
221F:CA             103             DEX             ;LOOP 4 TIMES ONLY
2220:D0 FA          104             BNE HN2
2222:05 44          105             ORA CNUM        ; OR IN NEW                     ; CNUM += digit
2224:85 44          106             STA CNUM        ; SAVE NEW
2226:4C 04 22       107             JMP HN0         ; GO FOR NEXT CHAR
                    108             PAGE
                    109 ;
                    110 ;  EPR - EXECUTE PR#
                    111 ;
                    112 <a class='f' name='EPR'      >EPR         </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [13]
2229:A5 44          113             LDA CNUM        ; GET PORT                      ; Get *slot* #, not port
222B:4C 95 FE       114             JMP OUTPRT      ; GO DO IT
                    115 ;
                    116 ; EIN - EXECUTE IN#
<hr>                    117 ;                                                           ; === <a class='page' name='page152'>152</a> ===
                    118 <a class='f' name='EIN'      >EIN         </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [14]

222E:A5 44          119             LDA CNUM        ; GET PORT
2230:4C 8B FE       120             JMP INPRT       ; GO DO IT
                    121 ;
                    122 ; EMON - EXECUTE MONITOR CMD
                    123 ;
                    124 <a class='f' name='EMON'     >EMON        </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [11]

2233:AD 5E 2A       125             LDA MONMOD      ; GET CURRENT BITS
2236:0D 74 2A       126             ORA IMBITS      ; OR IN NEW BITS
2239:8D 5E 2A       127             STA MONMOD      ; SET NEW MODE
223C:60             128             RTS
                    129 ;
                    130 ; ENOMON - EXECUTE NO MONITOR CMD
                    131 ;
                    132 <a class='f' name='ENOMON'   >ENOMON      </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [12]

223D:2C 74 2A       133             BIT IMBITS
                    134             BVC ENM1
                    135             JSR PRCRIF
                    136 ENM1        EQU *
2245:A9 70          137             LDA #$<span class='n'>70</span>                                        ; <a class='magic' name='_2246'>magic number</a>
                    138             EOR IMBITS      ; INVERT INPUT BITS
                    139             AND MONMOD      ; AND WITH CURRENT
                    140             STA MONMOD      ; SET NEW MODE
                    141             RTS
                    142             PAGE
                    143 ;
                    144 ; EMAXF - EXECUTE MAX FILES
                    145 ;
                    146 <a class='f' name='EMAXF'    >EMAXF       </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [15]
2251:               147             LDA #<span class='n'>0</span>              ; RESET EXECUTE
                    148             STA ESTATE
                    149             LDA CNUM        ; SAVE NEW NO FILES
                    150             PHA
                    151             JSR CLALL       ; GO CLOSE ALL FILES
                    152             PLA
                    153             STA CNFTBS      ; SET NEW NO FILE TBLS
                    154             JMP BLDFTB      ; GO BUILD NEW ONES
                    155 ;
                    156 ; EDEL - DELETE A FILE
                    157 ;
                    158 <a class='f' name='EDEL'     >EDEL        </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [5]
2263:               159             LDA #CRQDEL
2265:20 AA 22       160             JSR OPEN
                    161             JSR FILSRC
                    162             LDY #<span class='n'>0</span>                                          ; <a class='dumb' name='_'>Common Code</a> WHY isn't this a common subroutine <a class='link code' name='ZEROFILE'>ZEROFILE</a> ??
                    163             TYA                                             ; <a class='x' href='#BFT1'>BFT1</a>, <a class='x' href='#CLS'>CLS</a>, and the Append bug patch <a class='x' href='#CLOSFILE'>CLOSFILE</a> <i>all</i> do the same thing!
                    164             STA (ZPGWRK),Y  ; RESET FN                      ; Sadly, <a class='x' href='#INITD'>INITD</a> can't be re-factored.
                    165             RTS                                             ;
                    166 ;
                    167 ;  ELOCK - LOCK A FILE
                    168 ;
                    169 <a class='f' name='ELOCK'    >ELOCK       </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [6]
2271:               170             LDA #CRQLCK     ; SET LOCK
                    171             BNE ELGO                                        ; <a class='mem' name='_'>wastes</a> 1 byte, use <span class='code'>DFB $2C ; BIT $abs</span> to skip next instruction
                    172 ;
                    173 ; EUNLK - UNLOCK A FILE
                    174 ;
                    175 <a class='f' name='EUNLK'    >EUNLK       </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [7]
2275:               176             LDA #CRQUNL     ; SET UNLOCK
                    177 ELGO        EQU *                                           ; Holy shit! Common Code for ELOCK, EUnlock, EVerify but not to rain on our parade ...
                    178             JSR OPEN        ; OPEN FILE &amp; UNLOCK            ; ... <a class='dumb' name='CommonCodeELGO'>Common Code</a> Why is <a class='x' href='#ELGO'>ELGO</a> and <a class='x' href='#LCKGO'>LCKGO</a> different???
                    179             JMP ECLOSE      ; CLOSE IT
<hr>                    180 ;                                                           ; === Page <a class='page' name='pagename153'>153</a>
                    181 ; EVAR - VERIFY A FILE
                    182 ;
                    183 <a class='f' name='EVAR'     >EVAR        </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [1B]
227D:               184             LDA #CRQVAR     ; SET VARIFY                    ; *spelling* <i>Damnit, Jim, I wish you would VARIFY your spelling.</i>
                    185             BNE ELGO
                    186             PAGE
                    187 ;
                    188 ; EREN - RENAME
                    189 ;
                    190 <a class='f' name='EREN'     >EREN        </a>EQU *
2281:               191             LDA <a class='v' href='#FN2ADR'>FN2ADR</a>      ; MOVE FILE NAME2
                    192             STA <a class='v' href='#CCBFN2'>CCBFN2</a>
                    193             LDA <a class='v' href='#FN2ADR'>FN2ADR</a>+<span class='n'>1</span>        
                    194             STA <a class='v' href='#CCBFN2'>CCBFN2</a>+<span class='n'>1</span>        
                    195             LDA <a class='v' href='#CRQRNM'>CRQRNM</a>
                    196             STA <a class='v' href='#TEMP1A'>TEMP1A</a>      ; SET RENAME
                    197             JSR <a class='x' href='#EO3'>EO3</a>         ; GO OPEN AND RENAME
                    198             JMP <a class='x' href='#ECLOSE'>ECLOSE</a>      ; GO CLOSE
                    199 ;
                    200 ; EAPND - OPEN FILE FOR APPEND
                    201 ;
                    202 <a class='f' name='EAPND'    >EAPND       </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [E]
2298:               203             JSR <a class='x' href='#EOPEN'>EOPEN</a>       ; GO OPEN
                    204 <a class='f' name='AP1'      >AP1         </a>EQU *
                    205             JSR <a class='x' href='#RBYTE'>RBYTE</a>       ; READ A BYTE
                    206             BNE <a class='x' href='#AP1'>AP1</a>         ; BR IF NOT ZERO
                    207 ;                                                           ; <b>Test Time!</b> Without looking at the code, give a summary of why 
                    208             JMP <a class='x' href='#BUMPER'>BUMPER</a>      ; GO TO PATCH FOR APPEND FIX    ; a) <span class='code'>BUMPER</span> exists, and
                    209             PAGE                                            ; b) <span class='code'>APPEND_FIX</span>.
                    210 ;
                    211 ; EOPEN - OPEN A FILE
                    212 ;
22A3:A9 00          213 <a class='f' name='EOPEN'    >EOPEN       </a>LDA #<span class='n'>0</span>          ;FIX TYPE MISMATCH DETECTION    ; <a class='v' href='#CMDETB'>CMDETB</a> [D]
22A5:4C             214             JMP SV1         ;(CALLS EOPN1)                  ; Why not <span class='code'>JSR SV1</span>??? <a class='x' href='#EASAV'>EASAV</a>, <a class='x' href='#EBSV'>EBSV</a>, and <a class='x' href='#EBLD'>EBLD</a> all do <span class='code'>JSR SV1</span>
22A8:A9             215 EOPN1       LDA #CRQOPN
                    216 <a class='f' name='OPEN'     >OPEN</a>        EQU *                     ; Common entry point for EDEL, EUNLK, EBSV, EINIT, ECAT, and indirectly EOPEN, EPOS,
22AA:8D             217             STA TEMP1A
                    218             LDA CL          ; IF NO LENGTH ENTERED
                    219             BNE EO1         ; THEN SET DEFAULT OF 1
                    220             LDA CL+<span class='n'>1</span>
                    221             BNE EO1
                    222             LDA #<span class='n'>1</span>
                    223             STA CL
                    224 EO1         EQU *
                    225             LDA CL          ; MOVE REC LENGTH
                    226             STA CCBRLN
                    227             LDA CL+<span class='n'>1</span>
                    228             STA CCBRLN+<span class='n'>1</span>
                    229 EO3         EQU *
                    230             JSR ECLOSE      ; GO CLOSE IF OPEN
                    231 EO4         EQU *
                    232             LDA CNUM+<span class='n'>1</span>      ; GET AVALL ENTRY               ; *Spelling* Avail
                    233             BNE EO5         ; BR IF ONE AVAIL
                    234             JMP ENFA        ; DONE - NO FILES AVAIL
                    235 EO5         EQU *
                    236             STA ZPGWRK+<span class='n'>1</span>    ; MOVE AVAIL SLOT TO ZPG
                    237             LDA CNUM
                    238             STA ZPGWRK
                    239 EO6         EQU *
                    240             JSR MVFN1       ; GO MOVE FILE NAME
                    241             JSR MVBUFP      ; GO MOVE BUF PTRS
                    242             JSR OPNSUP      ; GO SET UP OPEN
<hr>                    243             LDA TEMP1A      ; SET OPEN REQ                  ; === <a class='page' name='page154'>154</a> ===
                    244             STA CCBREQ
                    245             JMP DOSGO       ; GO OPEN
                    246             PAGE
                    247 ;
                    248 ; ECLOSE - EXECUTE CLOSE FILE COMMAND
                    249 ;
                    250 <a class='f' name='ECLOSE'   >ECLOSE      </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [8]
22EA:AD 75 2A       251             LDA FNAME1
22ED:C9 A0          252             CMP #$<span class='n'>A0</span>                                        ; #' '+$80 aka SPC_HI
22EF:F0 25          253             BEQ CLALL
22F1:20 64 27       254             JSR FILSRC      ; GO FIND FILE
22F4:B0 3A          255             BCS CL2         ; BR IF NOT FOUND
22F6:20 FC 22       256             JSR CLOSE       ; GO CLOSE
22F9:4C EA 22       257             JMP ECLOSE      ; GO SEE IF ANY MORE OPEN
                    258 ;
                    259 ; CLOSE - CLOSE A FILE
                    260 ;
                    261 <a class='f' name='CLOSE'    >CLOSE       </a>EQU *
22FC:20 AD 27       262             JSR TSTEXC
22FF:D0 05          263             BNE CLX                                         ; === <a class='ts' name='T1S2'>T1S2</a> ===
2301:A9 00          264             LDA #<span class='n'>0</span>
2303:8D B3 2A       265             STA ESTATE
                    266 CLX         EQU *
2306:A0 00          267             LDY #<span class='n'>0</span>          ; CLEAR 1ST FN                  ; [.. <a class='mem' name='_2306'>wastes</a> 2 bytes, see <a class='link' href='#ZEROFILE'>ZEROFILE</a> note
                    268             TYA             ; CHAR TO ZERO                  ;  ..
                    269             STA (ZPGWRK),Y                                  ;  ..]
                    270             JSR MVBUFP      ; MOVE BUFFER PTRS
                    271             LDA #CRQCLS     ; SET CLOSE
                    272             STA CCBREQ
                    273             JMP DOSGO
                    274 ;
                    275 ; CLALL - CLOSE ALL FILES
                    276 ;
                    277 <a class='f' name='CLALL'    >CLALL       </a>EQU *
                    278             JSR TSINIT      ; GO INIT FILE SEARCH
                    279             BNE CL1 
                    280 <a class='f' name='CL0'      >CL0         </a>EQU *
                    281             JSR TXNXT       ; NEXT ENTRY
                    282             BEQ CL2         ; BR IF NO MORE
                    283 <a class='f' name='CL1'      >CL1         </a>EQU *
                    284             JSR TXTEXC
                    285             BEQ CL0
                    286             JSR TSTOPEN     ; GO TEST OPEN
                    287             BEQ CL0         ; BR NOT OPEN
232A:20 FC A2       288             JSR CLOSE       ; GO CLOSE
232D:4C 16 23       289             JMP CLALL       ; START OVER
2330:60             290 <a class='f' name='CL2'      >CL2         </a>RTS             ; DONE
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="XLODSAV">XLODSAV</a> - Execute Load / Save, Pages <a class='page' name='page140'>140</a> - 144, <a class='ts' href='#T1S2'>T1S2</a> - <a class='ts' href='#T1S4'>T1S4</a>, $<span class='n'>A331</span> .. $<span class='n'>A50F</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ; EBSV - EXECUTE BINARY SAVE
                    004 ;
                    005 <a class='f' name='EBSV'     >EBSV        </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [18] "BSAVE"
2331:A9 09          006             LDA #ADR+L      ; IF A&amp;L
2333:2D 65 2A       007             AND INOPS       ; NOT GIVEN
2336:C9 09          008             CMP #ADR+L
2338:F0 03          009             BEQ EBSV1
233A:4C 00 20       010             JMP CNF         ; THEN ERROR
                    011 <a class='f' name='EBSV1'    >EBSV1       </a>EQU *
233D:A9 04          012             LDA #<span class='n'>4</span>          ; SET BINARY FILE               ; <a class='magic' name='_233E'>magic number</a> <span class='code'>FILE_TYPE_BINARY EQU 4</span>
                    013             JSR SV1         ; GO OPEN &amp; TEST
                    014             LDA CA+1        ; OUTPUT ADR OF BLOCK
                    015             LDY CA           
                    016             JSR SV2         
                    017             LDA CL+1        ; GO OPEN AND TEST
                    018             LDY CL
                    019             JSR SV2         ; OUTPUT LENGTH
                    020             LDA CA+1        ; GET ADR GIVEN
                    021             LDY CA
                    022             JMP SV3         ; OUTPUT BLOCK
                    023 ;
                    024 ; EBLD - EXECUTE BINARY LOAD
                    025 ;
                    026 <a class='f' name='EBLD'     >EBLD        </a>EQU *                                           ; <a class='v' href='#CMDETB'>CMDETB</a> [19]
235D:20 A8 22       027             JSR EOPN1       ;(CHANGED 11/1/78 FOR TYPE MISMATCH)
                    028 <a class='f' name='EBLD2'    >EBLD2       </a>EQU *                                           ; *sigh* If only the local labels were in alphabetical order ...
2360:A9 7F          029             LDA #$<span class='n'>7F</span>                                        ; <a class='magic' name='_2361'>magic number</a> ~FILE_LOCK
2362:2D C2 35       030             AND CCBFUC
2365:C9 04          031             CMP #<span class='n'>4</span>                                          ; <a class='magic' name='_2366'>magic number</a> FILE_TYPE_BINARY
2367:F0 03          032             BEQ EBLD3
2369:4C D0 26       033             JMP ETYP        ;TYPE MISMATCH ERROR MESSAGE
                    034 <a class='f' name='EBLD3'    >EBLD3       </a>EQU *
236C:A9 04          035             LDA #4          ; SET BINARY FILE               ; <a class='magic' name='_236D'>magic number</a> /sarcasm if only we had <span class='code'>FILE_TYPE_BINARY EQU 4</span>
236E:20 D5 23       036             JSR SV1         ; GO OPEN &amp; TEST
2371:20 7A 24       037             JSR LD2         ; GO GET ADR
2374:AA             038             TAX
2375:AD 65 2A       039             LDA INOPTS
2378:29 01          040             AND #ADR        ; IF ADR NOT GIVEN
237A:D0 06          041             BNE EBLD1                                       ; &darr;
237C:8E 72 2A       042             STX CA          ; THEN USE ADR FROM FILE
237F:8C 73 2A       043             STY CA+1
                    044 <a class='f' name='EBLD1'    >EBLD1       </a>EQU *
2382:20 7A 24       045             JSR LD2         ; GET LENGTH
2385:AE 72 2A       046             LDX CA          ; GET GIVEN ADR
2388:AC 73 2A       047             LDY CA+1
238B:4C 71 24       048             JMP LD3         ; GO GET BLOCK                  ; Why is this +128 bytes away??
                    049 ;
                    050 ; EBRUN - EXECUTE BINARY RUN
                    051 ;
238E:20 5D 23       052 <a class='f' name='EBRUN'    >EBRUN       </a>JSR EBLD                                        ; <a class='v' href='#CMDETB'>CMDETB</a> [1A]
2391:20 51 28       053             JSR MVCSW       ; GO RESTORE CHAR I/O SW
<hr>2394:6C 72 2A       054             JMP (CA)        ; GO EXEC THE STUFF             ; === Page <a class="page" name="page141">141</a> ===
                                                                                    ; <a class='dumb'>How Not To Design an OS</a>
                                                                                    ; <b>Problem :</b> This (indirect) <span class='code'>JMP</span> is why Binary programs can't use <span class='code'>RTS</span> to return to DOS
                                                                                    ; <b>Solution:</b> The otherwise excellent 6502 has a short-Sighted design
                                                                                    ;           it lacks indirect mode: <span class='code'>JSR ($addr)</span>:
                                                                                    ;           Regular 6502 solution requires self-modifying code.
                                                                                    ; <span class='code'>             LDA CA                                     </span>
                                                                                    ; <span class='code'>             STA GOBRUN+1    ; ** SELF-MODIFYING ! **   </span>
                                                                                    ; <span class='code'>             LDA CA+1                                   </span>
                                                                                    ; <span class='code'>             STA GOBRUN+2    ; ** SELF-MODIFYING ! **   </span>
                                                                                    ; <span class='code'>GOBRUN       JSR $0000       ; NOTE: Self-Modifying code</span>
                                                                                    ; <span class='code'>             JMP <a class='x' href='#DBRST'>DBRST</a>       ; Warmstart DOS            </span>
                    055             PAGE
                    056 ;
                    057 ; ESAVE - EXECUTE SAVE REQUEST
                    058 ;
                    059 <a class='f' name='ESAVE'    >ESAVE       </a>EQU *
2397:AD B6 2A       060             LDA ASIBSW      ; IF IB THEN
239A:F0 20          061             BEQ EIBSV       ; GO TO IB SAVE
239C:A5 D6          062             LDA ASRNX       ; CAN NOT DO AS SAVE WHEN RUN-ONLY PROG.
239E:10 03          063             BPL EASAV       ; BRANCH IF OK TO SAVE, OTHERWISE
23A0:4C CC 26       064             JMP MFERR       ; PRINT "PROGRAM TOO LARGE", THAT OUGHT TO GET 'EM.
23A3:A9 02          065 <a class='f' name='EASAV'    >EASAV       </a>LDA #<span class='n'>2</span>          ; GET APPLESOFT PGM             ; <a class='magic' name='_23A4'>magic number</a> <span class='code'>FILE_TYPE_APPLESOFT EQU 2</span>
23A5:20 D5 23       066             JSR SV1         ; GO OPEN AND TEST
                    067 ;
23A8:38             068             SEC             ; BLOCK LENGTH
23A9:A5 AF          069             LDA ASEOP       ; =EOP-SOP
23AB:E5 67          070             SBC ASSOP
23AD:A8             071             TAY
23AE:A5 B0          072             LDA ASEOP+<span class='n'>1</span>                                     ; single letter difference asEop
23B0:E5 68          073             SBC ASSOP+<span class='n'>1</span>                                     ; is never a good idea:    asSop
23B2:20 E0 23       074             JSR SV2         ; GO OUTPUT LENGTH
                    075 ;
23B5:A5 68          076             LDA ASSOP+1     ; BLOCK ADR
23B7:A4 67          077             LDY ASSOP       ; =SOP
23B9:4C FF 23       078             JMP SV3         ; GO OUTPUT BLOCK
                    079 ;
                    080 <a class='f' name='EIBSV'    >EIBSV       </a>EQU *
23BC:A9 01          081             LDA #<span class='n'>1</span>          ; SET IB PGM                    ; PGM = Program, <a class='magic' name='_23BD'>magic number</a> <span class='code'>FILE_TYPE_INTEGER_BASIC EQU 1</span>
23BE:20 D5 23       082             JSR SV1         ; GO OPEN AND TEST
                    083 ;
23C1:38             084             SEC             ; BLOCK LENGTH
23C2:A5 4C          085             LDA IBHMEM      ; =HIMEM-SOP
23C4:E5 CA          086             SBC IBSOP
23C6:A8             087             TAY
23C7:A5 4D          088             LDA IBHMEM+<span class='n'>1</span>
23C9:E5 CB          089             SBC IBSOP+<span class='n'>1</span>
23CB:20 E0 23       090             JSR SV2         ; GO OUTPUT LENGTH
                    091 ;
23CE:A5 CB          092             LDA IBSOP+<span class='n'>1</span>     ; BLOCK ADR
23D0:A4 CA          093             LDY IBSOP       ; =SOP
23D2:4C FF 23       094             JMP SV3         ; GO OUTPUT BLOCK
                    095 ;
                    096 <a class='f' name='SV1'      >SV1         </a>EQU *
                    097 <a class='f' name='SV1A'     >SV1A        </a>EQU *
23D5:8D C2 35       098             STA CCBFUC      ; SET PGM TYPE
23D8:48             099             PHA             ; SAVE PGM TYPE
23D9:20 A8 22       100             JSR EOPN1       ; GO OPEN FILE  (CHGED 11/1/78)
23DC:68             101             PLA             ; GET SAVE TYPE
23DD:4C C4 27       102             JMP TSTFUC      ; GO CHECK
                    103 ;
                    104 <a class='f' name='SV2'      >SV2         </a>EQU *
23E0:8C C1 35       105             STY CCBBLN      ; SET BLOCK LENGTH              ; === <a class='dumb' name='HNTDAFS5'>HNTDAFS #5</a> ===
23E3:8C C3 35       106             STY CCBDAT      ; AND DATA BYTE                 ; You <b>never</b> store file meta-data
23E6:8D C2 35       107             STA CCBBLN+<span class='n'>1</span>                                    ;    File Length
23E9:A9 04          108             LDA #CRQWR      ; INDICATE WRITE                ; <i>in</i> the file itself!
23EB:8D BB 35       109             STA CCBREQ
23EE:A9 01          110             LDA #CRNBT      ; NEXT BYTE
23F0:8D BC 35       111             STA CCBRQM
23F3:20 A8 26       112             JSR DOSGO       ; GO WRITE
23F6:AD C2 35       113             LDA CCBBLN+<span class='n'>1</span>    ; OTHER BYTE TOO
23F9:8D C3 35       114             STA CCBDAT
<hr>23FC:4C A8 26       115             JMP DOSGO                                       ; === Page <a class='page' name='page142'>142</a> ===
                    116 ;
                    117 <a class='f' name='SV3'      >SV3         </a>STY CCBBBA      ; SET BLOCK ADR
                    118             STA CCBBBA+<span class='n'>1</span>
                    119             LDA #CRMNBL     ; INDICATE BLOCK I/O
                    120             JMP VPATCH      ;VERIFY AFTER SAVE
                    121 <a class='f' name='GODOS'    >GODOS       </a>JSR DOSGO       ; GO DO IT
                    122             JMP ECLOSE      ; CLOSE FILE
                    123             PAGE
                    124 <a class='f' name='NBPER'    >NBPER       </a>NBPER       JMP ERNU1                           ; Not Basic Program Error called from ELD1
                    125 ;
                    126 ; ELOAD - EXECUTE LOAD REQUEST
                    127 ;
                    128 <a class='f' name='ELOAD'    >ELOAD       </a>EQU *
                    129             JSR CLALL
                    130 <a class='f' name='ELOAD0'   >ELOAD0      </a>JSR EOPN1
                    131 ;
                    132 <a class='f' name='ELD1'     >ELD1        </a>EQU *                                           ; *sigh* Pick a bloody <i>consistent</i> naming schema: ELOAD# or ELD#
2419:A9 23          133             LDA #$<span class='n'>23</span>        ; STRIP UNRELATED STUFF         ; <a class='magic' name='_241A'>magic number</a>
                    134             AND CCBFUC      ; OUT OF FUC
                    135             BEQ NBPER       ; BR IF ERROR
                    136 ; ISOLATE IB &amp; AS
                    137 <a class='f' name='ELD2'     >ELD2        </a>EQU *
                    138             STA CCBFUC      ; SAVE IB/AS ONLY
                    139             LDA ASISBSW     ; IF IB THEN
                    140             BEQ EIBL        ; GO TO IB LOAD
2428:A9 02          141             LDA #2                                          ; <a class='magic' name='_2429'>magic number</a> <span class='code'>FILE_TYPE_APPLESOFT EQU 2</span>
                    142             JSR LD1         ; GO OPEN AND TEST
                    143 ;
242D:20 7A 24       144             JSR LD2         ; GO GET BLOCK LENGTH           ; <a class='mem' name='_242D'>wastes</a> 3 bytes, LD1 should fall into LD2
                    145 ;                                                           ; While EBLD2 (ExecBload2) calls LD2 by itself, LD1 is always followed by LD2
                    146             CLC
                    147             ADC ASSOP       ; ADD BLOCK LENGTH TO SOP
                    148             TAX
                    149             TYA
                    150             ADC ASSOP+1
                    151 ;
                    152             CMP ASHM1+1     ; IF BL+SOP &gt;= HMEM             ; If Block.Length + StartOfProgram &gt;= High Memory
                    153             BCS MFULL       ; THEN WON'T FIT                ; Memory Full
                    154 ;
                    155 <a class='f' name='EASL1'    >EASL1       </a>EQU *
                    156             STA ASEOP+<span class='n'>1</span>     ; SET NEW EOP ADR
                    157             STA ASEOP2+<span class='n'>1</span>
                    158             STX ASEOP
                    159             STX ASEOP2
                    160             LDX ASSOP       ; GET ADR WHERE TO LOAD
                    161             LDY ASSOP+<span class='n'>1</span>
                    162             JSR LD3         ; GO LOAD
                    163             JSR MVCSW       ;RESTORE I/O                    ; <span class='todo'>TODO</span> Why??? Did something change CIN/COUT ???
                    164             JMP (ASEQ)      ;RELOC FOR THIS VERSION OF APPLSOFT
                    165 ;
                    166 <a class='f' name='EIBL'     >EIBL        </a>EQU *
                    167             LDA #1          ; SET IB PGM                    ; Yup, almost 99% the same as ELD2
2452:20 B1 24       168             JSR LD1         ; GO OPEN AND TEST
                    169 ;
2555:20 7A 24       170             JSR LD2         ; GO GET BLOCK LENGTH           ; <a class='mem' name='_2555'>wastes</a> 3  bytes, see Line #141
                    171 ;
2458:38             172             SEC             ; HMEM - BLOCK LENGTH
                    173             LDA IBHMEM      ; IS NEW SOP
                    174             SBC SVBL
                    175             TAX
                    176             LDA IBHMEM+<span class='n'>1</span>
                    177             SBC SVBL+<span class='n'>1</span>
<hr>                    178             BCC MFULL                                       ; === Page <a class='page' name='page143'>143</a> ===
                    179             TAY
                    180 ;
                    181             CPY IBLMEM+<span class='n'>1</span>    ; IF NEW SOP &lt;= LMEM
                    182             BCC MFULL
                    183             BEQ MFULL
                    184             STY IBSOP+<span class='n'>1</span>     ; SET NEW SOP
                    185             STX IBSOP
                    186 <a class='f' name='LD3'      >LD3         </a>EQU *
                    187             STX CCBBBA      ; SET BLOCK ADDR                ; Googoo, Gaga? A single underscore '_' would go a LONG way towards readability
                    188             STY CCBBBA+<span class='n'>1</span>                                    ; CCB_BBA
                    189             JMP GODOS
                    190 ;
                    191 <a class='f' name='LD2'      >LD2         </a>EQU *                                           ; By putting this before LD1 this forces 6 byes to be wasted, see Line #143
247A:AD 0A 1D       192             LDA SVBLA       ; MOVE ADR OF WHERE
                    193             STA CCBBA       ; TO PUT DATA TO
                    194             LDA SVBLA+1     ; CCBN
                    195             STA CCBBBA+1
                    196             LDA #0
                    197             STA CCBBLN+1    ; READ INTO
                    198             LDA #2
                    199             STA CCBBLN
                    200             LDA #CRQRD      ; READ
                    201             STA CCBREQ
                    202             LDA #CRMNBL     ; BLOCK
                    203             STA CCBRQM
249A:20 A8 26       204             JSR DOSGO
                    205             LDA SVBL+1
                    206             STA CCBBLN+1
                    207             TAY
                    208             LDA SVBL
                    209             STA CCBBLN
                    210             RTS
                    211 ;
                    212 <a class='f' name='MFULL1'   >MFULL1      </a>EQU *
24AB:20 EA 2A       213             JSR ECLOSE      ; GO CLOSE FILE
24AE:4C CC 26       214             JMP MFERR       ; AND GIVE ERR MSG
                    215 LD1         EQU *
                    216             CMP CCBFUC      ; TEST TYPE
                    217             BEQ LD1C        ; BR IF MATCH
                    218             LDX CMDNO
                    219             STX SVCMD
                    220             LSR A
                    221             BEQ LD1A        ; BR IF PGM IS AS
                    222             JMP EINT        ; GO FOR INTG BASIC
                    223 ;
                    224 LD1A        EQU *
24C2:A2 1D          225             LDX #<span class='n'>29</span>         ; SAVE FILENAME                 ; <a class='magic' name='_24C3'>magic number</a> <span class='code'>FILENAME_MAX-1</span>
                    226 LD1B        LDA FNAME1,X    ; INCASE IS RAM APPLESOFT
                    227             STA FNAME2,X
                    228             DEX
                    229             BPL LD1B
                    230             JMP EAS         ; GO FOR AS
                    231 ;
                    232 LD1C        RTS
                    233             PAGE
                    234 ;
                    235 ; ERUN - EXECUTE RUN REQUEST
                    236 ;
                    237 ERUN        EQU *
                    238             LDA ASIBSW      ; IF APPLESOFT THEN RELOC FLAG SET
                    239             BEQ ERUN0
                    240             STA RSTATE      ; INDICATE APSFT RUN
<hr>                    241 ERUN0       JSR ELOAD       ; LOAD PGM                      ; === <a class='page' name='page144'>144</a> ===
                    242 ERUN1       JSR PRCRIF      ;REENTRY POINT FOR ASFT RELOC
                    243             JSR MVCSW       ; GO RESTORE CHAR I/O SW        ; <span class='todo'>TODO</span> What keeps futzing with CIN / COUT ??
                    244             JMP (RUN)
                    245 ;
                    246 ; IBRUN - INT BASIC RUN
                    247 ;
                    248 IBRUN       EQU *
                    249             LDA IBLMEM      ; RESET START OF VARS
                    250             STA IBSOV
                    251             LDA IBLMEM+<span class='n'>1</span>
                    252             STA IBSOV+<span class='n'>1</span>
24ED:6D 56 1D       253             JMP (CHAIN)
                    254 ;
                    255 ; EHCAIN - EXECUTE CHAIN REQUEST                            ; *spelling* ECHAIN
                    256 ;
                    257 ECHAIN      EQU *
24F0:20 16 24       258             JSR ELOAD0      ; LOAD PGM WITHOUT CLOSING READ FILES
24F3:20 C8 1F       259             JSR PRCRIF
24F6:20 51 28       260             JSR MVCSW       ; GO RESTORE CHAR I/O SW
24D9:6C 56 1D       261             JMP (CHAIN)
24FC:20 65 D6       262 ASRUN1      JSR $<span class='e'>D665</span>       ; ROM                           ; <a class='magic' name='_24FD'>magic number</a>
24FF:85 33          263             STA PROMPT      ;INSURES APPLESOFT RUN DETECT (A=0)     ; === <a class='ts' name=T1S4'>T1S4</a> ===
2501:85 D8          264             STA ASONERR     ;RESET APPLESOFT ONERR FLAG
2503:4C D2 D7       265             JMP $<span class='n'>D7D2</span>                                       ; <a class='magic' name='_2503'>magic number</a>
2506:20 65 0E       266 <a class="f" name="ASRUN2"  >ASRUN2      </a>JSR $<span class='n'>E65</span>        ; RAM                           ; <a class='magic' name='_2506'>magic number</a> <a class="d" href="#AS2VT">AS2VT</a> has pointer to us
2509:85 33          267             STA <a class="d" href="#PROMPT">PROMPT</a>      ;INSURES APPLESOFT RUN DETECT (A=0)     ; (dead code) <a class='mem' name='_2506'>wastes</a> 10 bytes on Apple ][+ or later
250B:85 D8          268             STA <a class="d" href="#ASONER">ASONER</a>      ;RESET APPLESOFT ONERR FLAG     ;
250D:4C D4 0F       269             JMP $<span class='n'>FD4</span>                                        ; <a class='magic' name='_250D'>magic number</a>
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="XMISCMD">XMISCMD</a> - Execute misc. commands, Pages <a class='page' name='page145'>145</a> - 149, <a class='ts' href='#T1S4'>T1S4</a> - <a class='ts' href='#T1S5'>T1S5</a>, $<span class='n'>A510</span> .. $<span class='n'>A6A7</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ; EWRITE - WRITE CMD EXECUTE
                    004 ;
                    005 <a class='f' name='EWRITE'   >EWRITE      </a>EQU *
2510:20 26 25       006             JSR <a class='x' href='#RWPOSN'>RWPOSN</a>      ; GO POSITION FILE IF REQD
2513:A9 05          007             LDA #<span class='n'>5</span>                                          ; WTF is state 5 ?? OK, <a class='x' href='#COS5'>COS5</a> And the state table transition is where again?
2515:8D 52 2A       008             STA <a class='v' href='#OSTATE'>OSTATE</a>      ; SET OSTATE=5                  ; /sarcasm <i>No Shit, Sherlock</i>
<img src="char_output_state.png">
2518:4C 83 1F       009             JMP <a class='x' href='#CERTN'>CERTN</a>
                    010 ;
                    011 ; EREAD - READ COMD EXECUTE
                    012 ;
                    013 <a class='f' name='EREAD'    >EREAD       </a>EQU *
251B:20 26 25       014             JSR <a class='x' href='#RWPOSN'>RWPOSN</a>      ; GO POSITION FILE IF REQD
251E:A9 01          015             LDA #<span class='n'>1</span>    
2520:8D 51 2A       016             STA <a class='v' href='#ISTATE'>ISTATE</a>      ; SET I STATE = DISK INPUT      ; /voice="Nick Burns" <i>See, that wasn't so hard!</i>
2523:4C 83 1F       017             JMP <a class='x' href='#CERTN'>CERTN</a>                                       ; <a class='mem' name='_2523'>wastes</a> 1 bytes, <span class='code'>BNE EREAD-3</span>
                    018 ;
                    019 ; RWPOSN - POSTION FOR READ/ WRITE
                    020 ;
                    021 <a class='f' name='RWPOSN'   >RWPOSN      </a>EQU *
2526:20 64 27       022 <!--                           -->            JSR <a class='x' href='#FILSRC'>FILSRC</a>      ; FIND THE FILE
2529:90 06          023 <!--                           -->            BCC <a class='x' href='#RWP1'  >RWP1</a>        ; BR IF FILE FOUND
252B:20 A3 22       024 <!--                           -->            JSR <a class='x' href='#EOPEN' >EOPEN</a>       ; GO OPEN FOR KLUTZ             ; ??? if file doesn't exist, open it ???
252E:4C 34 25       025 <!--                           -->            JMP <a class='x' href='#RWP2'  >RWP2</a>        ; THEN SKIP NEXT LINE           ; <a class='mem' name='_252E'>wastes</a> 1 byte
                    026 <a class='f' name='RWP1'     >RWP1        </a>EQU *
2531:20 4E 27       027 <!--                           -->            JSR <a class='x' href='#MVBUFP'>MVBUFP</a>      ; MOVE BUFF POINTERS
                    028 <a class='f' name='RWP2'     >RWP2        </a>EQU *
2534:AD 65 2A       029 <!--                           -->            LDA <a class='v' href='#INOPTS'>INOPTS</a>      ; GET IN OPTIONS
2537:29 06          030 <!--                           -->            AND #<a class='v' href='#R'>R</a>+<a class='v' href='#B'>B</a>        ; WAS IT B OR R
2539:F0 13          031 <!--                           -->            BEQ <a class='x' href='#RWPR'  >RWPR</a>        ; BR IF NOT                     ; wastes one byte, <span class='code'>BEQ LD1C</span>
253B:A2 03          032 <!--                           -->            LDX #<span class='n'>3</span>
253D:BD 6E 2A       033 <a class='f' name='RWP2A'    >RWP2A       </a>LDA <a class='v' href='#CR'    >CR</a>,X        ; MOVE REL REC
2540:9D BD 35       034 <!--                           -->            STA <a class='v' href='#CCBRRN'>CCBRRN</a>,X    ; AND REL BYTE
2543:CA             035 <!--                           -->            DEX
2544:10 F7          036 <!--                           -->            BPL <a class='x' href='#RWP2A' >RWP2A</a>
                    037 <a class='f' name='RWP3'     >RWP3        </a>EQU *
2546:A9 0A          038 <!--                           -->            LDA #<a class='v' href='#CRQPOS'>CRQPOS</a>     ; INDICATE POISTION REQUEST     ; *spelling* Position
2548:8D BB 35       039 <!--                           -->            STA <a class='v' href='#CCBREQ'>CCBREQ</a>
254B:20 A8 26       040 <!--                           -->            JSR <a class='x' href='#DOSGO' >DOSGO</a>                                       ; wastes 1 byte next instruction RTS, should be <span class='code'>JMP</span>
254E:60             041 <a class='f' name='RWPR'     >RWPR        </a>RTS
                    042 <!--                           -->            PAGE
                    043 ;
                    044 ;
                    045 ; EINIT - EXECUTE INIT COMMAND
                    046 ;
                    047 <a class='f' name='EINIT'    >EINIT</a>       EQU *                                           ; "INIT" -- also see FFMT
254F:A9 40          048             LDA #<a class='v' href='#V'>V</a>          ; MUST HAVE
2551:2D 65 2A       049             AND <a class='v' href='#INOPTS'>INOPTS</a>      ; VOL OPTION
2554:F0 05          050             BEQ <a class='x' href='#DFVOL'>DFVOL</a>       ;GO SET DEFAULT VOLUME=254
2556:AD 66 2A       051             LDA <a class='v' href='#CV'>CV</a>          ;CAN'T SPECIFY VOL=0
2559:D0 05          052             BNE <a class='x' href='#EINITA'>EINITA</a>
255B:A9 FE          053 <a class='f' name='DFVOL'    >DFVOL</a>       LDA #$<span class='n'>FE</span>        ;SET DEFAULT VOLUME NUMBER      ; <a class='magic' name='_'>magic number</a> <span class='code'>DEFAULT_VOLUME</span>
<hr>255D:8D 66 2A       054             STA <a class='v' href='#CV'>CV</a>                                          ; === Page <a class='page' name='page146'>146</a> ===
2560:AD 0D 1D       055 <a class='f' name='EINITA'   >EINITA</a>      LDA <a class='v' href='#ASTART'>ASTART</a>+<span class='n'>1</span>
2563:8D B3 35       056             STA <a class='v' href='#CCBBSA'>CCBBSA</a>
2566:A9 0B          057             LDA #<a class='v' href='#CRQFMT'>CRQFMT</a>
2568:20 AA 22       058             JSR <a class='x' href="#OPEN">OPEN</a>
256B:4C 97 23       059             JMP <a class='x' href="#ESAVE">ESAVE</a>
                    060 ;
                    061 ;
                    062 ; ECAT - PRINT CATALOG
                    063 ;
                    064 <a class='f' name='ECAT'     >ECAT        </a>EQU *
256E:A9 06          065             LDA #<a class='e' href='#CRQDIR'>CRQDIR</a>
2570:20 AA 22       066             JSR <a class='x' href='#OPEN'>OPEN</a>        ; GO PRETEND OPEN
2573:AD BF 35       067             LDA <a class='v' href='#CCBVOL'>CCBVOL</a>
2576:8D 66 2A       068             STA <a class='v' href='#CV'>CV</a>
2579:60             069             RTS
                    070             PAGE
                    071 ;
                    072 ; EAS - EXECUTE APPLESOFT REQUEST
                    073 ;
                    074 <a class='f' name='EAS'      >EAS</a>         EQU *
257A:A9 4C          075             LDA #<a class='v' href='#ATSTV'>ATSTV</a>      ; GET APPLESOFT TEST VALUE
257C:20 B2 25       076             JSR <a class='x' href='SWTST'>SWTST</a>       ; GO SWITCH AND TEST
257F:F0 2E          077             BEQ <a class='x' href='#GOINIT'>GOINIT</a>      ; BR IF APPLESOFT
2581:A9 00          078             LDA #<span class='n'>0</span>                                          ; <a class='magic' name='_'>magic number</a> LANGUAGE_APPLESOFT
2583:8D B6 2A       079             STA <a class='v' href='#ASIBSW'>ASIBSW</a>
                    080 ;
                    081 <a class='f' name='EAS0'     >EAS0</a>        EQU *
2586:A0 1E          082             LDY #<span class='n'>30</span>                                         ; <a class='magic' name='_'>magic number</a> MAX_FILENAME_LEN-1
2588:20 97 20       083             JSR <a class='x' href='#CLRFNA'>CLRFNA</a>                                      ; ClearFileName1
258B:A2 09          084             LDX #<a class='v' href='#FASBL'>FASBL</a>
258D:BD B7 2A       085 <a class='f' name='EAS1'     >EAS1</a>        LDA <a class='v' href='#FASB'>FASB</a>-<span class='n'>1</span>,X    ; MOVE SYSTEM FILENAME          ; No, <i>copy</i>
2590:9D 74 2A       086             STA <a class='v' href='#FNAME1'>FNAME1</a>-<span class='n'>1</span>,X
2593:CA             087             DEX
2594:D0 F7          088             BNE <a class='x' href='EAS1'>EAS1</a>
                    089 ;
                    090 <a class='f' name='EAS2'     >EAS2</a>        EQU *
2596:A9 C0          091             LDA #$<span class='n'>C0</span>                                        ; <a class='magic' name='_'>magic number</a> $80 + $40
2598:8D 51 2A       092             STA <a class='v' href='#ISTATE'>ISTATE</a>      ; FOR RAM APPLESOFT
259B:4C D1 24       093             JMP <a class='x' name='ERUN'>ERUN</a>
                    094 ;
                    095 ; EINT - EXECUTE INTEGER REQUEST
                    096 ;
                    097 <a class='f' name='EINT'     >EINT</a>        EQU *
259E:A9 20          098             LDA #<a class='v' href='#ITSTV'>ITSTV</a>      ; GET IB TEST VALUE
25A0:20 B2 25       099             JSR <a class='x' href='#SWTST'>SWTST</a>       ; GO SWITCH AND TEST
25A3:F0 05          100             BEQ <a class='x' href='#GOINT'>GOINT</a>       ;BR IF INTIGER BASIC                ; *spelling* Integer
25A5:A9 01          101             LDA #<span class='n'>1</span>          ;LANGUAGE NOT AVIALABLE, TOO BAD... ; *spelling* Available <a class='magic' name='_'>magic number</a>
25A7:4C D2 26       102             JMP <a class='x' href='#ERROR'>ERROR</a>
25AA:A9 00          103 <a class='f' name='GOINT'    >GOINT</a>       LDA #<span class='n'>0</span>          ;RESET RSTATE                   ; <a class='magic' name='_'>magic number</a>
25AC:8D B7 2A       104             STA <a class='v' href='#RSTATE'>RSTATE</a>      ; FOR NON APPLESOFT PROG.
                    105 <a class='f' name='GOINIT'   >GOINIT</a>      EQU *
25AF:4C 84 1D       106             JMP <a class='f' href='#DBINIT'>DBINIT</a>      ; GO INIT DOS
                    107 <a class='f' name='SWTST'    >SWTST       </a>EQU *
25B2:CD 00 E0       108             CMP <a class='v' href='#'>AITSTL</a>      ; TEST CURRENT VALUE
25B5:F0 0E          109             BEQ <a class='x' href='#'>SWTR</a>
25B7:8D 80 C0       110             STA $<span class='n'>C080</span>       ; TRY SWITCH 1                  ; <a class='magic' name='_'>magic number</a>
25BA:CD 00 E0       111             CMP <a class='v' href='#AITSTL'>AITSTL</a>      ; TEST AGAIN
25BD:F0 06          112             BEQ <a class='x' href='#SWTR'>SWTR</a>        ; BR IF NOW SAME
25BF:8D 81 C0       113             STA $<span class='n'>C081</span>       ; TRY SWITCH 2                  ; <a class='magic' name='_'>magic number</a>
25C2:CD 00 E0       114             CMP <a class='v' href='#AITSTL'>AITSTL</a>      ; TEST AND
25C5:60             115 <a class='f' name='SWTR'     >SWTR</a>        RTS             ; RETURN
                    116 ;
<hr>                    117             PAGE                                            ; === Page <a class='page' name='page147'>147</a> ===
                    118 ;
                    119 ; EEXEC - EXECUTE EXEC CMD
                    120 ;
                    121 <a class='f' name='EEXEC'    >EEXEC       </a>EQU *                                           ; "EXEC"
25C6:20 A3 22       122             JSR <a class='x' href='#EOPEN'>EOPEN</a>       ; OPEN FILE
25C9:AD 4F 2A       123             LDA <a class='v' href='#CFTABA'>CFTABA</a>      ; MOVE TABLE POINTERS
25CC:8D B4 2A       124             STA <a class='v' href='#EFTABA'>EFTABA</a>
25CF:AD 50 2A       125             LDA <a class='v' href='#CFTABA'>CFTABA</a>+<span class='n'>1</span>
25D2:8D B5 2A       126             STA <a class='v' href='#EFTABA'>EFTABA</a>+<span class='n'>1</span>
25D5:AD 75 2A       127             LDA <a class='v' href='#FNAME1'>FNAME1</a>      ; USE FILNAME                   ; *spelling* Filename
25D8:8D B3 2A       128             STA <a class='v' href='#ESTATE'>ESTATE</a>      ; SET EXSTATE NON ZERO
25DB:D0 0E          129             BNE <a class='x' href='#EXP2'>EXP2</a>
                    130 ;
                    131 ;
                    132 ; EPOS - EXECUTE POSITION
                    133 ;
                    134 <a class='f' name='EPOS'     >EPOS        </a>EQU *                                           ; "POSITION"
25DD:20 64 27       135             JSR <a class='x' href='#FILSRC'>FILSRC</a>
25E0:90 06          136             BCC <a class='x' href='#EXP1'>EXP1</a>
25E2:20 A3 22       137             JSR <a class='x' href='#EOPEN'>EOPEN</a>
25E5:4C EB 25       138             JMP <a class='x' href='#EXP2'>EXP2</a>
25E8:20 4E 27       139 <a class='f' name='EXP1'     >EXP1        </a>JSR <a class='x' href='#MVBUFP'>MVBUFP</a>
                    140 <a class='f' name='EXP2'     >EXP2        </a>EQU *
25EB:AD 65 2A       141             LDA <a class='v' href='#INOPTS'>INOPTS</a>      ; GET OPTIONS
25FE:29 04          142             AND #<a class='v' href='#R'>R</a>          ; TEST R
25F0:F0 1B          143             BEQ <a class='x' href='#EX2'>EX2</a>         ; BR NOT R
                    144 ;
25F2:AD 6E 2A       145 <a class='f' name='EX0'      >EX0         </a>LDA <a class='v' href='#CR'>CR</a>          ; IF CR NOT ZERO
25F5:D0 08          146             BNE <a class='x' href='#EX1A'>EX1A</a>        ; THEN DECREMENT
25F7:AE 6F 2A       147             LDX <a class='v' href='#CR'>CR</a>+<span class='n'>1</span>
25FA:F0 11          148             BEQ <a class='x' href='#EX2'>EX2</a>
25FC:CE 6F 2A       149             DEC <a class='v' href='#CR'>CR</a>+<span class='n'>1</span>
25FF:CE 6E 2A       150 <a class='f' name='EX1A'     >EX1A        </a>DEC <a class='v' href='#CR'>CR</a>
2602:20 8C 26       151 <a class='f' name='EX1'      >EX1         </a>JSR <a class='x' href='#RBYTE'>RBYTE</a>       ; AND READ A RECORD
2605:F0 38          152             BEQ <a class='x' href='#ICFD4'>ICFD4</a>
2607:C9 8D          153             CMP #$<span class='n'>8D</span>        ; UNTIL CR                      ; <a class='magic' name='_'>magic number</a> KEY_CR
2609:D0 F7          154             BNE <a class='x' href='#EX1'>EX1</a>
260B:F0 E5          155             BEQ <a class='x' href='#EX0'>EX0</a>         ; THEN TEST CR AGAIN
                    156 ;
260D:60             157 <a class='f' name='EX2'      >EX2         </a>RTS
                    158             PAGE
                    159 ;
                    160 ; OCTD - OUTPUT A CHAR TO DISK
                    161 ;
                    162 <a class='f' name='OCTD'     >OCTD        </a>EQU *
260E:20 5E 26       163             JSR <a  class='x' href='#TSTRUN'>TSTRUN</a>      ; GO TEST RUN
2611:B0 66          164             BCS <a  class='x' href='#ICFDB' >ICFDB</a>       ;BRANCH IF NOT RUN MODE
2613:AD 5C 2A       165             LDA <a  class='v' href='#SVA'   >SVA</a>         ; CHAR IN SAVED ACU
2616:8D C3 35       166             STA <a  class='v' href='#CCBDAT'>CCBDAT</a>      ; PUT INTO CCBDATA AREA
2619:A9 04          167             LDA #<a class='v' href='#CRQWR' >CRQWR</a>      ; SET WRITE
261B:8D BB 35       168             STA <a  class='v' href='#CCBREQ'>CCBREQ</a>
261E:A9 01          169             LDA #<a class='v' href='#CRMNBT'>CRMNBT</a>     ; SET NEXT BYTE
2620:8D BC 35       170             STA <a  class='v' href='#CCBRQM'>CCBRQM</a>
2623:4C A8 26       171             JMP <a  class='x' href='#DOSGO' >DOSGO</a>       ; GO WRITE BYTE
                    172 ;
                    173 ; INCFD - INPUT A CHAR FROM DISK
                    174 ;
                    175 <a class='f' name='ICFD'     >ICFD        </a>EQU *
2626:20 5E 26       176             JSR TSTRUN      ; GO TEST RUN
2629:B0 4E          177             BCS ICFDB       ;BRANCH IF NOT RUN MODE
262B:A9 06          178             LDA #6          ; SET OUT STE = 6               ; <a class='magic' name='_'>magic number</a>
                    179 <a class='f' name='ICFD3'    >ICFD3       </a>EQU *
<hr>262D:8D 52 2A       180             STA OSTATE      ; TO CATCH ECHO                 ; === Page <a class='page' name='page148'>148</a> ===
2630:20 8C 26       181             JSR RBYTE
2633:D0 0F          182             BNE ICFD1       ; BR IF NOT ZERO CHAR
                    183 <a class='f' name='ICFD2'    >ICFD2       </a>EQU *
2635:20 FC 22       184             JSR CLOSE
2638:A9 03          185             LDA #3                                          ; <a class='magic' name='_'>magic number</a>
263A:CD 52 2A       186             CMP OSTATE
263D:F0 CE          187             BEQ EX2
                    188 <a class='f' name='ICFD4'    >ICFD4       </a>EQU *
263F:A9 05          189             LDA #CREEOF
2641:4C D2 26       190             JMP ERROR       ; GO TO ERROR                   ; /sarcasm No shit, Sherlock -- HOW did we get here?
                    191 <a class='f' name='ICFD1'    >ICFD1       </a>EQU *
2644:C9 E0          192             CMP #$E0        ;CHECK FOR LOWER CASE
2646:90 02          193             BCC ICFNLC      ;BRANCH IF NOT LOWER-CASE
2648:29 7F          194             AND #$<span class='n'>7F</span>        ;STRIP HI BIT TO FOOL GETLINE
                    195 <a class='f' name='ICFNLC'   >ICFNLC      </a>EQU *
264A:8D 5C 2A       196             STA SVA         ; PUT INTO SAVED ACU
264D:AE 5A 2A       197             LDX SVX         ; MUST CHECK LAST FOR LOWER CASE
2650:F0 09          198             BEQ ICFD0       ;IGNORE IF FIRST CHAR.
2652:CA             199             DEX
2653:BD 00 02       200             LDA LBUFF,X
2656:09 80          201             ORA #$<span class='n'>80</span>        ;RESET HI BIT
2658:9D 00 02       202             STA LBUFF,X     ; EVEN THOUGH IT MAY NOT NEED IT
                    203 <a class='f' name='ICFD0'    >ICFD0       </a>EQU *
265B:4C B3 1F       204             JMP ORTN        ; GO RESTORE REGS AND RTS
                    205 ;
265E:48             206 <a class='f' name='TSTRUN'   >TSTRUN      </a>PHA
265F:AD B6 2A       207             LDA ASIBSW      ; GET AS/INT BASIC SWITCH
2662:F0 0E          208             BEQ TR1         ; BR IF INT
2664:A6 76          209             LDX $<span class='n'>76</span>         ;CHECK APPLESOFT RUN FLAG       ; <a class='magic' name='_'>magic number</a>
2666:E8             210             INX             ;(NOT RUN=0 AFTER INCREMENT)
2667:F0 0D          211             BEQ NOTRUN      ;IF SAYS RUNNING MAKE SURE WITH PROMPT.
2669:A6 33          212             LDX PROMPT      ;TEST APPLESOFT RUNNING.
266B:E0 DD          213             CPX #']'+$<span class='n'>80</span>
266D:F0 07          214             BEQ NOTRUN      ; BR IF NOT RUN
266F:68             215 <a class='f' name='TR0'      >TR0         </a>PLA
2670:18             216             CLC             ;INDICATE PROGRAM RUNNING
2671:60             217             RTS
                    218 <a class='f' name='TR1'      >TR1         </a>EQU *
2672:A5 D9          219             LDA $<span class='n'>D9</span>         ; GET INT RUN FLAG              ; <a class='magic' name='_'>magic nubmer</a>
2674:30 F9          220             BMI TR0         ; BR IF RUN
2676:68             221 <a class='f' name='NOTRUN'   >NOTRUN      </a>PLA             ;INDICATE PROGRAM NOT RUNNING
2677:38             222             SEC             ; WITH CARRY SET.
2678:60             223             RTS
                    224 ;
                    225 <a class='f' name='ICFDB'    >ICFDB       </a>EQU *           ; NOT RUN MODE
2679:20 FC 22       226             JSR CLOSE       ; GO CLOSE FILE
267C:20 5B 27       227             JSR CLRSTS      ; GO CLEAR STATES
267F:4C B3 1F       228             JMP <a class='x' href='#ORTN'>ORTN</a>                                        ;
                    229             PAGE
                    230 ;
                    231 ; NXTEXC - NEXT EXECUTE CHAR
                    232 ;
                    233 <a class='f' name='NXTEXC'   >NXTEXC      </a>EQU *
2682:20 9D 26       234             JSR MVEFTA
2685:20 4E 27       235             JSR MVBUFP      ; GO MOVE PTRS
2688:A9 03          236             LDA #<span class='n'>3</span>
268A:D0 A1          237             BNE ICFD3                                       ; &uarr; (always)
                    238 ;
                    239 ; RBYTE - READ NEXT BYTE
                    240 ;
                    241 <a class='f' name='RBYTE'    >RBYTE       </a>EQU *
<hr>268C:A9 03          242             LDA #CRQRD      ; SET READ                      ; === Page <a class='page' name='page149'>149</a> ===
268E:8D BB 35       243             STA CCBREQ
2691:A9 01          244             LDA #CRMNBT     ; SET NEXT BYTE
2693:8D BC 35       245             STA CCBRQM
2696:20 A8 26       246             JSR DOSGO       ; GO TO DOS
2699:AD C3 35       247             LDA CCBDAT      ; GET THE DATA BYTE
269C:60             248             RTS
                    249 <a class='f' name='MVEFTA'   >MVEFTA      </a>EQU *
269D:AD B5 2A       250             LDA EFTABA+<span class='n'>1</span>    ; MOVE TABLE ADR
26A0:85 41          251             STA ZPGWRK+<span class='n'>1</span>    ; NO ZPG
26A2:AD B4 2A       252             LDA EFTABA
26A5:85 40          253             STA ZPGWRK
26A7:60             254             RTS
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="DOSGOER">DOSGOER</a> - Print Error message, Pages <a class="page" name='page40'>40</a> - 43, <a class='ts' href='#T1S5'>T1S5</a> - <a class='ts' href='#T1S6'>T1S6</a>, $<span class='n'>A6A8</span> .. $<span class='n'>A7D3</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ; DOSGO - GOTO DOS
                    004 ;
                    005 <a class="f" name="DOSGO"       >DOSGO       </a>EQU *
26A8:20 06 2B       006             JSR DOSENT      ; GO TO DOS
26AB:90 16          007             BCC DG3         ; BR IF NOT ERROR
                    008 ;
26AD:AD C5 35       009             LDA CCBSTA      ;GET RETURN CODE
26B0:C9 05          010             CMP #<span class='n'>5</span>                                          ; <a class='magic' name='_26B1'>magic number</a> <span class='todo'>TODO</span>
26B2:F0 03          011             BEQ YESEOF
26B4:4C 5E 36       012             JMP CLOSFILE    ;NO. CLOSE &amp; COMPLAIN
26B7:4C 92 36       013 <a class='f' name='YESEOF'   >YESEOF      </a>JMP EOFFIX      ;MAYBE FIX IT UP?
26BA:EA             014             NOP                                             ; <a class='mem' name='_26BA'>wastes</a> 1 byte
                    015 ***************************
                    016 *
                    017 * DOS 3.3  (REV B) PATCH
                    018 *
                    019 ***************************
                    020             DO <a class='e' href='#DOS33B'>DOS33B</a>
26BB:20 69 3A       021 <a class='f' name='DOSGO2A'  >DOSGO2A     </a>JSR <a class='x' href='#MOVEOF'>MOVEOF</a>      ; MOVE END OF FILE PATCH        ; Called from <a class='x' href='#BACK'>BACK</a>
                    022             ELSE<span class='macro'>
                    023             NOP                                             
                    024 DOSGO2A     NOP                                             </span>Why isn't this label on the previous line???<span class='macro'>
                    025             NOP                                             </span>
                    026             FIN
26BE:A2 00          027             LDX #<span class='n'>0</span>          ; SET OTHER EIF
26C0:8E C3 35       028             STX CCBDATA
26C3:60             029 <a class='f' name='DG3'      >DG3         </a>RTS
                    030 ;
                    031             PAGE
                    032 ;
                    033 ; ERROR ROUTINE
                    034 ;
26C4:A9 0B          035 <a class='f' name='ESYNTX'   >ESYNTX      </a>LDA #CREFLK+<span class='n'>1</span>                                   ; <i>I'd like to buy a vowel, 'A'.</i> 
26C6:D0 0A          036 <!--                           -->            BNE ERROR                                       ; Sorry, we're fresh out.
26C8:A9 0C          037 <a class='f' name='ENFA'     >ENFA        </a>LDA #CREFLK+<span class='n'>2</span>
26CA:D0 06          038 <!--                           -->            BNE ERROR                                       ; &darr; (always)
26CC:A9 0E          039 <a class='f' name='MFERR'    >MFERR       </a>LDA #CREFLK+<span class='n'>4</span>
26CE:D0 02          040 <!--                           -->            BNE ERROR                                       ; &darr; (always) <a class='mem' name='_26CE'>wastes</a> 1 byte, $2C bit $abs to skip next instruction
                    041 <a class='f' name='ETYP'     >ETYP        </a>EQU *
26D0:A9 0D          042 <a class='f' name='ERNU1'    >ERNU1       </a>LDA #CREFLK+<span class='n'>3</span>
                    043 ;                                                           ; Intentional fall into ERROR
                    044 <a class='f' name='ERROR'    >ERROR       </a>EQU *
26D2:8D 5C 2A       045             STA SVA         ; SAVE MSG NUMBER
26D5:20 E6 3F       046             JSR CLRSTS1     ;PATCH TO CLR RSTATE TOO (WAS JSR CLRSTS)
26D8:AD B6 2A       047             LDA ASIBSW      ; GET AS/IN BASIC SWITCH
26DB:F0 04          048             BEQ ERNAS       ; BR IF NOT APPLESOFT
26DD:A5 D8          049             LDA ASONERR     ;GET AS ERR FLAG
26DF:30 0E          050             BMI ERRTN       ; BRT IF ON ERR IS GO
                    051 <a class='f' name='ERNAS'    >ERNAS       </a>EQU *
26E1:A2 00          052             LDX #<span class='n'>0</span>
<hr>26E3:20 02 27       053             JSR EMPR        ; GO OUTPUT                     ; === Page <a class='page' name='page41'>41</a> ===
26E6:AE 5C 2A       054             LDX SVA         ; GET SAVE MSG
26E9:20 02 27       055             JSR EMPR        ; GO OUTPUT MSG
26EC:20 C8 1F       056             JSR PRCRIF      ;OUTPUT A CARRIAGE RETURN AFTER MESSAGE
26EF:20 51 28       057 ERRNT       JSR MVCSW       ; GO MOVE CHAR I/ SW
26F2:20 5E 26       058             JSR TSTRUN
26F5:AE 5C 2A       059             LDX SVA
26F8:A9 03          060             LDA #<span class='n'>03</span>                                         ; <a class='magic' name='_'>magic number</a>
26FA:B0 03          061             BCS ERRTN1      ;DON'T GOTO BREAK HANDLER IF NOT RUNNING
26FC:6C 5A 1D       062             JMP (BREAK)
26FF:6C 5E 1D       063 ERRTN1      JMP (CONT)      ;REENTER CONT IF NOT RUN        ; === <a class='ts' href='#T1S6'>T1S6</a> ===
                    064 ;
                    065 EMPR        EQU *
2702:BD 3F 2A       066             LDA EMDTB,X     ; GET ITS DISPL
                    067             TAX             ; INTO X
                    068 EMPR1       EQU *
                    069             STX TEMP1A      ; SAVE DISPL
                    070             LDA EMSG,X      ; GET MSG CHAR
                    071             PHA             ; SAVE CHAR
                    072             ORA #$<span class='n'>80</span>        ; SET MSB ON
                    073             JSR ORTN1       ; OUTPUT CHAR
                    074             LDX TEMP1A      ; GET INDEX
                    075             INX             ; INCREMENT IT
                    076             PLA             ; RE-LOAD CHAR
                    077             BPL EMPR1       ; BR IF MORE CHARS
                    078             RTS             ; DONE
                    079             PAGE
                    080 ;
                    081 ; OPNSUP - OPEN SET UP
                    082 ;
                    083 OPNSUP      EQU *                                           ; If only these were contiguous
271A:AD 66 2A       084             LDA CV          ; VOLUME
271D:8D BF 35       085             STA CCBVOL      ;
                    086             LDA CD          ; DRIVE
                    087             STA CCBDRV
                    088             LDA CS          ; SLOT
                    089             STA CCBSLT
                    090             LDA FN1ADR      ; FILENAME 1 ADR
                    091             STA CCBFN1
                    092             LDA FN1ADR+<span class='n'>1</span>
                    093             STA CCBFN1+<span class='n'>1</span>
                    094             LDA ZPGWRK
                    095             STA CFTABA
                    096             LDA ZPGWRK+<span class='n'>1</span>
                    097             STA CFTABA+<span class='n'>1</span>
                    098             RTS
                    099 ;
                    100 ; MVFN1 - MOVE FILE NAME 1 TO FILE PTR
                    101 ;
                    102 MVFN1       EQU *
2743:A0 1D          103             LDY #<span class='n'>29</span>                                         ; <a class='magic' name='_'>magic number</a> <span class='code'>MAX_FILENAME-1</span>
                    104 MVFN1A      LDA FNAME1,Y
                    105             STA (ZPGWRK),Y
                    106             DEY
                    107             BPL MVFN1A
                    108             RTS
                    109 ;
                    110 ; MVBUFP - MOVE BUFFER PTR TO CCB
                    111 ;
                    112 MVBUFP      EQU *
274E:A0 1E          113             LDY #<span class='n'>30</span>                                         ; <a class='magic' name='_274F'>magic number</a> <span class='code'>MAX_FILENAME</span>
<hr>2750:B1 40          114 MVBP1       LDA (ZPGWRK),Y                                  ; === Page <a class='page' name='page42'>42</a> ===
2752:99 A9 35       115             STA CCBFCB-<span class='n'>30</span>,Y                                 ; <a class='magic' name='_2752'>magic number</a> <span class='code'>MAX_FILENAME</span>
2755:C8             116             INY
2756:C0 26          117             CPY #<span class='n'>38</span>                                         ; <a class='magic' name='_2756'>magic number</a> <span class='code'>MAX_FILENAME + HEADER.SIZE</span> (See <a class='file' href='#BLDFTAB'>BLDFTAB</a>)
2758:D0 F6          118             BNE MVBP1
275A:60             119             RTS
                    120 ;
                    121 ; CLRSTS - CLEAR STATES                                     ; <b>Which</b> states?? Input and Ouput
                    122 ;
                    123 <a class='f' name='CLRSTS'   >CLRSTS      </a>EQU *
275B:A0 00          124             LDY #<span class='n'>0</span>
                    125             STY ISTATE
                    126             STY OSTATE
                    <a class='line' name='DOSGOER.127'>127</a>             RTS                                             ; Should be <span class='code'>FLS4 SEC, RTS</span> for <a class='x' href='#FILSRC'>FILSRC</a> not found exit optimization
                    128             PAGE                                            ; Callers: <a class='x' href='#CMDGO1'>CMDGO1</a>, <a class='x' href='#CNF1'>CNF1</a>, <a class='x' href='#ERROR'>ERROR</a>, <a class='x' href='#INITZ'>INITZ</a>, don't use carry.
                    129 ;
                    130 ; FILSRC - SEARCH FOR FILE NAME1
                    131 ;
                    132 <a class='f' name='FILSRC'   >FILSRC      </a>EQU *
2764:A9 00          133             LDA #<span class='n'>0</span>          ; CLEAR SV AVAIL
2765:85 45          134             STA CNUM+1
                    135 ;
2768:20 92 27       136             JSR <a class='x' href='#TSINIT'>TSINIT</a>      ; GO INIT SEARCH                ; &darr;
276B:4C 73 27       137             JMP FLS1A                                       ; <a class='mem' name='_276B'>wastes</a> 1 byte, <a class='x' href='#CLALL'>CLALL</a> has <span class='code'>JSR TSINIT, BNE SKIPNEXT</span> so why JMP ???
276E:20 9A 27       138 <a class='f' name='FLS1'     >FLS1        </a>JSR TSNXT       ; LOOK AT NEXT
2771:F0 1D          139             BEQ FLS4        ; BR IF NO NET
                    140 ;
2773:20 AA 27       141 <a class='f' name='FLS1A'    >FLS1A       </a>JSR TSTOPN      ; GO TEST OPEN
2776:D0 0A          142             BNE FLS2        ; BR IF OPEN
                    143 ;
                    144             LDA ZPGWRK      ; SAVE AVAIL ENTRY ADR
                    145             STA CNUM
                    146             LDA ZPGWRK+<span class='n'>1</span>
                    147             STA CNUM+<span class='n'>1</span>
                    148             BNE FLS1        ; GO LOOK SOME MORE
                    149 ;
2782:A0 1D          150 FLS2        LDY #<span class='n'>29</span>         ; FILE HAD 30 CHARS             ; <a class='magic' name='_2782'>magic number</a> <span class='code'>MAX_FILENAME-1</span>
                    151 FLS3        LDA (ZPGWRK),Y  ; GET CHAR
                    152             CMP FNAME1,Y    TEST CHAR                       ; Missing <span class='code'>;</span> for comment
                    153             BNE FLS1        ; BR NOT
                    154             DEY
                    155             BPL FLS3        ; LOOK AT 30 CHARS
                    156             CLC             ; FOUND
                    157             RTS
                    158 ;
2790:38             159 FLS4        SEC             ; NOT FOUND                     ;[.. <a class='mem' name='_2790'>wastes</a> 1 byte, these 2 bytes should be moved to Line #<a class='line' href='#DOSGOER.127'>127</a>
2791:60             160             RTS             ; DONE                          ; ..]
                    161             PAGE
                    162 ;
                    163 ; TSINIT - INITIALIZE FOR FTAB SEARCH
                    164 ; TSNXT - GET NEXT FTAB ENTRY
                    165 ;
                    166 <a class='f' name='TSINIT'   >TSINIT      </a>EQU *
2792:AD 00 1D       167             LDA FTAB        ; GET 1ST PTR ADR
2795:AD 01 1D       168             LDX FTAB+1
2798:D0 0A          169             BNE TSST
                    170 <a class='f' name='TSNXT'    >TSNXT       </a>EQU *
279A:A0 25          171             LDY #37         ; GET LINK                      ; <a class='magic' name='_279B'>magic number</a> HEADER.LINK+1 (See <a class='file' href='#BLDFTB'>BLDFTB</a>)
                    172             LDA (ZPGWRK),Y
                    173             BEQ TSR         ; BR IF NO LINK
                    174 ;
                    175             TAX
                    176             DEY                                             ; HEADER.LINK+0
<hr>                    177             LDA (ZPGWRK),Y                                  ; === Page <a class='page' name='page43'>43</a> ===
                    178 TSST        EQU *
                    179             STX ZPGWRK+1
                    180             STA ZPGWRK
                    181             TXA             ; SET NE CC
                    182 TSR         RTS             ; RTN
                    183 ;
                    184 ; TSTOPN - TST FOR OPEN FILE                                ; TST? Really?? You have to abbreviate the <i>description</i> too ?!
                    185 ;
                    186 <a class='f' name='TSTOPN'   >TSTOPN      </a>EQU *
27AA:A0 00          187             LDY #0          ; GET 1ST CHAR OF FN
27AC:B1 40          188             LDA (ZPGWRK),Y
27AE:60             189             RTS
                    190 ;
                    191 ; TSTEXC - TEST CURRENT FILE FOR EXECUTE
                    192 ;
                    193 <a class='f' name='TSTEXC'   >TSTEXC      </a>EQU *
27AF:AD B3 2A       194             LDA ESTATE      ; IF ESTATE = 0
27B2:F0 0E          195             BEQ TXC1        ; THEN NO EXECUTE FILE
27B4:AD B4 2A       196             LDA EFTABA      ; TEST CURRENT
27B7:C5 40          197             CMP ZPGWRK
27B9:D0 08          198             BNE TXC2        ; IS NOT
27BB:AD B5 2A       199             LDA EFTABA+1
27BE:C5 41          200             CMP ZPGWRK+1
27C0:F0 01          201             BEQ TXC2        ; IS
27C2:CA             202 TXC1        DEX             ; IS NOT
27C3:60             203 TXC2        RTS             ; DONE                          ; /sarcasm Thanks, Caption Obvious
                    204             PAGE
                    205 ;
                    206 ; TSTFUC - TEST FILE USE CODE FOR PGM
                    207 ;
                    208 <a class='f' name='TSTFUC'   >TSTFUC      </a>EQU *
27C4:4D C2 35       209             EOR CCBFUC
27C7:F0 0A          <a class='line' name='DOSGOER.210'>210</a>             BEQ TFUCR                                       ; Forces TFUCR to waste 1 byte, should be <span class='code'>BEQ TXC2</span>
27C9:29 7F          211             AND #$<span class='n'>7F</span>                                        ; <a class='magic' name='_'>magic number</a>
27CB:F0 06          <a class='line' name='DOSGOER.212'>212</a>             BEQ TFUCR                                       ; Forces TFUCR to waste 1 byte, should be <span class='code'>BEQ TXC2</span>
27CD:20 EA 22       213             JSR ECLOSE      ; GO CLOSE THE SOB
27D0:4C D0 26       214             JMP ERNU1
27D3:60             215 TFUCR       RTS                                             ; <a class='mem' name='_27D3'>wastes</a> 1 byte due to Lines #<a class='line' href='#DOSGOER.210'>210</a> and #<a class='line' href='#DOSGOER.212'>212</a>
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="BLDFTAB">BLDFTAB</a> - Build File Tables, Page <a class="page" name="page4">4</a>, <a class='ts' href='#T1S6'>T1S6</a> @ $D4 - <a class='ts' href='#T1S7'>T1S7</a> @ $83, $<span class='n'>A7D4</span> .. $<span class='n'>A883</span> ===<hr class='join'><hr></div>
 <pre>
                    001             PAGE
                    002 ;
                    003 ; BLDFTB - BUILD FILE TABLES
                    004 ; TABLE MAP:                                                ; $9600 = Array of File Tables
                    005 ;   HIMEM,SOP                                               ; $9D00 = SOP = Start of Program
                    006 ;   SBUFF  N (256)
                    007 ;   DBUFF  N (256)
                    008 ;   FTB    N (FCBLEN)                                       ; <a class="file" href="#FVCBUFS">FVCBUFS</a>, Line #<a class='line' href='#FVCBUFS.186'>186</a>
                    009 ;   HEADER N (38)                                           ; See Header Map below
                    010 ;   .
                    011 ;   .
                    012 ;   SBUFF  1
                    013 ;   DBUFF  1
                    014 ;   FTB    1
                    015 ;   HEADER 1
                    016 ;   THIS PROGRAM
                    017 ;
                    018 ; HEADER MAP:
                    019 ;   FILENAME (30)
                    020 ;   FTB  PTR (2)
                    021 ;   DBUF PTR (2)
                    022 ;   SBUF PTR (2)
                    023 ;   LINK     (2)
                    024 ;
                    025 <a class='f' name='BLDFTB'     >BLDFTB      </a>EQU *
27D4:38             026             SEC
27D5:AD 00 1D       027             LDA <a class='v' href='#FTAB'  >FTAB</a>        ; START OF FTAB AREA            ;
27D8:85 40          028             STA <a class='v' href='#ZPGWRK'>ZPGWRK</a>      ; IS 1ST FTB PTR                ; $1D00: ptr $1CD3
27DA:AD 01 1D       029             LDA <a class='v' href='#FTAB'  >FTAB</a>+<span class='n'>1</span>      ; HEADER
27DD:85 41          030             STA <a class='v' href='#ZPGWRK'>ZPGWRK</a>+<span class='n'>1</span>
27DF:AD 57 2A       031             LDA <a class='v' href='#CNFTBS'>CNFTBS</a>      ; MOVE NO FTABS                 ; <a class="v" href="#DFNFTS">DFNFTS</a> default 3 buffers, <a class="x" href="#INITD">INITD</a>
27E2:8D 63 2A       032             STA <a class='v' href='#TEMP1A'>TEMP1A</a>      ; TO TEMP                       ; fdosent, 60
                    033 ;
27E5:A0 00          034 <a class='f' name='BFT1'       >BFT1        </a>LDY #<span class='n'>0</span>                                          ; [.. <a class='mem' name='_27E5'>wastes</a> 2 bytes, should <span class='code'>JSR <a class='link code' href='#ZEROFILE'>ZEROFILE</a></span>
27E7:98             035             TYA                                             ; ...
27E8:91 40          <a class='line' name='BLDFTAB.036'>036</a>             STA (ZPGWRK),Y  ; 1ST CHAR FN=0                 ; ..] Init [00] $9CD3: 00
27EA:A0 1E          037             LDY #<span class='n'>30</span>         ; INC Y TO FCB PTR              ; [[FTAB] + offset $1E] = $1CF1 <a class='magic' name='_27EB'>magic number</a> MAX_FILENAME_LEN
27EC:38             038             SEC
27ED:A5 40          039             LDA ZPGWRK      ; END OF PTR HEADER
27EF:E9 2D          040             SBC #FCBLEN     ; MINUS FTAB LENGTH
27F1:91 40          <a class='line' name='BLDFTAB.041'>041</a>             STA (ZPGWRK),Y  ; IS START OF FTB               ; Init [1E] $9CD3 = $9CF1: $9CA6 buf #1 ptr
27F3:48             042             PHA             ; SAVE LOW ADR BYTE
27F4:A5 41          043             LDA ZPGWKR+1
27F6:48             044             SBC #<span class='n'>0</span>
27F8:C8             045             INY
27F9:91 40          046             STA (ZPGWKR),Y                                  ; [1F] = page
27FB:AA             047             TAX
27FC:CA             048             DEX             ; FTB ADR - 256
27FD:68             049             PLA             ; IS ADR DIR BUFF
27FE:48             050             PHA
27FF:C8             051             INY
2800:91 40          052             STA (ZPGWRK),Y  ; SET DIR BUF PTR               ; === <a class='ts' href='#T1S7'>T1S7</a> === [20] $9CD3 = $9BF3: $9BA6 buf #2 ptr
2802:8A             053             TXA
<hr>2803:C8             054             INY                                             ; === Page <a class="page" name="page5">5</a> ===
2804:91 40          055             STA (ZPGWRK),Y                                  ; [21] = page
2806:AA             056             TAX
2807:CA             057             DEX             ; DIR BUFF - 256
2808:68             058             PLA             ; IS SBUFF ADR
2809:48             059             PHA
280A:C8             060             INY
280B:91 40          061             STA (ZPGWRK),Y                                  ; [22] $9CD3 = $9CF5: $9AA6
280D:C8             062             INY
280E:8A             063             TXA
280F:91 40          064             STA (ZPGWRK),Y
                    065 ;
2811:CE 63 2A       066             DEC <a class="v" href="#TEMP1A">TEMP1A</a>      ; DECREMENT TABLE INDEX         ; Init all buffers?
2814:F0 17          067             BEQ <a class="x" href="#BFT2">BFT2</a>        ; COUNT AND BR IF DONE          ; v
2816:AA             068             TAX
2817:68             069             PLA
2818:38             070             SEC
2819:E9 26          071             SBC #<span class='n'>38</span>         ; SBUFF ADR - 38                ; <a class='magic' name='_281A'>magic number</a> HEADER_SIZE
281B:C8             072             INY
281C:91 40          073             STA (ZPGWRK),Y  ; IF ADR OF NEXT TAB            ; [24] $9CD3 = $9CF7: $9A80
281E:48             074             PHA             ; WHICH GOES INTO
281F:8A             075             TXA             ; LINK
2820:E9 00          076             SBC #<span class='n'>0</span>
2822:C8             077             INY
2823:91 40          078             STA (ZPGWRK),Y
2825:85 41          079             STA ZPGWRK+<span class='n'>1</span>    ; AND INTO ZPGWRK
2827:68             080             PLA             ; FOR NEXT ENTRY
2828:85 40          081             STA ZPGWRK      ; BUILD
282A:4C E5 27       082             JMP <a class="x" href="#BFT1">BFT1</a>                                        ; ^ BFT1 @ $<b class='n'>A7E4</b> <a class='mem' name='_282A'>wastes</a> 1 byte, A = addr lo: $80
                    083 ;
                    084 <a class="f" name="BFT2"      id="BFT2"       >BFT2        </a>EQU *
282D:48             085             PHA
282E:A9 00          086             LDA #<span class='n'>0</span>          ; SET LAST LINK
2830:C8             087             INY             ; TO ZERO
2831:91 40          088             STA (ZPGWRK),Y
2833:C8             089             INY
2834:91 40          090             STA (ZPGWRK),Y
                    091 ;
2836:AD B6 AA       092             LDA ASIBSW      ; IF IB THEN GO                 ; Integer Basic
2839:F0 0B          093             BEQ <a class="x" href="#BFTIB">BFTIB</a>
                    094 ;
283B:68             095             PLA
283C:85 74          096             STA ASHM1+<span class='n'>1</span>
283E:85 70          097             STA ASHM2+<span class='n'>1</span>
2840:68             098             PLA
2841:85 73          099             STA ASHM1
2843:85 6F          100             STA ASHM2
2845:60             101             RTS
                    102 ;
                    103 <a class="f" name="BFTIB"   >BFTIB       </a>EQU *
2846:68             104             PLA             ; SET IB
2847:85 4D          105             STA IBHMEM+<span class='n'>1</span>    ; UPPER MEM LIMITS
2849:85 CB          106             STA IBSOP+<span class='n'>1</span>
284B:68             107             PLA
284C:85 4C          108             STA IBHMEM
284E:85 CA          109             STA IBSOP
2850:60             110             RTS
                    111             PAGE
                    112 ;
                    113 ; MVISW - MOVE INPUT SWITCH
                    114 ;
                    115 <a class="f" name="MVCSW"  >MVCSW       </a>EQU *
2851:A5 39          116             LDA INSW+<span class='n'>1</span>
<hr>2853:CD 03 1D       117             CMP CINA+<span class='n'>1</span>                                      ; === Page <a class="page" name="page6">6</a> ===
2856:F0 12          118             BEQ <a class="x" href="#MVOSW">MVOSW</a>
2858:8D 56 2A       119             STA SVINS+<span class='n'>1</span>
285B:A5 38          120             LDA INSW        ; SAVE CHAR IN SWITCH
285D:8D 55 2A       121             STA SVINS
                    122 ;
2860:AD 02 1D       123             LDA CINA        ; SET DFB CHAR IN ADR
2863:85 38          124             STA INSW
2865:AD 03 1D       125             LDA CINA+<span class='n'>1</span>
2868:85 39          126             STA INSW+<span class='n'>1</span>
                    127 ;
                    128 ;
                    129 ; MVOSW - MOVE OUTPUT SWITCH
                    130 ;
                    131 <a class="f" name="MVOSW"  >MVOSW       </a>EQU *
286A:A5 37          132             LDA OUTSW+<span class='n'>1</span>
286C:CD 05 1D       133             CMP COUTA+<span class='n'>1</span>
286F:F0 12          134             BEQ <a class="x" href="#MSVRTN">MVSRTN</a>
2871:8D 54 2A       135             STA SVOUTS+<span class='n'>1</span>
2874:A5 36          136             LDA OUTSW       ; SAVE CHAR OUT SWITCH
2876:8D 53 2A       137             STA SVOUTS
                    138 ;
2879:AD 04 1D       139             LDA COUTA       ; SET DFB CHAR OUT ADR
287C:85 36          140             STA OUTSW
287E:AD 05 1D       141             LDA COUTA+<span class='n'>1</span>
2881:85 37          142             STA OUTSW+<span class='n'>1</span>
                    143 <a class="f" name="MVSRTN" >MVSRTN      </a>EQU *
2883:60             144             RTS
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="CMDTBLS">CMDTBLS</a> - Commands, Page <a class="page" name="page21">21</a>, <a class='ts' href='#T1S7'>T1S7</a> - <a class='ts' href='#T1S9'>T1S9</a>, $<span class='n'>A884</span> .. $<span class='n'>AA4E</span> ===<hr class='join'><hr></div>
<pre>
                    001                 PAGE
                    002 ;                                                           ; <i>Smart</i> Operating System design separates
                    003 ; COMMAND NAME TABLE                                        ; * Kernel
                    004 ;                                                           ; * Shell (Command Interpretor)
                    005 <a class="d" name='EC1'      >EC1         </a>EQU *                                           ; This gives each program the maximum amount of run-time memory
                    006 <a class="d" name='CMDNTB'   >CMDNTB      </a>EQU *                                           ; Alas, DOS is not that smart
2884:49 4E 49 D4    007             DCI "INIT"                                      ; <a class='dumb' name='HNTODAOS1'>HNTODAOS: #1</a> Why is INIT listed first??? CATALOG is used <i>far more</i> then INIT
2888:4C 4F 41 C4    008             DCI "LOAD"                                      ; Either sort these by:
288C:53 41 56 C5    009             DCI "SAVE"                                      ;   a) frequency of use, (best)
2890:52 55 CE       010             DCI "RUN"                                       ;   b) alphabetical (better)
2893:43 48 41 49 CE 011             DCI "CHAIN"                                     ; i.e. "Power Users" are more likely to use BRUN, BLOAD, BSAVE before they use DELETE
2898:44 45 4C 45    012             DCI "DELETE"
289C:54 C5
289E:4C 4F 43 CB    013             DCI "LOCK"
28A2:55 4E 4C 4F    014             DCI "UNLOCK"
28A6:43 CB
28A8:43 4C 4F 53 C5 015             DCI "CLOSE"
28AD:52 45 41 C4    016             DCI "READ"
28B1:45 58 45 C3    017             DCI "EXEC"                                      ; inconsistent abbreviation: EXECUTE
28B5:57 52 49 54 C5 018             DCI "WRITE"
28BA:50 4F 53 49    019             DCI "POSITION"
2854:54 49 4F CE
28C2:45 50 45 CE    020             DCI "OPEN"                                      ; Calls EOPEN
28C6:41 50 50 45    021             DCI "APPEND"
28CA:4E C4
28CC:52 45 4E 41    022             DCI "RENAME"
28D0:4D C5
28D2:43 41 54 41    023             DCI "CATALOG"                                   ; <a class='dumb' name='HNTODAOS2'>HNTODAOS: #2</a> Let's slow users down forcing them type 7 characters
28D6:4C 4F C7                                                                       ; Which has a higher error rate of typos?
28D9:4D 4F CE       024             DCI "MON"                                       ; easier to type 3 characters CAT or DIR or 7 character CATALOG ?
28DC:4E 4F 4D 4F CE 025             DCI "NOMON"                                     ; /sarcasm Oh I see, we abbreviate the <i>uncomon</i> MONITOR but not the <b>common</b> CATALOG
28E1:50 52 A3       026             DCI "PR#"
28E4:49 4E A3       027             DCI "IN#"
28E7:4D 41 58 46    028             DCI "MAXFILES"
28EB:49 4C 45 D3
28EF:46 D0          029             DCI "FP"
28F1:49 4E D4       030             DCI "INT"
28F4:42 53 41 56 C5 031             DCI "BSAVE"
28F9:42 4C 4F 41 C4 032             DCI "BLOAD"
28FE:42 52 55 CE    033             DCI "BRUN"                                      ; === <a class='ts' name='T1S8'>T1S8</a> ===
2902:56 45 52 49    034             DCI "VERIFY"
2906:46 D9
2908:00             035             DFB 0                                           ; end sentinel, see <span class='todo'>TODO</span>
                    036             PAGE
                    037 ;                                                                   ; *sigh* Typical crap names; bitmask flags should be prefixed with common name:
                    038 ; COMMAND SYNTAX OP EQUATES FOR SYNTAX BYTE ONE                     ;     <span class='code'>P1_</span>     (better)
                    039 ;                                                                   ;     <span class='code'>PARAM1_</span> (best, but will concede a short name is extremely convenient)
                                                                                            ;
                                                                                            ;(better)
                    040 <a class='e' name='NPB'    >NPB         </a>EQU $<span class='n'>80</span>         ; NO PARMS OK, COMMAND GOES TO BASIC    ; P1_BAS    The <a class='dumb' name='amateur1'>first sign</a> of an amateur programmer:
                    041 <a class='e' name='NPE'    >NPE         </a>EQU $<span class='n'>40</span>         ; NO PARMS OK, COMMAND TO EXECUTION RTN ; P1_EXC        <b>Poor variable names</b>
                                                                                            ;
                                                                                            ;           Having 2 variable names differ by only <b>1 character</b>,
                                                                                            ;
                                                                                            ;               such as NPE, NPB,
                                                                                            ;               or worse NUM1, NUM2
                                                                                            ;
                                                                                            ;           is a recipe for disaster.
                                                                                            ;           "Silient" errors (uncaught typos) are a debugging nightmare.
                                                                                            ;           Using <b>unique names</b> lets us minimize this error.
                    042 <a class='e' name='FN1'    >FN1         </a>EQU $<span class='n'>20</span>         ; FILE NAME1 REGD                       ; P1_SRC
                    043 <a class='e' name='FN2'    >FN2         </a>EQU $<span class='n'>10</span>         ; FILE NAME2 REQD                       : P1_DST
                    044 <a class='e' name='NUM1'   >NUM1        </a>EQU $<span class='n'>08</span>         ; NUMERIC 0-7 REGD                      ; P1_SLT -- WTF is the <i>range</i> of NUM 1 ??? <b>Sl</b>o<b>t</b> tells us 3-bit
                    045 <a class='e' name='NUM2'   >NUM2        </a>EQU $<span class='n'>04</span>         ; NUMERIC 1-10 REQD                     ; P1_DEC -- WTF is the <i>range</i> of NUM 2 ??? <b>Dec</b>imal tells us 8-bit
                    046 <a class='e' name='RDONLY' >RNONLY      </a>EQU $<span class='n'>02</span>         ; RUN TIME ONLY FLAG.                   ; P1_RUN
                    047 <a class='e' name='CREFLG' >CREFLG      </a>EQU $<span class='n'>01</span>         ; FLAG TO INDICATE CMDS THAT MAY        ; P1_CRE -- FLaG tells us nothing, ALL of these are flags!
                    048 ;                                                                   ; <b>Q</b>. Why we would encode the type of paramater such as 1st or 2nd in the name?
                    049 ; COMMAND SYNTAX OP EQUATES FOR SYNTAX BYTE TWO                     ; <b>A</b>. It helps us to <i>visually</i> catch typos:
                    050 ;                                                                   ;        LDA PARAM2
                    051 <a class='e' name='V'      >V           </a>EQU $<span class='n'>40</span>         ; VOLUME ALLOWED                        ;        CMP PARAM1_CREATE  ; &larr; param 2 doesn&lsquo;t match param 1 above
<hr>                    052 <a class='e' name='D'      >D           </a>EQU $<span class='n'>20</span>         ; DRIVE ALLOWED                 ; === Page <a class='page' name='page22'>22</a> ===
                    053 <a class='e' name='S'      >S           </a>EQU $<span class='n'>10</span>         ; SLOT ALLOWED
                    054 <a class='e' name='L'      >L           </a>EQU $<span class='n'>08</span>         ; LENGTH ALLOWED
                    055 <a class='e' name='R'      >R           </a>EQU $<span class='n'>04</span>         ; RECORD NUMBER ALLOWED
                    056 <a class='e' name='B'      >B           </a>EQU $<span class='n'>02</span>         ; BYTE NUMBER ALLOWED
                    057 <a class='e' name='ADR'    >ADR         </a>EQU $<span class='n'>01</span>         ; ADDRESS                       ; crappy asm tools reserve <span class='code'>A</span> for implicit 6502 Accumulator, e.g. <span class='code'>LSR A</span>
                    058 <a class='e' name='CIO'    >CIO         </a>EQU $<span class='n'>80</span>         ; C,I, OR O ALLOWED             ; CIO = FLAG_CIO = $80 = minus, See <a class='e' href='#CIO'>CIO</a>, <a class='file' href='#CMDSCAN'>CMDSCAN</a>, Line #<a class='line' href='#CMDSCAN.204'>204</a>, and <a class='v' href='#OPTAB2'>OPTAB2</a>
                    059 ;
                    060 ; COMMAND SYNTAX TABLE
                    061 ; EACH COMMAND HAS TWO BYTE ENTRY 
                    062 ;
                    063 <a class='d' name='CMDSTB' >CMDSTB      </a>EQU *                                           ; This is another complete clusterfrak of bad formatting
                                                                                    ;
                                                                                    ; The <a class='dumb' name='amateur2'>second sign</a> of an amateur programmer:
                                                                                    ;     <b>One who doesn't understand the importance of whitespace.</b> (Horizontal and Vertical)
                                                                                    ;
                                                                                    ; 1. Horizontal alignment improves readability 1000%
                                                                                    ; 2. List the <b>common cases</b>, such as FN1, and V+D+S, <b>first</b>
                                                                                    ;
                                                                                    ; Notice how using a 2D grid it becomes trivial to check for typo's:
                                                                                    ;
                                                                                    ; FN1              +CREFLAG, V+D+S            ; INIT
                                                                                    ; FN1+NPB                  , V+D+S            ; LOAD
                                                                                    ; FN1+NPB          +CREFLAG, V+D+S            ; SAVE
                                                                                    ; FN1+NPB                  , V+D+S            ; RUN
                                                                                    ; FN1                      , V+D+S            ; CHAIN
                                                                                    ; FN1                      , V+D+S            ; DELETE
                                                                                    ; FN1                      , V+D+S            ; LOCK
                                                                                    ; FN1                      , V+D+S            ; UNLOCK
                                                                                    ; FN1    +NPE              , V+D+S            ; CLOSE
                                                                                    ; FN1       +RNONLY        ,       B+R        ; READ
                                                                                    ; FN1                      , V+D+S  +R        ; EXEC
                                                                                    ; FN1       +RNONLY        ,       B+R        ; WRITE
                                                                                    ; FN1       +RNONLY        ,         R        ; POSITION
                                                                                    ; FN1       +RNONLY+CREFLAG, V+D+S    +L      ; OPEN
                                                                                    ; FN1       +RNONLY        , V+D+S            ; APPEND
                                                                                    ; FN1+FN2                  , V+D+S            ; RENAME
                                                                                    ;         NPE              , V+D+S            ; CATALOG
                                                                                    ;         NPE              ,             CIO  ; MONITOR
                                                                                    ;         NPE              ,             CIO  ; NO MONITOR
                                                                                    ; NUM1                     , 0                ; PR#
                                                                                    ; NUM1                     , 0                ; IN#
                                                                                    ; NUM2                     , 0                ; MAXFILES
                                                                                    ;         NPE              , V+D+S            ; APPLESOFT
                                                                                    ;         NPE              , 0                ; INT
                                                                                    ; FN1              +CREFLAG, V+D+S    +L+ADR  ; BSAVE
                                                                                    ; FN1                      , V+D+S      +ADR  ; BLOAD
                                                                                    ; FN1                      , V+D+S      +ADR  ; BRUN
                                                                                    ; FN1                      , V+D+S            ; VERIFY
2909:21 70          064             DFB FN1+CREFLG,V+D+S          ; INIT
290B:A0 70          065             DFB NPB+FN1,V+D+S             ; LOAD
290D:A1 70          066             DFB NPB+FN1+CREFLG,V+D+S      ; SAVE
290E:A0 70          067             DFB NPB+FN1,V+D+S             ; RUN
2911:20 70          068             DFB FN1,V+D+S                 ; CHAIN
2913:20 70          069             DFB FN1,V+D+S                 ; DELETE
2915:20 70          070             DFB FN1,V+D+S                 ; LOCK
2917:20 70          071             DFB FN1,V+D+S                 ; UNLOCK
2919:60 00          072             DFB NPE+FN1,0                 ; CLOSE
291B:22 06          073             DFB FN1+RNONLY,B+R            ; READ
291D:20 74          074             DFB FN1,R+V+D+S               ; EXEC
291F:22 06          075             DFB FN1+RNONLY,B+R            ; WRITE
2921:22 04          076             DFB FN1+RNONLY,R              ; POSITION
2923:23 78          077             DFB FN1+RNONLY+CREFLG,L+V+D+S ; OPEN
2925:22 70          078             DFB FN1+RNONLY,V+D+S          ; APPEND
2927:30 70          079             DFB FN1+FN2,V+D+S             ; RENAME
2929:40 70          080             DFB NPE,V+D+S                 ; CATALOG
292B:40 80          081             DFB NPE,CIO                   ; MONITOR
292D:40 80          082             DFB NPE,CIO                   ; NO MONITOR
292F:08 00          083             DFB NUM1,0                    ; PR#
2931:08 00          084             DFB NUM1,0                    ; IN#
2933:04 00          085             DFB NUM2,0                    ; MAXFILES
2935:40 70          086             DFB NPE,V+D+S                 ; APPLESOFT
2937:40 00          087             DFB NPE,0                     ; INT
2939:21 79          088             DFB FN1+CREFLG,V+D+S+ADR+L    ; BSAVE
293B:20 71          089             DFB FN1,V+D+S+ADR             ; BLOAD
293D:20 71          090             DFB FN1,V+D+S+ADR             ; BRUN
293F:20 70          091             DFB FN1,V+D+S                 ; VERIFY
                    092             PAGE
                    093 ;                                                           
                    094 ; OPTAB - OPTIONAL PARMS SYNTAX TABLES                      
                    095 ;                                                           
                    096 <a class='d' name='OPTAB1'   >OPTAB1      </a>EQU *                                           ; <b>Problem</b>:  Keeping 2 tables in sync can lead to subtle bugs.
                                                                                    ; <b>Solution</b>: It would be better to <i>interleave</i> OPTAB1 and OPTAB2 
                                                                                    ;           to prevent synchronization mistakes:
                                                                                    ;    MSB ON
2941:D6 C4 D3 CC    097             DFB 'V'+$80,'D'+$80,'S'+$80,'L'+$80'            ;    DFB 'V', V         ; /sarcasm Apparently <span class='code'>MSB ON</span> was broken
2945:D2 C2 C1 C3    098             DFB 'R'+$80,'B'+$80,'A'+$80,'C'+$80'            ;    DFB 'D', D
2949:C9 CF          099             DFB 'I'+$80,'O'+$80'                            ;    DFB 'S', S         ; What's the point of compacting the lines???
                    100 <a class='d' name='OPT1L'    >OPT1L       </a>EQU *-OPTAB1                                    ;    DFB 'L', L         ; You write code for HUMANS not computers.
                    101 <a class='e' name='MI'       >MI          </a>EQU $<span class='n'>20</span>                                         ;    DFB 'R', R         ; <span class='todo'>TODO</span> does MI alias FN1? See <a class='x' href='#DRTNI'>DRTNI</a>
                    102 <a class='e' name='MO'       >MO          </a>EQU $<span class='n'>10</span>                                         ;    DFB 'B', B         ; <span class='todo'>TODO</span> does MO alias FN2? See <a class='x' href='#DRTNO'>DRTNO</a>
                    103 <a class='d' name='OPTAB2'   >OPTAB2      </a>EQU *                                           ;    DFB 'A', ADR
294B:40 20 10 08    104             DFB V,D,S,L                                     ;    DFB 'C', CIO+MC    ; MC was defined in <a class='file' href='#FDOSENT'>FDOSENT</a>, <a class='e' href='#MC'>MC</a>
294F:04 02 01 C0    105             DFB R,B,ADR,CIO+MC                              ;    DFB 'I', CIO+MI    ; CIO = FLAG_CIO = $80 = minus
2953:A0 90          106             DFB CIO+MI,CIO+MO                               ;    DFB 'O', CIO+MO    ; See <a class='e' href='#CIO'>CIO</a>, <a class='file' href='#CMDSCAN'>CMDSCAN</a>, Line #<a class='line' href='#CMDSCAN.204'>204</a>, and <a class='v' href='#OPTAB2'>OPTAB2</a>
                    107 <a class='d' name='OPTAB3'   >OPTAB3      </a>EQU *                                           ; /sarcasm Yay for more crappy table formatting and naming
                                                                                    ;              [Min, Max]
                                                                                    ; OptValMin  DW    0         ; Volume
                                                                                    ; OptValMax  DW       254
                                                                                    ;            DW    1, 2      ; Drive
                                                                                    ;            DW    1, 7      ; Slot
                                                                                    ;            DW    1, 32767  ; Length
                                                                                    ;            DW    0, 32767  ; Record Number
                                                                                    ;            DW    0, 32767  ; Record byte number
                                                                                    ;            DW    0, $FFFF  ; Address
2955:00 00          108             DW <span class='n'>0</span>                                            ; [0]
2957:FE 00          109             DW <span class='n'>254</span>          ; VOL RANGE
2959:01 00          110             DW <span class='n'>1</span>                                            ; [1]
295B:02 00          111             DW <span class='n'>2</span>            ; DRIVE RANGE
295D:01 00          112             DW <span class='n'>1</span>                                            ; [2]
295F:07 01          113             DW <span class='n'>7</span>            ; SLOT RANGE
2961:01 00          114             DW <span class='n'>1</span>                                            ; [3]             <span class='code'>BSAVE MEM.48K,A$0,L$C000</span> won't work without patching DOS
<hr>2963:FF 7F          115             DW <span class='n'>32767</span>        ; LENGTH RANGE                  ; === Page <a class='page' name='page23'>23</a> === A963:FF BF to save &gt; 32KB (48KB)
2965:00 00          116             DW <span class='n'>0</span>                                            ; [4]
2967:FF 7F          117             DW <span class='n'>32767</span>        ; REC NO RANGE
2969:00 00          118             DW <span class='n'>0</span>                                            ; [5]
296B:FF 7F          119             DW <span class='n'>32767</span>        ; REC BYTE NO RANGE
296D:00 00          120             DW <span class='n'>0</span>                                            ; [6]
296F:FF FF          121             DW $<span class='n'>FFFF</span>        ; ADDRESS RANGE
                    122             PAGE
                    123 ;
                    124 ; ERROR MESSAGE TABLES
                    125 ;
                    126 <a class='d' name='EMSG'     >EMSG        </a>EQU *
2971:0D 07 8D       127             DFB $<span class='n'>0D</span>, $<span class='n'>07</span>, $<span class='n'>8D</span>                               ; <a class='magic' name='_2971'>magic number</a> CR, BELL, CR + #$80
                    128 <a class='d' name='EM1'      >EM1         </a>EQU *-<a class='v' name='EMSG'>EMSG</a>
2974:4C 41 4E 47    129             DCI "LANGUAGE NOT AVAILABLE"
2978:55 41 47 45
297C:20 4E 4F 54
2980:20 41 56 41
2984:49 4C 41 42    130 <a class='d' name='EM2'      >EM2         </a>EQU *-EMSG                                      ; unnecessary duplicate
2988:4C C5          131 <a class='d' name='EM3'      >EM3         </a>EQU *-EMSG
298A:52 41 4E 47    132             DCI "RANGE ERROR"
298E:45 20 45 52
2992:52 4F D2       133 <a class='d' name='EM4'      >EM4         </a>EQU *-EMSG
2995:57 52 49 54    134             DCI "WRITE PROTECTED"
2999:45 20 50 52
299D:4F 54 45 43
29A1:54 45 C4       135 <a class='d' name='EM5'      >EM5         </a>EQU *-EMSG
29A4:45 4E 44 20    136             DCI "END OF DATA"
29A8:4F 46 20 44
29AC:41 54 C1       137 <a class='d' name='EM6'      >EM6         </a>EQU *-EMSG
29AF:46 49 4C 45    138             DCI "FILE NOT FOUND"
29B3:20 4E 4F 54    139 <a class='d' name='EM7'      >EM7         </a>EQU *-EMSG
29B7:20 46 4F 55
29BB:4E C4
29BD:56 4F 4C 55    140             DCI "VOLUME MISMATCH"
29C1:4D 45 20 4D
29C5:49 53 4D 41
29C9:54 43 C8       141 <a class='d' name='EM8'      >EM8         </a>EQU *-EMSG
29CC:49 2F 4F 20    142             DCI "I/O ERROR"
29D0:45 52 52 4F D2 143 <a class='d' name='EM9'      >EM9         </a>EQU *-EMSG
29D5:44 49 53 4B    144             DCI "DISK FULL"
29D9:20 46 55 4C CC 145 <a class='d' name='EM10'     >EM10        </a>EQU *-EMSG
29DE:46 49 4C 45    146             DCI "FILE LOCKED"
29E2:20 4C 4F 43    147 <a class='d' name='EM11'     >EM11        </a>EQU *-EMSG
29E6:4B 45 C4
29E9:53 59 4E 5E    148             DCI "SYNTAX ERROR"
29ED:41 58 20 45
29F1:52 52 4F D2    149 <a class='d' name='EM12'     >EM12        </a>EQU *-EMSG
29F5:4E 4F 20 42    150             DCI "NO BUFFERS AVAILABLE"
29F9:55 46 46 45
29FD:52 53 20 41                                                                    ; === <a class='ts' name='T1S9'>T1S9</a> ===
2A01:56 41 49 4C
2A05:41 42 4C C5    151 <a class='d' name='EM13'     >EM13        </a>EQU *-EMSG
2A09:46 49 4C 45    152             DCI "FILE TYPE MISMATCH"
2A0D:20 54 59 50
2A11:45 20 4D 49
2A15:53 4D 41 54
2A19:43 C8          153 <a class='d' name='EM14'     >EM14        </a>EQU *-EMSG
2A1B:50 52 4F 47    154             DCI "PROGRAM TOO LARGE"
2A1F:52 41 4D 20
2A23:54 4F 4F 20
2A27:4C 41 52 47 C5 155 ;
                    156 <a class='d' name='EM15'     >EM15        </a>EQU *-EMSG
2A2C:4E 4F 54 20    157             DCI "NOT DIRECT COMMAND"
2A30:44 49 52 45
2A34:43 54 20 43
2A38:4F 4D 4D 41
2A3C:4E C4
2A3E:8D             158             DFB $8D                                         ; KEY_CR
                    159 <a class='d' name='EMDTB'    >EMDTB       </a>EQU *                                           ; Array of (byte) Pointers to start of each error message
2A3F:00 03 19 19    160             DFB 0,<a class='v' href='#EM1' >EM1</a >,<a class='v' href='#EM2' >EM2</a >,<a class='v' href='#EM3' >EM3</a >                               ; <a class='mem' name='_2A42'>wastes</a> 1 byte for redundant error message EM3
2A43:24 33 3E 4C    161             DFB <a   class='v' href='#EM4' >EM4</a >,<a class='v' href='#EM5' >EM5</a >,<a class='v' href='#EM6' >EM6</a >,<a class='v' href='#EM7'>EM7</a>
2A47:5B 64 6D 78    162             DFB <a   class='v' href='#EM8' >EM8</a >,<a class='v' href='#EM8' >EM9</a >,<a class='v' href='#EM10'>EM10</a>,<a class='v' href='#EM11'>EM11</a>
2A4B:84 98 AA       163             DFB <a   class='v' href='#EM12'>EM12</a>,<a class='v' href='#EM13'>EM13</a>,<a class='v' href='#EM14'>EM14</a>
2A4E:BB             164             DFB <a   class='v' href='#EM15'>EM15</a>
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FDOSENT">FDOSENT</a> - External Entry Point, Pages <a class='page' name='page60'>60</a> - 62, <a class='ts' href='#T1S9'>T1S9</a> @ $4F - <a class='ts' href='#T1SA'>T1SA</a> @ $21, $<span class='n'>2A4F</span> .. $<span class='n'>2B21</span> ===<hr class='join'><hr></div>
<pre>
                    001                 PAGE
                    002 ;
                    003 ; MISC BUT REQD CELLS
                    004 ;
2A4F:00 00          005 <a class="d" name="CFTABA">CFTABA      </a>DDB <span class='n'>0</span>           ; CURRENT FILE TABLE POINTER    ; Why Big Endian??? DW is easier to tell this is 2 bytes then DFB DDB confusions
2A51:00             006 <a class="d" name="ISTATE">ISTATE      </a>DFB <span class='n'>0</span>           ; INPUT STATE
2A52:00             007 <a class="d" name="OSTATE">OSTATE      </a>DFB <span class='n'>0</span>           ; OUTPUT STATE
2A53:00 00          008 <a class="d" name="SVOUTS">SVOUTS      </a>DDB <span class='n'>0</span>           ; SAVED OUT SWITCH              ; Why Big Endian???
2A55:00 00          009 <a class="d" name="SVINS" >SVINS       </a>DDB <span class='n'>0</span>           ; SAVED IN SWITCH               ; Why Big Endian???
2A57:00             010 <a class="d" name="CNFTBS">CNFTBS      </a>DFB <span class='n'>0</span>           ; CURRENT NO FILE TABLES        ; "NO" == Number
2A58:03             011 <a class="d" name="DFNFB" >DFNFB       </a>DFB <span class='n'>3</span>           ; DEFAULT NO FILE TABLES        ; Does anyone actually use &gt; 2 ?
2A59:00             012 <a class="d" name="SVSTK" >SVSTK       </a>DFB <span class='n'>0</span>           ; SAVED STACK PTR
2A5A:00             013 <a class="d" name="SVX"   >SVX         </a>DFB <span class='n'>0</span>           ; DSAVED X REG                  ; *spelling* Saved
2A5B:00             014 <a class="d" name="SVY"   >SVY         </a>DFB <span class='n'>0</span>           : SAVED Y REG
2A5C:00             015 <a class="d" name="SVA"   >SVA         </a>DFB <span class='n'>0</span>           ; SAVED ACU
2A5D:00             016 <a class="d" name="LBUFD" >LBUFD       </a>DFB <span class='n'>0</span>           ; LINE BUFF DISPL
2A5E:00             017 <a class="d" name="MONMOD">MONMOD      </a>DFB <span class='n'>0</span>           ; MONITOR MODE BITS
                    018 <a class='e' name="MC"    >MC          </a>EQU $<span class='n'>40</span>         ; MONITOR CMDS
                    019 *MI EQU $20 ; MONITOR INPUT                                 ; Moved to <a class='file' href='CMDTBLS'>CMDTBLS</a>, <a class='e' href='#MI'>MI</a>
                    020 *MO EQU $10 ; MONITOR OUTPUT                                ; Moved to <a class='file' href='CMDTBLS'>CMDTBLS</a>, <a class='e' href='#MO'>MO</a>
2A5F:00             021 <a class="d" name="CMDNO" >CMDNO       </a>DFB $<span class='n'>00</span>         ; COMMAND NO IS ZERO FOR BOOT UP
2A60:00 00          022 <a class="d" name="SVBL"  >SVBL        </a>DFB <span class='n'>0</span>,<span class='n'>0</span>                                         ; <b>S</b>a<b>V</b>ed <b>B</b>inary <b>L</b>ength $AA60:Length of last BLOAD, BSAVE
2A62:00             023 <a class="d" name="SVCMD" >SVCMD       </a>DFB <span class='n'>0</span>                                           ; SaVed CoMmanD
2A63:00             024 <a class="d" name="TEMP1A">TEMP1A      </a>DFB <span class='n'>0</span>
2A64:00             025 <a class="d" name="TEMP2A">TEMP2A      </a>DFB <span class='n'>0</span>
2A65:00             026 <a class="d" name="INOPTS">INOPTS      </a>DFB <span class='n'>0</span>           ; INPUT OPTIONS
                    027 <a class="d" name="CUROPT">CUROPT      </a>EQU *           ; CURRENT OPTIONS               ; /sarcasm So we <i>can</i> type CUR ... but too lazy to type CUR_VOL, CUR_DRV, CUR_SLT??
                                                                                    ; <span class='note'>Note</span>: OPTAB3 and CUROPT must be keep in size sync! 
2A66:00 00          028 <a class="d" name="CV"    >CV          </a>DW <span class='n'>0</span>            ; VOLUME                        ; [0] normally <a class='mem' name='_2A67'>wastes</a> 1 byte; all numbers 16-bit, See CMDSCAN, Line #<a class='line' href='#CMDSCAN.239'>239</a>
2A68:00 00          029 <a class="d" name="CD"    >CD          </a>DW <span class='n'>0</span>            ; DRIVE                         ; [2] normally <a class='mem' name='_2A69'>wastes</a> 1 byte, all numbers 16-bit, /sarcasm because <a class="x" href="#DBINIT">DBINIT</a>, <a class="x" href="#OPNSUP">OPNSUP</a>
2A6A:00 00          030 <a class="d" name="CS"    >CS          </a>DW <span class='n'>0</span>            ; SLOT                          ; [4] normally <a class='mem' name='_2A6B'>wastes</a> 1 byte, all numbers 16-bit,      need 2 bytes bytes, right?
2A6C:01 00          031 <a class="d" name="CL"    >CL          </a>DW <span class='n'>1</span>            ; RECORD LENGTH                 ; [6]               
2A6E:00 00          032 <a class="d" name="CR"    >CR          </a>DW <span class='n'>0</span>            ; RECORD NUMBER                 ; [8] Not Carriage Return, but Current Record. /sarcasm Obvious, right?
2A70:00 00          033 <a class="d" name="CB"    >CB          </a>DW <span class='n'>0</span>            ; RECORD BYTE                   ; [A]
2A72:00 00          034 <a class="d" name="CA"    >CA          </a>DW <span class='n'>0</span>            ; ADDRESS                       ; [C] $AA72:Address of last BLOAD
2A74:00             035 <a class="d" name="IMBITS">IMBITS      </a>DFB <span class='n'>0</span>                                           ; <span class='todo'>TODO</span>: Input Monitor Bits??? Used in <a class='x' href='#EMON'>EMON</a>
                    036             MSB ON                                          ; We can't <span class="macro">DS 30-5,$A0</span> ???
2A75:C8 C5 CC CC    037 <a class="d" name="FNAME1">FNAME1      </a>ASC "HELLO                         " ; FILENAME 1"
2A79:CF A0 A0 A0
2A7D:A0 A0 A0 A0
2A81:A0 A0 A0 A0
2A85:A0 A0 A0 A0
2A89:A0 A0 A0 A0
2A8D:A0 A0 A0 A0
2A91:A0 A0
                    038             MSB OFF
2A93:A0 A0 A0 A0    039 <a class="d" name="FNAME2">FNAME2      </a>DS <span class='n'>30</span>,$<span class='n'>A0</span>       ;FILENAME 2                     ; Too lazy to leave MSB ON, and ASC " " x30 ??
2A97:A0 A0 A0 A0
2A9B:A0 A0 A0 A0
2A9F:A0 A0 A0 A0
2AA3:A0 A0 A0 A0
2AA7:A0 A0 A0 A0
2AAB:A0 A0 A0 A0
2AAF:A0 A0
2AB1:03             040 <a class="d" name="DFNFTS">DFNFTS      </a>DFB <span class='n'>3</span>           ; DEFAULT FILE TABLES = 3       ; <a class="x" href="#INITD">INITD</a> copies to <a class="v" href="#CNFTBS">CNFTBS</a>
2AB2:84             041 <a class="d" name="CCHAR" >CCHAR       </a>DFB $<span class='n'>84</span>         ; CONTROL CHAR                  ; Control-D actives DOS for next ASCII command <a class='magic'>magic number</a> KEY_CTRL_D
2AB3:00             042 <a class="d" name="ESTATE">ESTATE      </a>DFB <span class='n'>0</span>           ; EXECUTE STATE
2AB4:00 00          043 <a class="d" name="EFTABA">EFTABA      </a>DFB <span class='n'>0</span>,<span class='n'>0</span>         ; EXECUTE FILE TABLE POINTER
2AB6:00             044 <a class="d" name="ASIBSW">ASIBSW      </a>DFB <span class='n'>0</span>           ; APPLESOFT, IB SWITCH          ; <a class="x" href="#TSTRUN">00=Integer</a>, <a class="x" href="#IAS1">40=Applesoft ROM</a>, 80=Applesoft RAM
2AB7:00             045 <a class="d" name="RSTATE">RSTATE      </a>DFB <span class='n'>0</span>           ; FOR APPLESOFT RUN PROGRAM AFTER RELOC
2AB8:C1 D0 D0 CC    046 <a class="d" name="FASB"  >FASB        </a>DFB $<span class='n'>C1</span>,$<span class='n'>D0</span>,$<span class='n'>D0</span>,$<span class='n'>CC</span> ;'APPLESOFT' WITH BIT 7 HIGH; /sarcasm If only we had <span class='code'>MSB ON</span> and <span class='code'>ASC</span> directives
2ABC:C5 D3 CF C6    047             DFB $<span class='n'>C5</span>,$<span class='n'>D3</span>,$<span class='n'>CF</span>,$<span class='n'>C6</span>                             ; Binary to run if Integer active and user types <a class="x" href="#EAS">FP</a>
2AC0:D4             048             DFB $<span class='n'>D4</span>
                    049 <a class="d" name="FASBL" >FASBL       </a>EQU *-<a class="v" href="#FASB"  >FASB</a>                                      ; Filename Length of Applesoft binary, copied in <a class="x" href="#EAS0">EAS0</a>
                    050             PAGE
                    051 ;
                    052 ; DOS ADR TABLES (RELOCATED)
<hr>                    053 ;                                                           ; === Page <a class='page' name='page61'>61</a>
                    054 <a class="d" name="SAT2"  >SAT2        </a>EQU *                                           ; Start Address Table
                                                                                    ; Gee, we couldn't have put this at $1D00 to save 4 bytes in <a class='v' href='#ADRTAB'>ADRTAB</a> ?!
2AC1:E8 37          055 <a class="d" name="AIOB"  >AIOB        </a>DW <a class="v" href="#IOB"     >IOB</a>          ; 5-ADR IOB                     ; Also see <a class='v' href='#BAIOB'>BAIOB</a>; What happened to 1 .. 4 ??? At RVT, WVT ?
2AC3:BB 33          056 <a class="d" name="AVTOC" >AVTOC       </a>DW <a class="v" href="#VTOC"    >VTOC</a>         ; 6-ADR VTOC
2AC5:BB 34          057 <a class="d" name="AVOLDR">AVOLDR      </a>DW <a class="v" href="#VOLDIR"  >VOLDIR</a>       ; 7-ADR VOLDIR
2AC7:00 40          058 <a class="d" name="AEND"  >AEND        </a>DW <a class="v" href="#ENDOFDOS">ENDOFDOS</a>     ;END OF DOS                     ; See <a class='v' href='#REPAGE'>REPAGE</a>
                    059 ;                                                           ; File Manager
2AC9:7E 33          060 <a class='d' name='CMDVT'>CMDVT       </a>DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>     ; 0-NULL                        ; [0] <a class='mem' name='_2AC9'>wastes</a> 2 bytes &rarr; $B37E
2ACB:21 2B          061             DW <a class='x' href='#FOPEN' >FOPEN</a>-<span class='n'>1</span>      ; 1-OPEN FILE                   ; [1]
2ACD:05 2C          062             DW <a class='x' href='#FCLOSE'>FCLOSE</a>-<span class='n'>1</span>     ; 2-CLOSE FILE                  ; [2]
2ACF:57 2C          063             DW <a class='x' href='#FREAD' >FREAD</a>-<span class='n'>1</span>      ; 3-READ DATA                   ; [3]
2AD1:6F 2C          064             DW <a class='x' href='#FWRITE'>FWRITE</a>-<span class='n'>1</span>     ; 4-WRITE DATA                  ; [4]
2AD3:2A 2D          065             DW <a class='x' href='#FDEL'  >FDEL</a>-<span class='n'>1</span>       ; 5-DELETE FILE                 ; [5]
2AD5:97 2D          066             DW <a class='x' href='#RDIR'  >RDIR</a>-<span class='n'>1</span>       ; 6-READ DIRECTORY              ; [6] /sarcasm Yay for consistent naming: FDIR
2AD7:EE 2C          067             DW <a class='x' href='#FLOCK' >FLOCK</a>-<span class='n'>1</span>      ; 7-LOCK A FILE                 ; [7]
2AD9:F5 2C          068             DW <a class='x' href='#FUNLCK'>FUNLCK</a>-<span class='n'>1</span>     ; 8-UNLOCK A FILE               ; [8]
2ADB:39 2C          069             DW <a class='x' href='#FRNME' >FRNME</a>-<span class='n'>1</span>      ; 9-RENAME                      ; [9]
2ADC:11 2D          070             DW <a class='x' href='#FPOSTN'>FPOSTN</a>-<span class='n'>1</span>     ; 10-POSITION A FILE            ; [A]
2ADE:8D 2E          071             DW <a class='x' href='#FFMT'  >FFMT</a>-<span class='n'>1</span>       ; FORMAT                        ; [B]
2AE1:17 2D          072             DW <a class='x' href='#FVAR'  >FVAR</a>-<span class='n'>1</span>       ; VARIFY                        ; [C] *spelling* VERIFY
2AE3:7E 33          073             DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>     ; 11-SPARE                      ; [D] <a class='mem' name='_2AE3'>wastes</a> 2 bytes due to fencepost error
                                                                                    ;     Uh, calling 13 "eleven" doesn't make it so. 
                    074 ;                                                           ;     See <a class='x' href='#DOSENT'>DOSENT</a>: CCBREQ (FileManager.command) &gt;= <a class='v' href='#CRQMAX'>CRQMAX</a>
                                                                                    ;         AAE3:00 00                 ; (was 7E B3) to prove this is never called
                                                                                    ;         0300:20 DC 03  JSR CCBLDR  ; $9E5D GetCCBAdr   ; $9D0E: dw $B5BB = <a class='v' href='#CCB'>CCB</a>
                                                                                    ;         0303:84 FD     STY $FD
                                                                                    ;         0305:85 FE     STA $FE
                                                                                    ;         0307:A9 0D     LDA #$D     ; Command = CRQMAX
                                                                                    ;         0309:A0 00     LDY #0      ; FileManager.Command = Command
                                                                                    ;         030B:91 FD     STA ($FD),Y
                                                                                    ;         030D:4C D6 03  JMP USERENT ; $AAFD FileManager
                    075 <a class='f' name='RVT'      >RVT         </a>EQU *                                           ; <a class='x' href='#USERNT'>USERENT</a> calls <a class='x' href='#FREAD'>FREAD</a>
2AE5:7E 33          076             DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>                                     ; [0] <a class='mem' name='_2AE5'>wastes</a> 2 bytes; See <a class='v' href='#CRMNUL'>CRMNUL</a>
2AE7:89 2C          077             DW <a class='x' href='#RNXBYT'>RNXBYT</a>-<span class='n'>1</span>    ; 1-RD NEXT BYTE                 ; [1]
2AE9:95 2C          078             DW <a class='x' href='#RNXBLK'>NXBLK</a>-<span class='n'>1</span>     ; 1-RD NEXT BLOCK                ; [2] *sigh* copy-paste
2AEB:86 2C          079             DW <a class='x' href='#RSPBYT'>RSPBYT</a>-<span class='n'>1</span>    ; 2-RD SPECIFIC BYTE             ; [3]
2AED:92 2C          080             DW <a class='x' href='#RSPBLK'>RSPBLK</a>-<span class='n'>1</span>    ; 3 - RD SPECIFIC BLOCK          ; [4]
2AEF:7E 33          081             DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>    ; 4 - SPARE                      ; [5] <a class='mem' name'_2AEF'>wastes</a> 2 bytes off-by-1 allocation, see <a class='v' href='#CRMMAX'>CRMMAX</a>, <a class='x' href='#FREAD'>FREAD</a>
                    082 ;
                    083 <a class='f' name='WVT'      >WVT         </a>EQU *
2AF1:7E 33          084             DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>                                     ; [0] <a class='mem' name'_2AF1'>wastes</a> 2 bytes; Stop, please stop this stupidity
2AF3:BD 2C          085             DW <a class='x' href='#WNXBYT'>WNXBYT</a>-<span class='n'>1</span>    ; 1-WR NEXT BYTE                 ; [1]
2AF5:C9 2C          086             DW <a class='x' href='#WNXBLK'>WNXBLK</a>-<span class='n'>1</span>    ; WR NEXT BLOCK                  ; [2] *sigh* copy-paste
2AF7:BA 2C          087             DW <a class='x' href='#WSPBYT'>WSPBYT</a>-<span class='n'>1</span>    ; 2-WR SPECIFIC BYTE             ; [3]
2AF9:C6 2C          088             DW <a class='x' href='#WSPBLK'>WSPBLK</a>-<span class='n'>1</span>    ; 3-WR SPECIFIC BLOCK            ; [4]
2AFB:7E 33          089             DW <a class='x' href='#GOODIO'>GOODIO</a>-<span class='n'>1</span>    ; 4 - SPARE                      ; [5] <a class='mem' name='_2AFB'>wastes</a> 2 bytes
                    090 <a class='d' name='EAT2'>EAT2        </a>EQU *
                    091             PAGE
                    092 ;
                    093 ; USERENT - DOS EXTERNAL ENTRY POINT (USER ENTRY)
                    094 ; ENTRY PARM:
                    095 ;  A= HIGH ADDRESS OF CCB
                    096 ;  Y= LOW ADDRESS OF CCB
                    097 ;  X= 0 IF CREATE DESIRED
                    098 ;  X&gt; 0 IF CREATE NOT DESIRED
                    099 ; EXIT PARM:
                    100 ;  CARRY CLEAR = OPERATION OK
                    101 ;  CARRY SET = ERROR
                    102 ;
                    103 <a class='f' name='SC2'    >SC2         </a>EQU *                                           ; See: [1] <a class='v' href='#CDETAB'>CDETAB</a>
2AFD:E0 00          104 <a class='f' name='USERENT'>USERENT     </a>CPX #<span class='n'>0</span>          ;IF X=0 THEN FILE CREATED IF NOT
2AFF:F0 02          105             BEQ <a class='x' href='#USRCR'>USRCR</a>       ; FOUND. NOTE: FILE NOT FOUND ERROR STILL IS RETURNED ; === <a class='ts' href='#T1SA'>T1SA</a> ===
2B01:A2 02          106             LDX #<span class='n'>2</span>          ;INDICATE NO CREATE ALLOWED
2B03:8E 5F 2A       107 <a class='f' name='USRCR'  >USRCR       </a>STX <a class='v' href='#CMDNO'>CMDNO</a>       ;SET UP FOR CREATE CAPIBILITY   ; *spelling* CAPABILITY 
                    108 <a class='f' name='DOSENT' >DOSENT      </a>EQU *                                           ; /sarcasm Is that like our potential to be cap'd or knock'd off :-)
2B06:BA             109             TSX
2B07:8E 9B 33       110             STX <a class='v' href='#ENTSTK'>ENTSTK</a>
2B0A:20 6A 2E       111             JSR <a class='x' href='#CLCFCB'>CLCFCB</a>      ; GO CALCULATE FCB
2B0D:AD BB 35       112             LDA <a class='v' href='#CCBREQ'>CCBREQ</a>      ; GET REQUEST
2B10:C9 0D          113             CMP #CRQMAX     ; TTEST REQ RANGE               ; /sarcasm South Park: Jimmy
<hr>2B12:B0 0B          114             BCS <a class='x' href='#ERR2'>ERR2</a>        ; BR OUT OF RANGE               ; === Page <a class='page' name='page62'>62</a> === <i>A-a-n-d you still have an of-of-of-off-by-one bug allocation in array <a class='v' href='#CMDVT'>CMDVT</a>!</i>
2B14:0A             115             ASL A           ; REQ CODE *2
2B15:AA             116             TAX
2B16:BD CA 2A       117             LDA <a class='v' href='#CMDVT'>CMDVT</a>+<span class='n'>1</span>,X   ; PUSH ADR ONTO STACK
2B19:48             118             PHA
2B1A:BD C9 2A       119             LDA <a class='v' href='#CMDVT'>CMDVT</a>,X
2B1D:48             120             PHA
2B1E:60             121 <a class='f' name='DENRTS'>DENRTS      </a>RTS
2B1F:4C 63 33       122 <a class='f' name='ERR2'  >ERR2        </a>JMP <a class='x' href='#ERROR2'>ERROR2</a>
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FOPCLRW">FOPCLRW</a> - Open; Close; Rename; Read, Page <a class="page" name="page77">77</a>, <a class='ts' href='#T1SA'>T1SA</a> - <a class='ts' href='#T1SB'>T1SB</a>, $<span class='n'>2B22</span> ($AB22) ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ; FOPEN - OPEN A FILE
                    004 ;
                    005 <a class="f" name="FOPEN"      id="FOPEN"      >FOPEN       </a>EQU *
2B22:20 28 2B       006             JSR <a class='x' href='#DOPEN'>DOPEN</a>                    ; &darr;
2B24:4C 7F 33       007             JMP GOODIO
                    008 ;
                    009 <a class='f' name='DOPEN'    >DOPEN       </a>EQU *
                    010 ;
                    011             JSR DCBSUP
                    012 ;
                    013 ;
                    014             LDA #1
                    015             STA DCBSDL+1
                    016             LDX CCBRLN+1    ; MOVE RECORD LENGTH
                    017             LDA CCBRLN
                    018             BNE F01
                    019             CPX 0
                    020             BNE F02
                    021             INX             ; SET RL=256
                    022 <a class='f' name='F02'      >F02         </a>STA DCBRCL
                    023             STX DFBRCL+1
                    024 ;
                    025             JSR FNDFIL      ; GO FIND FILE
                    026             BCC F03         ; BR IF FOUND
                    027 ;
                    028 * CREATE FILE IF COMMAND IS SAVE, OPEN, BSAVE
                    029 ;
                    <a class='line' name='FOPCLRW.30'>030</a>             STX TEMP1       ; SAVE DIR. INDEX
                    031             LDX CMDNO       ;TEST COMMAND FOR CREATE FLAG
                    032             LDA CMDSTB,X    ; (BIT 0 MUST=1)
                    033             LDX TEMP1       ;RESTORE DIR INDEX
                    034             LSR A           ;SHIFT CREFLAG BIT TO CARRY
                    035             BCS F02B        ;BRANCH ON VALID INSTR.
                    036             LDA ISTATE      ;FIND OUT IF TRYING TO LOAD APPLESOFT
2B5A:C9 C0          037             CMP #$C0                                        ; <a class='magic' name='_2B5A'>magic number</a>
2B5C:D0 03          038             BNE F02A        ; NO GO
2B5E:4C 5F 33       039             JMP ERROR1                                      ; Which error message?? "LANGUAGE NOT AVAILABLE"
2B61:4C 73 33       040 <a class='f' name='F02A'     >F02A        </a>JMP ERROR6      ; PRINT "FILE NOT FOUND" MESSAGE.
2B64:A9 00          041 <a class='f' name='F02B'     >F02B        </a>LDA #<span class='n'>0</span>                                          ; 0001 Little Endian
2B66:9D E8 34       042             STA VDFILE+<span class='n'>34</span>,X                                 ; <a class='magic' name='_2B67'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC+0</span> (See <a class='v' href='#VDFILE'>VDFILE</a>)
2B69:A9 01          043             LDA #<span class='n'>1</span>
2B6B:9D E7 34       044             STA VDFILE+<span class='n'>33</span>,X                                 ; <a class='magic' name='_2B6C'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC+1</span>
2B6E:8E 9C 33       045             STX TEMP1       ; SAVE VDIR INDEX               ; Why?? <a class='mem' name='_2B6E'>wastes</a> 2 bytes, Line #<a class='line' href='#FOPCLRW.30'>30</a> already saved
2B71:20 44 32       046             JSR GETSEC      ; GO ALLOCATE SECTOR
2B74:AE 9C 33       047             LDX TEMP1
2B77:9D C7 34       048             STA VDFILE+<span class='n'>1</span>,X  ; PUT SECTOR INTO VDIR          ; <a class='magic' name='_2B78'>magic number</a> <span class='code'>VDFILE + CAT_FILE_SECTOR</span>
2B7A:8D D2 35       049             STA DCBFDS      ; PUT SECTOR AS 1ST FILE DIR
2B7D:8D D4 35       050             STA DCBCDS      ; PUT SECTOR AS CURRENT FILE DIR
2B80:AD F1 35       051 ;
2B83:9D C6 34       052             LDA DCBATK      ; GET ALLOCATED TRACK
<hr>2B86:8D D1 35       053             STA VDFILE,X    ; PUT INTO VDIR                 ; === Page <a class='page' name='page78'>78</page> === <a class='magic' name='_2B87'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TRACK</span>
                    054             STA DCBFDT      ; AND AS 1ST FILE DIR           ; More crappy variable names    : dcbFdt
                    055             STA DCBCDT      ; AND AS CURRENT FILE DIR       ; that differ by a single letter: dcbCdt
                    056;
                    057             LDA CCBFUC      ; SET USE CODE
2B8F:9D C8 34       058             STA VDFILE+<span class='n'>2</span>,X  ; INTO DIRECTORY                ; <a class='magic' name='_2B90'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TYPE</span>
                    059 ;
                    060             JSR WRVDIR      ; GO WRITE VOL DIRECTORY
                    061 ;
                    062             JSR MVFCBD      ; MOVE FILE DIR ADR TO ZP
                    063             JSR CLRSEC      ; GO CLEAR IT
                    064             JSR WRFDGO      ; GO WRITE FILE DIRECTORY
                    065 ; DONE CREATION
                    066             LDX TEMP1       ; RE-GET INDEX                  ; <b>Which</b> index?? VDFILE offset
                    067             LDA #CREFNF
                    068             STA CREFNF
                    069 ;
                    070 <a class='f' name='F03'      >F03         </a>EQU *
2BA6:BD C6 34       071             LDA VDFILE,X    ; MOVE FILE DIR TRACK           ; <a class='magic' name='_2BA7'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TRACK</span>
2BA9:               072             STA DCBFDT
2BAC:BD C7 34       073             LDA VDFILE+<span class='n'>1</span>,X  ; MOVE FILE DIR SECTOR          ; <a class='magic' name='_2BAD'>magic number</a> <span class='code'>VDFILE + CAT_FILE_SECTOR</span>
2BAF:               074             STA DCBFDS
2BB2:BD C8 34       075             LDA VDFILE+<span class='n'>2</span>,X  ; 7OVE FILE USE CODE            ; *spelling* Move; <a class='magic' name='_2BB3'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TYPE</span>
2BB5:               076             STA CCBFUC
2BB8:               077             STA DCBFUC
2BBB:BD E7 34       078             LDA VDFILE+<span class='n'>33</span>,X                                 ; <a class='magic' name='_2BBC'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC</span>
2BBE:               079             STA DCBNSA
2BC1:BD E8 34       080             LDA VDFILE+<span class='n'>34</span>,X                                 ; <a class='magic' name='_2BC2'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC+1</span>
                    081             STA DCBNSA+<span class='n'>1</span>
                    082             STX DCBVDI      ;SAVE DIRECTORY INDEX
                    083 ;
                    084             LDA #255        ; INDICATE NO SECTOR
                    085             STA DCBCMS      ; IN MEMORY                     ; More crappy variable names    : dcbCms
                    086             STA DCBCMS+<span class='n'>1</span>
                    087             LDA VTDMS       ; MOVE MAX FD SECTS
                    088             STA DCBDMS      ; TODCB                         ; that differ by a single letter: dcbDms
                    089             CLC
                    090             JMP RDFDIR      ; READ 1ST DIRECTORY RECORD     ; Read inode
                    091 ;
                    092 ;
                    093 ;
                    094 ;
                    095 <a class='f' name='DCBSUP'   >DCBSUP      </a>EQU *
2BDC:A9 00          096             LDA #0
2BDE:AA             097             TAX
2BDF:9D D1 35       098 <a class='f' name='F01'      >F01         </a>STA FCBDCB,X    ; CLEAR DCB
2BE2:E8             099             INX
2BE3:E0 2D          100             CPX #<a class='e' href='#DCBLEN'>DCBLEN</a>                                     ; Over-writes unused memory <a class='v' href='#DCBSPR'>DCBSPR</a>
                    101             BNE F01
                    102 ;
                    103             LDA CCBVOL      ; MOVE VOL
                    104             EOR #$FF        ; INVERT VOL BITS               ; Why??
                    105             STA DCBVOL
                    106             LDA CCBDRV      ; MOVE DRIVE
                    107             STA DCBDRV
                    108             LDA CCBSLT      ; GET USER SPEC SLOT
                    109             ASL A           ; SLOT*16
                    110             ASL A
                    111             ASL A
                    112             ASL A
2BFC:AA             113             TAX
                    114 <a class='f' name='F01A'     >F01A        </a>EQU *
2BFD:8E F7 FF       115             STX DCBSLT
<hr>                                                                                    ; === Page <a class='page' name='page79'>79</a> ===
                                                                                    ; === <a class='ts' name='T1SB'>T1SB</a> ===
2C00:A9             116             LDA #<span class='n'>17</span>                                         ;[.. <a class='mem' name='_2C00'>wastes</a> 5 bytes; <a class='magic' name='_2C01'>magic number</a> <span class='code'>FILESYSTEM_VTOC_CAT_TRACK = $11</span>
2C02:8D FA 35       117             STA <a class='v' href='#DCBVTN'>DCBVTN</a>                                      ; ..] due to unitialized <a class='x' href='#DCBVTN'>DCBVTN</a> DS 1           Because this can change???
2C05:60             118             RTS
                    119             PAGE
                    120 ;
                    121 ; FCLOSE - CLOSE A FILE
                    122 ;
                    123 <a class='f' name='FCLOSE'   >FCLOSE      </a>EQU *
2C06:20 1D 2F       124             JSR WRSECT      ; WRITE OPEN SECTOR
2C09:20 34 2F       125             JSR WRFDIR      ; GO WRITE FILE DIRECTORY       ; Asinine comments like this wouldn't even be needed with proper names
2C0C:20 C3 32       126             JSR FRETRK      ; FREE UNUSED SECTORS           ;     JSR WR_FILE_DIR
2C0F:A9 02          127             LDA #IBCWTS
2C11:2D D5 35       128             AND DCBWRF
2C14:F0 21          129             BEQ FC2
                    130 ;
2C16:20 F7 2F       131             JSR RDVTOC
2C19:A9 00          132             LDA #0
2C1B:18             133             CLC
                    134 <a class='f' name='FC1'      >FC1         </a>EQU *
2C1C:20 11 30       135             JSR <a class='x' href='#RDVDIR'>RDVDIR</a>      ; READ VDIR                     ; <span class='todo'>TODO</span> A = ???
2C1F:38             136             SEC
2C20:CE D8 35       137             DEC <a class='v' href='#DCBVDR'>DCBVDR</a>                                      ; <span class='todo'>TODO</span> Why DEC ? -- Sector offset set in <a class='x' href='#FNDFIL'>FNDFIL</a>
2C23:D0 F7          138             BNE FC1
2C25:AE D9 35       139             LDX <a class='v' href='#DCBVDI'>DCBVDI</a>                                      ; Volume Directory Index: X = file entry offset in CATALOG sector
2C28:AD EE 35       140             LDA DCBNSA      ; MOVE NO SECTORS ALLOCATED     ; <i>You keep using this word <b>move</b>, it doesn't mean what you think it means.</i>
2C2B:9D E7 34       141             STA VDFILE+33,X                                 ; <a class='magic' name='_2C2C'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC</span>
2C2E:AD EF 35       142             LDA DCBNSA+1
2C31:9D E8 34       143             STA VDFILE+34,X                                 ; <a class='magic' name='_2C32'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC</span>
2C34:20 37 30       144             JSR WRVDIR      ; WRITE VOL DIR REC
                    145 ;
                    146 ;
                    147 <a class='f' name='FC2'      >FC2         </a>EQU *
2C37:4C 7F 33       148             JMP GOODIO      ; DONE
                    149             PAGE
                    150 ;
                    151 * FRNAME - RENAME A FILE
                    152 ;
                    153 <a class='f' name='FRNME'    >FRNME       </a>EQU *
2C3A:20 28 2B       154             JSR DOPEN       ; GO OPEN FILE
2C3D:AD F6 35       155             LDA DCBFUC      ; GET USE CODE
2C40:30 2B          156             BMI ER10        ; BR IF LOCKED
2C42:AD BD 35       157             LDA CCBFN2      ; MOVE NEW FN
2C45:85 42          158             STA ZPGFCB      ; MOVE PTR TO ZPG
2C47:AD BE 35       159             LDA CCBFN2+1
2C4A:85 43          160             STA ZPGFCB+1
2C4C:AE 9C 33       161             LDX TEMP1       ; GET VDIR INDEX                ; <span class='todo'>TODO</span> Does DOPEN set this?
2C4F:20 1C 32       162             JSR MVFN        ; MOVE FILE NAME
2C52:20 37 30       163             JSR WRVDIR      ; GO WRITE VDIR
2C55:4C 7F 33       164             JMP GOODIO      ; DONE RENAME                   ; mastes 1 bytes
                    165             PAGE
                    166 ;
                    167 * FREAD - READ A FILE
                    168 ;
                    169 <a class='f' name='FREAD'    >FREAD       </a>EQU *
                    170 ;
2C58:AD BC 35       171             LDA CCBRQM      ; GET REQ MOD
2C5B:C9 05          172             CMP #<a class='e' href='#CRMMAX'>CRMMAX</a>     ; TEST LIMIT
2C5D:B0 0B          173             BCS ERR3A       ; BR BAD
                    174 ;
                                                                                    ; Current code uses: 32 bytes
                                                                                    ;   11 bytes  $2C5F..$2C69 <a class='x' href='#FREAD' >FREAD</a>
                                                                                    ;   11 bytes  $2C7C..$2C86 <a class='x' href='#FWRITE'>FWRITE</a>
                                                                                    ;   10 bytes  $2189..$2192 <a class='x' href='#ECMD'  >ECMD</a>
                                                                                    ;
                                                                                    ; New code uses: 31 bytes + reloc table entries
                                                                                    ;   4 bytes (<b>Setup code</b>)
                                                                                    ;     2C5F:A2 E6      <span class='code'>         LDX #&lt;RVT+1   </span> ; lo byte of func table address
                                                                                    ;     2C61:A0 2A      <span class='code'>         LDY #&gt;RVT     </span> ; hi byte of func table address
                                                                                    ;                     ; ... intentional fall into CallFunc ...
                                                                                    ;  14 bytes <a class='x' href='#FREAD' >FREAD</a> (<b>Common code</b>)
                                                                                    ;     2C63:0A         <span class='code'>CallFunc ASL           </span> ; main entry point if A not SHL
                                                                                    ;     2C64:86 48      <span class='code'>SaveFunc STX IOBPL     </span> ; 2nd  entry point if A is  SHL
                                                                                    ;     2C66:84 49      <span class='code'>         STY IOBPH     </span> ;
                                                                                    ;     2C68:A8         <span class='code'>         TAY           </span>
                                                                                    ;     2C69:B1 48      <span class='code'>         LDA (IOBPL),Y </span> ; B9 FF FF LDA $FFFF,Y
                                                                                    ;     2C6B:48         <span class='code'>         PHA           </span>
                                                                                    ;     2C6C:88         <span class='code'>         DEY           </span>
                                                                                    ;     2C6D:B1 48      <span class='code'>         LDA (IOBPL),Y </span>
                                                                                    ;     2C6F:48         <span class='code'>         PHA           </span>
                                                                                    ;     2C74:60         <span class='code'>         RTS           </span>
                                                                                    ;
                                                                                    ;   6 bytes <a class='x' href='#FWRITE'>FWRITE</a>
                                                                                    ;     2C7C:A2 F1      <span class='code'>        LDX #&lt;WVT+1    </span> ; lo byte of func table address
                                                                                    ;     2C7E:A0 2A      <span class='code'>        LDY #&gt;WVT      </span> ; hi byte of func table address
                                                                                    ;     2C80:90 DF      <span class='code'>        BCC CallFunc   </span>
                                                                                    ;
                                                                                    ;   7 bytes <a class='x' href='#ECMD'>ECMD</a>
                                                                                    ;     2189:A2 1E      <span class='code'>         LDX #&lt;CMDETB+1</span>
                                                                                    ;     218B:A0 1D      <span class='code'>         LDY #&gt;CMDETB  </span>
                                                                                    ;     218D:4C 63 2C   <span class='code'>         JMP SaveFunc  </span>
2C5F:0A             175             ASL A           ; CODE*2                        ;[.. <b>Data</b>*2 = Array of 16-bit Function Pointers
2C60:AA             176             TAX                                             ; ..
2C61:BD E6 2A       177             LDA <a class='v' href='#RVT'>RVT</a>+<span class='n'>1</span>,X     ; GET READ ROUTINE              ; ..
2C64:48             178             PHA                                             ; .. old code
<hr>2C65:BD E5 2A       179             LDA <a class='v' href='#RVT'>RVT</a>,X                                       ; .. === Page <a class='page' name='page80'>80</a> ===
2C68:48             180             PHA             ; AND                           ; ..
2C69:60             181             RTS             ; GO TO IT                      ; ..]
                    182 ;
2C6A:4C 67 33       183 <a class='f' name='ERR3A'    >ERR3A       </a>JMP <a class='x' href='#ERROR3'>ERROR3</a>                                      ; <b>What</b> is   &rarr; CREMRE: <a class='v' href='#EM3'>EM3</a>  "RANGE ERROR"
2C6D:4C 7B 33       184 <a class='f' name='ER10'     >ER10        </a>JMP <a class='x' href='#ERRR10'>ERRR10</a>                                      ; error#?   &rarr; CREFLK: <a class='v' href='#EM10'>EM10</a> "FILE LOCKED"
                    185 ;                                                           ; /sarcasm Really?! Have to abbreviate 'o' in ERROR10 ???
                                                                                    ;
                                                                                    ; <b>Problem</b>:
                                                                                    ;     <a class='x' href='#FD2'>FD2</a> has
                                                                                    ;         $2D34 BPL FD3
                                                                                    ;         $2D36 JMP ERROR10
                                                                                    ;
                                                                                    ;     To remove the 3 byte jump &amp; take advantage of existing
                                                                                    ;     code <a class='x' href='#ER10'>ER10</a> @ $2C6D JMP ERR10,
                                                                                    ;     we need to invert the branch to target ER10
                                                                                    ;
                                                                                    ;         $2D34 BMI ER10
                                                                                    ;
                                                                                    ;     But $2D36 - $2C6D = $C7 which is &gt; $80 bytes away for BMI
                                                                                    ;     Can <a class='x' href='#ER10'>ER10</a> be safely moved closer to FD2?
                                                                                    ;
                                                                                    ; <b>Solution</b>:
                                                                                    ;     The first reference to ER10 is in FRNME @ $2C40
                                                                                    ;
                                                                                    ;         $2C3D LDA DCBFUC
                                                                                    ;         $2C40 BMI ER10
                                                                                    ;
                                                                                    ;     We need to keep ER10 within the 128 byte range of FRNME.
                                                                                    ;
                                                                                    ;     The max branch address for FRNME is $2C42 + $80 = $2CC2
                                                                                    ;     The min branch address for FD2   is $2D36 - $80 = $2CB6
                                                                                    ;
                                                                                    ;     Since the two 128-byte ranges overlap we <i>can</i> move ER10 !
                                                                                    ;     The perfect spot is @ $2CBB (just after EOFIN)
                                                                                    ;
                                                                                    ; This is a good example of where:
                                                                                    ;
                                                                                    ;    <b>maximing locality</b>
                                                                                    ;
                                                                                    ; can open up new opportunities for optimizing.
                    186 * FWRITE - WRITE A FILE
                    187 ;
                    188 <a class='f' name='FWRITE'   >FWRITE      </a>EQU *
2C70:AD F6 35       189             LDA DCBFUC      ; IS FILE LOCKED
2C73:30 F8          190             BMI ER10        ; BR IF LOCKED
2C75:AD BC 35       191             LDA CCBRQM      ; GET REQ MOD
2C78:C9 05          192             CMP #CRMMAX     ; IN RANGE                      ; Off by 1 bug
2C7A:B0 EE          193             BCS ERR3A       ; BR IF NOT IN RANGE            ;
                    194 ;                                                           ;
2C7C:0A             195             ASL A                                           ;[.. Alternative:
2C7D:AA             196             TAX                                             ; .. (See above)
2C7E:BD F2 2A       197             LDA WVT+1,X     ; GET ROUTINE ADR               ; ..
2C81:48             198             PHA                                             ; ..     <span class='code'>LDX #&lt;WVT+1   </span> ; lo byte of func table address
2C82:BD F1 2A       199             LDA WVT,X                                       ; ..     <span class='code'>LDY #&gt;WVT     </span> ; hi byte of func table address
2C85:48             200             PHA                                             ; ..     <span class='code'>BCC CallFunc  </span> &uarr; (always)
2C86:60             201             RTS                                             ; ..]
                    202             PAGE
                    203 ;
                    204 * RSPBYT - READ A SPECIFIC BYTE
                    205 ;
                    206 <a class='f' name='RSPBYT'   >RSPBYT      </a>EQU *
2C87:20 00 33       207             JSR LOCSEC      ; GO GET REQD REL SECTOR
                    208 ;
                    209 * RNXBYT - READ NEXT BYTE
                    210 ;
2C8A:20 A8 2C       211 <a class='f' name='RNXBYT'   >RNXBYT      </a>JSR GETBYT      ; GO GET BYTE
2C8D:8D C3 35       212             STA CCBDAT      ; PUT IN CCB
2C90:4C 7F 33       213             JMP GOODIO      ; DONE
                    214 ;
                    215 * RSPBLK - READ A SPECIFIC BLOCK
                    216 ;
2C93:20 00 33       217 <a class='f' name='RSPBLK'   >RSPBLCK     </a>JSR LOCSEC      ; GO LOCATE REL SECTOR
                    218 ;
                    219 * RNXBLK - READ NEXT BLOCK
                    220 ;
                    221 <a class='f' name='RNXBLK'   >RNXBLK      </a>EQU *
2C96:20 B5 31       222             JSR DTBLN       ; GO DECR LEN (NOT RTN IF=0)
2C99:20 A8 2C       223             JSR GETBYT      ; GO GET BYTE
2C9C:48             224             PHA
2C9D:20 A2 31       225             JSR MIBDA       ; GO MOVE BLOCK ADR AND INCR
2CA0:A0 00          226             LDY #0
2CA2:68             227             PLA
2CA3:91 41          228             STA (ZPGFCB),Y  ; SET DATA BYTE
2CA5:4C 96 2C       229             JMP RNXBLK      ; GO FOR NEXT BYTE
                    230 ;
                    231 * GETBYT - GET A DATA BYTE
                    232 ;
                    233 <a class='f' name='GETBYT'   >GETBYT      </a>EQU *
2CA8:20 B6 30       234             JSR LOCNXB      ; LOCATE NEXT BYTE
2CAB:B0 0B          235             BCS EOFIN       ; BR IF EOF
2CAD:B1 42          236             LDA (ZPGFCB),Y  ; GET DAT BYTE
2CAF:48             <a class='line' name='FOPCLRW.237'>237</a>             PHA             ; SAVE IT                       ; <span class='code'>INCBYT</span> Should be common code for <a class='x' href='#PB0'>PB0</a> as well
2CB0:20 5B 31       238             JSR INCRRB      ; INCR REC BYTE                 ; <b>What</b> is the difference between these two???
2CB3:20 94 31       239             JSR INCSCB      ; INCR SEC BYTE                 ;
2CB6:68             240             PLA             ; GET SAVED BYTE                ; Stop treating the reader like an idiot with redundant comments
2CB7:60             241             RTS             ; RETURN                        ; All this does is just add <b>visual noise</b>
<hr>                    242 ;                                                           ; === Page <a class='page' name='page81'>81</a> ===
2CB8:4C 6F 33       243 <a class='f' name='EOFIN'    >EOFIN       </a>JMP ERROR5      ; GOTO EOF RTN                  ; CREEOF &rarr; <a class='v' href='#EM5'>EM5</a>: "END OF DATA"
                    244             PAGE
                    245 ;
                    246 * WSPBYT - WRITE SPECIFIC BYTE
                    247 ;
                    248 <a class='f' name='WSPBYT'   >WSPBYT      </a>EQU *
2CBB:20 00 33       249             JSR LOCSEC      ; GO LOCATE SECTOR
                    250 ;
                    251 * WNXBYT - WRITE NEXT BYTE
                    252 ;
                    253 <a class='f' name='WNXBYT'   >WNXBYT      </a>EQU *
2CBE:AD C3 35       254             LDA CCBDAT      ; GET THE BYTE
2CC1:20 DA 2C       255             JSR PUTBYT      ; GO WRITE BYTE
2CC4:4C 7F 33       256             JMP GOODIO      ; DONE
                    257 ;
                    258 * WSPBLK - WRITE A SPECIFIC BLOCK
                    259 ;
                    260  <a class='f' name='WSPBLK'   >WSPBLK     </a>EQU *
2CC7:20 00 33       261             JSR LOCSEC      ; GO LOCATE SECTOR
                    262 ;
                    263 * WNXBLK - WRITE NEXT BLOCK
                    264 ;
                    265  <a class='f' name='WNXBLK'   >WNXBLK     </a>EQU *
2CCA:20 A2 31       266             JSR MIBDA       ; GO MOVE ADR TO ZPG AND DEC
2CCD:A0 00          267             LDY #0
2CCF:B1 42          268             LDA (ZPGFCB),Y  ; GET DATA BYTE
2CD1:20 DA 2C       269             JSR PUTBYT      ; GO PUT IT
2CD4:20 B5 31       270             JSR DTBLN       ; GO DEC BLK LEN (NOT RTN IF = 0)
2CD7:4C CA 2C       271             JMP WNXBLK
                    272 ;
                    273 * PUTBYT - PUT OUT ONE BYTE
                    274 ;
                    275 <a class='f' name='PUTBYT'   >PUTBYT      </a>EQU *
2CDA:48             276             PHA             ; SAVE DATA BYTE
2CDB:20 B6 30       277             JSR LOCNXB      ; GO LOCATE NEXT BYTE
                    278 ;
2CDE:68             279 <a class='f' name='PB0'      >PB0         </a>PLA           ; GET SAVED BYTE
2CDF:91 42          280             STA (ZPGFCB),Y  ; PUT THE BYTE
2CE1:A9 40          281             LDA #$<span class='n'>40</span>        ; SET WRITE SECTOR REQD         ; <a class='magic' name='_2CE2'>magic number</a> WRITE_FLAG_SECTOR, See <a class='x' href='#GNWSEC'>GNWSEC</a>
2CE3:0D D3 35       282             ORA DCBWRF
2CE6:8D D5 35       283             STA DCBWRF
                    284 ;
2CE9:20 5B 31       285             JSR <a class='x' href='#INCRRB'>INCRRB</a>      ; INCR REL REC BYTE             ;[.. <a class='mem' name='_2CE9'>wastes</a> 3 bytes
2CEC:4C 94 31       286             JMP INCSCB      ; INCR SECTOR BYTE              ; ..] <span class='code'>JMP INCBYT</span> = (<a class='x' href='#GETBYT'>GETBYT</a>+7) = Line #<a class='line' href='#FOPCLRW.237'>237</a>
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FDELCAT">FDELCAT</a> - Delete, Catalog, Page <a class="page" name="page55">55</a>, <a class='ts' href='#1T1SB'>T1SB</a> @ $EF - <a class='ts' href='#T1SD'>T1SD</a>, $<span class='n'>2CEF</span> .. $<span class='n'>2E8D</span> ($<span class='n'>ACEF</span> .. $<span class='n'>AE8D</span>) ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 * FLOCK - LOCK A FILE
                    004 ;
2CEF:A9 80          005 <a class="f" name="FLOCK"      >FLOCK       </a>LDA #$<span class='n'>80</span>        ; REMEMBER LOCK                 ; <a class='magic' name='_2CF0'>magic number</a> LOCK_MASK = $80
2CF1:8D 9E 33       006             STA <a class="v" href="#TEMP3">TEMP3</a>                                       ; <a class='mem' name='_2CF1'>wastes</a> 3 bytes, BNE line #<a class='line' href='#FDELCAT.012'>12</a>
2CF4:D0 05          007             BNE <a class="x" href="#LCKGO">LCKGO</a>                                       ; even better, change to BIT $abs ($00A9)
                    008 ;
                    009 * FUNLOCK - UNLOCK A FILE
                    010 ;
2CF6:A9 00          011 <a class="f" name="FUNLCK"     >FUNLCK      </a>LDA #<span class='n'>00</span>         ; REMEMBER UNLOCK               ; <a class='magic' name='_2CF7'>magic number</a>
2CF8:8D 9E 33       <a class='line' name='FDELCAT.012'>012</a>             STA <a class="v" href="#TEMP3">TEMP3</a>
                    013 ;
                    014 <a class="f" name="LCKGO"   >LCKGO       </a>EQU *
                    015 ;
2CFB:20 28 2B       016             JSR <a class="x" href="#DOPEN" >DOPEN</a>       ; GO OPEN FILE
2CFE:AE 9C 33       017             LDX <a class="v" href="#TEMP1" >TEMP1</a>                                       ; === <a class='ts' href='#T1SC'>T1SC</a> ===
2D01:BD C8 34       018             LDA <a class="v" href="#VDFILE">VDFILE</a>+<span class='n'>2</span>,X  ; GET FILE USE CODE             ; <a class='magic' name='_2D02'>magic number</a>*
2D04:29 7F          019             AND #$<span class='n'>7F</span>        ; TURN OFF LOCK                 ; <a class='magic' name='_2D05'>magic number</a> ~LOCK_MASK
2D06:0D 9E 33       020             ORA <a class="v" href="#TEMP3" >TEMP3</a>
2D09:9D C8 34       021             STA <a class="v" href="#VDFILE">VDFILE</a>+<span class='n'>2</span>,X
2D0C:20 37 30       022             JSR <a class="x" href="#WRVDIR">WRVDIR</a>
2D0F:4C 7F 33       023 <a class="f" name="GOGOOD"     >GOGOOD      </a>JMP <a class="x" href="#GOODIO">GOODIO</a>
                    024 ;
                    025 * FPOSTN - POSITION A FILE
2D12:20 00 33       026 <a class="f" name="FPOSTN"     >FPOSTN      </a>JSR LOCSEC      ; GO POSITION
2D15:4C 7F 33       027             JMP GOODIO      ; DONE
                    028 ;
                    029 ;
                    030 * FVAR - VARIFY A FILE                                      ; *spelling* VERIFY
                    031 ;
                    032 <a class="f" name="FVAR"       >FVAR        </a>EQU *
2D18:20 28 2B       033             JSR <a class="x" href="#DOPEN" >DOPEN</a>       ; OPEN FILE
2D1B:20 B6 30       034 <a class="f" name="VAR1"       >VAR1        </a>JSR <a class="x" href="#LOCNXB">LOCNXB</a>      ; READ A SECTOR
2D1E:B0 EF          035             BCS <a class="x" href="#GOGOOD">GOGOOD</a>      ; BR IF EOF
2D20:EE E4 35       036             INC <a class="v" href="#DCBCRS">DCBCRS</a>      ; INCREMENT SECTOR
2D23:D0 F6          037             BNE <a class="x" href="#VAR1"  >VAR1</a>                                        ; Can't save &gt; 32KB, See <a class='v' href='#OPTAB3'>OPTAB3</a> 32767
2D25:EE E5 35       038             INC <a class="v" href="#DCBCRS">DCBCRS</a>+<span class='n'>1</span>                                    ; Therfore Current Relative Sector can never overflow to zero
2D28:4C 1B 2D       039             JMP <a class="x" href="#VAR1"  >VAR1</a>        ; READ THIS ONE                 ; <a class='mem' name='_2D28'>wastes</a> 1 bytes <span class='code'>BNE VAR1</span>
                    040             PAGE
                    041 ;
                    042 * FDEL - DELETE A FILE
                    043 ;
                    044 <a class='f' name='FDEL'     >FDEL        </a>EQU *
2D2B:20 28 2B       045             JSR DOPEN       ; GO OPEN FILE
                    046 ;
2D2E:AE 9C 33       047 <a class='f' name='FD2'      >FD2         </a>LDX TEMP1       ; SAVED INDEX
2D31:BD C8 34       048             LDA VDFILE+<span class='n'>2</span>,X  ; IS FILE LOCKED                ; <a class='magic' name='_2C2C'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TYPE</span>
2D34:10 03          049             BPL FD3                                         ; Should be <span class='code'>BMI ER10</span> (once ER10 is moved)
2D36:4C 7B 33       050             JMP ERROR10                                     ; <a class='mem' name='_2D36'>wastes</a> 3 bytes with <span class='code'>JMP</span>, See <a class='x' href='#ER10'>ER10</a> optimization above
                    051 ;
                    052 FD3         EQU *
2D39:AE 9C 33       053             LDX TEMP        ; GET SAVED INDEX
<hr>                                                                                    ; === Page <a class='page' name='page56'>56</a> ===
2D3C:BD C6 34       054             LDA VDFILE,X    ; GET DIR TRACK                 ; <a class='magic' name='_2D3C'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TRACK</span>
2D3F:8D D1 35       055             STA DCBFDT      ; SET AS 1ST FD TRACK           ; LC = last character
2D42:9D E6 34       056             STA VDFILE+<span class='n'>32</span>,X ; SAVE IN LC OF FN              ; <a class='magic' name='_2D42'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NAME + MAX_FILENAME_LEN - 1</span>
2D45:A9 FF          057             LDA #$<span class='n'>FF</span>        ; DELETED FILE MARKER           ; <a class='magic' name='_2D46'>magic number</a> FILE_TYPE_DELETED
2D47:9D C6 34       058             STA VDFILE,X    ; CLEAR ENTRY                   ; <a class='magic' name='_2D47'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TRACK</span>
2D4A:BC C7 34       059             LDY VDFILE+<span class='n'>1</span>,X  ; GET DIR SECTOR                ; <a class='magic' name='_2D4A'>magic number</a> <span class='code'>VDFILE + CAT_FILE_SECTOR</span>
2D4D:8C D2 35       060             STY DCBFDS      ; SET AS 1ST FD SEC
2D50:20 37 30       061             JSR WRVDIR      ; GO WRITE VOLUME DIR
2D53:18             062             CLC
2D54:20 5E 2F       063 FD4         JSR RDFDIR      ; GET 1ST FILE DIR SECTOR
2D57:B0 2A          064             BCS FD7         ; BR IF NO MORE
2D59:20 0C 2F       065             JSR MVFCBD      ; MOVE DIR TO ZPG
2D5C:A0 0C          066             LDY #FDENT      ; POINT Y TO 1ST SEC ENT
2D5E:8C 9C 33       067 FD5         STY TEMP1       ; SAVE Y                        ; School of Commenting on Useless Observations
2D61:B1 42          068             LDA (ZPGFCB),Y  ; GET REACK                     ; *spelling* Track
2D63:30 0B          069             BMI FD6         ; BR IF NONE
2D65:F0 09          070             BEQ FD6         ; BR IF END OF FILE
2D67:48             071             PHA             ; SAVE TRK
2D68:C8             072             INY
2D69:B1 42          073             LDA (ZPGFCB),Y  ; GET SECTOR
2D6B:A8             074             TAY             ; TO Y
2D6C:68             075             PLA             ; GET TRK
2D6D:20 89 2D       076             JSR FDSUB       ; GO FREE SECTOR                ; /sarcasm What? FREESECS wasn't available??? (It is but <a class='x' href='#FRESEC'>FRESEC</a> is used)
2D70:AC 9C 33       077 FD6         LDY TEMP1       ; GET DIR INDEX
2D73:C8             078             INY             ; INCR TO NEXT INDEX
2D74:C8             079             INY
2D75:D0 E7          080             BNE FD5         ; BR NOT DONE THIS DIR
2D77:AD D3 35       081             LDA DCBCDT      ; GET THIS DIR TRK
2D7A:AC D4 35       082             LDY DCBCDS      ; AND SECTOR
2D7D:20 89 2D       083             JSR FDSUB       ; AND GO FREE IT
2D80:38             084             SEC             ; GO
2D81:B0 D1          085             BCS FD4         ; READ NEXT DIR                 ; &uarr; (always)
                    086 FD7         EQU *
2D83:20 FB 2F       087             JSR WRVTOC
2D86:4C 7F 33       088             JMP GOODIO
                    089 ;
                    090 <a class='f' name='FDSUB'    >FDSUB       </a>EQU *
                    091             SEC             ; SET FOR REUSE OF SEC
                    092             JSR <a class='x' href='#FRESEC'>FRESEC</a>      ; GO FREE SECTOR
                    093             LDA #0          ; CLEAR DCB BIT MAP
                    094             LDX #5          ; CLEAR ALL OF TRK BITMAP SO    ; <a class='mem' name='_'>wastes</a> 1 byte
                    095 *                           ;gt;16 SECTORS/TRK WILL WORK
                    096 <a class='f' name='FDS1'     >FDS1        </a>STA DCBALS,X                                    ;
                    097             DEX                                             ; <span class='code'>INX         </span>
                    098             BPL FDS1                                        ; <span class='code'>STA DCBALS,X</span>
                    099             RTS
                    100             PAGE
                    101 ;
                    102 * RDIR - PRINT DIRECTORY                                    ; "CATALOG"
                    103 ;
                    104 <a class='f' name='RDIR'     >RDIR        </a>EQU *
                    105             JSR DCBSUP
                    106             LDA #$FF
                    107             STA DCBVOL
                    108             JSR RDVTOC
                    109             LDA #22         ; SET 21 LINES                  ;[.. <a class='mem' name='_'>wastes</a> 1 bytes, <span class='code'>JSR NewPage</span> 
                    110             STA TEMP2                                       ; ..]
                    111             JSR PRCR        ; GO PRINT                      ; Should be <span class='code'>JSR PRCR2</span>
                    112             JSR PRCR        ; PRINT ANOTHER CHAR            ; <a class='mem' name='_'>wastes</a> 3 bytes
                    <a class='line' name='FDELCAT.113'>113</a>             LDX #VML        ; VOLUME MSG LENGTH
                    114 RD0         LDA VOLMES,X    ; GET MSG CHAR                  ; \
                    115             JSR PRINT       ; PRINT IT                      ;  &gt; More stupid commenting stating the obvious
                    116             DEX             ; DECREMENT COUNT               ; /
<hr>                    117             BPL RD0         ; BR IF MORE                    ; === Page <a class='page' name='page57'>57</a> ===
                    118 ;
                    119             STX CNUM+1                                      ; X=0 &rarr; CNUM+1, clear high byte for printing
                    120             LDA IBSMOD      ; MOVE VOL NO FOR
                    121             STA CNUM        ; CONVERSION
                    122             JSR PRNUM       ; GO PRINT VOL NO
                    123 ;
                    124             JSR PRCR        ; PRINT CR                      ; Should be <span class='code'>JSR PRCR2</span>
                    125             JSR PRCR        ; AND AGAIN                     ; <a class='mem' name='_'>wastes</a> 3 bytes
                    126 ;
                    127             CLC             ; FIRST RECORD
                    128 ;
                    129 RD1         JSR RDVDIR      ; GO READ REC
                    130             BCS RD5
                    131             LDX #<span class='n'>0</span>          ; SET INDEX=0
                    132 RD2         STX TEMP1       ; SAVE INDEX
                    133             LDA VDFILE,X    ; GET TRACK                     ; <a class='magic' name='_'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TRACK</span>
                    134             BEQ RD5         ; BR IF END OF DIR
                    135             BMI RD4         ; BR IF DELETED
                    136 ;
                    137             LDY #$A0        ; BLANK                         ; KEY_SPACE
                    138             LDA VDFILE+2,X  ; GET TYPE                      ; <a class='magic' name='_'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TYPE</span>
                    139             BPL RD2A        ; BR IF NOT LOCKED
                    140             LDY #'*'+$80    ; AST                           ; Asterisk, KEY_ASTERISK
                    141 RD2A        TYA             ; ACU = AST OR BLANK
                    142             JSR PRINT       ; PRINT ACU
                    143 ;
                    144             LDA VDFILE+2,X  ; GET TYPE                      ; <a class='magic' name='_'>magic number</a> <span class='code'>VDFILE + CAT_FILE_TYPE</span>
                    145             AND #$7F        ; MASK OUT MISC                 ; <a class='magic' name='_'>magic number</a> FILE_LOCKED_MASK
                    146             LDY #7          ; SET INDEX = 7                 ; Using a bit mask instead of a enumeration is dumb
                    147             ASL A           ;GET RID OF HI BIT              ; Instead of the simple
                    148 RD2B        ASL A           ; SHIFT OUT MSB                 ;    LDX FILE_TYPE
                    149             BCS RD2C        ; BR IF TYPE BIT OUT            ;    LDA CHAR_FILE_TYPE,X
                    150             DEY             ; DEC INDEX                     ; We waste 9 bytes
                    151             BNE RD2B        ; BR IF NOT ACC BITS
                    152 RD2C        EQU *
                    153             LDA FTTAB,Y     ; GET TYPE CODE
                    154             JSR PRINT       ; PRINT IT
                    155             LDA #$A0        ; BLANK
                    156             JSR PRINT       ; PRINT
                    157 ;                                                           ; NOT File length, this is Number of Sectors Allocated
                    158             LDA VDFILE+33,X ; MOVE FILE LENGTH              ; <a class='magic' name='_'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC+0</span>
                    159             STA CNUM
                    160             LDA VDFILE+34,X ; MOVE FILE LENGTH              ; <a class='magic' name='_'>magic number</a> <span class='code'>VDFILE + CAT_FILE_NUM_SEC+1</span>
                    161             STA CNUM+1
                    162             JSR PRNUM       ; GO PRINT NUMBER
                    163             LDA #$A0        ; BLANK
                    164             JSR PRINT       ; PRINT
                    165 ;
                    166             INX
                    167             INX
                    168             INX
                    169             LDY #29                                         ; <a class='magic' name='_'>magic number</a> <span class='code'>MAX_FILENAME-1</span>
                    170 RD3         LDA VDFILE,X    ; GET CHAR
                    171             JSR PRINT       ; PRINT CHAR
                    172             INX
                    173             DEY
                    174             BPL RD3
                    175 RD3A        EQU *
                    176             JSR PRCR        ; GO PRINT CR
                    177 RD4         JSR VDINC       ; INCR INDEX
                    178             BCC RD2         ; BR IF MORE IN DIR
                    179             BCS RD1         ; GO READ NEXT DIR
                    180 ;
                    181 RD5         JMP GOODIO      ; DONE
<hr>                    182 ;                                                           ; === Page <a class='page' name='page58'>58</a> ===
                    183 <a class='f' name='PRCR'     >PRCR        </a>EQU *
                    184             LDA #$8D        ; CR
                    185             JSR PRINT       ; PRINTED
                    186             DEC TEMP2       ; DEC LINE COUNT
                    187             BNE PRCR1       ; BR IF NOT ZERO
                    188             JSR GETKEY      ; WAIT FOR INPUT
                    189             LDA #21         ; RESET LINE COUNTER            ; <span class='code'>NewPage</span>
                    190             STA TEMP2
                    191 PRCR1       RTS             ; DONE
                    192             PAGE
                    193 <a class='f' name='PRNUM'    >PRNUM       </a>EQU *                                           ; Print 16-bit CNUM as 3 decimal digits with leading zeroes
                    194             LDY #2          ; 3 DIGITS
                    195 PRN1        LDA #0          ; INIT DIGIT TO ZERO
                    196             PHA             ; SAVE IT
                    197 ;
                    198 PRN2        LDA CNUM        ; GET NUMBER
                    199             CMP CVTAB,Y     ; IF NUM &lt; CVTAB ENTRY          ; Crap comment: <b>What</b> is CVTAB??? Is digit &lt; power of 10
                    200             BCC PRN3        ; THEN DONE THIS DIGIT
                    201 ;
                    202             SBC CVTAB,Y     ; SUBTRACT TABLE ENTRY
                    203             STA CNUM
                    204             LDA CNUM+1
                    205             SBC #0
                    206             STA CNUM+1
                    207             PLA             ; INCREMENT DIGIT
                    208             ADC #0
                    209             PHA
                    210             JMP PRN2        ; TRY AGAIN                     ; <a class='mem'>wastes</a> 1 byte, A is &gt; 0, A &lt; $80, <span class='code'>BNE PRN2</span>
                    211 ;
                    212 PRN3        EQU *
                    213             PLA             ; GET DIGIT
                    214             ORA #$B0        ; ADD ASCII 0                   ; <a class='magic'>magic number</a> <span class='code'>#'0'+$80</span> or <span class='code'>KEY_0</span>
                    215             JSR PRINT       ; PRINT IT                      ; Gee I wonder what PRINT does ...
                    216             DEY             ; DECREMENT DIGIT COUNT
                    217             BPL PRN1        ; BR IF MORE DIGIT
                    218 ;
                    219             RTS             ; DONE
                    220             PAGE
                    221 ;
                    222 * CLCFCB - GET FCB VIA INDEX AND MOVE IT                    ; <i>You keep using this word <b>move</b>, it doesn't mean what you think it means</i>
                    223 ;
                    224 <a class='f' name='CLCFCB'   >CLCFCB      </a>EQU *                                           ; /sarcasm Oh I see, CLC_FB is clearer then COPY_FCB
                    225 ;
2E6A:20 08 2F       226             JSR MVFCBP      ; MOVE FCB PTR TO ZP
2E6D:A0 00          227             LDY #0
2E6F:8C C5 35       228             STY CCBSTA
2E72:B1 42          229 CF3         LDA (ZPGFCB),Y  ; MOVE FCB TO
2E74:99 D1 35       230             STA FCB,Y       ; FCB WORK AREA                 ; $B5BB
2E77:C8             231             INY
2E78:C0 2D          232             CPY #FCBLEN
2E7A:D0 F6          233             BNE CF3
                    234 ;
2E7C:18             235             CLC
2E7D:60             236             RTS
                    237 ;
                    238 * RTNFCB - MOVE FCB FROM WORK AREA TO FCB
                    239 ;
                    240 <a class='f' name='RTNFCB'   >RTNFCB      </a>EQU *
2E7E:20 08 2F       241             JSR MVFCBP      ; MOVE FCB ADR TO ZPG
                    242 ;
<hr>2E81:A0 00          243             LDY #<span class='n'>0</span>                                          ; === Page <a class='page' name='page59'>59</a> ===
2E83:B9 D1 35       244 RF1         LDA FCB,Y
2E86:91 42          245             STA (ZPGFCB),Y
2E88:C8             246             INY
2E89:C0 2D          247             CPY #FCBLEN
2E8B:D0 F6          248             BNE RF1
2E8D:60             249             RTS
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FMTRWIO">FMTRWIO</a> - Execute Format Request, Page <a class="page" name="page73">73</a>, <a class='ts' href='#T1SD'>T1SD</a> - <a class='ts'>T1SE</a>, $<span class='n'>AE8E</span> .. $<span class='n'>AFF6</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 * FFMT - Execute Format Request                             ; "INIT"
                    004 ;
                    005 <a class="f" name="FFMT"       id="FFMT"       >FFMT        </a>EQU *
2E8E:20 DC 2B       006             JSR DCBSUP      ; SET UP DCB
2E91:A9 04          007             LDA #IBFMT
2E93:20 58 30       008             JSR DCBIO2
2E96:AD F9 35       009             LDA DCBVOL
                    010             EOR #$FF                                        ; <span class='todo'>TODO</span> Is this the reason why not possible to format with Volume=0
                    011             STA VVOLNO
                    012             LDA #17                                         ; <a class='mem' name='_'>magic number</a> <span class='code'>FILESYSTEM_VTOC_CAT_TRACK</span>;
                    013             STA VALCA1      ; ALOCATE BYTE 1                ; *spelling* Allocate; Crappy name, should be: <span class='code'>ALLOC_TRK</span>
                    014             LDA #1                                          ; +$01 inwards to T22
                    015             STA VALCA2      ; ADD BYTE 2                    ; Crappy name, should be: <span class='code'>ALLOC_DIR</span>
                    016 ;
                    017             LDX #VSECAL-VTOC                                ; Skip VTOC header
                    018             LDA #0
2EAC:9D BB 33       019 <a class='f' name='NT1'      >NT1         </a>STA VTOC,X      ; CLEAR SECTOR AREA             ; We only care about 4 tracks set to used: T0,T1,T2,T17
                    020             INX
                    021             BNE NT1
                    022 ;
                    023             LDX #3*4        ; START AT TRACK 3              ; Idiotic 4 bytes/track , <a class='magic' name='_'>magic number</a> <span class='code'>FIRST_EMPTY_TRACK</span>
                    024 <a class='f' name='NT2'      >NT2         </a>CPX #35*4       ; END AT TRACK 35               ; instead of 2 bytes/trk, <a class='magic' name='_'>magic number</a> <span class='code'>LAST_EMPTY_TRACK</span>
                    025             BEQ NT4
                    026             LDY #3          ; 4 BYTES OF INFO
                    027 <a class='f' name='NT3'      >NT3         </a>LDA <a class='v' href='#ALC10S'>ALC10S</a>,Y    ; 10 SECTORS ALLOCATE           ; 16 ($10) sectors used bitmask: 0=free, 1=used
2EBD:9D F3 33       028             STA VSECAL,X
                    029             INX
                    030             DEY
                    031             BPL NT3
                    032             CPX #17*4       ; AT TRACK 17                   ; <a class='mem' name='_'>magic number</a> <span class='code'>FILESYSTEM_VTOC_CAT_TRACK * ALLOC_BYTE_PER_TRACK</span>;
                    033             BNE NT2
                    034             LDX #18*4       ; SKIP TO 18
                    035             BNE NT2                                         ; &uarr; (always)
                    036 ;
2ECC:20 FB 2F       037 NT4         JSR WRVTOC      ; WRITE NEW VTOC
                    038 ;
                    039             LDX #0
                    040             TXA
                    041 NT5         STA VOLDIR,X    ; CLEAR VOLDIR
                    042             INX
                    043             BNE NT5
                    044 ;
2ED8:20 45 30       045             JSR MVVDBA      ; MOVE BUF PTRS
                    046 ;
                    047             LDA #17         ; TRACK 17                      ; <a class='magic' name='_'>magic number</a> <span class='code'>FILESYSTEM_VTOC_CAT_TRACK = $11</span>
2ED8:AC F0 33       048             LDY VNOSEC                                      ; S16
                    049             DEY                                             ; S15 CATALOG [0]
                    050             DEY                                             ; S14 CATALOG [1]
                    051             STA IBTRK       ; INTO IOB
                    052 NT6         STA VDLTRK      ; INTO LINK
                    053 NT7         STY VDLSEC      ;
<hr>2EEB:C8             054             INY                                             ; === Page <a class='page' name='page74'>74</a> ===
2EEC:8C ED 37       055             STY IBSECT
2EEF:A9 02          056             LDA #IBCWTS
2EF1:20 58 30       057             JSR DCBIO2
                    058             LDY VDLSEC
                    059             DEY             ; DECREMENT SECTOR
                    060             BMI NT8         ; BR LAST WRITTEN
                    061             BNE NT7         ; BR NOT LAST
                    062             TYA             ; lAST, SET LINK TRK=0
                    063             BEQ NT6
                    064 ;
                    065 NT8         EQU *
2EFF:20 C2 37       066             JSR DLDSUP      ; GO SET UP FOR DOSLDR          ; === <a class='ts' name='T1SE'>T1SE</a> ===
2F02:20 4A 37       067             JSR WBOOT       ; GO WRITE THE BOOT
2F05:4C 7F 33       068             JMP GOODIO      ; DONE
                    069             PAGE
                    070 ;
                    071 * MVFCBX - MOVE FCB ADRS TO ZPGFCB
                    072 ;
                    073 <a class='f' name='MVFCBP'   >MVFCBP      </a>LDX #<span class='n'>0</span>          ; MOVE FCB ADR                  ; <a class='magic' name='_'>magic number</a> <span class='todo'>TODO</span>
                    074             BEQ MVF1
                    075 <a class='f' name='MVFCBD'   >MVFCBD      </a>LDX #<span class='n'>2</span>          ; MOVE FCB DIR BUFF             ; <a class='magic' name='_'>magic number</a> <span class='todo'>TODO</span>
                    076             BNE MVF1                                        ; <a class='mem' name='_'>wastes</a> 1 byte, $2C bit $abs
                    077 <a class='f' name='MVFCBS'   >MVFCBS      </a>LDX #<span class='n'>4</span>          ; MOVE FCB SECTOR BUFF          ; <a class='magic' name='_'>magic number</a> <span class='todo'>TODO</span>
                    078 ;
                    079 <a class='f' name='MVF1'     >MVF1        </a>EQU *
                    080             LDA CFCBAD,X    ; DO THE MOVE
                    081             STA ZPGFCB
                    082             LDA CFCBAD+1,X
                    083             STA ZPGFCB+1
                    084             RTS
                    085 ;
                    086             PAGE
                    087 ;
                    088 * WRSECT - WRITE CURRENT SECTOR IF REQD
                    089 ;
                    090 <a class='f' name='WRSECT'   >WRSECT      </a>EQU *
2F1D:2C D5 35       091             BIT DCBWRF      ; GET WRITE REQD FLAG
                    092             BVS WRSGO       ; BR IF WRITE SECTOR REQD       ; <a class='mem' name='_'>wastes</a> 1 byte with next instruction RTS, should be: <span class='code'>BVC WRFDIR-1</span>
                    093             RTS             ; RTS                           ; o7 Captain Obvious
                    094 ;
                    095 <a class='f' name='WRGO'     >WRGO        </a>EQU *
2F23:20 E4 2F       096             JSR MVSBA       ; GO MOVE SECT BUFF ADR         ; MoveSectorBufferAddress
                    097 ;
                    098             LDA #IBCWTS     ; GET COMMAND
                    099             JSR DCBIO       ; GO FILL IN IOB AND DO IO
                    100 ;
                    101             LDA #$<span class='n'>BF</span>        ; SET WRITE SECTOR REQD BIT OFF ; <a class='magic' name='_'>magic number</a> $BF = 1011_1111 <span class='code'>FLAG_W_CUR_SECTOR EQU $40; LDA ~FLAG_W_CUR_SECTOR</span>
                    102             AND DCBWRF
                    103             STA DCBWRF
                    104             RTS             ; DONE
                    105             PAGE
                    106 ;
                    107 * WRFDIR - WRITE FILE DIRECTRY IF REQD                      ; *spelling* Directory
                    108 ;
                    109 <a class='f' name='WRFDIR'   >WRFDIR      </a>EQU *
2F34:AD D5 35       110             LDA DCBWRF      ; GET WRITE REQD FLAG
2F37:30 01          111             BMI WRFDGO      ; BR IF NOT DIR REQD            ; <a class='mem' name='_'>wastes</a> 1 byte with next instruction RTS, should be: <span class='code'>BPL WRFDIR-1</span>
2F39:60             112             RTS
                    113 ;
                    114 <a class='f' name='WRFDGO'   >WRFDGO      </a>EQU *
2F3A:20 4B 2F       115             JSR MVFDBA                                      ; MoveFileDirectoryBufferAddress
                    116 ;
<hr>                    117             LDA #IBCWTS     ; GET WRITE CMD                 ; === Page <a class='page' name='page75'>75</a> ===
                    118             JSR DCBIO       ; GO FILL IN IOB AND DO I/O
                    119 ;
                    120             LDA #$<span class='n'>7F</span>        ; TURN WRITE DIR REQD BIT OFF   ; <a class='magic' name='_'>magic number</a> $7F = 0111_1111 <span class='code'>FLAG_W_FIL_SECTOR EQU $80; LDA ~FLAG_W_FIL_SECTOR</span>
                    121             AND DCBWRF
                    122             STA DCBWRF
                    123             RTS
                    124 ;
                    125 * MVFDBA - MOVE FILE DIRECTORY BUFF ASDR TO IOD
                    126 ;
                    127 <a class='f' name='MVFDBA'   >MVFDBA      </a>EQU *
                    128             LDA CFCBDR      ; MOVE ADR
                    129             STA IBBUFP
                    130             LDA CFCBDR+1
                    131             STA IBBUFP+1
2F57:AE D3 35       132             LDX DCBCDT      ; GET TRACK                     
2F5A:AC D4 35       133             LDY DCBCDS      ; GET SECTOR
2F5D:60             134             RTS
                    135             PAGE
                    136 ;
                    137 * RDFDIR - READ FILE DIRECTORY
                    138 ;
                    139 <a class='f' name='RDFDIR'   >RDFDIR      </a>EQU *
2F5E:08             140             PHP             ; SAVE STATUS
                    141             JSR WRFDIR      ; GO WRITE CURRENT DIR IF REQD
                    142             JSR MVFDBA      ; GO MOVE DBUFF ADR TO IOB
                    143             JSR MVFCBD      ; MOVE DBUFF ADR TO ZPG
2F68:28             144             PLP             ; GET SAVED STATUS
2F69:B0 09          145             BCS RFDNXT      ; BR IF RD NEXT
                    146 ;
2F6B:AE D1 35       147             LDX DCBFDT      ; GET TRACK                     ;DCBFDT != DCBCDT Line #132
2F6E:AE D2 35       148             LDY DCBFDS      ; GET SECTOR                    ;DCBFDS != DCBCDS Line #133
2F71:4C B5 2F       149             JMP RFDIO1      ; GO READ
                    150 ;
                    151 <a class='f' name='RFDNXT'   >RFDNXT      </a>EQU *
2F74:A0 01          152             LDY #FDLTRK     ; GET LINK TRACK
2F76:B1 42          153             LDA (ZPGFCB),Y
2F78:F0 08          154             BEQ RFDNL       ; NR NO LINK                    ; BUG: Can't have file on T0 <span class='code'>BPL RFDNL</span>
2F7A:AA             155             TAX             ; PUT TRACK INTO X              ; o7 Captain Obvious
2F7B:C8             156             INY
2F7C:B1 42          157             LDA (ZPGFCB),Y  ; GET LINK SECTOR
2F7E:A8             158             TAY             ; PUT SECTOR INTO Y
2F7F:4C B5 2F       159             JMP RFDIO1      ; GO DO I/O
                    160 ;
                    161 <a class='f' name='RFDNL'    >RFDNL       </a>EQU *                                           ; Read File Dir Next Link
2F82:AD BB 35       162             LDA CCBREQ      ; THIS A WRITE
2F85:C9 04          163             CMP #CRQWR
2F87:F0 02          164             BEQ RFDNL1      ; BR IF WRITE                   ; &darr; <span class='todo'>TODO</span> Should be BNE ...
                    165             SEC             ; SET EOF
                    166             RTS             ; RETURN                        ; o7 Captain Obvious
                    167 ;
                    168 <a class='f' name='RFDNL1'   >RFDNL1      </a>EQU *
                    169             JSR GETSEC      ; GET A SECTOR
                    170             LDY #FDLSEC                                     ;
                    171             STA (ZPGFCB),Y  ; PUT IN LINK
                    172             PHA             ; SAVE SECTOR
                    173             DEY
                    174             LDA DCBATK      ; GET TRACK
                    175             STA (ZPGFCB),Y  ; PUT IN LINK
                    176             PHA             ; SAVE TRACK
                    177             JSR WRFDGO      ; Go WRITE OLD DIR DEC
                    178 ;
                    179             JSR CLRSEC      ; CLEAN OUT DIR
<hr>                    180             LDY #FDFRS      ; SET NEW DIR SEC 1ST REL       ; === Page <a class='page' name='page76'>76</a> ===
                    181             LDA DCBDNF      ; FILE SECTOR
                    182             STA (ZPGFCB),Y
                    183             INY
                    184             LDA DCBDNF+1
                    185             STA (ZPGFCB),Y
                    186 ;
                    187             PLA             ; GET SAVED TRACK
                    188             TAX             ; INFO X
                    189             PLA             ; GET SAVED TRACK
                    190             TAY             ; INFO Y
                    191             LDA #IBCWTS     ; SET WRITE CMD
                    192             BNE RFDIO2      ; GO DO I/O
                    193 ;
                    194 <a class='f' name='RFDIO1'   >RFDIO1      </a>LDA #IBCRTS     ; SET READ CMD
                    195 <a class='f' name='RFDIO2'   >RFDIO2      </a>STX DCBCDT      ; SET CURR TRACK
                    196             STY DCBCDS      ; SET CUR SECTOR
                    197             JSR DCBIO       ; GO I/O
                    198 ;
                    199 <a class='f' name='RDFDC'    >RDFDC       </a>LDY #FDFRS      ; GET POINTER TO FIRST REL SECTOR
                    200             LDA (ZPGFCB),Y  ; GET FRS                       ; <b>F</b>irst <b>R</b>elative <b>S</b>ector
                    201             STA DCBDFS      ; SET INTO DCB
2FC7:18             202             CLC
2FC8:6D DA 35       203             ADC DCBDMS      ; ADD MAX SECTORS
2FCB:8D De 35       204             STA DCBDNF      ; PUT INTO DCB
                    205 ;
                    206             INY             ; DO SAME FOR HI BYTE
                    207             LDA (ZPGFCB),Y
                    208             STA DCBDFS+1
                    209             ADC DCBDMS+1
                    210             STA DCBDNF+1
                    211 ;
2FDA:18             212             CLC
2FDB:60             213             RTS             ; DONE
                    214             PAGE
                    215 ;
                    216 ;RDSECT - READ A SECTOR
                    217 ;
                    218 <a class='f' name='RDSECT'   >RDSECT      </a>EQU *                                           ; X = Track, Y = Sector
2FDC:20 E4 2F       219             JSR MVSBA       ; GO MOVE SECTOR BUFFER ADR
                    220 ;
2FDF:A9 01          221             LDA #IBCRTS
2FE1:3C 52 30       222             JMP DCBIO       ; GO DO I/O                     ; <a class='mem' name='_2FE1'>wastes</a> 1 byte, <span class='code'>BNE DCBIO</span> ($3052 - $2FE3 = $6F &lt; $80)
                    223 ;
                    224 ;MVSBA - MOVE SECTOR BUFFER ADR FOR I/O
                    225 ;
                    226 <a class="f" name="MVSBA"    >MVSBA       </a>EQU *
2FE4:AC CB 35       227             LDY CFCBSB      ; GET SECTOR BUFF ADR
2FE7:AD CC 35       228             LDA CFCBSB+1
2FEA:8C F0 37       229 <a class="f" name="MSB1"     >MSB1        </a>STY IBBUFP      ; SET IOB SECTOR
2FED:8D F1 37       230             STA IBBUFP+1    ; BUFF PTR
2FF0:AE D6 35       231             LDX DCBTRK      ; GET TRACK
2FF3:AC D7 35       232             LDY DCBSEC      ; GET SECTOR
2FF6:60             233             RTS             ; RTN
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FLOCNXB">FLOCNXB</a> - Locate Next Byte, Page <a class="page" name="page63">63</a>, <a class='ts' href='#T1SE'>T1SE</a> - <a class='ts' href='#T2S0'>T2S0</a>, $<span class='n'>AFF7</span> .. $<span class='n'>B1C8</span> ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ;RDVTOC - READ VTOC
                    004 ;WRVTOC - WRITE VTOC
                    005 ;
                    006 <a class="f" name="RDVTOC"   >RDVTOC      </a>EQU *
2FF7:A9 01          007             LDA #<a class="v" href="#IBCRTS">IBCRTS</a>     ; READ
2FF9:D0 02          008             BNE <a class="x" href="#VTIO">VTIO</a>                                        ; <a class='mem' name='_2FF9'>wastes</a> 1 byte, FIX: <span class='code'>HEX 2C</span> bit $abs
                    009 <a class="f" name="WRVTOC"   >WRVTOC      </a>EQU *
2FFB:A9 02          010             LDA #<a class="v" href="#IBCWTS">IBCWTS</a>     ; WRITE
                    011 ;
2FFD:AC C3 2A       012 <a class="f" name="VTIO"     >VTIO        </a>LDY AVTOC       ; MOVE BUFF ADR
3000:8C F0 37       013             STY IBBUFP                                      ; === <a class='ts' href='#T1SF'>T1SF</a> === $<span class='n'>B000</span>
3003:AC C4 2A       014             LDY AVTOC+1
3006:8C F1 37       015             STY IBBUFP+1
                    016 ;
3009:AE FA 35       017             LDX DCBVTN      ; GET TRACK                     ; $B5FA = VTN = VTOC Track Number = $11
300C:A0 00          018             LDY #<span class='n'>0</span>                                          ; VTOC Sector Number = $0 <a class='magic' name='_300D'>magic number</a> <span class='code'>FILESYSTEM_VTOC_SECTOR EQU 0</span>
300E:4C 52 30       019             JMP <a class="x" href="#DCBIO">DCBIO</a>       ; GO DO I/O                     ; <a class='mem' name='_300E'>wastes</a> 1 byte, FIX: <span class='code'>BPL DCBIO</span> &darr; (always)
                    020             PAGE
                    021 ;
                    022 ;RDVDIR - READ VOLUME DIRECTOR
                    023 ;
                    024 <a class="f" name="RDVDIR"   >RDVDIR      </a>EQU *
3011:08             025             PHP             ; SAVE STATUS
3012:20 45 30       026             JSR MVVDBA
                    027 ;
3015:28             028             PLP             ; GET STATUS
                    029             BCS RVDA        ; BR IF R0 NEXT
                    030 ;
                    031 RVDC        LDY VDIRSC      ; READ 1ST SECTOR
                    032             LDX VDIRTK      ; GET FIRST TRK
                    033             BNE RVDGO       ; GO READ                       ; BUG: Catalog can't be on T0, FIX: <span class='code'>BPL RVDGO</span>
                    034 ;
                    035 RVDA        EQU *
                    036             LDX VDLTRK      ; GET LINK TRACK
                    037             BNE RDVC        ; BR IF A LINK                  ; BUG: Catalog can't be on T0, FIX: <span class='code'>BPL RDVC</span>
3025:38             038             SEC             ; SET END OF DIR
3026:60             039             RTS
                    040 ;
                    041 <a class='f' name='RDVC'     >RDVC        </a>LDY VDLSEC      ; GET SECTOR                    ; Volume Directory Link Sector
                    042 RDVDGO      EQU *
                    043             STX CVDTRK      ; SET CUR TRACK
                    044             STY CVDSEC      ; SET CUR SECTOR
                    045             LDA #IBCRTS     ; GET CMD                       ; <i>No shit Sherlock</i> Q. <b>Which</b> command? A. ReadTrackSector
                    046             JSR DCBIO       ; GO DO I/O
3035:18             047             CLC
3036:60             048             RTS
                    049             PAGE
                    050 ;
                    051 ;WRVDIR - WRITE VOLUME DIRECTORY SECTOR
                    052 ;
                    053 <a class='f' name='WRVDIR'   >WRVDIR      </a>EQU *
<hr>                    054             JSR MVVDBA                                      ; === <a class='page' name='page64'>64</a> ===
                    055 ;
                    056             LDX CVDTRK      ; CURRENT TRACK
                    057             LDY CVDSEC      ; CURRENT SECTOR
3040:A9 02          058             LDA #IBCWTS     ; WRITE COMMAND
3042:4C 52 30       059             JMP DCBIO       ; GO DO I/O                     ; <a class='mem' name='_3042'>wastes</a> 1 byte, <span class='code'>BNE DCBIO</span> &darr; (always)
                    060 ;
                    061 ; MVVDBA - MOVE VOL DIR BUF ADR TO IOB
                    062 ;
                    063 <a class='f' name='MVVDBA'   >MVVDBA      </a>EQU *
                    064             LDA AVOLDR
                    065             STA IBBUFP
                    066             LDA AVOLDR+1
                    067             STA IBBUFP+1
3051:60             068             RTS
                    069             PAGE
                    070 ;
                    071 ;DCBIO - DO I/O FOR A DCB                                   ; Prologe should be:
                    072 ;                                                           ;     <span class='code'>LDA #IBCWTS</span>
                    073 <a class='f' name='DCBIO'    >DCBIO       </a>EQU *
3052:8E EC 37       074             STX IBTRK       ; TRACK                         ; As this is called from Page 74 and 75
3055:8C ED 37       075             STY IBSECT      ; SECTOR
                    076 <a class='f' name='DCBIO2'   >DCBIO2      </a>EQU *
3058:8D F4 37       077             STA IBCMD       ; COMMAND
305B:C9 02          078             CMP #IBCWTS
305D:D0 06          079             BNE DCBIO1                                      ; Read
305F:0D D5 35       080             ORA DCBWRF
3062:8D D5 35       081             STA DCBWRF
                    082 <a class='f' name='DBIO1'    >DBIO1       </a>EQU *
3065:AD F9 35       083             LDA DCBVOL      ; VOL                           ;[..<a class='mem' name='_3065'>wastes</a> 2 bytes
3068:49 FF          084             EOR #$FF        ; UNINVERT VOL BITS             ; ..  0. Why was it inverted in the first place???
306A:8D EB 37       085             STA IBVOL                                       ; ..  1. More crappy names; Since DCB and IB are used all the time,
306D:AD F7 35       086             LDA DCBSLT      ; SLOT                          ; ..     a single letter prefix with an underscore '_' would
3070:8D E9 37       087             STA IBSLOT                                      ; ..         a) improve readability significantly, and
3073:AD F8 35       088             LDA DCBDRV      ; DRIVE                         ; ..         b) require less typing to boot
3076:8D EA 37       089             STA IBDRVN                                      ; ..     Compare and constrast the two:
3079:AD E2 35       090             LDA DCBSDL      ; LENGTH                        ; ..         D_SLOT         DCBSLT
307C:8D F2 37       091             STA IBDLEN                                      ; ..         I_SLOT         IBSLOT
307F:AD E3 37       092             LDA DCBSDL+1                                    ; ..  2. Note: Length is 16-bit
3082:8D F3 37       093             STA IBDLEN+1                                    ; ..] 3. <b>Over-engineered memcpy()</b> to marshall DCB to/from IOB
                                                                                    ;        Due to the <b>contiguous</b> <i>layout</i> (/saracasm Who knew!)
                                                                                    ;
                                                                                    ;            [26] DCBSLT &lt;-&gt; [1] IBSLOT
                                                                                    ;            [27] DCBDRV &lt;-&gt; [2] IBDRVN
                                                                                    ;            [28] DCBVOL &lt;-&gt; [3] IBVOL
                                                                                    ;
                                                                                    ;        This entire mem copy can be simplified: (18 vs 20 org. bytes)
                                                                                    ;            <span class='code'>        LDX #0           </span>
                                                                                    ;            <span class='code'>DCB2IOB LDA DCBSLT,X     </span>
                                                                                    ;            <span class='code'>        STA IBSLOT,X     </span>
                                                                                    ;            <span class='code'>        INX              </span>
                                                                                    ;            <span class='code'>        CPX #IBVOL-IBSLOT</span> ; copy 3 fields (3 bytes)
                                                                                    ;            <span class='code'>        BNE DCB2IOB      </span>
                                                                                    ;            <span class='code'>        EOR #$FF         </span> ; Invert Volume
                                                                                    ;            <span class='code'>        STA IBSLOT,X     </span>
                                                                                    ;
                                                                                    ;        If we didn't have the bad design of DCBSDL
                                                                                    ;        being not contiguous with the above 3 fields,
                                                                                    ;
                                                                                    ;            [11] DCBSDL != [A] IBDLEN
                                                                                    ;
                                                                                    ;        Which should be:
                                                                                    ;
                                                                                    ;            [24] DCBSDL &lt;-&gt; [0] IBDLEN
                                                                                    ;
                                                                                    ;        Then we could instead have:
                                                                                    ;
                                                                                    ;            <span class='code'>        LDX #0           </span>
                                                                                    ;            <span class='code'>DCB2IOB LDA DCBSDL,X     </span>
                                                                                    ;            <span class='code'>        STA IBDLEN,X     </span>
                                                                                    ;            <span class='code'>        INX              </span>
                                                                                    ;            <span class='code'>        CPX #IBVOL-IBDLEN</span> ; copy 4 fields (5 bytes)
                                                                                    ;            <span class='code'>        EOR #$FF         </span> ; Invert Volume
                                                                                    ;            <span class='code'>        STA IBSLOT,X     </span>
                                                                                    ;
                                                                                    ;        Also, if we didn't have to deal with that stupid VOLUME EOR #$FF
                                                                                    ;        It could be simplified even more: (11 bytes vs 32bytes!)
                                                                                    ;
                                                                                    ;            <span class='code'>        LDX #IBVOL-IBDLEN</span> ; copy 4 fields (5 bytes)
                                                                                    ;            <span class='code'>DCB2IOB LDA DCBSLT,X     </span>
                                                                                    ;            <span class='code'>        STA IBSLOT,X     </span>
                                                                                    ;            <span class='code'>        DEX              </span>
                                                                                    ;            <span class='code'>        BPL DCB2IOB      </span>
                                                                                    ;
3085:A9 01          094             LDA #1          ; IOB TYPE                      ;[..  <a class='mem' name='_3085'>wastes</a> 5 bytes, <a class='magic' name='_'>magic number</a>
3087:8D E8 37       <a class='line' name='FLOCNXB.095'>095</a>             STA <a class='v' href='#IBTYPE'>IBTYPE</a>                                      ; ..] never referenced!
                    096 ;
308A:AC C1 2A       097             LDY AIOB
                    098             LDA AIOB+1
                    099             JSR DISKIO
                    100 ;
                    101             LDA IBSMOD                                      ; <b>Hack</b>
                    102             STA CCBVOL
                    103             LDA #$FF        ; RESET VOL
                    104             STA IBVOL
                    105             BCS BADIO       ; BR IF BAD
                    106             RTS             ; RTN IF GOOD
                    107 ;
30A1:AD F5 37       108 BADIO       LDA IBSTAT      ; GET STATUS
                    109             LDY #CREVMM
                    110             CMP #IBVMME     ; WAS IT VOLUME MISMATCH
                    111             BEQ BD2         ; BR IF YES
                    112             LDY #CREPRO
                    113             CMP #IBWPER
                    114             BEQ BD2
                    115             LDY #CREIOE
                    116 BD2         TYA
<hr>30B3:4C 85 33       117             JMP ERRROB                                      ; === <a class='page' name='page65'>65</a> ===
                    118             PAGE
                    119 ;
                    120 ;LOCNXB - LOCATE NEXT BYTE
                    121 ;
                    122 <a class='f' name='LOCNXB'   >LOCNXB      </a>EQU *
30B6:AD E4 35       123             LDA DCBCRS      ; IS THE CURRENT RELATIVE SECTOR
                    124             CMP DCBCMS      ; EQUAL TO THE CURRENT MEM SECTOR
                    125             BNE LNB1        ; BR IF NOT EQ
                    126             LDA DCBCRS+1
                    127             CMP DCBCMS+1
                    128             BEQ LNB8        ; BR IF REQD SECTOR IN MEM
                    129 ;
                    130 <a class='f' name='LNB1'     >LNB1        </a>EQU *           ; NEED A DIFFERENT SECTOR IN MEM
30C6:20 1D 2F       131             JSR WRSECT      ; GO WRITE SECTOR (IF REQD)
                    132 ;
                    133 <a class='f' name='LNB2'     >LNB2        </a>LDA DCBCRS+<span class='n'>1</span>    ; IS CURRENT REL SECTORY
                    134             CMP DCBDFS+1    ; IN CURRENT DIRECTORY (LOW LIMIT)
                    135             BCC LNB4        ; BR IF IN A PREVIOUS DIR
                    136             BNE LNB3        ; BR IF MAYBE IN THIS ONE
                    137             LDA DCBCRS      ; TEST LOW BYTES
                    138             CMP DCBDFS
                    139             BCC LNB4        ; BR IF IN PREVIOUS DIR
                    140 ;
                    141 <a class='f' name='LNB3'     >LNB3        </a>LDA DCBCRS+1    ; CURRENT REL SECTOR
                    142             CMP DCBDNF+1    ; IN CURRENT DIRECTOR (HI LIMIT)
                    143             BCC LNB6        ; BR IF IN THIS ONE
                    144             BNE LNB4
                    145             LDA DCBCRS
                    146             CMP DCBDNF
                    147             BCC LNB6
                    148 ;REQD SECTOR IN A NEXT DIRECTORY
30ED:20 5E 2F       149 LNB4        JSR RDFDIR
30F0:90 D7          150             BCC LNB2
30F2:60             151             RTS
                    152 ;
                    153 ;
                    154 <a class='f' name='LNB6'     >LNB6        </a>EQU *           ; CALCULATE DISPL INTO DIR
30F3:38             155             SEC
                    156             LDA DCBCRS      ;
                    157             SBC DCBDFS
                    158             ASL A           ; TIMES 2
                    159             ADC #FDENT      ; PLUS DISPL TO 1ST
                    160             TAY
                    161             JSR MVFCBD      ; MOVE DIR ADR TO ZPG
                    162             LDA (ZPGFCB),Y  ; GET TRACK
                    163             BNE LNB7        ; BR IF NOT ZERO                ; should be <b>BPL</b>, Filesystem Design FLAW: Can't store data on Track 0
                    164             LDA CCBREQ
                    165             CMP #CRQWR      ; WRITE!
                    166             BEQ LNB7A
                    167             SEC
310D:60             168             RTS
310E:20 34 31       169 LNB7A       JSR <a class='x' href='#GNWSEC'>GNWSEC</a>      ; GO GET A NEW SECTOR           ; A=C0
3111:4C 20 31       170             JMP <a class='x' href='#LNBCON'>LNBCON</a>                                      ;&darr; <a class='mem' name='_3111'>wastes</a> 1 byte 1 byte, BNE LNBCON
                    171 <a class='f' name='LNB7'     >LNB7        </a>STA DCBTRK      ; SET TRK INTO DCB
                    172             INY
                    173             LDA (ZPGFCB),Y  ; GET SECTOR
                    174             STA DCBSEC      ; PUT INTO DCB
311D:20 DC 2F       175             JSR RDSEC       ; GO READ SECTOR
3120:AD E4 35       176 <a class='f' name='LNBCON'   >LNBCON      </a>LDA DCBCRS      ; MOVE CUR REL SECTOR
                    177             STA DCBCMS
                    178             LDA DCBCRS+<span class='n'>1</span>    ; TO CUR MEM SECTOR
                    179             STA DCBCMS+<span class='n'>1</span>
<hr>                    180 ;                                                           ; === <a class='page' name='page66'>66</a> ===
                    181 <a class='f' name='LNB8'     >LNB8        </a>EQU *
                    182             JSR MVFCBS      ; MOVE SECTOR BUFF ADR TO ZP
                    183             LDY DCBCSB      ; GET SECT BYTE
                    184             CLC             ; CARRY CLEAR = ALL OK
3133:60             185             RTS             ; DONE
                    186             PAGE
                    187 ;
                    188 ;
                    189 <a class='f' name='GNWSEC'   >GNWSEC      </a>EQU *           ; NEED NEW SECTOR
3134:8C 9D 33       190             STY TEMP2       ; SAVE DIR INDEX
3137:20 44 32       191             JSR GETSEC      ; GET A SECTOR
313A:AC 9D 33       192             LDY TEMP2
313D:C8             193             INY
313E:91 42          194             STA (ZPGFCB),Y  ; SET NEW SECTOR
3140:8D D7 35       195             STA DCBSEC
                    196             DEY
                    197             LDA DCBATK                                      ; Allocated track?
                    198             STA (ZPGFCB),Y  ; SET NEW TRACK
                    199             STA DCBTRK
                    200 ;
                    201             JSR MVFCBS
                    202             JSR CLRSEC      ; GO CLEAR SECTOR
                    203 ;
                    204 ;
3152:A9 C0          205             LDA #$C0        ; INDICATE BOTH                 ; <a class='magic' name='_3153'>magic number</a> WRITE_FLAG_SECTOR | WRITE_FLAG_DIR
                    206             ORA DCBWRF      ; DIR AND SECTOR                ; <span class='todo'>TODO</span> DIRECTORY or DIRECTION ???
                    207             STA DCBWRF      ; MUST BE WRITTEN
                    208             RTS             ; DONE                          ; For the love of god, WHY do you keep stating the obvious???
                    209             PAGE
                    210 ;
                    211 ;INCRRB - INCREMENT RELATIVE RECORD BYTE
                    212 ;
                    213 <a class='f' name='INCRRB'   >INCRRB      </a>EQU *
                    214             LDX DCBCRR      ; MOVE BYTE JUST READ OR WRITTEN
                    215             STX CCBRRN
                    216             LDX DCBCRR+1
                    217             STX CCBRRN+1
                    218             LDX DCBCRB      ; X=REL BYTE (LOW)
                    219             LDY DCBCRB+1    ; Y=REL BYTE HI
                    220             STX CCBBYT
                    221             STY CCBBYT+1
                    222             INX             ; INC REL BYTE (LOW)
                    223             BNE INCR1       ; BR IF NO CARRY
                    224             INY
                    225 ;
                    226 <a class='f' name='INCR1'    >INCR1       </a>CPY DCBRCL+<span class='n'>1</span>    ; REL BYTE=REC LENGTH
                    227             BNE INCR2       ; BR IF NOT
                    228             CPX DCBRCL
                    229             BNE INCR2
                    230             LDX #0
                    231             LDY #0          ; RESET REL BYTE TO ZERO
                    232             INC DCBCRR      ; AND INCR
                    233             BNE INCR2       ; RELATIVE RECORD
                    234             INC DCBCRR+1
                    235 ;
                    236 <a class='f' name='INCR2'    >INCR2       </a>STX DCBCRB      ; SAVE NEW RELATIVE BYTE
                    237             STY DCBCRB+1
                    238 ;
                    239             RTS
                    240             PAGE
                    241 ;
                    242 ;INCSCB - INCREMENT SECTOR BYTE
<hr>                    243 ;                                                           ; === <a class='page' name='page67'>67</a> ===
                    244 <a class='f' name='INCSCB'   >INCSCB      </a>EQU *
                    245             INC DCBCSB      ; INC SECTOR BYTE
                    246             BNE INCS2       ; BR IF NOT FULL
                    247             INC DCBCRS      ; AND INCR
                    248             BNE INCS2       ; RELATIVE SECTOR
                    249             INC DCBCRS+<span class='n'>1</span>
                    250 ;
                    251 ;
                    252 <a class='f' name='INCS2'    >INCS2       </a>EQU *
                    253             RTS
                    254             PAGE
                    255 ;
                    256 ;MIBDA - MOVE AND INCREMENT CCBDAT
                    257 ;
                    258 <a class='f' name='MIBDA'    >MIBDA       </a>EQU *
                    259             LDY CCBBBA      ; Y=ADR LOW
                    260             LDX CCBBBA+<span class='n'>1</span>    ; X=ADR HI
                    261             STY ZPGFCB      ; PUT ADR INTO ZPG
                    262             STX ZPGFCB+<span class='n'>1</span>
                    263 ;
                    264             INC CCBBA       ; INC ADR LOW
                    265             BNE MIB1        ; BR IF NOT ZERO
                    266             INC CCBBA+<span class='n'>1</span>     ; DONE
                    267 <a class='f' name='MIB1'     >MIB1        </a>RTS             ; DONE
                    268 ;
                    269 ;DTBLN - DECREMENT BLONG LENGTH AND TEST ZERO
                    270 ;
                    271 <a class='f' name='DTB2'     >DTBLN       </a>EQU *
                    272             LDY CCBBLN      ; GET LEN LOW
                    273             BNE DTB1        ; BR IF NOT ZERO                ; <i>No shit Caption Obvious!</i>
                    274             LDX CCBBLN+<span class='n'>1</span>    ; GET LEN HI
                    275             BEQ DTB2        ; BR IF LEN=0
                    276             DEC CCBBLN+<span class='n'>1</span>    ; DEC LEN (HIGH)
                    277 <a class='f' name='DTB1'     >DTB1        </a>DEC CCBBLN      ; DEC LEN (LOW)
                    278             RTS             ; DONE
                    279 ;
                    280 <a class='f' name='DTB2'     >DTB2        </a>JMP <a class='x' href='#GOOIO'>GOODIO</a>      ; FINISHED BLOCK
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FLOCSEC">FLOCSEC</a> - Locate Sector, Page <a class="page" name="page68">68</a>, <a class='ts' href='#T2S0'>T2S0</a> - <a class='ts' href='#T2S2'>T2S2</a>, $<span class='n'>B1C9</span> .. $<span class='n'>B396</span>  ===<hr class='join'><hr></div>
<pre>
                    001             PAGE
                    002 ;
                    003 ;FNDFIL - FIND FILE NAME IN VOLUUME DIR                     ; *spelling* VOLUME
                    004 ;
                    005 <a class='f' name='FNDFIL'   >FNDFIL      </a>EQU *
31C9:20 F7 2F       006             JSR <a class='x' href='#RDVTOC'>RDVTOC</a>      ; GO GET VTOC
31CC:AD C3 35       007             LDA <a class='v' href='#CCBFN'>CCBFN</a>       ; MOVE FN PTR
31CD:85 42          008             STA <a class='v' href='#ZPGFCB'>ZPGFCB</a>      ; TO ZERO PAGE
31D1:AD C4 35       009             LDA <a class='v' href='#CCBFN'>CCBFN</a>+<span class='n'>1</span>
31D5:85 43          010             STA <a class='v' href='#ZPGFCB'>ZPGFCB</a>+<span class='n'>1</span>
31D6:A9 01          011             LDA #<span class='n'>1</span>                                          ; *sigh* <a class='magic' name='_31D6'>magic number</a> <span class='todo'>TODO</span>
31D8:8D 9D 33       012 <a class='f' name='FF1'      >FF1         </a>STA <a class='v' href='#TEMP2'>TEMP2</a>
31DB:A9 00          013             LDA #<span class='n'>0</span>
31DD:8D D8 35       014             STA <a class='v' href='#DCBVDR'>DCBVDR</a>
31E0:18             015             CLC
                    016 <a class='f' name='FF2'      >FF2         </a>EQU *
31E1:EE D8 35       017             INC <a class='v' href='#DCBVDR'>DCBVDR</a>                                      ;
31E4:20 11 30       018             JSR <a class='x' href='#RDVDIR'>RDVDIR</a>      ; GO GET VDIR SECTOR
31E7:B0 51          019             BCS <a class='x' href='#FF4A'>FF4A</a>                                        ;&darr;
31E9:A2 00          020             LDX #<span class='n'>0</span>          ; SET FOR 1ST FILE
                    021 ;
31EB:8E 9C 33       022 <a class='f' name='FF3'      >FF3         </a>STX <a class='v' href='#TEMP1'>TEMP1</a>       ; SAVE INDEX
31EE:BD C6 34       023             LDA <a class='v' href='#VDFILE'>VDFILE</a>,X    ; GET FILE TRK
31F1:F0 1F          024             BEQ <a class='x' href='#FF6'>FF6</a>         ; BR IF LAST ENTRY              ;&darr; <span class='todo'>TODO</span> NTODAFS can't store data on track 0; Should be <span class='code'>NOP NOP</span>
31F3:30 22          025             BMI <a class='x' href='#FF7'>FF7</a>         ; BR IF DELETED ENTRY           ;&darr;
31F5:A0 00          026             LDY #<span class='n'>0</span>          ; X=X+3
31F6:E8             027             INX
31F7:E8             028             INX
31F8:E8             029 <a class='f' name='FF4'      >FF4         </a>INX
31FA:B1 42          030             LDA (<a class='v' href='#ZPGFCB'>ZPGFCB</a>),Y  ; GET FN CHAR
31FC:DD C6 B4       031             CMP <a class='v' href='#VDFILE'>VDFILE</a>,X    ; COMPARE TO ENTRY CHAR
31FF:D0 0A          032             BNE <a class='x' href='#FF5'>FF5</a>         ; BR IF NOT SAME                ;&darr;
3201:C8             033             INY
3202:C0 1E          034             CPY #<span class='n'>30</span>         ; ALL 30 CHARS                  ;  <a class='magic' name='_3203'>magic number</a> <span class='code'>FILENAME_MAX</span>
3204:D0 F3          035             BNE <a class='x' href='#FF4'>FF4</a>         ; BR IF NOT                     ;&uarr;
3206:AE 9C 33       036             LDX <a class='v' href='#TEMP1'>TEMP1</a>       ; GET INDEX
3209:18             037             CLC             ; FILE FOUND
320A:60             038             RTS             ; RETURN
                    039 ;
                    040 <a class='f' name='FF5'      >FF5         </a>EQU *
320B:20 30 32       041             JSR <a class='x' href='#VDINC'>VDINC</a>
320E:90 DB          042             BCC <a class='x' href='#FF3'>FF3</a>                                         ;&uarr;
3210:B0 CF          043             BCS <a class='x' href='#FF2'>FF2</a>                                         ;&uarr;
                    044 ;
3212:AC 9D 33       045 <a class='f' name='FF6'      >FF6         </a>LDY <a class='v' href='#TEMP2'>TEMP2</a>       ; LOOKING FOR DELETED           ;           *sigh* <b>Found Last Catalog Entry</b>
3215:D0 C1          046             BNE <a class='x' href='#FF1'>FF1</a>         ; BR IF NOT (DO)                ;&uarr; (always?) This is why you don't use crappy function names
                    047 ;                                                           ;            that only differ by one digit
3217:AC 9D 33       048 <a class='f' name='FF7'      >FF7         </a>LDY <a class='v' href='#TEMP2'>TEMP2</a>       ; LOOKING FOR EMPTY             ;           *sigh* Found Deleted
321A:D0 EF          049             BNE <a class='x' href='#FF5'>FF5</a>         ; BR IF NOT                     ;&uarr; (always?)
                    050 ;
                    051 <a class='f' name='MVN'      >MVN         </a>EQU *
321C:A0 00          052             LDY #<span class='n'>0</span>          ; HAVE NEW ENTRY
321E:E8             053             INX
<hr>321F:E8             054             INX                                             ; === <a class='page' name='page69'>69</a> ===
3220:E8             055 <a class='f' name='FF8'      >FF8         </a>INX
3221:B1 42          056             LDA (<a class='v' href='#ZPGFCB'>ZPGFCB</a>),Y  ; MOVE FILENAME
3223:9D C6 34       057             STA <a class='v' href='#VDFILE'>VDFILE</a>,X
3226:C8             058             INY
3227:C0 1E          059             CPY #<span class='n'>30</span>                                         ;  <a class='magic' name='_3228'>magic number</a> <span class='code'>FILENAME_MAX</span>
3229:D0 F5          060             BNE <a class='x' href='#FF8'>FF8</a>                                         ;&uarr;
                    061 ;
322B:AE 9C 33       062             LDX <a class='v' href='#TEMP1'>TEMP1</a>       ; GET INDEX
322E:38             063             SEC                                             ; <span class='todo'>TODO</span> PASS? FAIL?
322F:60             064             RTS
                    065 <a class='f' name='VDINC'    >VDINC       </a>EQU *
3230:18             066             CLC
3231:AD 9C 33       067             LDA <a class='v' href='#TEMP1'>TEMP1</a>                                       ; pCatalog++;
3234:69 23          068             ADC #<span class='n'>35</span>                                         ;  <a class='magic' name='_3228'>magic number</a> <span class='code'>FILENAME_ENTRY_SIZE</span>
3236:AA             069             TAX
2337:E0 F5          070             CPX #<a class='v' href='#VDFLEN'>VDFLEN</a>
3239:60             071             RTS
                    072 <a class='f' name='FF4A'     >FF4A        </a>EQU *
323A:A9 00          073             LDA #<span class='n'>0</span>
323C:AC 9D 33       074             LDY <a class='v' href='#TEMP2'>TEMP2</a>                                       ; /cynical What? Can't do <span class='code'>FILE_ENTRY_OFFSET = TEMP2</span>
323F:D0 97          075             BNE <a class='x' href='#FF1'>FF1</a>                                         ;
3241:4C 77 33       076             JMP <a class='x' href='#ERROR9'>ERROR9</a>                                      ; <a class='v' href='#EM9'>EM9</a>: I/O ERROR
                    077             PAGE
                    078 ;
                    079 ;GETSEC - GET A SECTOR
                    080 ;
                    081 <a class='f' name='GETSEC' >GETSEC      </a>EQU *
3244:AD 51 35       082             LDA <a class='v' href='#DCBATK'>DCBATK</a>      ; GET ALLOCATED TRK
3247:F0 21          <a class='line' name="FLOCSEC.83">083</a>             BEQ <a class="x" href="#GSS1"  >GSS1</a>        ; BR IF NONE                    ; DESIGN FLAW: Can't store file on track 0 !
                    084 ;
                    085 <a class='f' name='GS0'    >GS0         </a>EQU *
3249:CD F0 35       086             DEC <a class='v' href='#DCBALS'>DCBALS</a>      ; DECREMENT SECTOR NO
324C:30 17          087             BMI <a class='x' href='#CS2'>CS2</a>         ; BR IF NO SECTORS REM
                    088 ;
324E:18             089             CLC
324F:A2 04          090             LDX #<span class='n'>4</span>          ; 4 BYTE SHIFT       ; <span class='TODO'>TODO</span> magic number sizeof( DCBABM ),  See: <a class='v' href='#ALC10S'>ALC10S</a>)
3251:3E F1 35       091 <a class='f' name='GS1'      >GS1         </a>ROL DCBABM-<span class='n'>1</span>    ; SHIFT BYTE LEFT               ; ???
3254:CA             092             DEX
3255:D0 FA          093             BNE <a class='x' href='#GS1'>GS1</a>
3257:90 F0          094             BCC <a class='x' href='#GS0'>GS0</a>
                    095 ;
3259:EE EE 35       096             INC DCBNSA
325C:D0 03          097             BNE GS1A                                        ;&darr;
325E:EE EF 35       098             INC DCBNSA+1
3261:AD F0 35       099 <a class='f' name='GS1A'   >GS1A        </a>EQU *
3264:60             100             LDA DCBALS      ; GET ALLOCATED SECTOR
                    101             RTS             ; RETURN
                    102 ;
3265:A9 00          103 <a class='f' name='CS2'    >CS2         </a>LDA #<span class='n'>0</span>          ; CLEAR ALLOCATED
3267:8D F1 35       104             STA <a class='v' href='#DCBATK'>DCBATK</a>      ; TRK
                    105 ;
326A:A9 00          106 <a class='f' name='GSS1'   >GSS1        </a>LDA #0          ; SET SEARCH STATE=0
326C:8D 9E 33       107             LDA TEMP3
326F:20 F7 2F       108             JSR RDVTOC      ; GET VTOC
                    109 ;
                    110 <a class='f' name='GS2'    >GS2         </a>EQU *
3272:18             111             CLC
3273:AD EB 33       112             LDA VALCA1      ; GET LAST ALLOCATED TRK
3276:6D EC 33       113             ADC VALCA2      ; AD (+1) OR (-1)
3279:F0 09          114             BEQ GS3         ; BR IF DECK TO ZERO            ; <span class='todo'>TODO</span> Can't allocate data on Track 0
327B:CD EF 33       115             CMP VNOTRK
327E:90 14          116             BCC GS5         ; BR IF NOT AT OUTER LIMIT
<hr>3280:A9 FF          117             LDA #$FF        ; SET (-1)                      ; === Page <a class="page" name="page70">70</a> ===
3282:D0 0A          118             BNE GS4                                         ;&darr; Allways
3284:AD 9E 33       119 <a class='f' name='GS3'    >GS3         </a>LDA TEMP3       ; GET SEARCH STATE
3287:D0 37          120             BNE ERR9        ; BR IF NOT ZERO
3289:A9 01          121             LDA #1          ; SET (+1)
328B:8D 9E 33       122             STA TEMP3       ; SET SEARCH SATE = 1
328E:8D EC 33       123 <a class='f' name='GS4'    >GS4         </a>STA VALCA2      ; SET NEW (+1) OR (-1)
3291:18             124             CLC
3292:69 11          125             ADC #17         ; ADD VTOC TRK NO               ; <a class='magic' name='_3293'>magic number</a> CAT_FILE_TRACK, FILESYSTEM_VTOC_CAT_TRACK = $11
3294:8D EB 33       126 <a class='f' name='GS5'    >GS5         </a>STA VALCA1      ; SET NEW LAST ALLOCATED
3297:8D F1 35       127             STA DCBATK      ; PUT IN DCB
                    128 ;
329A:A8             129             TAY             ; ALLOCATED TRACK
329B:0A             130             ASL A           ; TIME 4                        ; HARD-CODED 4 bytes/VTOC
329C:0A             131             ASL A
329D:A8             132             TAY                                             ; See <a class="dumb" href='#HNTDAFS3'>HNTDAFS #3</a> Wastes 4 bytes/track for free sector bitmap, sizeof( DCBABM )
329E:A2 04          133             LDX #<span class='n'>4</span>                                          ; <a class='magic' name='_???'>magic number</a> VTOC_BITMAP_BYTES_PER_TRACK = sizeof(DCBABM),  See: <a class='v' href='#ALC10S'>ALC10S</a>
32A0:18             134             CLC
32A1:B9 F6 33       135 <a class='f' name='GS6'    >GS6         </a>LDA VSECAL+3,Y  ; MOVE BIT MAP BYTE
32A4:9D F1 35       136             STA DCBABM-1,X
32A7:F0 06          137             BEQ GS7         ; BR IF NO BITS ON
32A9:38             138             SEC             ; SET HAVE SECTOR
32AA:A9 00          139             LDA #0          ; CLEAR VTOC BYTE
32AC:99 F6 33       140             STA VSECAL+3,Y
32AF:88             141 <a class='f' name='GS7'    >GS7         </a>DEY
32B0:CA             142             DEX
32B1:D0 EE          143             BNE GS6         ; BR IF MORE TO MOVE
32B3:90 BD          144             BCC GS2
32B5:20 FB 2F       145             JSR WRVTOC      ; GO WRITE VTOC
32B8:AD F0 33       146             LDA VNOSEC      ; GET NO SECTORS
32BB:8D F0 35       147             STA DCBALS      ; SET IN DCB SECTOR BYTE
32BE:D0 89          148             BNE GS0         ; GO ALLOCATED  SECTOR          ;&uarr;
32C0:4C 77 33       149 <a class='f' name='GS8'    >GS8         </a>JMP ERROR9
                    150             PAGE
                    151 ;
                    152 ;FRETRK - FREE TRACK OF SECTORS
                    153 ;
                    154 <a class='f' name='FRETRK' >FRETRK      </a>EQU *
32C3:AD F1 35       155             LDA <a class='x' href='#DCBATK'>DCBATK</a>      ; GET ALLOCATED TRACK
32C6:D0 01          156             BNE <a class='x' href='#FT1'>FT1</a>         ; BR IF NONE                    ;&darr; DESIGN FLAW: Can't store data on track 0, <span class='todo'>TODO</span>
32C8:60             157             RTS
32C9:48             158 <a class='f' name='FT1'    >FT1         </a>PHA
32CA:20 F7 2F       159             JSR <a class='x' href='#RDVTOC'>RDVTOC</a>      ; GET VTOC
32CD:AC F0 35       160             LDY <a class='v' href='#DCBALS'>DCBALS</a>      ; GET SECTORS
32D0:68             161             PLA             ; GET TRACK
32D1:18             162             CLC             ; SET FREE
32D2:20 DD 32       163             JSR <a class='x' href='#FRESEC'>FRESEC</a>      ; GO FREE
32D5:A9 00          164             LDA #<span class='n'>0</span>          ; CLEAR ALLOCATED TRK
32D7:8D F1 35       165             STA <a class='v' href='#DCBATK'>DCBATK</a>
32DA:4C FB 2F       166             JMP <a class='x' href='#WRVTOC'>WRVTOC</a>      ; WRITE VTOC
                    167 ;
                    168 ;FRESEC - FREE A SECTOR
                    169 ;A=TRK, Y=SECTOR, C=ON/OFF
                    170 ;
                    171 <a class='f' name='FRESEC' >FRESEC      </a>EQU *
32DD:A2 FC          172 <a class='f' name='FS1'    >FS1         </a>LDX #<span class='n'>252</span>        ; 4 BYTE SHIFT                  ; <a class='magic' name='#_32dd'>magic number</a> 256 - sizeof(<a class='v' href='#DCBABM'>DCBABM</a>), See: <a class='v' href='#ALC10S'>ALC10S</a>
32DF:7E F6 34       173 <a class='f' name='FS2'    >FS2         </a>ROR <a class='v' href='#DCBABM'>DCBABM</a>-<span class='n'>252</span>  ; SHIFT IN CARRY
32E2:E8             174             INX             ; NEXT BYTE
32E3:D0 FA          175             BNE <a class='x' href='#FS2'>FS2</a>         ; BR IF NOT DONE
32E5:C8             176             INY             ; INC SECTOR NO
32E6:CC F0 33       177             CPY <a class='v' href='#VNOSEC'>VNOSEC</a>      ; NORMAL
32E9:D0 F2          178             BNE <a class='x' href='#FS1'>FS1</a>         ; BR IF NOT
                    179 ;
<hr>                    180             ASL A           ; TRACK*4                       ; === Page <a class='page' name='page71'>71</a> ===
                    181             ASL A
                    182             TAY
                    <a class='line' name='FLOCSEC.183'>183</a>             BEQ <a class='x' href='#FS4'>FS4</a>                                         ; See <a class="dumb" href='#HNTDAFS3'>HNTDAFS #3</a> Wastes 4 bytes/track for free sector bitmap, sizeof( DCBABM )
32F0:A2 04          <a class='line' name='FLOCSEC.184'>184</a>             LDX #<span class='n'>4</span>                                          ; <a class='magic' name='_32F1'>magic number</a> VTOC_BITMAP_BYTES_PER_TRACK,  See: <a class='v' href='#ALC10S'>ALC10S</a>
32F2:BD F1 35       185 <a class="f" name="FS3"    >FS3         </a>LDA <a class="v" href="#DCBABM">DCBABM</a>-1,X  ; GET BIT MAP BYTE
32F5:19 F6 33       186             ORA <a class="v" href="#VSECAL">VSECAL</a>+3,Y  ; OR WITH VTOC BM
32F8:99 F6 33       187             STA <a class="v" href="#VSECAL">VSECAL</a>+3,Y
32FB:88             188             DEY
32FC:CA             189             DEX
32FD:D0 F3          190             BNE <a class="x" href="#FS3">FS3</a>
32FF:60             191 <a class="f" name="FS4"    >FS4         </a>RTS             ; DONE
                    192             PAGE
                    193 ;
                    194 ;LOCSEC - LOCATE SECTOR FOR RECORD I/O
                    195 ;
                    196 ;RELSEC = (REL REC * RECLEN + RELBYTE)/256
                    197 ;SECBYT = REMAINDER
                    198 ;
                    199 <a class='f' name='LOCSEC' >LOCSEC      </a>EQU *                                           ;               <b>Proper</b> variable names such as
3300:AD BD 35       200             LDA <a class="v" href="#CCBRRN">CCBRRN</a>      ; RELATIVE RECORD NUMBER        ; === <a class='ts' href='#TS2S'>T2S2</a> ===  CCB_REL_REC_NUM
3303:8D E6 35       201             STA <a class="v" href="#DCBCSB">DCBCSB</a>      ; TO CSB FOR MULT               ;               Would negate the need for
3306:8D EA 35       202             STA <a class="v" href="#DCBCRR">DCBCRR</a>      ; AND CRR FOR SAVE              ;               50% of comments
3309:AD BE 35       203             LDA <a class="v" href="#CCBRRN">CCBRRN</a>+1                                    ; But's let abbrev. the frak out of everything
                    204             
                    205 
                    206 
                    207 
                    208 
                    209 
                    210 
                    211 
                    212 
                    213 
                    214 
                    215 
                    216 
                    217 
                    218 
                    219 
                    220 
                    221 
                    222 
                    223 
                    224 
                    225 
                    226 
                    227 
                    228 
                    229 
                    230 
                    231 
                    232 
                    233 
                    234 
                    235 
                    236 
                    237 
                    238 
                    239 
                    240 
                    241 
                    242 
                    243 
                    244 
                    245 
                    246 
                    247 
                    248 
                    249 
                    250 
                    251 
                    252 
                    253 
                    254 
                    255 
                    256 
                    257 
                    258 
                    259 
                    260 
                    261 
                    262 
                    263 
                    264 
                    265 
                    266 
                    267 
                    268 
                    269 
                    270 
                    271 
                    272 
                    273 
                    274 
                    275 
                    276 
                    277 
                    278 
                    279 
3391:28             280             PLP             ; GET STATUS
3392:AE 9B 23       281             LDX ENTSTK      ; GET ENT STACK
3395:9A             282             TXS             ; RESTORE STACK                 ; o7 Captain Obvious
3396:60             283             RTS             ; DONE
                    284 <a class='f' name='EC2'    >EC2         </a>EQU *
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FVCBUFS">FVCBUFS</a> - File Volume Catalog Buffers, Page <a class="page" name="page86">86</a>, <a class='ts' href='#T2S2'>T2S2</a> @ $97 - <a class='ts' href='#T2S4'>T2S4</a> @ $FD, $<span class='n'>B397</span> .. $<span class='n'>B5FD</span> ===<hr class='join'><hr></div>
<pre>
"<i>Show me your code and I'll have to guess at your data (structures),
 Show me your data and I won't have to see your code, I'll already know it.</i>"
 -- Michael, paraphrasing Fred Brooks

"<i>Show me your flowcharts and conceal your tables, and I shall continue to be mystified.
 Show me your tables, and I won't usually need your flowcharts; they'll be obvious.</i>"
-- Fred Brooks

Let the complete clusterfrak of bad design commence in <a class='link' href="https://www.nasa.gov/audience/foreducators/topnav/materials/listbytype/3_2_1_Puff.html">3..2..1..</a>

                    001             PAGE                                            ; This is why I partially dislike old source code:
                    002 ;MISC DOS WORK CELLS                                        ;   <i>(almost) Everything has been abbreviated</i>
                    003 ;                                                           ;   <i>(almost) to the point of obfuscation.</i>
3397:00             004 <a class="d" name="CVDTRK">CVDTRK      </a>DFB 0           ; CUR VOL DIR TRK               ; i.e.
3398:00             005 <a class="d" name="CVDSEC">CVDSEC      </a>DFB 0           ; CUR VOL DIR SECTOR            ;    ENT = Entry
3399:00 00          006 <a class="d" name="CURCCB">CURCCB      </a>DFB 0,0         ; CURRENT CCB ADR               ;    ALC = Allocation
339B:00             007 <a class="d" name="ENTSTK">ENTSTK      </a>DFB 0           ; ENTRY STACK POINTER           ; Why are we futzing with the stack pointer???
339C:00             008 <a class="d" name="TEMP1" >TEMP1       </a>DFB 0           ; TEMP BYTE1                    ; /sarcasm o7 Captain Obvious
339D:00             009 <a class="d" name="TEMP2" >TEMP2       </a>DFB 0           ; TEMP BYTE 2                   ;   *note* All the cool kids use "o7" for salute these days
339E:00             010 <a class="d" name="TEMP3" >TEMP3       </a>DFB 0           ; TEMP BYTE 3                   ; Used by <a class="x" href="#FLOCK">FLOCK</a>, <a class="x" href="#FUNLCK">FUNLCK</a> and <a class="x" href="#GSS1">GSS1</a>
339F:00             011 <a class="d" name="ENTSLT">ENTSLT      </a>DFB 0           ; BOOT SLOT SAVE
33A0:00 00 FF FF    012 <a class="d" name="ALC10S">ALC10S      </a>DFB 0,0,$FF,$FF ; ALLOCATION TRACK BIT MAP      ; <a class='mem' name='_33A0'>wastes</a> 4 bytes/track free sector bitmap mask, used in <a class='x' href='#NT3'>NT3</a>; See <a class='v' href='#DCBABM'>DCBABM</a>,
                                                                                    ; The thinking was probably:
                                                                                    ;     DOS 3.2 = 13 sector
                                                                                    ;     DOS 3.3 = 16 sector
                                                                                    ;     DOS 3.4 &gt; 16 sector -- See <a class="v" href="#VNOSEC">VNOSEC</a>
                                                                                    ; === <a class="dumb" name="HNTDAFS1">HNTDAFS #1</a> ===
                                                                                    ; Anytime you see the word <b>reserved</b> or <b>unused</b> in a (file) format
                                                                                    ; your spidey sense should be tingling.
                                                                                    ; Translation: <i>I pulled this out of my ass -- </i>
                                                                                    ;              <i>because I didn't actually <b>measure</b> what is <b>needed</b>!"</i>
33A4:01 0A 64       013 <a class="d" name="CVTAB" >CVTAB       </a>DFB 1,10,100    ; CONVERSION TABLE              ; Powers of 10; sadly Applesoft's DECTBL @ $<span class='n'>EE6C</span> is useless :-/
                    014             MSC ON                                          ; Switch ASCII to Apple Text (high bit set)
33A7:D4 C9 C1 C2    015 <a class="d" name="FTTAB" >FTTAB       </a>ASC "TIAB"      ; FILE TYPE CONVERSTION TABLE"  ; <a class='dumb'>File Types</a> You couldn't use file types that make <i>visual</i> hex editing easier??
                                                                                    ;     Type             Code  Dumb       Smart 
                                                                                    ;     Applesoft Basic  A     02 Ctrl-B  01 Ctrl-A
                                                                                    ;     Binary           B     04 Ctrl-D  02 Ctrl-B
                                                                                    ;                      c                03
                                                                                    ;                      d                04
                                                                                    ;                      e                05
                                                                                    ;                      f                06
                                                                                    ;                      g                07
                                                                                    ;                      h                08
                                                                                    ;     Integer Basic    I     01 Ctrl-A  09 Ctrl-I
                                                                                    ; You have 3 guesses to tell which DOS uses and the first 2 don't count.
33AB:D3 D2 C1 C2    016             ASC "SRAB"                                      ; *sigh* <b>Really</b>, you just <i>had</i> to re-use AB ??
                                                                                    ; === <a class="dumb" name="HNTDAFS2">HNTDAFS #2</a> ===
                                                                                    ; <i>Gee, how about using, oh I don't know:</i> <b>CD</b>
                                                                                    ; At the very least D = "user Defined" or *<i>shock</i>* <b>directory</b>:
                                                                                    ;    C = Child (directory) Parent Track/Sector, e.g. T$11S$F
                                                                                    ;    D = Directory (child),                     e.g. T$12S$F
                                                                                    ; Yeah, yeah 20/20
33AF:A0 C5 CD D5    017 <a class="d" name="VOLMES">VOLMES      </a>ASC " EMULOV DISK" ; "DISK VOLUME " BACWARDS    ; *sigh* Micro-optimization; Not that these are bad but
33B3:CC CF D6 A0                                                                    ;        /sarcasm <i>Lets focus on a <b>single</b> tree,</i>
33B7:CB D3 C9 C4                                                                    ;                 and <b>completely</b> miss the <i>entire <a class='link' href="https://en.wikipedia.org/wiki/Frak_(expletive)">fraking</a> forest!</i>
                    018             MSB OFF                                         ; Switch back to 7-bit ASCII
                    019 <a class="d" name="VML"   >VML         </a>EQU *-<a class="v" href="#VOLMES">VOLMES</a>-1                                  ; Used by File <a class="file" href="#FDELCAT">FDELCAT</a>, Func <a class="x" href="#RDIR">RDIR</a>, Line <a class='line' href='#FDELCAT.113'>113</a>
                    020             PAGE                                            ;
                    021 ;VTOC RECORD AREA                                           ; === VTOC ===
                    022 <a class="d" name="VTOC"  >VTOC        </a>EQU *                                           ; <a class='ts'>T11S0</a> [offset], Right side = normal snarky commentary
33BB:04             <a class="line" name="FVCBUFS.023">023</a> <a class="d" name="VDOST" >VDOST       </a>DFB 4           ; DOS TYPE                      ; [00] <a class='struct' name='_33BB'>wastes</a> 1 byte -- never referenced !
                                                                                    ;      <a class='magic' name='#_33BC'>magic number</a> /sarcasm If only <span class='code'>FILESYSTEM_TYPE_VTOC EQU $4</span>
33BC:11             024 <a class="d" name="VDIRTK">VDIRTK      </a>DFB 17          ; COLUME DIRECTORY SECTOR       ; [01] *spelling* VOLUME, *sigh* <b>TRACK</b> not <i>sector</i> -- <b>read</b> the bloody variable name!
                                                                                    ;      Used by <a class='x' href='#VTIO'>VTIO</a>
                                                                                    ;      *note* This is only a copy.  To change DOS while running
                                                                                    ;             <a class='x' href='#F01A'>F01A</a>+4:11 &rarr; <a class='v' href='#DCBVTN'>DCBVTN</a> 
                                                                                    ;              $<span class='n'>2C01</span>:<span class='n'>11</span> &rarr; $35FA
                                                                                    ;              $<span class='n'>AC01</span>:<span class='n'>11</span> &rarr; $B5FA
33BD:0F             025 <a class="d" name="VDIRSC">VDIRSC      </a>DFB 15          ; VOLUME DIRECTORY SECTOR       ; [02] Used by File <a class="file" href="#FLOCNXB">FLOCNXB</a>, Func <a class="x" href="#RVDC">RVDC</a>, Line <span class="todo">??</span>
33BE:04             026 <a class="d" name="VDOSRN">VDOSRN      </a>DFB 4           ; DOS RELEASE NUMBER            ; [03] *sarcasm* I guess <b>VERSION</b> made too much sense.
33BF:00             027             DFB 0           ; SPARE                         ; [04] <a class='struct' name='_33BF'>wastes</a> 1 byte /sarcasm "<i>Because <b>someday</b> these <b>might</b> be used ... ?</i>"
33C0:00             028             DFB 0           ; SPARE                         ; [05] <a class='struct' name='_33C0'>wastes</a> 1 byte &#x0CA0;_&#x0CA0;       Uh-huh.
33C1:FE             029 <a class="d" name="VVOLNO">VVOLNO      </a>DFB $FE         ; VOLUME NUMBER                 ; [06]                         <b>Design for today</b>, not <i>someday</i>
33C2:00 00 00 00    030             DS 32           ; SPARE                         ; [07] <a class='struct' name='_33C2'>wastes</a> 32 bytes, <b>WTF !</b>
33C6:00 00 00 00                                                                    ;      Gee, here's an idea:
33CA:00 00 00 00                                                                    ;      Instead of <i>wasting space</i> in the VTOC
33CE:00 00 00 00                                                                    ;        1) <b>Pack our data</b> by removing all the <i>unused crap:</i>
33D2:00 00 00 00                                                                    ;           Total 1+1+32+8 = <b>42 bytes!</b>
33D6:00 00 00 00                                                                    ;        2) Put VTOC data as first XX bytes in the <a class='ts'>T11SF</a> CATALOG
33DA:00 00 00 00                                                                    ;      
33DE:00 00 00 00                                                                    ;      
33E2:7A             031 <a class="d" name="VTDMS" >VTDMS       </a>DFB 122         ; MAX SECTORS IN A FILE DIR     ; [27] *sigh* not 128 so we can BMI (Branch on Minus) ??? (Copied to <a class='v' href='#DCBDMS'>DCBDMS</a>)
33E3:00 00 00 00    032 <a class="d" name="VSPARE">VSPARE      </a>DS 8            ; SPARES                        ; [28] <a class='struct' name='_33E3'>wastes</a> 8 bytes, <i>Oh FFS already ...</i>
33E7:00 00 00 00    033 ;                                                           ;      Who 1) <i>designed</i>, and 2) <b>implemented</b> this crap?!?!
33EB:11             034 <a class="d" name="VALCA1">VALCA1      </a>DFB 17          ; ALOCATION ALGORITHM BYTE 1    ; [30] ALLOC_TRK Last allocated track <span class="todo">TODO</span> Cross-Ref
33EC:01             035 <a class="d" name="VALCA2">VALCA2      </a>DFB 1           ; AA BYTE2                      ; [31] ALLOC_DIR Direction of last track allocation --  Used by <a class="x" href="#GS4">GS4</a>
                                                                                    ;       +1 = $01 inwards  to <a class='ts'>T22</a>,
                                                                                    ;       -1 = $FF outwards to <a class='ts'>T00</a>.
33ED:00             036 <a class="d" name="VALCA3">VALCA3      </a>DFB 0           ; AA BYTE3                      ; [32] <a class='struct' name='_33ED'>wastes</a> 1 byte /sarcasm <i>I <b>really</b> don't know what we</i>
33EE:00             037 <a class="d" name="VALCA4">VALCA4      </a>DFB 0           ; AA BYTE4                      ; [33] <a class='struct' name='_33EE'>wastes</a> 1 byte          <i>would do without you Captain Obvious!</i>
33EF:23             038 <a class="d" name="VNOTRK">VNOTRK      </a>DFB 35          ; NO TRACKS ON VOL              ; [34] *note* "No" = Number; To format more then 35 tracks:
                                                                                    ;      $<span class='n'>AEFE</span>:## ($3EFE), See: <a class="file" href="#FORMATR">FORMATR</a>, Line #<a class='line' href='#FORMATR.054'>054</a>
33F0:10             039 <a class="d" name="VNOSEC">VNOSEC      </a>DFB 16          ; NO SECTORS PER TRACK          ; [35]          Evidence that one day DOS 3.4+ might support:
33F1:00 01          040 <a class="d" name="VSECLN">VSECLN      </a>DW 256          ; NO. BYTES PER SECTOR          ; [36] (Little)     &gt;  16 sectors/track
                    041 ;                                                           ; [37] (Endian) and &gt; 256 bytes/sector.
                    042 <a class="d" name="VSECAL">VSECAL      </a>EQU *                                           ;      *note* <b>Actual</b> VTOC header is $F3-$BB = $38 bytes
                                                                                    ;       But we only really <b>use</b>:
                                                                                    ;         VVOLNO  (dubious value; ProDOS users don't miss it.)
                                                                                    ;         VALCA1
                                                                                    ;         VALCA2
                                                                                    ;       a total of <b>3 bytes</b> out of 56!
                                                                                    ;       That is ~5% usage!?!?
                                                                                    ; <a class='mem' name='_33F3'>wastes</a> 70 bytes (35 tracks * 2) due to allocating 32 sectors/track!
                    043 ;SECTORS ALLOCATED BY BIT MAP                               ;struct TrackBitmap {   //    Bits =   MSB.LSB
                    044 ;4 BYTES OF BITS PER TRACK                                  ;    uint8_t _f_8;      //[0] Sectors: FEDCBA98    0=Used
                    045 ;LEFT MOST BIT REPRESENTS SECTOR                            ;    uint8_t _7_0;      //[1] Sectors: 76543210    1=Free
                    046 ;WHERE N=NO SECTORS PER TRACK                               ;    uint8_t pad1;      //[2] *sigh* 1 byte unused
                    047 ;                                                           ;    uint8_t pad2;      //[3] *sigh* 1 byte unused
                    048 ;                                                           ; } FreeSectors[ $22 ]; // Technically have room for $31 (49) tracks
                                                                                    ;*sigh* Bytes <b>stored</b>     : 35*4 bytes = 140 bytes ($8C)
                                                                                    ;       When we only <b>need</b>: 35*2 bytes =  70 bytes ($46)
                                                                                    ;As Mike Acton says: "<i>Solve the <b>actual</b> problem,</i>
                                                                                    ;                     <i>NOT the one you <b>think</b> you have.</i>"
                    049            PAGE                                             ;<span class='n'>B3F3</span> =T00
33F3:00 00 FF FF    050            ORG VTOC+256                                     ; [38]=T00 See <a class="dumb" href="#HNTDAFS3">HNTDAFS #3</a>; Why not simply <span class="macro">DS 256-<a class="v" href=#"VSECAL">VSECAL</a>-<a class="v" href="#VTOC">VTOC</a>,0</span> ???
33F7:00 00 FF FF                                                                    ; [3C]=T01                 Uninitialized memory is <b>never</b> a good idea
33FB:00 00 FF FF                                                                    ; [40]=T02 See <a class="dumb" href="#HNTDAFS4">HNTDAFS #4</a>
33FF:FF FF FF FF                                                                    ; [44]=T03 === <a class='ts' href='#T2S3'>T2S3</a> === <a class='disk' name='_3400'>disk</a> wastes <i>an <b>entire</b> sector for a <b>single</b> byte!?</i>
3403:FF FF FF FF                                                                    ; [48]=T04 The real kicker? <a class="d" href="#VDTCDE">VDTCDE</a> <i>isn't even <b>bloody</b> used!</i> *<a class="dumb" href="http://i.imgur.com/iWKad22.jpg">facepalm</a>*
3407:FF FF FF FF                                                                    ; [4C]=T05
340B:FF FF FF FF                                                                    ; [50]=T06 We then proceed to waste $C8 bytes (256-<a class="v" href=#"VSECAL">VSECAL</a>-<a class="v" href="#VTOC">VTOC</a>)
340F:FF FF FF FF                                                                    ; [54]=T07 to <b>force us to span 2 sectors</b> with this dumb shit
3413:FF FF FF FF                                                                    ; [58]=T08 instead of copying the VTOC header ($38 byte)
3417:FF FF FF FF                                                                    ; [5C]=T09 into a new temporary page on init!
341B:FF FF FF FF                                                                    ; [60]=T0A 
341F:FF FF FF FF                                                                    ; [64]=T0B === <a class="dumb" name="HNTDAFS4">HNTDAFS #4</a> ===
3423:FF FF FF FF                                                                    ; [68]=T0C DOS reserves the <b>entire</b> Track 2 even though it only uses <b>T2S0 - T2S4</b> !?
3427:FF FF FF FF                                                                    ; [6C]=T0D 
342B:FF FF FF FF                                                                    ; [70]=T0E Instead of wasting <i>yet another track</i> <a class='ts'>T11</a> for meta data
342F:FF FF FF FF                                                                    ; [74]=T0F 
3433:FF FF FF FF                                                                    ; [78]=T10    <a class='ts'>S0</a> = VTOC, <a class='ts'>S1</a>-<a class='ts'>SF</a> = CATALOG
3437:00 00 FF FF                                                                    ; [7C]=T11 
343B:FF FF FF FF                                                                    ; [80]=T12 if we <i>weren't dumb</i> then both the
343F:FF FF FF FF                                                                    ; [84]=T13 VTOC &amp; CATALOG would reside on <a class='ts'>T2S5</a> - <a class='ts'>T2SF</a>
3443:FF FF FF FF                                                                    ; [88]=T14 
3447:FF FF FF FF                                                                    ; [8C]=T15 === <a class="dumb" name="HNTDAFS3">HNTDAFS #3</a> ===
344B:FF FF FF FF                                                                    ; [90]=T16 DOS is <b>unable</b> to use Track 0 to store user files.
344F:FF FF FF FF                                                                    ; [94]=T17 This means a non-bootable <i>data disk</i> is robbed of an <i>additional</i> 15 sectors!
3453:FF FF FF FF                                                                    ; [98]=T18 (Boot sector would display non-bootable message)
3457:FF FF FF FF                                                                    ; [9C]=T19 See File <a class="file" href="#FLOCSEC">FLOCSEC</a>, Func <a class="x" href="#GETSEC">GETSEC</a>, Line #<a class='line' href='#FLOCSEC.83'>83</a>; Trk Free <a class='x' href='#FRESEC'>FRESEC</a>, Line #<a class='line' href='#FLOCSEC.183'>183</a>; Trk Allocation <span class="todo">todo</span>
345B:FF FF FF FF                                                                    ; [A0]=T1A The <b>smart</b> thing to have done would be to
345F:FF FF FF FF                                                                    ; [A4]=T1B put the VTOC and CATALOG on <a class='ts'>T0SF</a> - <a class='ts'>T0S1</a>
3463:FF FF FF FF                                                                    ; [A8]=T1C That way <b>both</b> a bootable and data disk would
3467:FF FF FF FF                                                                    ; [AC]=T1D get an extra 16 sectors of free disk space.
346B:FF FF FF FF                                                                    ; [B0]=T1E 
346F:FF FF FF FF                                                                    ; [B4]=T1F The <a class="file" href="#BOOTLDR">BOOTLDR</a> would just need to move the
3473:FF FF FF FF                                                                    ; [B8]=T20 disk head to track <a class='ts'>T1</a> and continue loading as normal.
3477:FF FF FF FF                                                                    ; [BC]=T21 
347B:FF FF FF FF                                                                    ; [C0]=T22 (Normal last 35th accessible track)
347F:FF FF FF FF                                                                    ; [C4]=T23 (Extra 36th track)
3483:FF FF FF FF                                                                    ; [C8]=T24 (Extra 37th track)
3487:FF FF FF FF                                                                    ; [CC]=T25 (Extra 38th track)
348B:FF FF FF FF                                                                    ; [D0]=T26 (Extra 39th track)
348F:FF FF FF FF                                                                    ; [D4]=T27 (Extra 40th track)
3493:FF FF FF FF                                                                    ; [D8]=T28
3497:FF FF FF FF                                                                    ; [DC]=T29 <a class='mem' name='_3497'>wastes</a> 40 bytes [$D8..$FF] = $28
349B:FF FF FF FF                                                                    ; [E0]=T2A          *note* Tracks 41+ are not accessible
349F:FF FF FF FF                                                                    ; [E4]=T2B                 on any drive that I know of.
34A3:FF FF FF FF                                                                    ; [E8]=T2C                 That's not to say that they <i>don't</i>
34A7:FF FF FF FF                                                                    ; [EC]=T2D                 exist but basic engineering and repair
34AB:FF FF FF FF                                                                    ; [F0]=T2E                 should tell us that accessing
34AF:FF FF FF FF                                                                    ; [F4]=T2F                 more then 40 tracks is not possible.
34B3:FF FF FF FF                                                                    ; [F8]=T30
34B7:FF FF FF FF                                                                    ; [FC]=T31 (Extra 50th track)
                    051 ;
                    052 ;VOLUME DIRECTORY AREA                                      ; 
                    053 ;                                                           ; [--] <a class='ts'>T11SF</a> offsets === <a class='section' name='CATALOG'>CATALOG</a> ===
<hr>                    054 <a class="d" name="VOLDIR"   >VOLDIR      </a>EQU *           ;                               ; === Page <a class="page" name="page87">87</a> ===
34BB:02             055 <a class="d" name="VDTCDE"   >VDTCDE      </a>DFB 2           ; VOLUME DIRECTORY TYPE CODE    ; [00] <a class='struct' name='_34BB'>wastes</a> 1 byte -- and not even used !?!?!
                                                                                    ; <a class='magic' name='_34BC'>magic number</a> /sarcasm If only <span class='code'>FILESYSTEM_TYPE_CATALOG EQU $02</span>
34BC:FD             056 <a class="d" name="VDLTRK"   >VDLTRK      </a>DS 1            ; VD LINK TRACK                 ; [01] ($11)
34BD:FC             057 <a class="d" name="VDLSEC"   >VDLSEC      </a>DS 1            ; VD LINK SECTOR                ; [02] ($0E)
34BE:FC             058 <a class="d" name="VDNF"     >VDNF        </a>DS 1            ; VD NUMBER FILES THIS SECTOR   ; [03] <a class='struct' name='#_34BE'>wastes</a> 1 byte -- never referenced
34BF:FC FD FC FD    059 <a class="d" name="VDSPAR"   >VDSPAR      </a>DS 7            ; SPARES                        ; [04] <a class='struct' name='#_34BF'>wastes</a> 7 bytes -- never referenced
34C3:FD FC FC       060 ;                                                           ;      /sarcasm Glad to see this was put to <i>good</i> use ... NOT!
                    061 <a class="d" name="VDFILE"   >VDFILE      </a>EQU *           ; FILE ALLOCATION AREA (7 FILES); [0B] NO, this is the _not_ the allocation; this is the *meta* data
                    062 ;EACH FILE:                                                 ; What can't do <span class='code'>DSECT VDFILE</span> *note* indented "struct FileEntry" for readability
                    063 ;  FILE DIR TRK                                             ;     DFB CAT_FILE_TRACK    ;[00] (0) inode (FILDIR) track
                    064 ;  FILE DIR SECTOR                                          ;     DFB CAT_FILE_SECTOR   ;[01] (1) inode (FILDIR) sector
                    065 ;  FILE USE CODE                                            ;     DFB CAT_FILE_TYPE     ;[02] (2)
                    066 ;  FILE NAME         (30)                                   ;     DS  CAT_FILE_NAME     ;[03] (3) <b>WTF</b> -- sizeof( FileEntry ) == 35 bytes; make it 27
                    067 ;  FILE SECTOR COUNT (2)                                    ;     DW  CAT_FILE_NUM_SEC  ;[21] (33) so entire struct is 32 bytes
34C6:FC FF          068             ORG VOLDIR+256                                  ; <a class='mem' name='_34BC'>wastes</a> 256 bytes of disk space <b>spanning two sectors</b> *<a class="dumb" href="https://c1.staticflickr.com/3/2536/3904932487_54cce78f13.jpg">double facepalm</a>* 
34C8:FC FC FD FC
34CC:FC FC FE FC
34D0:FF FC FC FF
34D4:FF FD FF FF
34D8:FE FF FD FC
34DC:FE FC FC FC
34E0:FC FE FE FE
34E4:FC FD FC FE
34E8:FC FE FC FC
34EC:FF FC FC FC
34F0:FD FC FD FD
34F4:FC FC FF FC
34F8:FD FD FF FD
34FC:FE FC FD FD
3500:FC FE FF FC                                                                    ; === <a class='ts' href='#T2D4'>T2S4</a> ===
3504:FC FF FC FF
3508:FE FD FE FC                                                                    ; /sarcasm Who cares, we have 140KB, right!
350C:FC FD FC FD
3510:FE FC FC FC
3514:FC FF FD FC
3518:FF FC FC FC
351C:FC FF FC FC
3520:FC FD FC FC
3524:FD FC FE FF
3528:FE FC FC FC
352C:FF FC FC FC
3530:FC FD FC FC
3534:FC FC FC FD
3538:FE FE FD FE
353C:FD FF FC FE
3540:FE FC FE FD
3544:FC FD FD FE
3548:FF FE FC FF
354C:FC FF FC FC
3550:FD FC FC FF
3554:FC FF FF FC
3558:FC FC FD FC
355C:FE FC FC FD
3560:FC FE FC FE
3564:FC FD FC FC
3568:FD FC FE FD
356C:FD FC FC FC
3570:FC FC FD FF
3574:FF FC FD FD
3578:FC FC FE FC
357C:FC FF FC FC
3580:FE FD FC FE
3584:FE FC FD FC
3588:FC FF FD FD
358C:FF FC FC FF
3590:FC FD FE FC
3594:FC FF FC FF
3598:FC FC FF FC
359C:FC FD FC FE
35A0:FD FC FC FC
35A4:FC FC FD FC
35A8:FE FE FE FD
35AC:FE FF FE FC
35B0:FC FC FC FD
35B4:FC FC FC FD
35B8:FC FD FE
                    069 <a class='d' name='VDEND'      >VDEND       </a>EQU *
                    070 <a class='d' name='VDLEN'      >VDLEN       </a>EQU *-VOLDIR                                   ; $35BB - $34BB = 256
                    071 <a class='d' name='VDFLEN'     >VDFLEN      </a>EQU *-VDFIL                                    ; $35BB - $34C6 = $F5
                    072 ;
                    073             PAGE
                    074 ;
                    075 ;COMMAND CONTROL BLOCK (CCB)
                    076 ;
                    077 <a class='d' name='CCB'        >CCB         </a>EQU *                                           ;$B5BB CCB Buffer; FM = File Manager
35BB:FD             078 <a class='d' name='CCBREQ'     >CCBREQ      </a>DS 1        ; USER REQUEST BYTE                 ; [0] FM_Command = 0, See GetCCBAdr aka <a class='x' href='#CCBLDR'>CCBLDR</a>
                    079 <a class='e' name='CRQNUL'     >CRQNUL      </a>EQU 0
                    080 <a class='e' name='CRQOPN'     >CRQOPN      </a>EQU 1
                    081 <a class='e' name='CRQCLS'     >CRQCLS      </a>EQU 2
                    082 <a class='e' name='CRQRD'      >CRQRD       </a>EQU 3
                    083 <a class='e' name='CRQWR'      >CRQWR       </a>EQU 4
                    084 <a class='e' name='CRQDEL'     >CRQDEL      </a>EQU 5
                    085 <a class='e' name='CRQDIR'     >CRQDIR      </a>EQU 6
                    086 <a class='e' name='CRQLCK'     >CRQLCK      </a>EQU 7
                    087 <a class='e' name='CRQUNL'     >CRQUNL      </a>EQU 8
                    088 <a class='e' name='CRQRNM'     >CRQRNM      </a>EQU 9
                    089 <a class='e' name='CRQPOS'     >CRQPOS      </a>EQU 10
                    090 <a class='e' name='CRQFMT'     >CRQFMT      </a>EQU 11
                    091 <a class='e' name='CRQVAR'     >CRQVAR      </a>EQU 12
                    092 <a class='e' name='CRQMAX'     >CRQMAX      </a>EQU 13
                    093 ;
                    094 <a class='d' name='CCBBSA'     >CCBBSA      </a>EQU *
35BC:FD             095 <a class='d' name='CCBRQM'     >CCBRQM      </a>DS 1                                            ; [1] FM_RequestMod = 1 (SubCommand)
                    096 <a class='e' name='CRMNUL'     >CRMNUL      </a>EQU 0
                    097 <a class='e' name='CRMNBT'     >CRMNBT      </a>EQU 1
                    098 <a class='e' name='CRMNBL'     >CRMNBL      </a>EQU 2
                    099 <a class='e' name='CRMSBT'     >CRMSBT      </a>EQU 3
                    100 <a class='e' name='CRMSBL'     >CRMSBL      </a>EQU 4
                    101 <a class='e' name='CRMMAX'     >CRMMAX      </a>EQU 5
                    102 ;
                    103 <a class='d' name='CCBBYT'     >CCBRRN      </a>EQU *                                           ; Relative Record Number, see <a class='x' href='#LOCSEC'>LOCSEC</a>
                    104 <a class='d' name='CCBBYT'     >CCBFN2      </a>EQU *                                           ; Address of FileNameDst
35BD:FD FC          105 <a class='d' name='CCBBYT'     >CCBRLN      </a>DS 2                                            ; [2] FM_RelRecordNum
                    106 ;
                    107 <a class='d' name='CCBBYT'     >CCBBYT      </a>EQU *
35BF:FC             108 <a class='d' name='CCBVOL'     >CCBVOL      </a>DS 1                                            ; [4] FM_Volume
35C0:FD             109 <a class='d' name='CCBDRV'     >CCBDRV      </a>DS 1                                            ; [5] FM_Drive
                    110 ;
                    111 <a class='d' name='CCBBLN'     >CCBBLN      </a>EQU *                                           ; FM_BLockLength
35C1:FF             112 <a class='d' name='CCBSLT'     >CCBSLT      </a>DS 1                                            ; [6] FM_Slot
35C2:FD             113 <a class='d' name='CCBFUC'     >CCBFUC      </a>DS 1                                            ; [7] FM_FileUseCode (File Type), See <a class='x' href='#TSTFUC'>TSTFUC</a>, <a class='x' href='#FRNME'>FRNME</a>
                    114 ;
                    115 <a class='d' name='CCBFN1'     >CCBFN1      </a>EQU *           ; OPEN, DELETE, LOCK, UNLOCK, RENAME - FILENAME
<hr>                    116 <a class='d' name='CCBBBA'     >CCBBBA      </a>EQU *           ; BLOCKK I/O - BLOCK BUFFER PTR ; === Page <a class='page' name='page88'>88</a> === **spelling* BLOCK
35C3:FC FD          117 <a class='d' name='CCBDAT'     >CCBDAT      </a>DS 2            ; BYTE I/O - DATA BYTE          ; [8]
                    118 ;
35C5:FD             119 <a class='d' name='CCBSTA'     >CCBSTA      </a>DS 1            ; RESULT STATUS                 ; [A] Return Code
                    120 <a class='e' name='CREFUN'     >CREFUN      </a>EQU 1           ; FCB UNALLOCATED
                    121 <a class='e' name='CRERR'      >CRERR       </a>EQU 2           ; CCB REQ RANGE ERR
                    122 <a class='e' name='CREMRE'     >CREMRE      </a>EQU 3           ; REQ MOD RANGE ERR
                    123 <a class='e' name='CREPRO'     >CREPRO      </a>EQU 4           ; WRITE PROTECT
                    124 <a class='e' name='CREEOF'     >CREEOF      </a>EQU 5           ; END OF FILE ON READ
                    125 <a class='e' name='CREFNF'     >CREFNF      </a>EQU 6           ; FILE NOT FOUND
                    126 <a class='e' name='CREVMM'     >CREVMM      </a>EQU 7           ; VOL MIS MATCH
                    127 <a class='e' name='CREIOE'     >CREIOE      </a>EQU 8           ; I/O ERR
                    128 <a class='e' name='CRENSA'     >CRENSA      </a>EQU 9           ; NO SECTORS AVAILABLE
                    129 <a class='e' name='CREFLK'     >CREFLK      </a>EQU 10          ; FILE LOCKED
                    130 ;
35C6:FD             131 <a class='d' name='CCBSM'      >CCBSM       </a>DDS 1           ; STATUS MODIFIER               ; [B] FM_WASTED1 <a class='mem' name='_35C6'>wastes</a> 1 byte; never used! Can't remove since middle of struct.
35C7:FF FC          132 <a class='d' name='CCBFCB'     >CCBFCB      </a>DDS 2           ; FCB PTR                       ; [C] FM_FCB_PTR
35C9:FC FC          133 <a class='d' name='CCBDBP'     >CCBDBP      </a>DDS 2           ; DIR BUF PTR                   ; [E] FM_DIR_PTR
35CB:FC FC          134 <a class='d' name='CCBSBP'     >CCBSBP      </a>DDS 2           ; SECTOR BUF PTR                ;[10] FM_SEC_PTR
35CD:FF FC FC FC    135 <a class='d' name='CCBSPR'     >CCBSPR      </a>DDS 4           ; SPARE                         ;[12] FM_WASTED2 <a class='mem' name='_35CD'>wastes</a> 4 bytes /sarcasm Someday, someday.
                    136 <a class='d' name='CCBLEN'     >CCBLEN      </a>EQU *-CCB       ; CCB LENGTH                    ;$16
                    137 <a class='d' name='CFCBAD'     >CFCBAD      </a>EQU CCBFCB
                    138 <a class='d' name='CFCBDR'     >CFCBDR      </a>EQU CCBDBP
                    139 <a class='d' name='CFCBSB'     >CFCBSB      </a>EQU CCBSBP
                    140             PAGE
                    141 ;
                    142 ;FILE CONTROL BLOCK (FCB) DEFINITION
                    143 ;DCB - FILE DATA CONTROL BLOCK
                    144 ;
                    145 <a class='f' name='FCB'      >FCB         </a>EQU *
                    146 ;
                    147 ;DATA CONTROL BLOCK
                    148 ;
                    149 FCBDCB      EQU *
35D1:FC             150 <a class='d' name='DCBFDT'     >DCBFDT      </a>DS 1            ; 1ST FILE DIRECTORY TRACK      ; [00]
35D2:FC             151 <a class='d' name='DCBFDS'     >DCBFDS      </a>DS 1            ; 1ST FILE DIRECTORY SECTOR     ; [01]
35D3:FF             152 <a class='d' name='DCBCDT'     >DCBCDT      </a>DS 1            ; CURRENT FILE DIRECTORY TRACK  ; [02]
35D4:FC             153 <a class='d' name='DCBCDS'     >DCBCDS      </a>DS 1            ; CURRENT FILE DIRECTORY SECTOR ; [03]
35D5:FC             154 <a class='d' name='DCBWRF'     >DCBWRF      </a>DS 1            ; WRITE REQD FLAG               ; [04]
                    155 ;$80=WRITE FILE DIR
                    156 ;$40=WRITE SECTOR DIR
35D6:FF             157 <a class='d' name='DCBTRK'     >DCBTRK      </a>DS 1            ; SECTOR TRACK ADR              ; [05]
35D7:FF             158 <a class='d' name='DCBSEC'     >DCBSEC      </a>DS 1            ; SECTOR ADR                    ; [06]
35D8:FE             159 <a class='d' name='DCBVDR'     >DCBVDR      </a>DS 1            ; VOL DIR REC                   ; [07] DEC by <a class='x' href='#FC1'>FC1</a>
35D9:FC             160 <a class='d' name='DCBVDI'     >DCBVDI      </a>DS 1            ; VOL DIR INDEX                 ; [08] <a class='x' href='#FNDFIL'>FNDFIL</a>: X = File entry offset in CATALOG sector, <a class='x' href='#FOPEN'>FOPEN</a>, <a class='x' href='#FCLOSE'>FCLOSE</a>
35DA:FC FE          161 <a class='d' name='DCBDMS'     >DCBDMS      </a>DS 2            ; MAX NO DIRECTORY SECTORS      ; [09]
35DC:FC FC          162 <a class='d' name='DCBDFS'     >DCBDFS      </a>DS 2            ; CURRENT DIR 1ST REL SECTOR    ; [0B]
35DE:FF FC          163 <a class='d' name='DCBDNF'     >DCBDNF      </a>DS 2            ; REL SECTOR OF NXT DIR         ; [0D]
35E0:FE FC          164 <a class='d' name='DCBCMS'     >DCBCMS      </a>DS 2            ; SECTOR CURRENTLY IN MEMORY    ; [0F]
35E2:FE FC          165 <a class='d' name='DCBSDL'     >DCBSDL      </a>DS 2            ; SECTOR DATA LENGTH            ; [11] 
35E4:FC FC          166 <a class="d" name="DCBCRS"     >DCBCRS      </a>DS 2            ; CURRENT RELATIVE SECTOR       ; [13] See <a class="x" href="#FVAR">FVAR</a>
35E6:FC FD          167 <a class="d" name="DCBCSB"     >DCBCSB      </a>DS 2            ; CURRENT SECTOR BYTE           ; [15] 
35E8:FC FF          168 <a class="d" name="DCBRCL"     >DCBRCL      </a>DS 2            ; RECORD LENGTH                 ; [17]
35EA:FC FC          169 <a class="d" name="DCBCRR"     >DCBCRR      </a>DS 2            ; CURRENT RELATIVE REC          ; [19]
35EC:FC FF          170 <a class="d" name="DCBCRB"     >DCBCRB      </a>DS 2            ; CURRENT RELATIVE BYTE         ; [1B]
35EE:FC FC          171 <a class="d" name="DCBNSA"     >DCBNSA      </a>DS 2            ; NO SECTORS ALLOCATED          ; [1D]
                    172 ;
35F0:FD             173 <a class="d" name="DCBALS"     >DCBALS      </a>DS 1            ; ALLOCATION SECTOR BYTE        ; [1F]
35F1:FC             174 <a class="d" name="DCBATK"     >DCBATK      </a>DS 1            ; ALLOCATION TRACK              ; [20]
35F2:FE FE FF FC    175 <a class="d" name="DCBABM"     >DCBABM      </a>DS 4            ; ALLOCATION TRACK SECTOR BIT MAP;[21] <a class='struct' name='_35F2'>wastes</a> 2 bytes, See <a class="x" href="#FS3">FS3</a> and Line #<a class='line' href='#FLOCSEC.184'>184</a>
                    176 ;
35F6:FD             177 <a class="d" name="DCBFUC"     >DCBFUC      </a>DS 1            ; FILE USE CODE                 ; [25]
35F7:FF             178 <a class="d" name="DCBSLT"     >DCBSLT      </a>DS 1            ; SLOT NUMBER                   ; [26]
<hr>35F8:FC             179 <a class="d" name="DCBDRV"     >DCBDRV      </a>DS 1            ; DRIVE NUMBER                  ; [27] === Page <a class="page" name="page89">89</a> ===
35F9:FE             180 <a class="d" name="DCBVOL"     >DCBVOL      </a>DS 1            ; VOLUME DRIVER                 ; [28]
35FA:FD             181 <a class="d" name="DCBVTN"     >DCBVTN      </a>DS 1            ; VTOC TRACK NUMBER             ; [29] Why isn't this <span class='code'>DFB 17</span>?? See <a class='x' href='#F01A'>F01A</a>
                    182 ;
35FB:FC FD FC       183 <a class="d" name="DCBSPR"     >DCBSPR      </a>DS 3            ; SPARES                        ; [2A] <a class="mem" name="_35fb">wastes</a> 3 bytes, Zeroed via <a class="x" href="#DCBSUP">DCBSUP</a>, *unused*
                    184 ;
                    185 <a class="e" name="DCBLEN"     >DCBLEN      </a>EQU *-<a class="v" href="#FCBDCB">FCBDCB</a>    ; DCB LENGTH                    ;=$2D
                    <a class='line' name='FVCBUFS.186'>186</a> <a class="e" name="FCBLEN"     >FCBLEN      </a>EQU *-<a class="v" href="#FCB"   >FCB</a>       ; FCB LENGTH                    ; = $35FE - $35D1 = $2D
                    187 ;
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="BOOTLDR">BOOTLDR</a> - Boot loader, Page <a class="page" name="page8">8</a>, <a class='ts' href='#T0S0'>T0S0</a> - <a class='ts' href='#T0S1'>T0S1</a>, $<span class='n'>B5FE</span> .. $<span class='n'>B7FF</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR DOS BOOT'
                    002 <a class="d" name="HERE3L"     id="HERE3L"     >HERE3L      </a>EQU &gt;*                                          ; End of FVCBUFS = $35FD, * = $35FE
                    003 <a class="d" name="REMDR3"     id="REMDR3"     >REMDR3      </a>EQU 256-HERE3L                                  ; Remainder 2
35FE:FD FE          004             ORG *+<a class="v" href="#REMDR3">REMDR3</a>                                    ; <a class='mem' name='_35fe'>wastes</a> 2 bytes to page align BOOTLDR
                    005 <a class="d" name="TRK0LDR"    id="TRK0LDR"    >TRK0LDR     </a>EQU *
                    006     DO &gt;<a class="do" href="#TRK0LDR">TRK0LDR</a><span class="macro">
                    007         ???                 ;DELIBERATE ERROR IF NOT AT PAGE BOUNDARY</span>
                    008     FIN
                    009 ***************************
                    010 *                         *
                    011 * 16-SECTOR DOS BOOTSTRAP *
                    012 *                         *
                    013 *     RICK AURICCHIO      *
                    014 *       10/10/79          *
                    015 *                         *
                    016 ***************************
                    017 *                         *
                    018 * THIS PROGRAM RESIDES IN *
                    019 *  TRACK 0,SECTOR 0 OF A  *
                    020 *  DOS DISKETTE. ITS SOLE *
                    021 *  PURPOSE IS TO READ THE *
                    022 *  DOS LOADER PROGRAM IN  *
                    023 *  FROM TRACK 0, SECTORS  *
                    024 *  1-9. CONTROL IS THEN   *
                    025 *  TRANSFERRED TO THAT    *
                    026 *  PROGRAM.               *
                    027 *                         *
                    028 * NOTE: THE DOS LOADER    *
                    029 *  CONTAINS THE ENTIRE    *
                    030 *  SET OF 16-SECTOR CORE  *
                    031 *  ROUTINES; THOSE CORE   *
                    032 *  ROUTINES ARE USED TO   *
                    033 *  LOAD THE REST OF THE   *
                    034 *  DOS IMAGE INTO MEMORY. *
                    035 *                         *
                    036 ***************************
                    037 <a class="d" name="POINTA"   >POINTA      </a>EQU $26         ;BUFFER POINTER
                    038 <a class="d" name="BSLOT"    >BSLOT       </a>EQU $2B         ;BOOT BSLOT
                    039 <a class="d" name="BSECTR"   >BSECTR      </a>EQU $3D         ;LAST BSECTR READ
                    040 <a class="d" name="BTEMP"    >BTEMP       </a>EQU $3E         ;ADDRESS BTEMP
                    041 <a class="d" name="BRETRY"   >BRETRY      </a>EQU $5C         ;OFFSET TO READER
                    042 *
                    043 <a class="f" name="MONINIT"  >MONINIT     </a>EQU $<span class='e'>FB2F</span>       ;MONINIT SCREEN
                    044 <a class="d" name="BHERE3"   >BHERE3      </a>EQU &gt;*
                    045 <a class="d" name="BOOTCNT"  >BOOTCNT     </a>EQU $800+BHERE3
3600:01             046             DFB <span class='n'>01</span>                                          ; We <b>could</b> store $10 here to have the P6 PROM read <i>16 sectors</i> but nah,
                    047             PAGE                                            ; let's waste $839-$801 = $38 (56) bytes instead!
                    048             LDA <a class="d" href="#POINTA">POINTA</a>+1    ;WHERE DID BSECTR GET LOADED?   ;[.. <a class='mem' name='_3601'>wastes</a> 56 bytes; Get memory page of last load
                    049             CMP #<span class='n'>09</span>         ; (AT 0800)?                    ; ..
                    050             BNE <a class="x" href="#READNEXT">READNEXT</a>    ;=&gt;NO. WE'RE LOADING SOMETHING  ; ..
                    051 * WE'VE BEEN BOOTED. SET UP                                 ; ..
                    052 * PARAMS FOR BOOT PROM SO                                   ; ..
<hr>                    053 * THAT WE'LL READ IN TRACK 0,                               ; .. === Page <a class="page" name="page9">9</a> ===
                    054 * BSECTRS 00-09.                                            ; ..
                    055             LDA BSLOT       ;GET BOOT SLOT                  ; ..
                    056             LSR A           ;CONVERT TO CX00                ; ..
                    057             LSR A                                           ; ..
                    058             LSR A                                           ; ..
                    059             LSR A                                           ; ..
                    060             ORA #$<span class='n'>C0</span>                                        ; ..
                    061             STA BTEMP+<span class='n'>1</span>                                     ; ..
                    062             LDA #BRETRY     ; PROM ROUTINE OFFSET           ; ..
                    063             STA BTEMP                                       ; ..
                    064             CLC             ;BUMP LOAD ADDRESS UP TO        ; ..
                    065             LDA LOADADDR+<span class='n'>1</span>  ; LAST PAGE SO WE               ; ..
                    066             ADC BGRPGC      ;  CAN LOAD 'EM BACKWARDS       ; ..
                    067             STA LOADADDR+<span class='n'>1</span>                                  ; ..
                    068 * READ IN ANOTHER BSECTR FROM                               ; ..
                    069 *  TRACK ZERO...                                            ; ..
                    070 <a class='f' name='READNEXT' >READNEXT    </a>LDX BGRPGC                                      ; ..
                    071             BMI GOLOADER    ;=&gt;ALL DONE...EXECUTE IT!       ; ..
                    072             LDA TABLE,X     ;GET PHYSICAL BSECTR NUMBER     ; .. /sarcasm Real original name there guys
                    073             STA BSECTR      ; AND SET FOR BOOT PROM READ    ; ..          You couldn't call it <span class='code'>LOGSECTR</span> for Logical Sector??
                    074             DEC BGRPGC      ;ONE LESS BELL TO ANSWER...     ; ..
                    075             LDA LOADADDR+<span class='n'>1</span>  ;GET LOAD ADDRESS               ; ..
                    076             STA POINTA+<span class='n'>1</span>    ; FOR BSECTR READ               ; ..
                    077             DEC LOADADDR+<span class='n'>1</span>  ;MOVE LOAD ADDRESS DOWN A PAGE  ; ..
                    078             LDX BSLO        ;RESTORE BSLOT NUMBER           ; ..
                    079             JMP (BTEMP)     ;READ MORE OF TRACK 0           ; ..]
                    080 <a class='f' name='GOLOADER' >GOLOADER    </a>INC LOADADDR+<span class='n'>1</span>  ;ENTRY AT SECOND PAGE
                    081             INC LOADADDR+<span class='n'>1</span>
                    082             JSR <a class='x' href='#SETKBD'>SETKBD</a>      ;CLEAR IN#X
                    083             JSR <a class='x' href='#SETVID'>SETVID</a>      ; AND PR#X
                    084             JSR <a class='x' href='#MONINIT'>MONINIT</a>     ;MONINIT THE SCREEN PARAMS
                    085             LDX <a class='v' href='#BSLOT'>BSLOT</a>       ;PASS BSLOT NBR TO LOADER
                    086             JMP (LOADADDR)  ;OFF TO LOOADER!                ; *spelling* Loader
                    087 * TABLE OF PHYSICAL BSECTR NUMBERS
                    088 *  WHICH CORRESPOND TO THE LOGICAL
                    089 *  BSECTRS 0-F ON TRACK ZERO...
                    090 <a class='d' name='BHERE2'   >BHERE2      </a>EQU &gt;*                                          ; low byte (modern assemblers reverse this)
                    091 <a class='d' name='TABLE'    >TABLE       </a>EQU $800+BHERE2                                 ; Our native address is $3600 but also loaded at $0800
                                                                                    ;
                                                                                    ; This is one time where you <b>don't</b> want to compact lines
                                                                                    ; <b>Problem</b>: Compare &amp; contrast this clusterfrak
364D:00 0D 0B       092             DFB $<span class='n'>00</span>,<span class='n'>13</span>,<span class='n'>11</span>   ;00-&gt;00,01-&gt;13,02-&gt;11           ;    <i>WHY</i> is this grouped in triplets???    *sigh* inconsistent <span class='code'>$00</span> code
3650:09 07 05       093             DFB <span class='n'>09</span>,<span class='n'>07</span>,<span class='n'>05</span>    ;03-&gt;09,04-&gt;07;05-&gt;05           ;    We have a sector interleave of <b>two</b>!   *sigh* inconsistent: <span class='code'>;</span> comment
3653:03 01 0E       094             DFB <span class='n'>03</span>,<span class='n'>01</span>,<span class='n'>14</span>    ;06-&gt;03,07-&gt;01,08-&gt;14           ;    The last line having an even number
3656:0C 0A 08       095             DFB <span class='n'>12</span>,<span class='n'>10</span>,<span class='n'>08</span>    ;09-&gt;12,10-&gt;10,11-&gt;08           ;    of terms wasn't your first clue!?!
3659:06 04 02 0F    096             DFB <span class='n'>06</span>,<span class='n'>04</span>,<span class='n'>02</span>,<span class='n'>15</span> ;12-&gt;6,13-&gt;04,14-&gt;02,15-&gt;15     ;                                          *sigh* inconsistent <span class='code'>6</span> comment
                                                                                    ; <b>Solution</b>:
                                                                                    ;     LOG_TO_PHYS EQU *
                                                                                    ;                 DFB $0  ; [0]  0
                                                                                    ;                 DFB $D  ; [1] 13
                                                                                    ;                 DFB $B  ; [2] 11
                                                                                    ;                 DFB $9  ; [3]  9
                                                                                    ;                 DFB $7  ; [4]  7
                                                                                    ;                 DFB $5  ; [5]  5
                                                                                    ;                 DFB $3  ; [6]  3
                                                                                    ;                 DFB $1  ; [7]  1
                                                                                    ;                 DFB $E  ; [8] 14
                                                                                    ;                 DFB $C  ; [9] 12
                                                                                    ;                 DFB $A  ; [A] 10
                                                                                    ;                 DFB $8  ; [B]  8
                                                                                    ;                 DFB $6  ; [C]  6
                                                                                    ;                 DFB $4  ; [D]  4
                                                                                    ;                 DFB $2  ; [E]  2
                                                                                    ;                 DFB $F  ; [F] 15
                    097             PAGE
                    098             REP 40                                          ; alias ****************************************
                    099 * APPEND BUG PATCHES
                    100 ****************************
                    101 <a class='d' name='SC3'      >SC3         </a>EQU *
365D:00             102 <a class='d' name='EOFFLAG'  >EOFFLAG     </a>DFB <span class='n'>0</span>
                    103 <a class='f' name='CLOSFILE' >CLOSFILE    </a>EQU *
365E:20 64 27       104             JSR FILSRC      ;FILE BUFFER FOUND?
3661:B0 08          105             BCS NOTFOUND    ;=&gt; NO, SO SKIP IT.
3663:A9 00          106             LDA #<span class='n'>0</span>          ;YES, CLOSE IT
3665:A8             107             TAY
3666:8D 5D 36       108             STA EOFFLAG
3669:91 40          109             STA (ZPGWRK),Y  ;RIGHT NOW
366B:AD C5 35       110 <a class='f' name='NOTFOUND' >NOTFOUND    </a>LDA CCBSTA      ;ORIGINAL INSTRUCTION
366E:4C D2 26       111             JMP ERROR       ;BACK TO ERROR HANDLER
                    112 ****************************
                    113 <a class='f' name='BUMPER'   >BUMPER      </a>EQU *
3671:Ad 5D 36       114             LDA EOFFLAG     ;SHOULD WE?
3674:F0 08          115             BEQ GOBACK      ;=&gt; NO
<hr>3676:EE BD 35       116             INC <a class="v" href="#CCBRRN">CCBRRN</a>      ;BUMP CCB RECORD NUMBER         ; === Page <a class="page" name="page10">10</a>
3679:D0 03          117             BNE GOBACK
367B:EE BE 35       118             INC CCBRRN+<span class='n'>1</span>    ;TO GET TO NEXT SECTOR
367E:A9 00          119 GOBACK      LDA #<span class='n'>0</span>
3680:8D 5D 36       120             STA EOFFLAG     ;TURN FLAG OFF
3683:4C 46 25       121             JMP FIXIT2      ;Go to FIXIT2 as exit           ; Oh look, we have lowercase CapsLock on //e!
                    122             REP 40
                    123 VPATCH      EQU *
3686:8D BC 35       124             STA CCBRQM      ;ORIGINAL INSTRUCTION
3689:20 A8 26       125             JSR DOSGO       ;GO SAVE
368C:20 EA 22       126             JSR ECLOSE      ;CLOSE THE FILE
368F:4C 7D 22       127             JMP EVAR        ;GO VERIFY IT AFTER SAVE
                    128 ****************************
                    129 EOFFIX      EQU *
3692:A0 13          130             LDY #$<span class='n'>13</span>        ;PEEK INTO THE FCB: IF          ; <a class='magic' name='_'>magic number</a> <span class='code'>FCB_CUR_REL_SEC</span>
3694:B1 42          131 CHKFILE     LDA (ZPGFCB),Y  ;DCBCRS,DCBCSB ARE ZEROS,
3696:D0 14          132             BNE FIXIT       ; THEN WE HAVE EMPTY FILE
3698:C8             133             INY
3699:C0 17          134             CPY #$<span class='n'>17</span>                                        ; <a class='magic' name='_'>magic number</a> <span class='code'>FCB_REC_LEN</span>
369B:D0 F7          135             BNE CHKFILE
369D:A0 19          136             LDY #$<span class='n'>19</span>                                        ; <a class='magic' name='_'>magic number</a> <span class='code'>FCB_CUR_REL_REC</span>
369F:B1 42          137 MOVE        LDA (ZPGFB),Y   ; DCBCRR,DCBCRB
36A1:99 A4 35       138             STA CCBRRN-$<span class='n'>19</span>,Y;INTO CCBRRN,CCBBYT             ; <a class='magic' name='_'>magic number</a> <span class='code'>FCB_CUR_REL_REC</span>
36A4:C8             139             INY
36A5:C0 1D          140             CPY #$<span class='n'>1D</span>                                        ; <a class='magic' name='_'>magic number</a> <span class='code'>FCB_NUM_SEC_ALLOC</span>
36A7:D0 F6          141             BNE MOVE
36A9:4C BC 26       142 BACK        JMP DOSGO2A     ;NOW LET APPEND CONTINUE
                    143 FIXIT       EQU *
36AC:A2 FF          144             LDX #$<span class='n'>FF</span>        ;SET FLAG SO APPEND WILL        ; <a class='magic' name='_'>magic number</a> <span class='code'>FLAG_EOF_SEC_BOUNDARY EQU $0</span>
36AE:8E 5D 36       145             STX EOFFLAG     ;KNOW TO CROSS SECTOR BOUNDARY
36B1:D0 F6          146             BNE BACK        ;ALWAYS TAKEN                   ; &uarr;
                    147             PAGE
                    148             REP 40
                    149 * END OF BOOT PAGE DATA SETUP
                    150             REP 40
                    151 *
                    152 * FIXIT2 was developed to fix the wrap around
                    153 * problem APPEND has when trying to APPEND to
                    154 * a sequential file which is &gt; 255 sectors in length.
                    155 *
                    156 *                  Fix by
                    157 *
                    158 *              Fern Bachman
                    159 *               Guil Banks
                    160 *           September 28, 1982
                    161 *
                    162 * Fix to fix added to correctly APPEND to a SECTOR
                    163 * 255 bytes in length
                    164 *
                    165 *                    by
                    166 *                Guil Banks
                    167 *               July 11, 1983
                    168 *
                    169             REP 30
                    170             SKP 1
                    171 FIXIT2      EQU *
                    172             LDA CCBRLN      ;Current record length lo
                    173             STA DCBCSB      ;Current sector byte
                    174             STA DCBCRR      ;Current relative record
                    175             LDA CCBRLN+1    ;Do hi as well
                    176             STA DCBCSB+1
                    177             STA DCBCRR+1
                    178             STA DCBCRS      ;Set current relative sector
<hr>                    179             TSX                                             ; === Page <a class="page" name="page11">11</a> ===
                    180             STX ENTSTK
                    181             JMP GOODIO
                    182             SKP 2
                    183             REP 30
                    184 *
                    185 *   Upper/Lower case patch
                    186 *   for DOS 3.3C and BASIC
                    187 *
                    188 *            by
                    189 *        Guil Banks
                    190 *        Mark Houde
                    191 *
                    192             REP 10
                    193 *
                    194 * This routine converts all characters
                    195 * that are not between quotes to
                    196 * upepr case and returns them to the
                    197 * input buffer ($200). This works with
                    198 * DOS, Integer &amp; Applesoft.
                    199 *
                    200 * Upon entry -
                    201 *
                    202 *              X Reg = 0
                    203 *
                    204 * Upon exit -
                    205 *
                    206 *              Y Reg = $FF
                    207 *              ACCUM = $8D
                    208 *              X Reg = unknown
                    209 *
                    210             REP 30
                    211             DO <a class='do' href='#ULC'>ULC</a><span class='macro'>
                    212 UPRCASE     EQU *                                           
                    213 LUP1        LDA LBUFF,X     ;Get a char                     
                    214             CMP #'"+$80     ;Is it a quote?                 
                    215             BNE CHK4UC      ;=&gt; if not                      
                    216 LUP2        INX             ;Bump to next char              
                    217             LDA LBUFF,X     ;Get it                         
                    218             CMP #'"+$80     ;Closing quote?                 
                    219             BEQ NEXTCHR     ;=&gt; if so                       
                    220             CMP #$<span class='n'>8D</span>        ;End of Line?                   ; <a class='magic' name='_'>magic number</a> KEY_CR
                    221             BNE LUP2        ;=&gt; if not                      
                    222 ULFINI      LDY #$FF        ;Do what DOS wants              
                    223             STY CMDNO                                       
                    224             RTS             ;   &amp; exit                      
                    225 CHK4UC      EQU *                                           
                    226             CMP #$E0        ;Upper case?                    
                    227             BCC CHK4CR      ;=&gt; if not                      
                    228             AND #$DF        ;Make upper case                
                    229             STA LBUFF,X     ;   &amp; restore                   
                    230 CHK4CR      CMP #$<span class='n'>8D</span>,X      ;End of input?                  ; <a class='magic' name='_'>magic number</a> KEY_CR
                    231             BEQ ULFINI      ;=&gt; if so                       
                    232 NEXTCHR     INX             ;Bump to next char              
                    233             BNE LUP1        ;=&gt; always                      </span>; &uarr; No, not always, 256 times
                    234             FIN                                             ; Patch incomplete! Where is the <span class='code'>RTS</span>??? Called from <a class='x' href='#SCNCMD'>SCNCMD</a>
                    235             SKP 1
                    236 BHERE1      EQU &gt;*
36B3:00             237             DS $FD-BHERE1,0                                 ;[.. <a class='mem' name='_36B3'>wastes</a> 74 bytes ($36FD-$36B3=$4A)
36B4:00 00 00 00                                                                    ; ..
36B8:00 00 00 00                                                                    ; ..
36BC:00 00 00 00                                                                    ; ..
36C0:00 00 00 00                                                                    ; ..
36C4:00 00 00 00                                                                    ; ..
36C8:00 00 00 00                                                                    ; ..
36CC:00 00 00 00                                                                    ; ..
36D0:00 00 00 00                                                                    ; .. DOS 3.3A (Jan. 1980) has a secret message @ 36D0 ($B6D0): "B01-00"
36D4:00 00 00 00                                                                    ; ..   JSR HOME        ; $FC58
36D8:00 00 00 00                                                                    ; ..   LDA #'B'+$80    ;   $C2
36DC:00 00 00 00                                                                    ; ..   JSR COUT        ; $FDED
36E0:00 00 00 00                                                                    ; ..   LDA #$01        ;
36E4:00 00 00 00                                                                    ; ..   JSR PRBYTE      ; $FDDA
36E8:00 00 00 00                                                                    ; ..   LDA #'-'+$80    ;   $AD
36EC:00 00 00 00                                                                    ; ..   JSR COUT        ; $$FDED
36F0:00 00 00 00                                                                    ; ..   LDA #$00
36F4:00 00 00 00                                                                    ; ..   JMP PRBYTE      ; $FDDA
36F8:00 00 00 00                                                                    ; ..
36FC:00                                                                             ; ..]

                    238 * LOAD ADDRESS FOR CODE (PG BDY)
                    239 * ENTRY AFTER BOOT IS AT LOADADDR+256 (SECOND PAGE LOADED)
                    240 *
                    241 BHERE4      EQU &gt;*
<hr>                    242 LOADADDR    EQU $<span class='n'>800</span>+BHERE4                                 ; === Page <a class="page" name="page12">12</a> ===
36FD:00             243             DFB <span class='n'>0</span>
36FE:36             244 GRSPG       DFB &lt;<a class='v' href='#TRK0LDR'>TRK0LDR</a>        ;CONTAINS PAGE#-1 OF TRK 0, SEC 1 LOAD ADDRESS
                    245 * LAST LOGICAL BSECTOR TO READ STARTING AT $00
                    246 BHERE5      EQU &gt;*
36FF:09             247 BGRPGC      EQU $<span class='n'>800</span>+BHERE5
                    248 GRPGC       DFB &lt;<a class='v' href='#ENDOFDOS'>ENDOFDOS</a>-<a class='v' href='#TRK0LDR'>TRK0LDR</a>-$<span class='n'>100</span>
                    249 ********************
                    250             PAGE
                    251 DOSLODR     EQU *
                    252             DO &gt;<a class='do' href='#DOSLODR'>DOSLODR</a><span class='macro'>
                    253             ???             ;ERROR IF NOT ON PAGE BOUNDARY  </span>
                    254             FIN
                    255             REP 40
                    256 * FAST BOOT AT 2:1 INTERLEAVE                               ; "<i>You keep using this word fast,</i>
                    257 * FOR 16-SECTOR DISKETTES                                   ;  <i>it doesn't mean what you think it means.</i>"
                    258             REP 40                                          ; Copy ][+ has a FAST boot via 4&amp;4 encoding, not 6&amp2;2 encoding.
3700:8E E9 37       259             STX IBSLOT      ; SET BOOT SLOT                 ; === <a class='ts' href='#T0S1'>T0S1</a> ===
3703:8E F7 37       260             STX IBPSLT      ; SET PREVIOUS SLOT
3706:A9 01          261             LDA #<span class='n'>1</span>          ; SET PREV DRIVE                ; <i>Assumes</i> boot was from drive 1; Sadly there is no hardware support to tell.
3708:8D F8 37       262             STA IBPDRV                                      ; More crappy names differing by a single letter
370B:8D EA 37       263             STA IBDRVN                                      ;     IBPDRV    IB_PRV_DRV
                    264 ;                                                           ;     IBDRVN    IB_CUR_DRV
370E:AD E0 37       265             LDA NDPGS       ; COPY NO PAGES TO GET
3711:8D E1 37       266             STA BRWCNT
3714:A9 02          267             LDA #<span class='n'>2</span>
                    268             STA IBTRK       ; SET TRACK 0                   ; Uhm, T2S4, not T0S4
                    269             LDA #<span class='n'>4</span>          ;ENDING SECTOR OF DOS IMAGE
                    270             STA IBSECT      ;TO IOB
                    271             LDY ADOSLD+<span class='n'>1</span>    ;END PAGE OF DOS IMAGE
                    272             DEY             ;IS ONE LESS THAN
                    273             STY IBBUFP+<span class='n'>1</span>    ;START OF DOSLDR+BOOT
                    274 ;
                    275             LDA #IBCRTS     ; SET READ
                    276             STA IBCMD
                    277 ;
                    278             TXA             ; SET PREV TRACK = 0
                    279             LSR A
                    280             LSR A
                    281             LSR A
                    282             LSR A
                    283             TAX
                    284             LDA #<span class='n'>0</span>
3732:9D F8 04       285             STA $<span class='n'>4F8</span>,X                                      ; <a class='magic' name='_3733'>magic number</a> The 40x24 text screen has "memory holes"
3735:9D 78 04       286             STA $<span class='n'>478</span>,X                                      ; <a class='magic' name='_3736'>magic number</a> reserved for each Slot 1..7 as "scratchpad" or temp vars
3738:20 93 27       287             JSR BOOTIO      ; GO READ DOS
                    288 ;
                    <a class='line' name='BOOTLDR.289'>289</a> ;DOSINT - INITIALIZE DOS                                    ; /sarcasm Couldn't afford extra 'i' in "dosinIt"
                    290 ;
                    291 <a class="f" name="DOSINT"   >DOSINT      </a>EQU *                                            ; Ironically in Boot Loader, not Dos Init
373B:A2 FF          292             LDX #$<span class='n'>FF</span>
373D:9A             293             TXS
373E:8E EB 37       294             STX IBVOL
3741:4C C8 3F       <a class='line' name='BOOTLDR.295'>295</a>             JMP <a class="x" href="#RCPATCH">RCPATCH</a>
3744:20 89 FE       296 <a class="f" name="RCBACK"   >RCBACK      </a>JSR SETKBD
                    297 ;
3747:4C 84 1D       <a class='line' name='BOOTLDR.298'>298</a> <a class="f" name="DI3"      >DI3         </a>JMP <a class="x" href="#DOSREL">DOSREL</a>      ; GO TO POST INIT ROUTINE       ; Relocate DOS to high mem
                    299             PAGE
                    300 <a class='f' name='WBOOT'    >WBOOT       </a>EQU *                                           ; Write Boot; part of the INIT process
                    301             LDA ADOSLD+<span class='n'>1</span>
                    302             SEC
                    303             SBC IBBUFP+<span class='n'>1</span>
<hr>                    304             STA BRWCNT      ;COMPUT PAGE COUNT              ; === Page <a class='page' name='page13'>13</a> === *spelling* Compute
                    305             LDA ADOSLD+<span class='n'>1</span>
                    306             STA IBBUFP+<span class='n'>1</span>    ;BUFFER=LAST PAGE OF RWTS
                    307             DEC IBBUFP+<span class='n'>1</span>
                    308             LDA #<span class='n'>2</span>                                          ; <a class='magic' name='_????'>magic number</a> <span class='todo'>TODO</span> sizeof( PROGRAM ) / 16
                    309             STA IBTRK       ;ENDING TRACK
                    310             LDA #<span class='n'>4</span>
                    311             STA IBSECT      ;ENDING SECTOR
3767:A9 02          312             LDA #<span class='n'>2</span>                                          ; <a class='magic' name='_????'>magic number</a> Why not <span class='code'>IBCWTS</span> ???
3769:8D F4 37       313             STA IBCMD       ;COMMAND = WRITE
376C:20 93 37       314             JSR BOOTIO      ;WRITE DOS IMAGE TRK 2, SEC 4
                    315 *                           ;BACKWARDS TO TRK 0,SEC C
                    316             LDA ADOSLD+<span class='n'>1</span>
                    317             STA GRSPG       ;BOOTSTRAP LOAD ADDRESS
                    318             CLC
                    319             ADC #<span class='n'>9</span>
                    320             STA IBBUFP+<span class='n'>1</span>    ;BUFFER ADDRESS OF END OF BOOT
                    321             LDA #<span class='n'>10</span>
                    322             STA BRWCNT      ;SECTOR COUNT TO WRITE          ; /sarcasm If only <span class='code'>NUM_SEC_WRITE</span>
                    323             SEC
                    324             SBC #<span class='n'>1</span>
                    325             STA GRPGC       ;BOOT LAST SECTOR #
                    326             STA IBSECT      ;START AT END OF RWTS&amp;BOOT
                    327             JSR BOOTIO      ;AND WRITE DOWN TO ZERO
378C:60             328             RTS
378D:00 00 00 00    329             DS <span class='n'>6</span>,<span class='n'>0</span>          ;FILL WITH BRKS                 ; <a class='mem' name='_378D'>wastes</a> 6 bytes -- WHY ???
3791:00 00          330             PAGE
                    331 <a class='f' name='BOOTIO'   >BOOTIO      </a>EQU *
3793:AD E5 37       332             LDA BAIOB+<span class='n'>1</span>                                     ; <a class='mem' name='_3793'>wastes</a> 3 bytes; <a class='v' href='#BAIOB'>BAIOB</a> &rarr; <a class='v' href='#IOB'>IOB</a>, <span class='code'>JSR <a class='x' href='#IOBLDR'>IOBLDR</a></span> loads <a class='v' href='#AIOB'>AIOB</a> &rarr; <a class='v' href='#IOB'>IOB</a>
3796:AC E5 37       333             LDY BAIOB
3799:20 B5 37       334             JSR DISKIO
                    335 ;
                    336             LDY IBSECT      ; GET SECTOR
                    337             DEY             ; DECREMENT TO NEXT             ; Stupid Commenting - stop treating the reader as a moron
                    338             BPL BIO1        ;AT END OF TRACK?               ; See now this is a useful comment in contradistinction to the one above
                    339             LDY #<span class='n'>15</span>         :SET TO SECTOR 15               ; as it tells us WHY we are branching
37A4:EA             340             NOP                                             ; [.. <a class='mem' name='_37A4'>wastes</a> 2 bytes
37A5:EA             341             NOP                                             ;  ..]
                    342             DEC IBTRK
                    343 BI01        STY IBSECT      ; SET NEXT SECTOR
                    344 ;
                    345             DEC IBBUFP+<span class='n'>1</span>    ; DECREMENT BUFFER POINTER
                    346             DEC BRWCNT      ; DECREMENT PAGE COUNTER
                    347             BNE BOOTIO      ; BR IF NOT DONE
                    348             RTS
                    349 ;
                    350             PAGE
                    351 DISKIO      PHP             ;SAVE INTERUPT STATUS           ; *spelling* Interrupt
                    352             SEI             ;INHIBIT INTERUPT WHILE         ; *spelling* Interrupt
                    353             JSR RWTS        ; ACCESSING DISK
                    354             BCS DSKERR      ;MUST PASS BACK CARRY FLAG &amp; INTERUPT      ; *spelling* Interrupt
                    355             PLP
                    356             CLC
                    357             RTS
37BF:28             358 DISKERR     PLP             ;CARRY SET MEANS ERROR
37C0:38             359             SEC
37C1:60             360             RTS
37C2:AD BC 35       361 DLDSUP      LDA CCBBSA      ;SET UP FOR DOS LOADER
                    362             STA IBBUFP+<span class='n'>1</span>    ;START ADDRESS
                    363             LDA #<span class='n'>0</span>
                    364             STA IBBUFP
                    365             LDA DCBVOL      ;INVERT VOLUME NUMBER
<hr>                    366             EOR #$<span class='n'>FF</span>                                        ; === Page <a class='page' name='page14'>14</a> ===
                    367             STA IBVOL
                    368             RTS
                    369 ;
37D6:A9 00          370 CLRSEC      LDA #<span class='n'>0</span>          ;CLEAR SECTOR
37D8:A8             371             TAY
37D9:91 41          372 CS1         STA (ZPGFCB),Y
37DB:C8             373             INY
37DC:D0 FB          374             BNE CS1
37DE:60             375             RTS
37DF:00             376             BRK                                             ; <a class='mem' name='_37DF'>wastes</a> 1 byte -- Why???
                    377 EC3         EQU *
37E0:1B             378 NDPGS       DFB &lt;<a class='v' href='#TRK0LDR'>TRK0LDR</a>-<a class='x' href='#BEGIN'>BEGIN</a> ;CALC #PAGES IN DOS WITHOUT RWTS
37E1:00             379 BRWCNT      DFB <span class='n'>0</span>           ;WRK CTR FOR BOOTIO
37E2:0A             380             DFB $<span class='n'>0A</span>                                         ;[.. <a class='mem' name='_37E2'>wastes</a> 2 bytes -- never used!
37E3:1B             381             DFB $<span class='n'>1B</span>                                         ; ..] 
37E4:E8 37          382 <a class='d' name='BAIOB'    >BAIOB       </a>DW <a class='v' href='#IOB'>IOB</a>                                          ; <a class='v' href='#BAIOB'>BAIOB</a> and <a class='v' href='#AIOB'>AIOB</a> both point to <a class='v' href='#IOB'>IOB</a>
37E6:00 36          383 ADOSLD      DW <a class='v' href='#TRK0LDR'>TRK0LDR</a>
                    384             PAGE
                    385 ;
                    386 IOB - INPUT / OUTPUT CONTROL BLOCK
                    387 ;THE IOB IS USED FOR THE INTERFACE
                    388 ;BETWEEN DOS AND THE DISK I/O ROUTINES
                    389 ;
                    390 <a class='e' name='IOB'      >IOB         </a>EQU *                                           ;    Descriptive Names
37E8:01             391 <a class='d' name='IBTYPE'   >IBTYPE      </a>DFB <span class='n'>1</span>           ; IOB TYPE CODE                 ; [0] IOB_OFFSET_TYPE <a class='struct' name='_37e8'>wastes</a> 1 bytes, hard-coded to 1 in <a class='file' href='#FLOCNXB'>FLOCNXB</a>, Line #<a class='line' href='#FLOCNXB.095'>95</a> !
37E9:60             392 <a class='d' name='IBSLOT'   >IBSLOT      </a>DFB <span class='n'>6</span>*<span class='n'>16</span>        ; CONTROLELR SLOT NO.           ; [1] IOB_OFFSET_SLOT
37EA:01             393 <a class='d' name='IBDRVN'   >IBDRVN      </a>DFB <span class='n'>1</span>           ; DRIVE NUMBER                  ; [2] IOB_OFFSET_DRV_NUM
37EB:00             394 <a class='d' name='IBVOL'    >IBVOL       </a>DFB $<span class='n'>00</span>         ; VOLUME NUMBER                 ; [3] IOB_OFFSET_VOL
37EC:00             395 <a class='d' name='IBTRK'    >IBTRK       </a>DFB <span class='n'>0</span>           ; TRACK NUMBER                  ; [4] IOB_OFFSET_TRK
37ED:00             396 <a class='d' name='IBSECT'   >IBSECT      </a>DFB <span class='n'>0</span>           ; SECTOR NUMBER                 ; [5] IOB_OFFSET_SEC
37EE:FB 37          397 <a class='d' name='IBDCTP'   >IBDCTP      </a>DW <span class='v' href='#DCT'>DCT</a>                                          ; [6] IOB_OFFSET_DCT   Why is the Device Characteristics Table
37F0:00 00          398 <a class='d' name='IBBUFP'   >IBBUFP      </a>DW <span class='n'>0</span>            ; POINTER TO BUFFER             ; [8] IOB_OFFSET_BUF   even exposed to the caller???
37F2:00 01          399 <a class='d' name='IBDLEN'   >IBDLEN      </a>DW <span class='n'>256</span>          ; DATA LENGTH                   ; [A] IOB_OFFSET_LEN   These values never change!
37F4:00             400 <a class='d' name='IBCMD'    >IBCMD       </a>DFB <span class='n'>0</span>           ; COMMAND                       ; [C] IOB_OFFSET_CMD
                    401 <a class='e' name='IBCNUL'   >IBCNUL      </a>EQU 0           ; 0-NULL COMMAND                ;                      Stop with the shitty API already!
                    402 <a class='e' name='IBCRTS'   >IBCRTS      </a>EQU 1           ; 1-READ TRACK, SECTOR          ;     IB_CMD_R
                    403 <a class='e' name='IBCWTS'   >IBCWTS      </a>EQU 2           ; 2-WRITE TRACK,SECTOR          ;     IB_CMD_W
                    404 <a class='e' name='IBFMT'    >IBFMT       </a>EQU 4           ; 4-FORMAT DISK                 ;     IB_CMD_FORMAT
                    405 <a class='e' name='IBBOOT'   >IBBOOT      </a>EQU 8           ; 8-WRITE BOOT                  ;     IB_CMD_X_BOOT
37F5:00             406 <a class='d' name='IBSTAT'   >IBSTAT      </a>DFB <span class='n'>0</span>           ; STATUS                        ; [D] IOB_OFFSET_STATUS
                    407 <a class='e' name='IBRERR'   >IBRERR      </a>EQU $80         ; READ ERR                      ;     IB_ERR_R         Interleaving const and struct types
                    408 <a class='e' name='IBDERR'   >IBDERR      </a>EQU $40         ; DRIVE ERR                     ;     IB_ERR_DRV       makes for extremely poor readability
                    409 <a class='e' name='IBVMME'   >IBVMME      </a>EQU $20         ; VOLUME MISMATCH               ;     IB_ERR_VOL
                    410 <a class='e' name='IBWPER'   >IBWPER      </a>EQU $10         ; WRITE PROTECT ERROR           ;     IB_ERR_W
37F6:00             411 <a class='d' name='IBSMOD'   >IBSMOD      </a>DFB <span class='n'>0</span>           ; STATUS MODIFIER BYTE          ; [E] IOB_OFFSET_MOD
37F7:60             412 <a class='d' name='IBPSLT'   >IBPSLT      </a>DFB <span class='n'>6</span>*<span class='n'>16</span>        ; PREVIOUS SLOT                 ; [F] IOB_OFFSET_PREV_SLOT   Why isn't this set at boot ???
37F8:01             413 <a class='d' name='IBPDRV'   >IBPDRV      </a>DFB <span class='n'>1</span>           ; PREVIOUS DRIVE                ;[10] IOB_OFFSET_PREV_DRV
37F9:00 00          414 <a class='d' name='IBSPAR'   >IBSPAR      </a>DS <span class='n'>2</span>,<span class='n'>0</span>          ; IOB SPARES                    ;[11] <a class='struct' name='_37F9'>wastes</a> 2 bytes
37FB:00 01 EF D8    415 <a class='d' name='DCT'      >DCT         </a>DFB <span class='n'>0</span>,<span class='n'>1</span>,$<span class='n'>EF</span>,$<span class='n'>D8</span> ;                               ; <a class='magic'  name='_37FB'>magic number</a> More crappy formatting, values defined in <a class='file' href='#RWTSONE'>RWTSONE</a>
                                                                                    ; Put these values on one per line for <b>readability</b> like this:
                                                                                    ;     DFB 0    ; Device Type, $0 = Disk II
                                                                                    ;     DFB 1    ; Phases per Track
                                                                                    ;     DW $D8EF ; Motor on time in 100 microseconds
37FF:00             416             DS <span class='n'>1</span>,<span class='n'>0</span>          ; FILL IN 3700 PAGE             ; <a class='mem'    name='_37FF'>wastes</a> 1 byte
                    417             PAGE
                    418 ;
                    419 ; FILE DIRECTORY DEFINITION                                 ; i-node; meta-data: array of sectors belonging to file
                    420 ;
                    421             DSECT
                    422 <a class='d' name='FILDIR'   >FILDIR      </a>EQU *                                               ;T12SF <a class='dumb' name='HNTDAFS6'>HNTDAFS #6</a>
                    423 <a class='d' name='FDUCDE'   >FDUCDE      </a>DS  1           ; FILE USE CODE                     ; [00] <a class='struct' name='_3800'>wastes</a> 1 byte -- never referenced! I presume <span class='code'>FILESYSTEM_TYPE_FILE EQU $1</span>
                    424 <a class='d' name='FDLTRK'   >FDLTRK      </a>DS  1           ; LINK TO NEXT DIR TRACK            ; [01] e.g. $12 ($00 = none)
                    425 <a class='d' name='FDLSEC'   >FDLSEC      </a>DS  1           ; LINK TO NEXT DIR SECTOR           ; [02] e.g. $0E ($00 = none)
                    426 <a class='d' name='FDNSA'    >FDNSA       </a>DS  1           ; NO SECTORS ALLOCATED              ; [03] <a class='struct' name='_3803'>wastes</a> 1 byte -- never referenced!
                    427 <a class='d' name='FDLSDL'   >FDLSDL      </a>DS  1           ; LAST SECTOR DATA LENGTH           ; [04] <a class='struct' name='_3804'>wastes</a> 1 byte -- never referenced!
                    428 <a class='d' name='FDFRS'    >FDFRS       </a>DS  2           ; 1ST RELATIVE SECTOR IN THIS DIR   ; [05] read by <a class='x' href='#RFDNL1'>RFDNL1</a> and <a class='x' href='#RDFDC'>RDFDC</a> in FMTRWIO
<hr>                    429 <a class='d' name='FDSPAR'   >FDSPAR      </a>DS  5           ; SPARES                            ; [07] === Page <a class='page' name='page15'>15</a> ===
                    430 ;
                    431 <a class='d' name='FDENT'    >FDENT       </a>DS  1           ; START OF FILE ENTRIES (122)       ; [0C]
                    432 <a class='e' name='FDTRK'    >FDTRK       </a>EQU 0           ; TRACK
                    433 <a class='e' name='FDSEC'    >FDSEC       </a>EQU 1           ; SECTOR
                    434 ;
                    435 <a class='d' name='FDLAST'   >FDLAST      </a>EQU FILDIR+256                                  ; $3900 ($B900) -- never referenced
                    436             DEND
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="COREQUS">COREQUS</a> - Core Equates, Page <a class="page" name="page24">24</a>, <a class='ts'>n/a</a>, $<span class='n'>n/a</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR CORE ROUTINES'
                    002 ***************************
                    003 *                         *
                    004 *          DISC-II        *
                    005 *      16-SECTOR FORMAT   *
                    006 *       READ AND WRITE    *
                    007 *        SUBROUTINES      *
                    008 *                         *
                    009 ***************************
                    010 *                         *
                    011 *                         *
                    012 *     COPYRIGHT 1979      *
                    013 *   APPLE COMPUTER INC.   *
                    014 *                         *
                    015 *   ALL RIGHTS RESERVED   *
                    016 *                         *
                    017 ***************************
                    018 *                         *
                    019 *      MAR 18, 1979       *
                    020 *          WOZ            *
                    021 *                         *
                    022 ***************************
                    023 <a class='d' name='ASC1'     >ASC1        </a>EQU *           ;TELL RELOCATOR WHERE CORE STARTS
                    024             PAGE
                    025 ***************************
                    026 *                         *
                    027 *     CRITICAL TIMING     *
                    028 *   REQUIRES PAGE BOUND   *
                    029 *   CONSIDERATIONS FOR    *
                    030 *      CODE AND DATA      *
                    031 *                         *
                    032 *     -----CODE-----      *
                    033 *                         *
                    034 *   VIRTUALLY THE ENTIRE  *
                    035 *    'WRITE16' ROUTINE    *
                    036 *      MUST NOT CROSS     *
                    037 *     PAGE BOUNDARIES.    *
                    038 *                         *
                    039 *  THE WRITE16, READ16    *
                    040 *  AND RDADR16 SUBRS      *
                    041 *  WHICH MUST NOT CROSS   *
                    042 *  PAGE BOUNDARIES ARE    *
                    043 *  NOTED IN COMMENTS.     *
                    044 *                         *
                    045 *     -----DATA-----      *
                    046 *                         *
                    047 *  NBUF1 AND NBUF2 ARE    *
                    048 *  256-BYTE AND 86-BYTE   *
                    049 *  NIBL BUFFERS IN RAM.   *
                    050 *  BOTH MUST BEGIN ON     *
                    051 *  PAGE BOUNDARIES.       *
                    052 *                         *
                    053 *  NIBLIZING TABLE 'NIBL' *
<hr>                    054 * (64 BYTES) MAPS 6-BIT   *                                 ; === Page <a class='page'. name='page25'>25</a> ===
                    055 * NIBLS INTO VALID 7-BIT  *
                    056 * NIBLS.  THIS TABLE      *
                    057 * MUST NOT CROSS A PAGE   *
                    058 * BOUNDARY.               *
                    059 *                         *
                    060 * DENIBLIZING TABLE       *
                    061 * 'DNIBL' MAPS 7-BIT      *
                    062 * NIBLS INTO 6-BIT        *
                    063 * NIBLS.  IT MUST BEGIN   *
                    064 * ON A PAGE BOUNDARY,     *
                    065 * BUT ONLY DNIBL,$96 TO   *
                    066 * DNIBL,$FF ARE USED.     *
                    067 *                         *
                    068 ***************************
                    069             PAGE
                    070 ***************************
                    071 *                         *
                    072 *         EQUATES         *
                    073 *                         *
                    074 ***************************
                    075 *                         *
                    076 *     ----PRENIBL16----   *
                    077 *       AND POSTNB16      *
                    078 *    (16-SECTOR FORMAT)   *
                    079 *                         *
                    080 ***************************
                    081 <a class='d' name='BUF'      >BUF         </a>EQU $3E         TWO BYTE POINTER.
                    082 *
                    083 * POINTS TO 256-BYTE
                    084 * USER BUFFER ANYWHERE
                    085 * IN MEMORY. PRENIBL16
                    086 * CONVERTS USER DATA
                    087 * (IN BUF) INTO 6-BIT
                    088 * NIBLS 00ABCDEF IN
                    089 * NBUF1 AND NBUF2 PRIOR
                    090 * TO 'WRITE'. POSTNBL16
                    091 * CONVERTS 6-BIT NIBLS
                    092 * 00ABCDEF BACK TO USER
                    093 * DATA IN BUF AFTER 'READ'.
                    094 *
                    095 <a class='d' name='T0'       >T0          </a>EQU $26         TEMP FOR POSTNBL16
                    096 ************************
                    097 *                      *
                    098 *    ----RDADR16----   *
                    099 *                      *
                    100 ************************
                    101 <a class='d' name='COUNT'    >COUNT       </a>EQU $26         'MUST FIND' COUNT.
                    102 <a class='d' name='LAST'     >LAST        </a>EQU $26         'ODD BIT' NIBLS.
                    103 <a class='d' name='CSUM'     >CSUM        </a>EQU $27         CHECKSUM BYTE.
                    104 <a class='d' name='CSSTV'    >CSSTV       </a>EQU $2C         FOUR BYTES,                     ; Read forward, stored in <i>backwards order</i> due to <a class="x" href="#RDA5">RDA5</a>
                    105 *                           CHECKSUM, SECTOR, TRACK, AND VOLUME.
                    106 *
                    107 ************************
                    108 *                      *
                    109 *    ---WRITE16---     *
                    110 *                      *
                    111 *  USES NBUF1, NBUF2,  *
                    112 *  AND 64-BYTE TABLE   *
                    113 *       'NIBL'.        *
                    114 *                      *
                    115 ************************
                    116 <a class='d' name='WTEMP'    >WRTEMP      </a>EQU $26         TEMP FOR DATA AT NBUF2,0.
                    117 <a class='d' name='SLOTZ'    >SLOTZ       </a>EQU $27         SLOTNUM IN Z-PAG LOC.
                    118 <a class='d' name='SLOTABS'  >SLOTABS     </a>EQU $678        SLOTNUM IN NON-ZPAG LOC.
                    119 *
                    120 ************************
                    121 *                      *
                    122 *     ----READ16-----  *
                    123 *  (16-SECTOR FORMAT)  *
                    124 *                      *
                    125 *   USES NBUF1,NBUF2.  *
                    126 * USES LAST 106 BYTES  *
                    127 * OF A DATA PAGE FOR   *
                    128 * SIGNIFICANT BYTES    *
                    129 * OF DNIBL16 TABLE.    *
                    130 *                      *
                    131 ************************
                    132 <a class='d' name='IDX'      >IDX         </a>EQU $26         INDEX INTO (BUF).
                    133 *
                    134 ************************
                    135 *                      *
                    136 *    ---- SEEK ----    *
                    137 *                      *
                    138 ************************
                    139 <a class='d' name='TRKCNT'   >TRKCNT      </a>EQU $26         HALFTRKS MOVED COUNT.
                    140 <a class='d' name='PRIOR'    >PRIOR       </a>EQU $27         PRIOR HALFTRACK.
                    141 <a class='d' name='TRKN'     >TRKN        </a>EQU $2A         DESIRED TRACK.
                    142 <a class='d' name='SLOTTEMP' >SLOTTEMP    </a>EQU $2B         SLOT NUM TIMES $10.
                    143 <a class='d' name='CURTRK'   >CRKTRK      </a>EQU $478        CURRENT TRACK ON ENTRY.           ; "Current Track" Drive 1
                    144 *
                    145 ************************
                    146 *                      *
                    147 *   ---- MSWAIT ----   *
                    148 *                      *
                    149 ************************
                    150 <a class='d' name='MONTIMEL' >MONTIMEL    </a>EQU $46         MOTON-ON TIME
                    151 <a class='d' name='MONTIMEH' >MONTIMEH    </a>EQU $47         COUNTERS.
                    152 *
                    153 ************************
                    154 *                      *
                    155 *   ---- WRADR16 ----  *
                    156 *                      *
                    157 ************************
                    158 <a class="d" name="AA"         >AA          </a>EQU $3E         ;TIMING CONSTANT                ; *sigh* Really people you couldn't pick <i>any other</i> variable name?!, See: <a class='x' href='#DSKFORM'>DSKFORM</a>
                    159 <a class="d" name="NSECT"      >NSECT       </a>EQU $3F         ;SECTOR NUMBER
                    160 <a class="d" name="NVOL"       >NVOL        </a>EQU $41         ;VOLUME NUMBER
                    161 <a class="d" name="TRK"        >TRK         </a>EQU $44*        ;TRACK NUMBER
                    162 *
                    163 ************************
                    164 *                      *
                    165 *    DEVICE ADDRESS    *
                    166 *     ASSIGNMENTS      *
                    167 *                      *                                    ; See <a class="v" href="#ONTABLE">ONTABLE</a>, and <a class="v" href="#OFFTABLE">OFFTABLE</a>
                    168 ************************                                    ; Typical B.A.D. (Beneath Apple Dos) shenanigans (Page 6-3):
                    169 <a class="d" name="PHASEOFF"   >PHASEOFF    </a>EQU $C080       STEPPER PHASE OFF.              ; <i>"The timing between accesses to these locations is</i>
                    170 <a class="d" name="PHASEON"    >PHASEON     </a>EQU $C081       STEPPER PHASE ON.               ; <i> critical, making this a non-trivial exercise."</i> <b>WHICH IS???</b>
                    171 <a class="d" name="Q6L"        >Q6L         </a>EQU $C08C       Q7L,Q6L=READ                    ; *sigh* /sarcasm Riiight, because it is _obvious_ what Q7L &amp; Q7H
                    172 <a class="d" name="Q6H"        >Q6H         </a>EQU $C08D       Q7L,Q6H=SENSE WPROT             ; do -- but let's keep copy/paste these shitty non-descript names!
                    173 <a class="d" name="Q7L"        >Q7L         </a>EQU $C08E       Q7H,Q6L=WRITE                   ; DRIVE_MODE_R
                    174 <a class="d" name="Q7H"        >Q7H         </a>EQU $C08F       Q7H,Q6H=WRITE STORE             ; DRIVE_MODE_W
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="PRENIBL">PRENIBL</a> - Prenibblize sector data for writing, Page <a class="page" name="page104">104</a>, <a class='ts' href='#T0S2'>T0S2</a>, $<span class='n'>B800</span> .. $<span class='n'>B829</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR PRENIBLIZE'
                    002 ****************************
                    003 *                          *
                    004 *    PRENIBLIZE SUBR       *
                    005 *   (16-SECTOR FORMAT)     *
                    006 *                          *
                    007 ****************************
                    008 *                          *
                    009 *  CONVERTS 256 BYTES OF   *
                    010 *  USER DATA IN (BUF),0    *
                    011 *  TO (BUF),255 INTO 342   *
                    012 *  6-BIT NIBLS (00ABCDEF)  *
                    013 *  IN NBUF1 AND NBUF2.     *
                    014 *                          *
                    015 *    ---- ON ENTRY ----    *
                    016 *                          *
                    017 *  BUF IS 2-BYTE POINTER   *
                    018 *    TO 256 BYTES OF USER  *
                    019 *    DATA.                 *
                    020 *                          *
                    021 *    ---- ON EXIT -----    *
                    022 *                          *
                    023 *  A-REG UNCERTAIN.        *
                    024 *  X-REG HOLDS $FF.        *
                    025 *  Y-REG HOLDS $FF.        *
                    026 *  CARRY SET.              *
                    027 *                          *
                    028 * NBUF1 AND NBUF2 CONTAIN  *
                    029 *   6-BIT NIBLS OF FORM    *
                    030 *   00ABCDEF.              *
                    031 *                          *
                    032 ****************************
3800:A2 00          033 <a class="f" name="PRENIB16"  >PRENIB16    </a>LDX #$<span class='n'>0</span>         ;START NBUF2 INDEX. CHANGED BY WOZ
3802:A0 02          034             LDY #<span class='n'>2</span>          ;START USER BUF INDEX. CHANGED BY WOZ.
3803:88             035 <a class="f" name="PRENIB1"   >PRENIB1     </a>DEY             ;NEXT USER BYTE.
3805:B1 3E          036             LDA (<a class="v" hre="#BUF">BUF</a>),Y
3807:4A             037             LSR A           ;SHIFT TWO BITS OF
3808:3E 00 3C       038             ROL <a class="v" hre="#NBUF2">NBUF2</a>,X     ;CURRENT USER BYTE
380B:4A             039             LSR A           ;INTO CURRENT NBUF2
380C:3E 00 3C       040             ROL <a class="v" hre="#NBUF2">NBUF2</a>,X     ;BYTE.
380F:99 00 3B       041             STA <a class="v" hre="#NBUF1">NBUF1</a>,Y     ;(6 BITS LEFT).
3812:E8             042             INX             ;FROM 0 TO $55.
3813:E0 56          043             CPX #$<span class='n'>56</span>
3815:90 ED          044             BCC <a class="x" href="#PRENIB1">PRENIB1</a>     ;BR IF NO WRAPAROUND.
3817:A2 00          045             LDX #<span class='n'>0</span>          ;RESET NBUF2 INDEX.
3819:98             046             TYA             ;USER BUF INDEX.
381A:D0 E8          047             BNE <a class="x" href="#PRENIB1">PRENIB1</a>     ;(DONE IF ZERO)
381C:A2 55          048             LDX #$<span class='n'>55</span>        ;NBUF2 IDX $55 TO 0.
381E:BD 00 3C       049 <a class="f" name="PRENIB2"   >PRENIB2     </a>LDA <a class="v" hre="#NBUF2">NBUF2</a>,X
3821:29 3F          050             AND #$<span class='n'>3F</span>        ;STRIP EACH BYTE
3823:9D 00 3C       051             STA <a class="v" hre="#NBUF2">NBUF2</a>,X     ;OF NBUF2 TO 6 BITS.
3826:CA             052             DEX
3827:10 F5          053             BPL <a class="x" href="#PRENIB2">PRENIB2</a>     ;LOOP UNTIL X NEG.
3828:60             054             RTS             ;RETURN.                        ; o7 Captain Obvious
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="WRITRTN">WRITRTN</a> - Write Routine, Page <a class="page" name="page137">137</a>, <a class='ts' href='#T0S2'>T0S2</a>, $<span class='n'>B82A</span> .. $<span class='n'>B8C1</span> ===<hr class='join'><hr></div>
<pre>
                    001                 SBTL '16-SECTOR WRITE'
                    002 ************************
                    003 *                      *
                    004 *      WRITE SUBR      *
                    005 *  (16-SECTOR FORMAT)  *
                    006 *                      *
                    007 ************************
                    008 *                      *
                    009 *   WRITES DATA FROM   *
                    010 *    NBUF1 AND NBUF2   *
                    011 *   CONVERTING 6-BIT   *
                    012 *    TO 7-BIT NIBLS    *
                    013 *   VIA 'NIBL' TABLE.  *
                    014 *                      *
                    015 *  FIRST NBUF2,        *
                    016 *      HIGH TO LOW.    *
                    017 *  THEN NBUF1,         *
                    018 *      LOW TO HIGH.    *
                    019 *                      *
                    020 *  ---- ON ENTRY ----  *
                    021 *                      *
                    022 *   X-REG: SLOTNUM     *
                    023 *        TIMES $10.    *
                    024 *                      *
                    025 *   NBUF1 AND NBUF2    *
                    026 *    HOLD NIBLS FROM   *
                    027 *    PRENIBL SUBR.     *
                    028 *    (00ABCDEF)        *
                    029 *                      *
                    030 *  ---- ON EXIT -----  *
                    031 *                      *
                    032 *  CARRY SET IF ERROR. *
                    033 *   (W PROT VIOLATION) *
                    034 *                      *
                    035 *  IF NO ERROR:        *
                    036 *                      *
                    037 *    A-REG UNCERTAIN.  *
                    038 *    X-REG UNCHANGED.  *
                    039 *    Y-REG HOLDS $00.  *
                    040 *    CARRY CLEAR.      *
                    041 *                      *
                    042 *    SLOTABS, SLOTZ,   *
                    043 *     AND WTEMP USED.  *
                    044 *                      *
                    045 *  ---- ASSUMES ----   *
                    046 *                      *
                    047 *  1 USEC CYCLE TIME   *
                    048 *                      *
                    049 ************************
382A:38             050 <a class="f"    name="WRITE16"      >WRITE16     </a>SEC             ;ANTICIPATE WPROT ERR.          ; === Reloc @ $B82A ===
382B:86 27          051             STX <a class="v" href="#SLOTZ"  >SLOTZ</a>       ;FOR ZERO PAGE ACCESS.
382D:8E 78 06       052             STX <a class="v" href="#SLOTABS">SLOTABS</a>     ;FOR NON-ZERO PAGE.
3830:BD 8D C0       053             LDA <a class="v" href="#Q6H"    >Q6H</a>,X
3833:BD 8E C0       054             LDA <a class="v" href="#Q7L"    >Q7L</a>,X       ;SENSE WPROT FLAG.
3836:30 7C          055             BMI <a class="x" href="#WEXIT"  >WEXIT</a>       ;IF HIGH, THEN ERR.             ; v
3838:AD 00 3C       056             LDA <a class="v" href="#NBUF2"  >NBUF2</a>
383B:85 26          057             STA <a class="v" href="#WTEMP"  >WTEMP</a>       ;FOR ZERO-PAGE ACCESS.
383D:A9 FF          058             LDA #$<span class='n'>FF</span>        ;SYNC DATA
383F:9D 8F C0       059             STA <a class="v" href="#">Q7H</a>,X       ;(5) WRITE 1ST NIBL.
3842:1D 8C C0       060             ORA <a class="v" href="#">Q6L</a>,X       ;(4)
3845:48             061             PHA             ;(3)
3846:68             062             PLA             ;(4) CRITICAL TIMING!
3847:EA             063             NOP             ;(2)
3848:A0 04          064             LDY #<span class='n'>4</span>          ;(2)  FOR 5 NIBLS.
384A:48             065 <a class="f"    name="WSYNC"        >WSYNC       </a>PHA             ;(3) EXACT TIMING               ; --- Sync FF ---
384B:68             066             PLA             ;(4) EXACT TIMING
384C:20 B9 38       067             JSR <a class="x" href="#WNIBL7"   >WNIBL7</a>      ;(13,9,6)  WRITE SYNC
384F:88             068             DEY             ;(2)
3850:D0 F8          069             BNE <a class="x" href="#WSYNC"    >WSYNC</a>       ;(2*)  MUST NOT  CROSS PAGE!    ; ^
3852:A9 D5          070             LDA #$D5        ;(2)  1ST DATA MARK.            ; --- Data Header D5 AA AD ---
3854:20 B8 38       071             JSR <a class="x" href="#WNIBL9"   >WNIBL9</a>      ;(15,9,6)
3857:A9 AA          072             LDA #$AA        ;(2)  2ND DATA MARK.
3859:20 B8 38       073             JSR <a class="x" href="#WNIBL9"   >WNIBL9</a>      ;(15,9,6)
385C:A9 AD          074             LDA #$AD        ;(2)  3RD DATA MARK.
385E:20 B8 38       075             JSR <a class="x" href="#WNIBL9">WNIBL9</a>      ;(15,9,6)
3861:98             076             TYA             ;(2) CLEAR CHECKSUM
3862:A0 56          077             LDY #$56        ;(2) NBUF2 INDEX.
3864:D0 03          078             BNE <a class="x" href="#WDATA1">WDATA1</a>      ;(3)  ALWAYS.  NO PAGE CROSS!!  ; v
3866:B9 00 3C       079 <a class="f"    name="WDATA0"       >WDATA0      </a>LDA <a class="v" href="#NBUF2">NBUF2</a>,Y     ;(4)  PRIOR 6-BIT NIBL.
3869:58 FF 3B       <a class='line' name='WRITRTN.080'>080</a> <a class="f"    name="WDATA1"       >WDATA1      </a>EOR <a class="v" href="#NBUF2">NBUF2</a>-1,Y   ;(5)  XOR WITH CURRENT.
                    081 *   (NBUF2 MUST BE ON PAGE BOUNDARY FOR TIMING!!)
386C:AA             082             TAX             ;(2)  INDEX To 7-BIT NIBL
386D:BD 29 3A       083             LDA <a class="v" href="#NIBL" >NIBL</a>,X      ;(4)  MUST NOT CROSS PAGE!
3870:A6 27          084             LDX <a class="v" href="#SLOTZ">SLOTZ</a>       ;(3)  CRITICAL TIMING!
3872:9D 8D C0       085             STA <a class="v" href="#Q6H"  >Q6H</a>,X       ;(5)  WRITE NIBL.
3875:BD 8C C0       086             LDA <a class="v" href="#Q6L"  >Q6L</a>,X       ;(4)
3878:88             087             DEY             ;(2)  NEXT NIBL.
3879:D0 EB          088             BNE <a class="x" href="#WDATA0"   >WDATA0</a>      ;(2*) MUST NOT CROSS PAGE!      ; ^
387B:A5 26          089             LDA WTEMP       ;(3) PRIOR NIBL FROM BUF6.
387D:EA             090             NOP             ;(2)  CRITICAL TIMING.
387E:59 00 3B       091 <a class="f"    name="WDATA2"       >WDATA2      </a>EOR NBUF1,Y     ;(5)  XOR WITH CURRENT.
3881:AA             092             TAX             ;(2)
3882:BD 29 3A       093             LDA <a class="v" href="#NIBL"   >NIBL</a>,X      ;(4)
3885:AE 78 06       094             LDX <a class="v" href="#SLOTABS">SLOTABS</a>     ;(4) TIMING CRITICAL
3888:9D 8D C0       095             STA <a class="v" href="#Q6H"    >Q6H</a>,X       ;(5) WRITE NIBL.
388B:BD 8C C0       096             LDA <a class="v" href="#Q6L"    >Q6L</a>,X       ;(4)
388E:B9 00 3B       097             LDA <a class="v" href="#NBUF1"  >NBUF1</a>,Y     ;(4)  PRIOR 6-BIT NIBL.
3891:C8             098             INY             ;(2)NEXT NBUF1 NIBL.
3892:D0 EA          099             BNE <a class="x" href="#WDATA2" >WDATA2</a>      ;(2*) MUST NOT CROSS PAGE!      ; ^
3894:AA             100             TAX             ;(2)
3895:BD 29 3A       101             LDA <a class="v" href="#NIBL"   >NIBL</a>,X      ;(4)  INDEX TO 7-BIT NIBL
3898:A6 27          102             LDX <a class="v" href="#SLOTZ"  >SLOTZ</a>       ;(3)
389A:20 BB 38       103             JSR <a class="x" href="#WNIBL"  >WNIBL</a>       ;(6,9,6)  WRITE CHKSUM
389D:A9 DE          104             LDA #$<span class='n'>DE</span>        ;(2)  DM4, BIT SLIP MARK.
389F:20 B8 38       105             JSR <a class="x" href="#WNIBL9" >WNIBL9</a>      ;(15,9,6)    WRITE IT.
38A2:A9 AA          106             LDA #$<span class='n'>AA</span>        ;(2)  DM5, BIT SLIP MARK.
38A4:20 B8 38       107             JSR <a class="x" href="#WNIBL9" >WNIBL9</a>      ;(15,9,6)    WRITE IT.
38A7:A9 EB          108             LDA #$<span class='n'>EB</span>        ;(2)  DM6, BIT SLIP MARK.
38A9:20 B8 38       109             JSR <a class="x" href="#WNIBL9" >WNIBL9</a>      ;(15,9,6)    WRITE IT.
38AC:A9 FF          110             LDA #$<span class='n'>FF</span>        ;(2) TURN-OFF BYTE.
38AE:20 B8 38       111             JSR <a class="x" href="#WNIBL9" >WNIBL9</a>      ;(15,9,9) WRITE IT.             ; TODO: 15,9,6??
38B1:BD 8E C0       112             LDA <a class="v" href="#Q7L"    >Q7L,X</a>       ;OUT OF WRITE MODE.
38B4:BD 8C C0       113 <a class="f"    name="WEXIT"        >WEXIT       </a>LDA <a class="v" href="#Q6L"    >Q6L</a>,X       ;TO READ MODE.
38B7:60             114             RTS             ;RETURN FROM WRITE.
                    115 *****************************
                    116 *                           *
<hr>                    117 *   7-BIT NIBL WRITE SUBRS  *                               ; === WRITRTN, Page <a class="page" name="page139">139</a> ===
                    118 *                           *
                    119 *   A-REG OR'D PRIOR EXIT   *
                    120 *       CARRY CLEARED       *
                    121 *                           *
                    122 *****************************
38B8:18             123 <a class="f"    name="WNIBL9"     >WNIBL9      </a>CLC             ; (2) 9 CYCLES, THEN WRITE.
38B9:48             124 <a class="f"    name="WNIBL7"     >WNIBL7      </a>PHA             ; (3) 7 CYCLES, THEN WRITE.
38BA:68             125             PLA             ; (4)
38BB:9D 8D C0       126 <a class="f"    name="WNIBL"      >WNIBL       </a>STA <a class="v" href="#Q6H">Q6H</a>,X       ; (5) NIBL WRITE SUB.
38BE:1D 8C C0       127             ORA <a class="v" href="#Q6L">Q6L</a>,X       ; (4) CLOBBERS ACC, NOT CARRY
38C1:60             128             RTS
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="POSTNRD">POSTNRD</a> - Post Nibbilize Read, Page <a class="page" name="page101">101</a>, <a class='ts' href='#T0S2'>T0S2</a> @ $C2 - <a class='ts' href='#T0S3'>T0S3</a> @ $43, $<span class='n'>B8C2</span> .. $<span class='n'>B943</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR POSTNIBLIZE'
                    002 ***************************
                    003 *                         *
                    004 *    POSTNIBLIZE SUBR     *
                    005 *    16-SECTOR FORMAT     *
                    006 *                         *
                    007 ***************************
                    008 *                         *
                    009 *  CONVERTS 6-BIT NIBLS   *
                    010 *  OF FORM 00ABCDEF IN    *
                    011 *  NBUF1 AND NBUF2 INTO   *
                    012 *  256 BYTES OF USER      *
                    013 *  DATA IN BUF.           *
                    014 *                         *
                    015 *   ---- ON ENTRY ----    *
                    016 *                         *
                    017 *  X-REG: HOLDS SLOTNUM   *
                    018 *            TIMES $10.   *
                    019 *                         *
                    020 *  BUF IS 2-BYTE POINTER  *
                    021 *    TO 256 BYTES OF USER *
                    022 *    DATA TO BE CONVERTED *
                    023 *    TO 6-BIT NIBLS IN    *
                    024 *    NBUF1 AND NBUF2      *
                    025 *    PRIOR TO WRITE.      *
                    026 *                         *
                    027 *  T0 CONTAINS BYTE COUNT *
                    028 *    CODE0 = 256 BYTES    *
                    029 *    CODE1 =   1 BYTE     *
                    030 *    CODE2 =   2 BYTER    *
                    031 *                         *
                    032 *    CODE 255=255 BYTES   *
                    033 *                         *
                    034 *   ---- ON EXIT -----    *
                    035 *                         *
                    036 *  A-REG UNCERTAIN.       *
                    037 *  Y-REG SAME AS T0.      *
                    038 *  X-REG UNCERTAIN.       *
                    039 *  CARRY SET.             *
                    040 *                         *
                    041 *  6-BIT NIBLS OF FORM    *
                    042 *    00ABCDEF IN NBUF1    *
                    043 *    AND NBUF2.           *
                    044 *      (342 NIBLS)        *
                    045 ***************************
38C2:A0 00          046 <a class="f"    name="POSTNB16"   >POSTNB16    </a>LDY #$<span class='n'>0</span>         USER DATA BUF IDX.              ; <a class='ts' href='#T0S2'>T0S2</a> <span class="todo">TODO</span>
38C4:A2 56          047 <a class="f"    name="POST1"      >POST1       </a>LDX #$<span class='n'>56</span>        INIT NBUF2 INDEX.
38C6:CA             048 <a class="f"    name="POST2"      >POST2       </a>DEX             IDX $55 TO $0
38C7:30 FB          049             BMI <a class="x" href="#POST1">POST1</a>       WRAPAROUND IF NEG.              ; ^
38C9:B9 00 3B       050             LDA <a class="v" href="#NBUF1">NBUF1</a>,Y
38CC:5E 00 3C       051             LSR <a class="v" href="#NBUF2">NBUF2</a>,X     SHIFT 2 BITS FROM
38CF:2A             052             ROL A           CURRENT NBUF2 NIBL
38D0:5E 00 3C       053             LSR             INTO CURRENT NBUF1
<hr>38D3:2A             054             ROL A           NIBL.                           ; === Page <a class="page" name="page102">102</a> ===
38D4:91 3E          055             STA (<a class="v" href="#">BUF</a>),Y     BYTE OF USER DATA.
38D6:C8             056             INY             NEXT USER BYTE.
38D7:C4 26          057             CPY <a class="v" href="#">T0</a>          DONE IF EQUAL T0.
38D9:D0 EB          058             BNE <a class="x" href="#POST2">POST2</a>                                       ; ^
38DB:60             059             RTS             RETURN.
                    060                 SBTL '16-SECTOR READ'
                    061 **************************
                    062 *                        *
                    063 *     READ SUBROUTINE    *
                    043 *   (16-SECTOR FORMAT)   *
                    065 *                        *
                    066 **************************
                    067 *                        *
                    068 *    READS 6-BIT NIBLS   *
                    069 *     (00ABCDEF) INTO    *
                    070 *     NBUF1 and NBUF2    *
                    071 *    CONVERTING 7-BIT    *
                    072 *     NIBLS TO 7-BIT     *
                    073 *    VIA 'DNIBL' TABLE   *
                    074 *                        *
                    075 *  FIRST READS NBUF2     *
                    076 *           HIGH TO LOW  *
                    077 *  THEN READS NBUF1      *
                    078 *           LOW TO HIGH  *
                    079 *                        *
                    080 *   ---- ON ENTRY ----   *
                    081 *                        *
                    082 *  X-REG: SLOTNUM        *
                    083 *         TIMES $10.     *
                    084 *                        *
                    085 *  READ MODE (Q6L, Q7L)  *
                    086 *                        *
                    087 *   ---- ON EXIT -----   *
                    088 *                        *
                    089 *  CARRY SET IF ERROR    *
                    090 *                        *
                    091 *  IF NO ERROR:          *
                    092 *     A-REG HOLDS $AA.   *
                    093 *     X-REG UNCHANGED.   *
                    094 *     Y-REG HOLDS $00.   *
                    095 *     CARRY CLEAR.       *
                    096 *                        *
                    097 *     NBUF1 AND NBUF2    *
                    098 *       HOLD 6-BIT NIBLS *
                    099 *       (00ABCDEF)       *
                    100 *                        *
                    101 *     USES TEMP 'IDX'.   *
                    102 *                        *
                    103 *  ---- CAUTION -----    *
                    104 *                        *
                    105 *        OBSERVE         *
                    106 *    'NO PAGE CROSS'     *
                    107 *      WARNIGNS ON       *
                    108 *    SOME BRANCHES!!     *
                    109 *                        *
                    110 *   ---- ASSUMES ----    *
                    111 *                        *
                    112 *   1 USEC CYCLE TIME    *
                    113 *                        *
                    114 **************************
38DC:A0 20          115 <a class="f" name="READ16"   >READ16      </a>LDY #$20        'MUST FIND' COUNT.
38DE:88             116 <a class="f" name="RSYNC"    >RSYNC       </a>DEY             IF CAN'T FIND MARKS
<hr>38DF:F0 61          117 <!--                       -->            BEQ RDERR       ;THEN EXIT WITH CARRY SET       ; === Page <a class="page" name="page103">103</a> ===
38E1:BD 8C C0       118 <a class="f" name="READ1"    >READ1       </a>LDA Q6L,X       READ NIBL.
38E4:10 FB          119 <!--                           -->            BPL READ1       *** NO PAGE CROSS! ***
38E6:49 D5          120 <a class="f" name="RSYNC1"   >RSYNC1      </a>EOR #$D5        DATA MARK 1?
38E8:D0 F4          121 <!--                           -->            BNE RSYNC       LOOP IF NOT.
38EA:EA             122 <!--                           -->            NOP             DELAY BETWEEN NIBLS.
38EB:BD 8C C0       123 <a class="f" name="READ2"    >READ2       </a>LDA Q6L,X
38EE:10 FB          124 <!--                           -->            BPL READ2       *** NO PAGE CROSS! ***
38F0:C9 AA          125 <!--                           -->            CMP #$AA        DATA MARK 2?
38F2:D0 F2          126 <!--                           -->            BNE RSYNC1      (IF NOT, IS IT DM1?)            ;              <span class='code'>NUM_6N2_NIBBLES = 342</span>
38F4:A0 56          127 <!--                           -->            LDY #$<span class='n'>56</span>        INIT NBUF2 INDEX                ; <a class='magic' name='#_38F5'>magic number</a> <span class='code'>NUM_6N2_NIBBLES - 256</span>
                    128 <!--                           -->*                           (ADDED NIBL DELAY)
38F6:BD 8C C0       129 <a class="f" name="READ3"    >READ3       </a>LDA Q6L,X
38F9:10 FB          130 <!--                           -->            BPL READ3       *** NO PAGE CROSS! ***
38FB:C9 AD          131 <!--                           -->            CMP #$AD        DATA MARK 3?
38FD:D0 E7          132 <!--                           -->            BNE RSYNC1
                    133 <!--                           -->*                           (CARRY SET IF DM3!)             ; And this imporant <b>why??</b>
38FF:A9 00          134 <!--                           -->            LDA #$00        INIT CHECKSUM
3901:88             135 <a class="f" name="RDATA1"   >RDATA1      </a>DEY
3902:84 26          136 <!--                           -->            STY IDX
3904:BC 8C C0       137 <a class="f" name="READ4"    >READ4       </a>LDY Q6L,X
3907:10 FB          138 <!--                           -->            BPL READ4       *** NO PAGE CROSS! ***
3909:59 00 3A       139 <!--                           -->            EOR DNIBL,Y     XOR 6-BIT NIBL.
390C:A4 26          140 <!--                           -->            LDY IDX
390E:99 00 3C       141 <!--                           -->            STA NBUF2,Y     STORE IN NBUF2 PAGE.
3911:D0 EE          142 <!--                           -->            BNE RDATA1      TAKEN IF Y-REG NONZERO.
3913:84 26          143 <a class="f" name="RDATA2"   >RDATA2      </a>STY IDX
3915:BC 8C C0       144 <a class="f" name="READ5"    >READ5       </a>LDY Q6L,X
3918:10 FB          145 <!--                           -->            BPL READ5       *** NO PAGE CROSS! ***
391A:59 00 3A       146 <!--                           -->            EOR DNIBL,Y     XOR 6-BIT NIBL.
391D:A4 26          147 <!--                           -->            LDY IDX
391F:99 00 BB       148 <!--                           -->            STA NBUF1,Y     STORE IN NBUF1 PAGE.
3922:C8             149 <!--                           -->            INY
3923:D0 EE          150 <!--                           -->            BNE RDATA2
3925:BC 8C C0       151 <a class="f" name="READ6"    >READ6       </a>LDY Q6L,X       READ 7-BIT CSUM NIBL.
3928:10 FB          152 <!--                           -->            BPL READ6       *** NO PAGE CROSS! ***
392A:D9 00 3A       153 <!--                           -->            CMP DNIBL,Y     IF LAST NBUF1 NIBL NOT
392D:D0 13          154 <!--                           -->            BNE RDERR       EQUAL CHKSUM NIBL THEN ERR.
392F:BD 8C C0       155 <a class="f" name="READ7"    >READ7       </a>LDA Q6L,X
3932:10 FB          156 <!--                           -->            BPL READ7       *** NO PAGE CROSS! ***
3934:C9 DE          157 <!--                           -->            CMP #$DE        FIRST BIT SLIP MARK?
3936:D0 0A          158 <!--                           -->            BNE RDERR       (ERR IF NOT)
3938:EA             159 <!--                           -->            NOP             DELAY BETWEEN NIBLS.
3939:BD 8C C0       160 <a class="f" name="READ8"    >READ8       </a>LDA Q6L,X
393C:10 FB          161 <!--                           -->            BPL READ8       *** NO PAGE CROSS! ***
393E:C9 AA          162 <!--                           -->            CMP #$AA        SECOND BIT SLIP MARK?
3940:F0 5C          163 <!--                           -->            BEQ RDEXIT      (DONE IF IT IS)
3942:38             164 <a class="f" name="RDERR"    >RDERR       </a>SEC             INDICATE 'ERROR EXIT'.
3943:60             165 <!--                           -->            RTS             FROM READ16 OR RDADR16.
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="RDADSEK">RDADSEK</a> - Read Disk Address; Seek, Page <a class="page" name="page106">106</a>, <a class='ts' href='#T0S3'>T0S3</a> @ $44, $<span class='n'>B944</span> .. $<span class='n'>B9FC</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR READ ADDRESS'
                    002 ****************************
                    003 *                          *
                    004 *    READ ADDRESS FIELD    *
                    005 *        SUBROUTINE        *
                    006 *    (16-SECTOR FORMAT)    *
                    007 *                          *
                    008 ****************************
                    009 *                          *
                    010 *    READS VOLUME, TRACK   *
                    011 *        AND SECTOR        *
                    012 *                          *
                    013 *   ---- ON ENTRY ----     *
                    014 *                          *
                    015 *  XREG: SLOTNUM TIMES $10 *
                    016 *                          *
                    017 *  READ MODE (Q6L, Q7L)    *
                    018 *                          *
                    019 *   ---- ON EXIT -----     *
                    020 *                          *
                    021 *  CARRY SET IF ERROR.     *
                    022 *                          *
                    023 *  IF NO ERROR:            *
                    024 *    A-REG HOLDS $AA.      *
                    025 *    Y-REG HOLDS $00.      *
                    026 *    X-REG UNCHANGED.      *
                    027 *    CARRY CLEAR.          *
                    028 *                          *
                    029 *    CSSTV HOLDS CHKSUM,   *
                    030 *      SECTOR, TRACK, AND  *
                    031 *      VOLUME READ.        *
                    032 *                          *
                    033 *    USES TEMPS COUNT,     *
                    034 *      LAST, CSUM, AND     *
                    035 *      4 BYTES AT CSSTV.   *
                    036 *                          *
                    037 *    ---- EXPECTS ----     *
                    038 *                          *
                    039 *   ORIGINAL 10-SECTOR     *
                    040 *  NORMAL DENSITY NIBLS    *
                    041 *   (4-BIT), ODD BITS,     *
                    042 *   THEN EVEN.             *
                    043 *                          *
                    044 *    ---- CAUTION ----     *
                    045 *                          *
                    046 *         OBSERVE          *
                    047 *    'NO PAGE CROSS'       *
                    048 *      WARNINGS ON         *
                    049 *    SOME BRANCHES!!       *
                    050 *                          *
                    051 *    ---- ASSUMES ----     *
                    052 *                          *
                    053 *    1 USEC CYCLE TIME     *
<hr>                    054 *                          *                                ; === Page <a class="page" name="page107">107</a> ===
                    055 ****************************
3944:A0 FC          056 <a class="f" name="RDADR16"  >RDADR16     </a>LDY #$<span class='n'>FC</span>
3946:84 26          057 <!--                           -->            STY COUNT       'MUST FIND' COUNT.
3948:C8             058 <a class="f" name="RDASYN"   >RDASYN      </a>INY
3949:D0 04          059 <!--                           -->            BNE RDA1        LOW ORER OF COUNT.
394B:E6 26          060 <!--                           -->            INC COUNT       (2K NIBLS TO FIND)
394D:F0 F3          061 <!--                           -->            BEQ RDERR       (ADR MARK, ELSE ERR)
394F:BD 8C C0       062 <a class="f" name="RDA1"     >RDA1        </a>LDA Q6L,X       READ NIBL.
3952:10 FB          063 <!--                           -->            BPL RDA1        *** NO PAGE CROSS! ***
3954:C9 D5          064 <a class="f" name="RDASN1"   >RDASN1      </a>CMP #$<span class='n'>D5</span>        ADR MARK 1?                     ; <a class='magic' name='#_3955'>magic number</a> <span class='macro'>DISK_ADR_PROLOG_1 EQU #$D5</span>
3956:D0 F0          065 <!--                           -->            BNE RDASYN      (LOOP IF NOT)
3958:EA             066 <!--                           -->            NOP             ADDED NIBL DELAY.
3959:BD 8C C0       067 <a class="f" name="RDA2"     >RDA2        </a>LDA Q6L,X
395C:10 FB          068 <!--                           -->            BPL RDA2        *** NO PAGE CROSS! ***
395E:C9 AA          069 <!--                           -->            CMP #$<span class='n'>AA</span>        ADR MARK 2?                     ; <a class='magic' name='#_395F'>magic number</a> <span class='macro'>DISK_ADR_PROLOG_2 EQU #$AA</span>
3960:D0 F2          070 <!--                           -->            BNE RDASN1      (IF NOT, IS IT AM1?)
3962:A0 03          071 <!--                           -->            LDY #$3         INDEX FOR 4-BYTE READ.          ; Technically, we read 8 disk nibbles &rarrow; 4 memory bytes
                    072 <!--                           -->*                           (ADDED NIBL DELAY)
3964:BD 8C C0       073 <a class="f" name="RDA3"     >RDA3        </a>LDA Q6L,X
3967:10 FB          074 <!--                           -->            BPL RDA3        *** NO PAGE CROSS! ***
3969:C9 96          075 <!--                           -->            CMP #$<span class='n'>96</span>        ADR MARK 3?                     ; <a class='magic' name='#_396A'>magic number</a> <span class='macro'>DISK_ADR_PROLOG_3 EQU #$96</span>
396B:D0 E7          076 <!--                           -->            BNE RDASN1      (IF NOT, IS IT AM1?)
                    077 <!--                           -->*                           (LEAVES CARRY SET!)             ; C=1, <i>And this important WHY?</i> Carry becomes Bit 0 of 4&4 Checksum odd nibble, Line #<a class='line' href='#RDADSEK.082'>082</a>
396D:A9 00          078 <!--                           -->            LDA #$<span class='n'>0</span>         INIT CHECKSUM.
396F:85 27          079 <a class="f" name="RDAFLD"   >RDAFLD      </a>STA CSUM
3971:BD 8C C0       080 <a class="f" name="RDA4"     >RDA4        </a>LDA Q6L,X       READ 'ODD BIT' NIBL.            ; Technically, read odd <b>bits</b>
3974:10 FB          081 <!--                           -->            BPL RDA4        *** NO PAGE CROSS! ***          ; A=1a1c1e1g
3976:2A             <a class='line' name='RDADSEK.082'>082</a>             ROL A           ;ALIGN ODD BITS, '1' into LSB.  ; A=a1c1e1gC, and C <i>stays</i> set
3977:85 26          083 <!--                           -->            STA LAST
3979:BD 8C C0       084 <a class="f" name="RDA5"     >RDA5        </a>LDA Q6L,X       READ 'EVEN BIT' NIBL.           ; Technically, read even <b>bits</b>
397C:10 FB          085 <!--                           -->            BPL RDA5        *** NO PAGE CROSS! ***          ; A=1b1d1f1h
397E:25 26          086 <!--                           -->            AND LAST        MERGE ODD AND EVEN BITS         ; &amp;=a1c1e1g1
3980:99 2C 00       087 <!--                           -->            STA CSSTV,Y     STORE DATA BYTE.                ; A=abcdefgh, Store bytes in reverse order due to Y counting down
3983:45 27          088 <!--                           -->            EOR CSUM        XOR CHECKSUM
3985:88             089 <!--                           -->            DEY
3986:10 E7          090 <!--                           -->            BPL RDAFLD      LOOP ON 4 DATA BYTES.
3988:A8             091 <!--                           -->            TAY             IF FINAL CHECKSUM
3989:D0 B7          092 <!--                           -->            BNE RDERR       NONZERO, THEN ERROR.
398B:BD 8C C0       093 <a class="f" name="RDA6"     >RDA6        </a>LDA Q6L,X       FIRST BIT-SLIP NIBL.
398E:10 FB          094 <!--                           -->            BPL RDA6        *** NO PAGE CROSS! ***
3990:C9 DE          095 <!--                           -->            CMP #$<span class='n'>DE</span>                                        ; <a class='magic' name='#_3991'>magic number</a> <span class='macro'>DISK_ADR_EPILOG_1 EQU #$DE</span>
3992:D0 AE          096 <!--                           -->            BNE RDERR       ERROR IF NONMATCH.
3994:EA             097 <!--                           -->            NOP             DELAY BETWEEN NIBLS.
3995:BD 8C C0       098 <a class="f" name="RDA7"     >RDA7        </a>LDA Q6L,X       SECOND BIT-SLIP NIBL.
3998:10 FB          099 <!--                           -->            BPL RDA7        *** NO PAGE CROSS! ***
399A:C9 AA          100 <!--                           -->            CMP #$<span class='n'>AA</span>                                        ; <a class='magic' name='#_399B'>magic number</a> <span class='macro'>DISK_ADR_EPILOG_2 EQU #$AA</span>
399C:D0 A4          101 <!--                           -->            BNE RDERR       ERROR IF NONMATCH.              ; <b>Uh, what happened to checking the last disk nibble!?!?!</b> <span class='macro'>DISK_ADR_EPILOG_3 EQU #$EB</span>
399E:18             102 <a class="f" name="RDEXIT"   >RDEXIT      </a>CLC             CLEAR CARRY ON                  ; This probably deserves a "<i>No shit, Sherlock</i>"
399F:60             103 <!--                           -->            RTS             NORMAL READ EXITS.              ; Brilliant <i>hardware</i> engineers tend to clutter up code with useless trivial comments. :-/
                    104             SBTL '16-SECTOR SEEK'
                    105 **************************
                    106 *                        *
                    107 *  FAST SEEK SUBROUTINE  *                                  ; A fast seek is <i>completely useless</i>
                    108 *                        *                                  ; if READING forces extra disk spins due to buffer bloat
                    109 **************************
                    110 *                        *
                    111 *   ---- ON ENTRY ----   *
                    112 *                        *
                    113 *  X-REG HOLDS SLOTNUM   *
                    114 *         TIMES $10.     *
                    115 *                        *
                    116 *  A-REG HOLDS DESIRED   *
<hr>                    117 *         HALFTRACK,     *                                  ; === Page <a class='page' name='page110'>110</a> ===
                    118 *         (SINGLE PHASE) *
                    119 *                        *
                    120 *  CURTRK HOLDS CURRENT  *
                    121 *          HALFTRACK.    *
                    122 *                        *
                    123 *   ---- ON EXIT -----   *
                    124 *                        *
                    125 *  A-REG UNCERTAIN.      *
                    126 *  Y-REG UNCERTAIN.      *
                    127 *  X-REG UNCERTAIN.      *
                    128 *                        *
                    129 *  CURTRK AND TRKN HOLD  *
                    130 *      FINAL HALFTRACK.  *
                    131 *                        *
                    132 *  PRIOR HOLDS PRIOR     *
                    133 *    HALFTRACK IF SEEK   *
                    134 *    WAS REQUIRED.       *
                    135 *                        *
                    136 *  MONTIMEL AND MONTIMEH *
                    137 *    ARE INCREMENTED BY  *
                    138 *    THE NUMBER OF       *
                    139 *    100 USEC QUANTUMS   *
                    140 *    REQUIRED BY SEEK    *
                    141 *    FOR MOTOR ON TIME   *
                    142 *    OVERLAP.            *
                    143 *                        *
                    144 * --- VARIABLES USED --- *
                    145 *                        *
                    146 *  CURTRK, TRKN, COUNT,  *
                    147 *    PRIOR, SLOTTEMP     *
                    148 *    MONTIMEL, MONTIMEH  *
                    149 *                        *
                    150 **************************
39A0:86 2B          151 <a class="f" name="SEEK"     >SEEK        </a>STX SLOTTEMP    ;SAVE X-REG
39A2:85 2A          152 <!--                           -->            STA TRKN        ;SAVE TARGET TRACK
39A4:CD 78 04       153 <!--                           -->            CMP CURTRK      ON DESIRED TRACK?               ;
39A7:F0 53          154 <!--                           -->            BEQ <a class="x" href="#SEEKRTS">SEEKRTS</a>     ;YES, RETURN
39A9:A9 00          155 <!--                           -->            LDA #$<span class='n'>0</span>
39AB:85 26          156 <!--                           -->            STA TRKCNT      ;HALFTRACK COUNT.
39AD:AD 78 04       157 <a class="f" name="SEEK2"    >SEEK2       </a>LDA CURTRK      ;SAVE CURTRK FOR
39B0:85 27          158 <!--                           -->            STA PRIOR       ; DELAYED TURNOFF.
39B2:38             159 <!--                           -->            SEC
39B3:E5 2A          160 <!--                           -->            SBC TRKN        ;DELTA-TRACKS.
39B5:F0 33          161 <!--                           -->            BEQ <a class="x" href="#SEEKEND">SEEKEND</a>     ;BR IF CURTRK=DESTINATION
39B7:B0 07          162 <!--                           -->            BCS <a class="x" href="#OUT"    >OUT</a>         (MOVE OUT, NOT IN)
39B9:49 FF          163 <!--                           -->            EOR #$<span class='n'>FF</span>        CALC TRKS TO GO
39BB:EE 78 04       164 <!--                           -->            INC CURTRK      INCR CURRENT TRACK (IN).
39BE:90 05          165 <!--                           -->            BCC MINTST      (ALWAYS TAKEN)
39C0:69 FE          166 <a class="f" name="OUT"      >OUT         </a>ADC #$<span class='n'>FE</span>        CALC TRKS TO GO.
39C2:CE 78 04       167 <!--                           -->            DEC CURTRK      DECR CURRENT TRACK (OUT).
39C7:C5 26          168 <a class="f" name="MINTST"   >MINTST      </a>CMP TRKCNT                                      ; crappy abbreviation: <i>Min Test</i>
39C7:90 02          169 <!--                           -->            BCC MAXTST      AND 'TRKS MOVED'.
39C9:A5 26          170 <!--                           -->            LDA TRKCNT                                      ; crappy abbreviation: <i>Max Test</i>
39CB:C9 0C          171 <a class="f" name="MAXTST"   >MAXTST      </a>CMP #$<span class='n'>C</span>                                         ; <a class='magic' name='#_39CC'>magic number</a> <span class='code'>ON_TIME_SIZE EQU $C</span>, or even <span class='code'>OFFTABLE - ONTABLE</span>
39CD:BB 01          172 <!--                           -->            BCS STEP2       ;IF TRKCNT&gt;$B LEAVE Y ALONE (Y=$B).
39CF:A8             173 <a class="f" name="STEP"     >STEP        </a>TAY             ;ELSE SET ACCELERATION INDEX IN Y
                    174 <a class="f" name="STEP2"    >STEP2       </a>EQU *
39D0:38             175 <!--                           -->            SEC             ;CARRY SET=PHASE ON
39D1:20 EE 39       176 <!--                           -->            JSR SETPHASE    ;PHASE ON
39D4:B9 11 3A       177 <!--                           -->            LDA <a class="v" href="#ONTABLE"  >ONTABLE</a>,Y   FOR 'ONTIME'.
39D7:20 00 3A       178 <!--                           -->            JSR <a class="x" href="#MSWAIT"   >MSWAIT</a>      (100 USEC INTERVALS)
                    179 <!--                           -->*
<hr>39DA:A5 27          180             LDA <a class="v" href="#PRIOR"    >PRIOR</a>
39DC:18             181             CLC             ;CARRY CLEAR=PHASE OFF
39DD:20 F1 39       182             JSR <a class="x" href="#CLRPHASE">CLRPHASE</a>    ;PHASE OFF
39E0:BD 1D 3A       <a class='line' name='RDADSEEK.183'>183</a>             LDA <a class="v" href="#OFFTABLE">OFFTABLE</a>,Y  THEN WAIT 'OFFTIME'.
39E3:20 00 3A       184             JSR <a class="x" href="#MSWAIT"  >MSWAIT</a>      (100 USEC INTERVALS)
39E6:E6 26          185             INC <a class="v" href="#TRKCNT"  >TRKCNT</a>      'TRACKS MOVED' COUNT.
39E8:D0 C3          186             BNE <a class="x" href="#SEEK2"   >SEEK2</a>       (ALWAYS TAKEN)
                    187 *
                    188 <a class="f" name="SEEKEND"    >SEEKEND     </a>EQU *
39EA:20 00 3A       189             JSR <a class="x" href="#MSWAIT">MSWAIT</a>      ;A=0: WAIT 25 MS SETTLE
39ED:18             190             CLC
                    191 *
                    192 * TURN HEAD STEPPER PHASE ON/OFF
                    193 *
                    194 <a class="f" name="SETPHASE"   >SETPHASE    </a>EQU *
39EE:AD 78 04       195             LDA <a class="v" href="#CURTRK">CURTRK</a>      ;GET CURRENT PHASE
                    196 <a class="f" name="CLRPHASE"   >CLRPHASE    </a>EQU *
39F1:29 03          197             AND #<span class='n'>3</span>          ;MASK FOR 1 OF 4 PHASES
39F3:2A             198             ROL A           ;DOUBLE FOR PHASE INDEX
39F4:05 2B          199             ORA <a class="v" href="#SLOTTEMP">SLOTTEMP</a>
39F6:AA             200             TAX
39F7:BD 80 C0       201             LDA <a class="v" href="#PHASEOFF">PHASEOFF</a>,X  ;FLIP THE PHASE
39FA:A6 2B          202             LDX <a class="v" href="#SLOTTEMP">SLOTTEMP</a>    ;RESTORE X-REG
39FC:60             203 <a class="f" name="SEEKRTS"    >SEEKRTS     </a>RTS             ;AND RETURN                     ; /sarcasm I don't know what we would do without you Captain Obvious!
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="MSWAITR">MSWAITR</a> - Microsecond wait routine, Page <a class="page" name="page97">97</a>, <a class='ts' href='#T0S3'>T0S3</a> @ $FD - <a class='ts' href='#T0S6'>T0S6</a> @ $55, $<span class='n'>B9FD</span> .. $<span class='n'>BC55</span> ===<hr class='join'><hr></div>
<pre>
                    001                 SBTL '16-SECTOR MSWAIT'
                    002 **************************
                    003 *   MSWAIT SUBROUTINE    *
                    004 **************************
                    005 *                        *
                    006 *  DELAYS A SPECIFIED    *
                    007 *   NUMBER OF 100 USEC   *
                    008 *   INTERVALS FOR MOTOR  *
                    009 *   ON TIMING.           *
                    010 *                        *
                    011 *   ---- ON ENTRY ----   *
                    012 *  A-REG: HOLDS NUMBER   *
                    013 *        OF 100 USEC     *
                    014 *        INTERVALS TO    *
                    015 *        DELAY.          *
                    016 *                        *
                    017 *   ---- ON EXIT -----   *
                    018 *  A-REG: HOLDS $00.     *
                    019 *  X-REG: HOLDS $00.     *
                    020 *  Y-REG: UNCHANGED.     *
                    021 *  CARRY: SET.           *
                    022 *                        *
                    023 *  MONTIMEL, MONTIMEH    *
                    024 *   ARE INCREMENTED ONCE *
                    025 *   PER 100 USEC INTERVAL*
                    026 *   FOR MOTON ON TIMING. *
                    027 *    ---- ASSUMES ----   *
                    028 * 1 USEC CYCLE TIME      *
                    029 **************************
39FD:00 00 00       <a class='line' name='MSWAITR.030'>030</a>         DS 3,0              ;AVOID PAGE BOUNDARY CROSSING...; <a class='ts' href='#T0S3'>T0S3</a> @ $FC <a class='mem' name='_39FD'>wastes</a> 3 bytes
3A00:A2 11          031 <a class="f"    name="MSWAIT"     >MSWAIT      </a>LDX #$<span class='n'>11</span>                                        ; === <a class='ts' href='#T0S4'>T0S4</a> === *sigh* Typical bloated code ...
3A02:CA             032 <a class="f"    name="MSW1"       >MSW1        </a>DEX             DELAY 86 USEC.                  ; ... should just adjust algorithm timing instead!
3A03:D0 FD          033             BNE <a class="x" href="#MSW1"    >MSW1</a>
3A05:E6 46          034             INC <a class="v" href="#MONTIMEL">MONTIMEL</a>
3A07:D0 02          035             BNE <a class="x" href="#MSW2"    >MSW2</a>        ; DOUBLE-BYTE
3A09:E6 47          036             INC <a class="v" href="#MONTIMEH">MONTIMEH</a>    INCREMENT.
3A0B:38             037 <a class="f"    name="MSW2"       >MSW2        </a>SEC
3A0C:E9 01          038             SBC #$<span class='n'>1</span>         DONE 'N' INTERVALS?
3A0E:D0 F0          039             BNE <a class="x" href="#MSWAIT">MSWAIT</a></b>            (A-REG COUNTS)
3A10:60             040             RTS
                    041 AEC1        EQU *           ;TELL RELOCATOR WHERE CORE ENDS
                    042 **************************
                    043 *  PHASE ON-, OFF-TIME   *
                    044 *   TABLES IN 100-USEC   *
                    045 *   INTERVALS. (SEEK)    *
                    046 **************************
3A11:01 30 28       047 <a class="d" name="ONTABLE"    >ONTABLE     </a>DFB 1,$30,$28                                   ; See <a class="file" href="#RDADSEK">RDADSEK</a>, Page <a class="page" href="#page108">108</a>, Line #<a class='line'>TODO</a>
3A14:24 20 1E       048             DFB $24,$20,$1E
3A17:1D 1C 1C       049             DFB $1D,$1C,$1C
3A1A:1C 1C 1C       050             DFB $1C,$1C,$1C
3A1D:70 2C 26       051 <a class="d" name="OFFTABLE"   >OFFTABLE    </a>DFB $70,$2C,$26                                 ; See <a class="file" href="#RDADSEK">RDADSEK</a> Page <a class="page" href="#page109">109</a>, Line #<a class='line' href='#RDADSEK.183'>183</a>
3A20:22 1F 1E       052             DFB $22,$1F,$1E
3A23:1D 1C 1C       053             DFB $1D,$1C,$1C
<hr>3A26:1C 1C 1C       054             DFB $1C,$1C,$1C                                 ; === Page <a class="page" name="page98">98</a> ===
                    055             SBTL '16-SECTOR NYBBLE TABLES'
                    056 ***************************
                    057 *                         *
                    058 *     6-BIT TO 7-BIT      *
                    059 *  NIBL CONVERSION TABLE  *
                    060 *                         *
                    061 ***************************
                    062 *                         *
                    063 *   CODES WITH MORE THAN  *
                    064 *   ONE PAIR OF ADJACENT  *
                    065 *    ZEROES OR WITH NO    *
                    066 *   ADJACENT ONES (EXCEPT *
                    067 *     B7) ARE EXCLUDED.   *
                    068 *                         *
                    069 * THIS TABLE MAY *NOT*    *
                    070 * CROSS A PAGE BOUNDARY!  *
                    071 *                         *
                    072 ***************************
3A29:96 97 9A       073 <a class="d"    name="NIBL"       >NIBL        </a>DFB $96,$97,$9A                                 ; /sarcasm, Gee if only
3A2C:9B 9D 9E       074             DFB $9B,$9D,$9E                                 ; there was a HEX pseudo-mnemonic
3A2F:9F A6 A7       075             DFB $9F,$A6,$A7                                 ; so we could group these in 4 bytes ...
3A32:AB AC AD       076             DFB $AB,$AC,$AD                                 ; ... maybe one day. :)
3A35:AE AF B2       077             DFB $AE,$AF,$B2                                 ; NOTE: Also see <a class='v' href="#NIBL">NIBL</a> and <a class='v' href="#PD2">PD2</a>
3A38:B3 B4 B5       078             DFB $B3,$B4,$B5
3A3B:B6 B7 B9       079             DFB $B6,$B7,$B9
3A3E:BA BB BC       080             DFB $BA,$BB,$BC
3A41:BD BE BF       081             DFB $BD,$BE,$BF
3A44:CB CD CE       082             DFB $CB,$CD,$CE
3A47:               083             DFB $CF,$D3,$D6
                    084             DFB $D7,$D9,$DA
                    085             DFB $DB,$DC,$DD
                    086             DFB $DE,$DF,$E5
                    087             DFB $E6,$E7,$E9
                    088             DFB $EA,$EB,$EC
                    089             DFB $ED,$EE,$EF
                    090             DFB $F2,$F3,$F4
                    091             DFB $F5,$F6,$F7
                    092             DFB $F9,$FA,$FB
                    093             DFB $FC,$FD,$FE
                    094             DFB $FF
                    095             PAGE
                    096 ***************************
                    097 *      7-BIT TO 6-BIT     *
                    098 *     'DENIBLIZE' TABL    *
                    099 *    (16-SECTOR FORMAT)   *
                    100 *                         *
                    101 *       VALID CODES       *
                    102 *     $96 TO $FF ONLY.    *
                    103 *                         *
                    104 *                         *
                    105 *   CODES WITH MORE THAN  *
                    106 *   ONE PAIR OF ADJACENT  *
                    107 *    ZEROES OR WITH NO    *
                    108 *   ADJACENT ONES (EXCEPT *
                    109 *    BIT 7) ARE EXCLUDED. *
                    110 *                         *
                    111 * THIS TABLE *MUST* BE    *
                    112 * ALIGNED AT THE END OF   *
                    113 * A PAGE IN MEMORY!!!     *
                    114 ***************************
                    115 <a class="d"    name='XP'         >XP          </a>EQU &lt;*          ;CURRENT PAGE ADDRESS
                    116 <a class="d"    name='DNIBL'      >DNIBL       </a>EQU 256*XP      ;DNIBL  TABLE PAGE              ; See <a class='f' href='#READ4'>READ4</a>
<hr>                    117             PAGE                                            ; === Page <a class='page' name='page99'>99</a> ===
                    118 ***********************************************
                    119 *
                    120 * GHOST APPEND BUG PATCH BY
                    121 * BILL GRIMM
                    122 *
                    123 ***********************************************
                    124 <a class='f'    name='PSC1'       >PSC1        </a>EQU *           ;Tell relocater where to start
                    125 <a class='f'    name='MOVEOF'     >MOVEOF      </a>EQU *                         ; Called from <a class='x' href='#DOSGO2A'>DOSGO2A</a>
3A69:AE 5F 2A       126             LDX <a class='v' href='#CMDNO'>CMDNO</a>       ; GET CMD NUMBER
3A6C:E0 1C          127             CPX #$<span class='n'>1C</span>        ; APPEND COMMAND?               ; <a class='magic' name='#_3A6D'>magic number</a> <span class='todo'>TODO</span>
3A6E:F0 05          128             BEQ <a class='x' href='#GOON'>GOON</a>        ; YES, RETURN TO CALLING ROUTINE
3A70:A2 00          129             LDX #$<span class='n'>00</span>        ; NO, THEN CLEAR X              ; <i>Aye, Aye, Captain Obvious</i>
3A72:8E 5D 36       130             STX <a class='v' href='#EOFFLAG'>EOFFLAG</a>     ; CLEAR EOF FLAG
3A75:60             131 <a class='f'    name='GOON'       >GOON        </a>RTS
                    132             SKP 4
                    133 ***********************************************
                    134 *
                    135 * TURN Apple //e 80 COLUMN CARD
                    136 * OFF &amp; INIT APPLE
                    137 *
                    138 ***********************************************
                    139 <a class='f'    name='OFF80'      >OFF80       </a>EQU *
3A76:A9 FF          140             LDA #$<span class='n'>FF</span>
3A78:8D FB 04       141             STA $<span class='n'>4FB</span>        ; CLEARS FUNNY 80 COL STUFF
3A7B:8D 0C C0       142             STA $<span class='n'>C00C</span>       ; TURNS 80 COL OFF
3A7E:8D 0E C0       143             STA $<span class='n'>C00E</span>       ; TURN OFF  ALT CHAR SET        ; /sarcasm <i>If only we could define symbols ...</i>
3A81:4C 2F FB       144             JMP $<span class='n'>FB2F</span>       ; MONITOR INIT ROUTINE          ;          <i>Oh wait!</i> <b>We already have</b> <a class='x' href='#MONINIT'>MONINIT</a> in <a class='file' href='#BOOTLDR'>BOOTLDR</a>
                    145             PAGE
                    146 <a class="f" name="PEC1"        >PEC1        </a>EQU *           ;Tell relocater where to stop   ; See <a class="v" href="#CDETAB">CDETAB</a>, <a class="file" href="#RELOCTR">RELOCTR</a>, Page <a class="page" href="#page115">115</a>
                    147 PD1         EQU &gt;*
                    148 <a class="f" name="PD2"         >PD2         </a>EQU $96-PD1<span class="patch">
                    === DOS 3.3 D? PATCH ===        
                    3A84:AD BD 35   LDA $<span class='n'>35BD</span> ; <span class="todo">TODO</span>
                    3A87:8D E6 35   STA $<span class='n'>35E6</span> ; <span class="todo">TODO</span>
                    3A8A:8D EA 35   STA $<span class='n'>35EA</span> ; <span class="todo">TODO</span>
                    3A8D:BA         TSX             
                    3A8E:8E 9B 33   STX $<span class='n'>339B</span> ; <span class="todo">TODO</span>
                    3A91:4C 7F 33   JMP $<span class='n'>337F</span> ; <span class="todo">TODO</span>
                    === DOS 3.3 ? PATCH ===         </span>
3A84:00 00 00 00    149             DS  PD2,0       ;Must pad to $XX96              ; *wastes* 18 bytes
3A88:00 00 00 00                                                                    ; No, no, no!
3A8C:00 00 00 00                                                                    ; Negative array index OFFSETS like the P6 PROM uses
3A90:00 00 00 00                                                                    ;
3A94:00 00
3A96:00 01 98       150             DFB $00,$01,$98                                 ; 96 97 --   *sigh* And the comment that this is the
3A99:99 02 03       151             DFB $99,$02,$03                                 ; -- 9A 9B   64 disk nibbles of 6&amp;2 Read Table
3A9C:9C 04 05       152             DFB $9C,$04,$05                                 ; -- 9D 9E   is where again? Comments people, comments!
3A9F:06 A0 A1       153             DFB $06,$A0,$A1                                 ; 9F -- --   Hey, after annotating 154 pages
3AA2:A2 A3 A4       154             DFB $A2,$A3,$A4                                 ; -- -- --   you would be grumpy too. :-)
3AA5:A5 07 08       155             DFB $A5,$07,$08                                 ; -- A6 A7
3AA8:A8 A9 AA       156             DFB $A8,$A9,$AA                                 ; -- -- !!   (!! Technically AA is a valid disk nibble)
3AAB:09 0A 0B       157             DFB $09,$0A,$0B                                 ; AB AC AD   but it reserved for a 3 byte header id
3AAE:0C 0D B0       158             DFB $0C,$0D,$B0                                 ; AE AF --   Typical DOS 3.3 B-L-O-A-T
3AB1:B1 0E 0F       159             DFB $B1,$0E,$0F                                 ; -- B2 B3   One reserved byte D5 could be used for T/S  header
3AB4:10 11 12       160             DFB $10,$11,$12                                 ; B4 B5 B6   One reserved byte AA could be used for Data header
3AB7:13 B8 14       161             DFB $13,$B8,$14                                 ; B7 -- B9
3ABA:15 16 17       162             DFB $15,$16,$17                                 ; BA BB BC
3ABD:18 19 1A       163             DFB $18,$19,$1A                                 ; BD BE BF
3AC0:C0 C1 C2       164             DFB $C0,$C1,$C2                                 ; -- -- --   *wastes* 11 bytes (unused)
3AC3:C3 C4 C5       165             DFB $C3,$C4,$C5                                 ; -- -- --   /sarcasm But who cares, we have 48K right!?
3AC6:C6 C7 C8       166             DFB $C6,$C7,$C8                                 ; -- -- --   This is why DOS takes seconds longer to boot.
3AC9:C9 CA 1B       167             DFB $C9,$CA,$1B                                 ; -- -- CB
3ACC:CC 1C 1D       168             DFB $CC,$1C,$1D                                 ; -- CD CE   *sigh* This entire table can be compactly
3ACF:1E D0 D1       169             DFB $1E,$D0,$D1                                 ; CF -- --   represented with 8 lines instead of 36 lines
3AD2:D2 20 21       170             DFB $D2,$1F,$D4                                 ; -- D3 --   If only we had a HEX pseudo-mnemonic ...
3AD5:D5 20 21       171             DFB $D5,$20,$21                                 ; @@ D6 D7   (@@ Technically D5 is valid but is reserved too)
3AD8:D8 22 23       172             DFB $D8,$22,$23                                 ; -- D9 DA      x0 x1 x2 x3 x4 x5 x6 x7 x8 x9 xA xB xC xD xE xF
3ADB:24 25 26       173             DFB $24,$25,$26                                 ; DB DC DD   9x:-- -- -- -- -- -- 00 01 -- -- 02 03 -- 04 05 06
3ADE:27 28 E0       174             DFB $27,$28,$E0                                 ; DE DF --   Ax:-- -- -- -- -- -- 07 08 -- -- !! 09 0A 0B 0C 0D
3AE1:E1 E2 E3       175             DFB $E1,$E2,$E3                                 ; -- -- --   Bx:-- -- 0E 0F 10 11 12 13 -- 14 15 16 17 18 19 1A
3AE4:E4 29 2A       176             DFB $E4,$29,$2A                                 ; -- E5 E6   Cx:-- -- -- -- -- -- -- -- -- -- -- 1B -- 1C 1D 1E
3AE7:2B E8 2C       177             DFB $2B,$E8,$2C                                 ; E7 -- E9   Dx:-- -- -- 1F -- @@ 20 21 -- 22 23 24 25 26 27 28
3AEA:2D 2E 2F       178             DFB $2D,$2E,$2F                                 ; EA EB EC   Ex:-- -- -- -- -- 29 2A 2B -- 2C 2D 2E 2F 30 31 32
3AED:30 31 32       179             DFB $30,$31,$32                                 ; ED EE EF   Fx:-- -- 33 34 35 36 37 38 -- 39 3A 3B 3C 3D 3E 3F
<hr>3AF0:F0 F1 33       180             DFB $F0,$F1,$33                                 ; -- -- F2   === Page <a class="page" name="page100">100</a> ===
3AF3:34 35 36       181             DFB $34,$35,$36                                 ; F3 F4 F5
3AF6:37 38 F8       182             DFB $37,$38,$F8                                 ; F6 F7 --
3AF9:39 3A 3B       183             DFB $39,$3A,$3B                                 ; F9 FA FB
3AFC:3C 3D 3E       184             DFB $3C,$3D,$3E                                 ; FC FD FE
3AFF:3F             185             DFB $3F                                         ; FF
                    186             PAGE
                    187 ***************************
                    188 *                         *
                    189 *    NYBBLE BUFFERS       *
                    190 *                         *
                    191 * NBUF1 (256 BYTES) MUST  *
                    192 *  BE ALIGNED ON A PAGE   *
                    193 *  BOUNDARY.              *
                    194 *                         *
                    195 * NBUF2 (86 BYTES) MUST   *                                 ; Incorrect: It must _not_ CROSS
                    196 *  BE ALIGNED ON A PAGE   *                                 ; a page boundary. Technically, It can be
                    197 *  BOUNDARY.              *                                 ; anywhere *within* the page. But then the
                    198 *                         *                                 ; code at <a class="file" href="#WRITRTN">WRITRTN</a>, Line #<a class='line' href='WRITRTN.080'>>80</a> needs fixing up.
                    199 ***************************                                 ;
                    200 *                                                           ;
3B00:00 00 00 00    201 <a class="d" name="NBUF1"       >NBUF1       </a>DS 256,0        ;NBUF1                          ; === <a class='ts' href='#T0S5'>T0S5</a> === <a class='disk'>disk</a> sector wasted with zeroes
3B04:00 00 00 00                                                                    ; *sigh* Let's waste an *entire* sector
3B08:00 00 00 00                                                                    ; with 342 disk nibbles of raw $96 nibbles
3B0C:00 00 00 00                                                                    ; PLUS the time decoding it
3B10:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ; when _9 bytes_ would do
3B20:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ; the job
3B30:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;
3B40:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;    LDA #0
3B50:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;    TAY
3B60:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;.1  STA NBUF1,Y
3B70:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;    INY
3B80:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ;    BNE .1
3B90:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                :
3BA0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ; This data should at $3F00 ($BF00)
3BB0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3BC0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3BD0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3BE0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3BF0:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
;     0  1  2  3  4  5  6  7  8  9  A  B  C  D  E  F

3C00:00 00 00 00    202 <a class="d" name="NBUF2"       >NBUF2       </a>DS  86,0        ;NBUF2                          ;  === <a class='ts' href='#T0S6'>T0S6</a> ===
3C04:00 00 00 00                                                                    ; *sigh* more wasted disk space
3C08:00 00 00 00                                                                    ; pack code THEN data
3C0C:00 00 00 00                                                                    ; as interleaving it just
3C10:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00                                ; wastes memory
3C20:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3C30:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3C40:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
3C50:00 00 00 00 00 00
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="WRITADR">WRITADR</a> - Write Address, Page <a class="page" name="page134">134</a>, <a class='ts' href='#T0S6'>T0S6</a> @ $56, $<b class='n'>BC56</b> .. $<b class='n'>BCFF</b> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL '16-SECTOR WRITE ADDRESS'
                    002 
                    003 
                    004 
                    005 
                    006 
                    007 
                    008 
                    009 
                    010 
                    011 
                    012 
                    013 
                    014 
                    015 
                    016 
                    017 
                    018 
                    019 
                    020 
                    021 
                    022 
                    023 
                    024 
                    025 
                    026 
                    027 
                    028 
                    029 
                    030 
                    031 
                    032 
                    033 
                    034 
                    035 
                    036 
                    037 
                    038 
                    039 
                    040 
                    041 
                    042 
                    043 
                    044 
                    045 
                    046 
                    047 
                    048 
                    049 
                    050 
                    051 
                    052 
3C56:38             053 WADR16      SEC             ANTICIPATE WR PROT ERR.
3C57:BD 8D C0       054             LDA <a class="v" href="#Q6H"   >Q6H</a>,X       INTO 'WR PROT SENSE' MODE.
3C5A:BD 8E C0       055             LDA <a class="v" href="#Q7L"   >Q7L</a>,X       SENSE IT (NEG=PROTECTED)
3C5D:30 5E          056             BMI <a class="x" href="#WADRTS">WADRTS</a>      ERR EXIT IF PROTECTED.

3C5F:A9 FF          057             LDA #$<span class='n'>FF</span>        SELF-SYNC NIBL.
3C61:9D 8F C0       058             STA <a class="v" href="#Q7H"   >Q7H</a>,X       WRITE FRIST NIBL.
3C64:DD 8C C0       059             CMP <a class="v" href="#Q6L"   >Q6L</a>,X       (4) BACK TO WRITE MODE.
3C67:48             060             PHA             (3) FOR DELAY
3C68:68             061             PLA             (4)
                    062 
                    063 
                    064 
                    065 
                    066 
                    067 
                    068 
                    069 
                    070 
                    071 
                    072 
                    073 
                    074 
                    075 
                    076 
                    077 
                    078 
                    079 
                    080 
                    081 
                    082 
                    083 
                    084 
                    085 
                    086 
                    087 
                    088 
                    089 
                    090 
                    091 
                    092 
                    093 
                    094 
                    095 
                    096 
                    097 
                    098 
                    099 
                    100 
                    101 
                    102 
                    103 
                    104 
                    105 
                    106 
                    107 
                    108 
                    109 
                    110 
                    111 
                    112 
                    113 
                    114 
                    115 
                    116 
                    117 
                    118 
                    119 
                    120 
                    121 
                    122 
                    123 
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="RWTSONE">RWTSONE</a> - Read Write Track Sector - Part 1, Page <a class="page" name="page116">116</a>, <a class='ts' href='#T0S7'>T0S7</a>, $<b class='n'>BD00</b> .. $<b class='n'>BDAA</b> ===<hr class='join'><hr></div>
<pre>
                    001             STBL '16-SECTOR RWTS'
                    002 
                    003 
                    004 
                    005 
                    006 
                    007 
                    008 
                    009 
                    010 
                    011 
                    012 
                    013 
                    014 
                    015 
                    016 
                    017 
                    018 
                    019 
                    020 
                    021 
                    022 
                    023 
                    024 
                    025 
                    026 
                    027 
                    028 
                    029 
                    030 
                    031 
                    032 
                    033 
                    034 
                    035 
                    036 
                    037 
                    038 
                    039 
                    040 
                    041 
                    042 
                    043 
                    044 
                    045 
                    046 
                    047 
                    048 
                    049 
                    050 
                    051 
                    052 
                    053 
                    054 
                    055 
                    056 
                    057 
                    058 
                    059 
                    060 
                    061 
                    062 
                    063 
                    064 
                    065 
                    066 
                    067 
                    068 
                    069 
                    070 
                    071 
                    072 
                    073 
                    074 
                    075 
                    076 
                    077 
                    078 
                    079 
                    080 
                    081 
                    082 
                    083 
                    084 
                    085 
                    086 
                    087 
                    088 
                    089 
                    090 
                    091 
                    092 
                    093 
                    094 
                    095 
                    096 
                    097 
                    098 
                    099 
                    100 
                    101 
                    102 
                    103 
                    104 
                    105 
                    106 
                    107 
                    108 
                    109 
                    110 
                    111 
                    112 
                    113 
                    114 
                    115 
                    116 
                    117 
                    118 
                    119 
                    120 
                    121 
                    122 
                    123 
                    124 
                    125 
                    126 
                    127 
                    128 
                    129 
                    130 
                    131 
                    132 
                    133 
                    134 
                    135 
                    136 
                    137 
                    138 
                    139 
                    140 
                    141 
                    142 
                    143 
                    144 
                    145 
                    146 
                    147 
                    148 
                    149 
                    150 
                    151 
                    152 
                    153 
                    154 
                    155 
                    156 
                    157 
                    158 
                    159 
                    160 
                    161 
                    162 
                    163 
                    164 
                    165 
                    166 
                    167 
                    168 
                    169 
                    170 
                    171 
                    172 
                    173 
                    174 
                    175 
                    176 
                    177 
                    178 
                    179 
                    180 
                    181 
                    182 
                    183 
                    184 
                    185 
                    186 
                    187 
                    188 
                    189 
                    190 
                    191 
                    192 
                    193 
                    194 
                    195 
                    196 
                    197 
                    198 
                    199 
                    200 
                    201 
                    202 
                    203 
                    204 
                    205 
                    206 
                    207 
                    208 
                    209 
                    210 
                    211 
                    212 
                    213 
                    214 
                    215 
                    216 
                    217 
                    218 
                    219 
                    220 
                    221 
                    222 
                    223 
                    224 
                    225 
                    226 
                    227 
                    228 
                    229 
                    230 
                    231 
                    232 
                    233 
                    234 
                    235 
                    236 
                    237 
                    238 
                    239 
                    240 
                    241 
                    242 
                    243 
                    244 
                    245 
                    246 
                    247 
                    248 
                    249 
                    250 
                    251 
                    252 
                    253 
                    254 
                    255 
                    256 
                    257 
                    258 
                    259 
                    260 
                    261 
                    262 
                    263 
                    264 
                    265 
                    266 
                    267 
                    268 
                    269 
                    270 
                    271 
                    272 
                    273 
                    274 
                    275 
                    276 
                    277 
                    278 
                    279 
                    280 
                    281 
                    282 
                    283 
                    284 
                    285 
                    286 
                    287 
                    288 
                    289 
                    290 
                    291 
                    292 
                    293 
                    294 
                    295 
                    296 
                    297 
                    298 
                    299 
                    300 
                    301 
                    302 
                    303 
                    304 
                    305 
                    306 
                    307 
                    308 
                    309 
                    310 
                    311 
                    312 
                    313 
                    314 
                    315 
                    316 
                    317 
                    318 
                    319 
                    320 
                    321 
                    322 
                    323 
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="RWTSTWO">RWTSTWO</a> - Read Write Track Sector - Part 2, Page <a class="page" name="page122">122</a>, <a class='ts'>T0S7</a> - <a class='ts' href='#T0S8'>T0S8</a>, $<b class='n'>BDAB</b> .. $<b class='n'>BEAE</b> ===<hr class='join'><hr></div>
<pre>
                    001 *
                    002 * DISK IS NOW UP TO SPEED: READ IT!
                    003 * NOW CHECK: IF IT IS NOT THE FORMAT DISK COMMAND,
                    004 * LOCATE THE CORRECT SECTOR FOR THIS OPERATION.
                    005 *
                    006 <a class="f"    name="TRYTRK"     >TRYTRK      </a>EQU *
3DAB:A0 0C          007             LDY #$<span class='n'>0C</span>                                        ; <a class='magic' name='_3DAB'>magic number</a> IOB_OFFSET_CMD = $C
3DAD:B1 48          008             LDA (<a class="d" href="#IOBPL">IOBPL</a>),Y   ;GET COMMAND CODE #
3DAF:F0 5A          009             BEQ <a class="x" href="#GALLDONE">GALLDONE</a>    ;IF NULL COMMAND, GO HOME TO BED.           ; v
3DB1:C9 04          010             CMP #$<span class='n'>04</span>        ;FORMAT THE DISK?               ; *sigh* RWTS_CMD_FORMAT = 4
3DB3:F0 58          011             BEQ <a class="x" href="#FORMDSK">FORMDSK</a>     ;ALLRIGHT,ALLRIGHT, I WILL...
3DB5:6A             012             ROR A           ;SET CARRY=1 FOR READ, 0 FOR WRITE
3DB6:08             013             PHP             ;AND SAVE THAT
3DB7:B0 03          014             BCS <a class="x" href="#TRYTRK2">TRYTRK2</a>     ;MUST PRENIBBLE FOR WRITE.
                    015     LST OFF
                    016     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    017         LDY #TC17           ;SAY 'PRENIBBLIZING'
                    018         STY TL7                                 </span>
                    019     FIN
                    020     LST ON
3DB9:20 00 38       021             JSR <a class="x" href="#PRENIB16">PRENIB16</a>
                    022     LST OFF
                    023     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    024         LDY #SP             ;PRENIB FINISHED    
                    025         STY TL7                                 </span>
                    026     FIN
                    027     LST ON
3DBC:A0 30          028 <a class="f" name="TRYTRK2"     >TRYTRK2     </a>LDY #$30        ;ONLY 48 RETRIES OF ANY KIND.
3DBE:8C 78 05       029             STY RETRYCNT
3DC1:AE F8 05       030 <a class="f" name="TRYADR"      >TRYADR      </a>LDX SLOT        ;GET SLOT NUM INTO X-REG
                    031     LST OFF
                    032     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    033         LDA #TC4            ;SAY 'READING ADDRESS'          
                    034         STA TL4                                             
                    035         LDA #SP             ;SAY 'NO ADDRESS ERROR' (YET)   
                    036         STA TL6                                             </span>
                    037     FIN
                    038     LST ON
3DC4:20 44 39       039             JSR <a class="x" href="#RDADR16">RDADR16</a>     ;READ NEXT ADDRESS FIELD        ; ^
                    040     LST OFF
                    041     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    042         LDA #SP             ;ADDRESS-READ DONE              
                    043         STA TL4                                             </span>
                    044     FIN
                    045     LST ON
3DC7:90 24          046             BCC <a class="x" href="#RDRIGHT">RDRIGHT</a>     ;IF READ IT RIGHT, HURRAH!      ; v
                    047     LST OFF
                    048     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    049         LDA #TC6            ;ADDRESS-READ DONE              
                    050         STA TL4                                             </span>
                    051     FIN
                    052     LST ON
3DC9:CE 78 05       053 <a class="f" name="TRYADR2"     >TRYADR2     </a>DEC RETRYCNT    ;ANOTHER MISTAEK!!              ; *spelling* **irony**
<hr>3DCC:10 F3          054             BPL <a class="x" href="#TRYADR">TRYADR</a>      ; WELL, LET IT GO THIS TIME..   ; === page <span class="page">123</span> ===
                    055 *
                    056 * RRRRRECALIBRATE !!!!
                    057 *
                    058 RECAL       EQU *
3DCE:AD 78 04       059             LDA CURTRK
3DD1:48             060             PHA             ;SAVE TRACK WE REALLY WANT      ; /sarcasm Nice to read <a class="v" href="#VNOTRK">VNOTRK</a> * 2 phases/track
3DD2:A9 60          061             LDA #$<span class='n'>60</span>        ;RECALIBRATE ALL OVER AGAIN!    ; /sarcasm <i>Yeah ... let's bang the user's drive head against</i>
3DD4:20 95 3E       062             JSR <a class="x" href="#SETTRK">SETTRK</a>      ;PRETEND TO BE ON TRACK 96      ; <i>the case -- that will make it work and won't cause</i>
3DD7:CE F8 06       063             DEC RECALCCNT   ;ONCE TOO MANY??                ; <i>any head alignment problems over time ...</i> <b>NOT!</b>
3DDC:F0 28          064             BEQ <a class="x" href="#DRVERR">DRVERR</a>      ;TRIED TO RECALIBRATE TOO MANY TIMES, ERROR! ; v
3DDE:A9 04          065             LDA #MAXSEEKS   ;RESET THE
3DDE:8D F8 04       066             STA SEEKCNT     ; SEEK COUNTER
3DE1:A9 00          067             LDA #$00
3DE3:20 5A 3E       068             JSR <a class="x" href="#MYSEEK">MYSEEK</a>      ;MOVE TO TRACK 00               ; v
3DE6:68             069             PLA
3DE7:4C 5A 3E       070 <a class="f" name="RESEEK"      >RESEEK      </a>JSR <a class="x" href="#MYSEEK">MYSEEK</a>      ;GO TO CORRECT TRACK THIS TIME!
3DEA:4C BC 3D       071             JMP <a class="x" href="#TRYTRK2">TRYTRK2</a>     ;LOOP BACK, TRY AGAIN ON THIS TRACK
                    072 *
                    073 * HAVE NOW READ
                    074 * MAKE SURE THIS IS THE TRACK, SECTOR, AND VOLUME DESIRED.
                    075 *
3DED:A4 2E          076 <a class="f" name="RDRIGHT"     >RDRIGHT     </a>LDY TRACK       ;ON THE RIGHT TRACK?
3DEF:CC 78 04       077             CPY CURTRK
3DF2:F0 1C          078             BEQ <a class="x" href="#RTTRK">RTTRK</a>       ;IF SO, GOOD                    ; v
                    079 * NO, DRIVE WAS ON A DIFFERENT TRACK. TRY
                    080 * RESEEKING/RECALIBRATING FROM THIS TRACK
3DF4:AD 78 04       081             LDA CURTRK      ;PRESERVE DESTINATION TRACK
3DF7:48             082             PHA
3DF8:98             083             TYA
3DF9:20 95 3E       084             JSR <a class="x" href="#SETTRK">SETTRK</a>
3DFC:68             085             PLA
3DFD:CE F8 04       086             DEC <a class="v" href="#SEKCNT">SEKCNT</a>      ;SHOULD WE RESEEK?
3E00:D0 E5          087             BNE <a class="x" href="#RESEEK">RESEEK</a>      ;=&gt;YES, RESEEK                  ; ^ === <a class='ts' href='#T0S8'>T0S8</a> ===
3E02:F0 CA          088             BEQ <a class="x" href="#RECAL" >RECAL</a>       ;=&gt;NO, RECALIBRATE!             ; ^
                    089 ****
3E04:68             090 <a class="f" name="DRVERR"      >DRVERR      </a>PLA             ;REMOVE CURTRK
3E05:A9 40          091             LDA #<a class="v" href="#IBDERR">IBDERR</a>     ;BAD DRIVE ERROR
3E07:28             092 <a class="f" name="JMPTO1"      >JMPTO1      </a>PLP
3E08:4C 48 3E       093             JMP <a class="x" href="#HNDLERR">HNDLERR</a>
3E0B:F0 39          094 <a class="f" name="GALLDONE"    >GALLDONE    </a>BEQ <a class="x" href="#ALLDONE">ALLDONE</a>                                     ; v
3E0D:4C AF 3E       095 <a class="f" name="FORMDSK"     >FORMDSK     </a>JMP <a class="x" href="#DSKFORM">DSKFORM</a>     ;=&gt;GO TO IT!                    ; v
                    096 *
                    097 * DRIVE IS ON RIGHT TRACK, CHECK VOLUME MISMATCH
                    098 *
3E10:A0 03          099 <a class="f" name="RTTRK"       >RTTRK       </a>LDY #3          ;IS THE RIGHT DISK IN?
3E12:B1 48          100             LDA (<a class="v" href="#IOBPL"     >IOBPL</a>),Y   ;GET DESIRED VOLUM
3E14:48             101             PHA             ;PRESERVE DESIRED VOLUME#
3E15:A5 2F          102             LDA <a class="v"  href="#VOLUME"    >VOLUME</a>      ;GET ACTUAL VOLUME HERE
3E17:A0 0E          103             LDY #$<span class='n'>0E</span>        ;TELL OPSYS WHAT VOLUME WAS THERE ; <a class='magic' name='_3E17'>magic number</a> IOB_OFFSET_VOL = $E
3E19:91 48          104             STA (<a class="v" href="#IOBPL"     >IOBPL</a>),Y
3E1B:68             105             PLA             ;GET DESIRED VOLUME BACK
3E1C:F0 08          106             BEQ <a class="x"  href="#CORRECTVOL">CORRECTVOL</a>  ;DESIRED VOLUME 00 MATCHES ALL. ; v
3E1E:C5 2F          107             CMP <a class="v"  href="#VOLUME"    >VOLUME</a>
3E20:F0 04          108             BEQ <a class="x"  href="#CORRECTVOL">CORRECTVOL</a>  ;YUP, IT WAS RIGHT!             ; v
3E22:A9 20          109             LDA #<a class="v" href="#IBVMME"    >IBVMME</a>     ;HE SWITCHED DISCS!
3E24:D0 E1          110             BNE <a class="x"  href="#JMPTO1"    >JMPTO1</a>      ;ALWAYS TAKEN                   ; ^
                    111 <a class=="f" name="CORRECTVOL" >CORRECTVOL  </a>EQU *
3E26:A0 05          112             LDY #<span class='n'>5</span>                                          ; <a class='magic' name='_3E26'>magic number</a> IOB_OFFSET_SECTOR = $5
3E28:B1 48          113             LDA (<a class="v" href="#IOBPL">IOBPL</a>),Y   ; TO ALLOW FOR INTERLEAVE
3E2A:A8             114             TAY
3E2B:B9 B8 3F       115             LDA <a class="v" href="#INTRLEAV"   >INTRLEAV</a>,Y  ;COMPUTE PHYSICAL SECTOR        ; DOS Sector Interleave/Skew Mapping
<hr>3E2E:C5 2D          116             CMP <a class="v" href="#SECT"   >SECT</a>        ;DID WE GET THE SECTOR?         ; === Page <a class="page" name="page124">124</a> ===
                    117     LST OFF
                    118     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    119         BEQ GOTSECT         ;=&gt;WE FOUND IT!                         
                    120         LDA #TC5            ;SAY 'LATENCY'                          
                    121         STA TL5                                                     
                    122         LDA SCOUNT          ;ARE WE WAITING FOR FIRST SECTOR?       
                    123         BEQ NOLAT           ;=&gt;YES, LATENCY UNPREDICTABLE ANYWAY    
                    124         INC LCOUNT          ;NO, COUNT SECTORS MISSED               
                    125 <a class="f" name="NOLAT"       >NOLAT   </a>EQU *                                                       
                    126         JMP TRYADR2         ;NOW..GET CORRECT SECTOR..              </span>
                    127     ELSE
                    128     LST ON
3E30:D0 97          129             BNE <a class="x" href="#TRYADR2">TRYADR2</a>     ;NO, KEEP TRYING.               ; ^
                    130     FIN
                    131 *
                    132 * HOORAY! WE GOT THE RIGHT SECTOR!
                    133 *
                    134 <a class="f" name="GOTSECT"     >GOTSECT     </a>EQU *
                    135     LST OFF
                    136     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    137         LDA #SP             ;SAY 'NO LATENCY'                   
                    138         STA TL5                                                 
                    139         INC SCOUNT          ;BUMP 'SECTORS-ACCESSED' COUNT      </span>
                    140     FIN
                    141     LST ON
3E32:28             142             PLP
3E33:90 1C          143             BCC <a class="x" href="#WRIT">WRIT</a>        ;CARRY WAS SET FOR READ OPERATION. ; v
                    144     LST OFF
                    145     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    146         LDA #TC9            ;SAY 'READING'                  
                    147         STA TL9                                             
                    148         LDA #SP                                             
                    149         STA TL10                                            </span>
                    150     FIN
                    151     LST ON
3E35:20 DC 38       152             JSR <a class="x" href="#READ16">READ16</a>      ;CLEARED FOR WRITE
                    153     LST OFF
                    154     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    155         LDA #SP                                             
                    156         STA TL9                                             </span>
                    157     FIN
                    158     LST ON
3E38:08             159             PHP             ;SAVE STATUS OF READ OPERATION
                    160     LST OFF
                    161     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    162         BCC <a class="name" href="#GOODREAD">GOODREAD</a>        ;NO ERROR                       
                    163         LDA #TC10           ;SAY 'READ ERROR'               
                    164         STA TL10                                            
                    165         JMP <a class="x" href="#TRYADR2">TRYADR2</a>         ;RETRY ON ERROR                 
                    166 *                                                           
                    167 <a class="name" name="GOODREAD">GOODREAD </a>EQU *                                              </span>
                    168     ELSE
                    169     LST ON
3E39:B0 8E          170             BCS <a class="x" href="#TRYADR2">TRYADR2</a>     ;CARRY SET UPON RETURN IF BAD READ ;  ^
                    171     FIN
3E3B:28             172             PLP             ;CAREFUL OF STACK
3E3C:A2 00          173             LDX #0          ;SET TO POSTNIBLIZE
3E3E:86 26          174             STX T0          ; All 256 BYTES OF THE SECTOR
                    175     LST OFF
                    176     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    177         LDA #TC11           ;SAY 'POSTINIBBLIZING'          </span>;POST_IN_NIBBLIZING<span class="macro">
                    178         STA TL11                                            </span>
<hr>                    179     FIN                                                     ; === Page <a class="page" name="page125">125</a> ===
                    180     LST ON
3E40:20 C2 38       181             JSR <a class="x" href="#POSTNB16">POSTNB16</a>    ;DECODE INTO REAL WORLD DATA
                    182     LST OFF
                    183     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    184         LDA #SP             ;POSTNIB COMPLETED              
                    185         STA TL11                                            </span>
                    186     FIN
                    187     LST ON
3E43:AE F8 05       188             LDX SLOT        ;RESTORE SLOTNUM INTO X         ; I never would have guessed ...
3E46:18             189 <a class="x" name="ALLDONE"     >ALLDONE     </a>CLC
3E47:24             190             DFB $24         ;SKIP OVER NEXT BYTE WITH BIT OPCODE        ; BIT $zp
3E48:38             191 <a class="x" name="HNDLERR"     >HNDLERR     </a>SEC             ;INDICATE AN ERROR
3E49:A0 0D          192             LDY #$<span class='n'>0D</span>        ;GIVE HIM ERROR#                ; <a class='magic' name='_3E49'>magic number</a> IOB_OFFSET_ERROR = $D
3E4B:91 48          193             STA (<a class="v" href="#IOBPL"   >IOBPL</a>),Y
3E4D:BD 88 C0       194             LDA <a class="v"  href="#MOTOROFF">MOTOROFF</a>,X  ; TURN IT OFF...
                    195     LST OFF
                    196     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    197 * AVERAGE LATENCY = LCOUNT/SCOUNT                           
                    198         LDA LCOUNT          ; GET TOTAL LATENCY             
                    199         LDY #0              ; CLEAR QUOTIENT                
                    200 <a class="name" name="DIVIDE" id="DIVIDE" >DIVIDE  </a>EQU *                                               
                    201         CMP SCOUNT          ; DONE?                         
                    202         BCC <a class="x" href="#PRTLAT"   >PRTLAT</a>          ; =&gt;YES.PRINT IT                
                    203         SBC SCOUNT          ; REMOVE SCOUNT                 
                    204         INY                 ; INCREMENT QUOTIENT            
                    205         BNE <a class="x" href="#DIVIDE">DIVIDE</a>                                          
                    206 *                                                           
                    207 <a class="name" name="PRTLAT" id="PRTLAD">PRTLAT  </a>TYA                                                 </span>; Print Latency<span class='macro'>
                    208         AND #$0F            ; MAX LATENCY=15                
                    209         ORA #$B0            ; MAKE ASCII                    </span>; No, this is make Apple Text, as ASCII = $00..$7F<span class='macro'>
                    210         CMP #$BA            ; IS IT A-F                     
                    211         BCC <a class="x" href="#PRTL2" >PRTL2</a>           ;=&gt;NO                           
                    212         ADC #6              ;ADD 7 (INCLUDES CARRY)         
                    213 <a class="name" name="PRTL2" id="PRTL2">PRTL2   </a>STA TL12            ; STUFF LATENCY COUNT           
                    214         LDA #SP             ; SAY 'RWTS NOT ACTIVE'         
                    215         STA TL1                                             </span>
                    216     FIN
                    217     LST ON
3E50:60             218             RTS
                    219 <a class="f" name="WRIT"        >WRIT        </a>EQU *
                    220     LST OFF
                    221     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span style="macro">
                    222        LDA #TC8             ; SAY 'WRITING'                 
                    223        STA TL8                                              </span>
                    224     FIN
                    225     LST ON
3E51:20 2A 38       226             JSR <a class="x" href="#WRITE16">WRITE16</a>     ; WRITE NYBBLES NOW             ; ^ WRITRTN, page 137

                    227     LST OFF
                    228     DO <a class="do" href="#DIAGMOD">DIAGMOD</a><span class="macro">
                    229        LDA #SP              ; SAY 'WRITING'                 
                    230        STA TL8                                              </span>
                    231     FIN
                    232     LST ON
3E54:90 F0          233             BCC <a class="x" href="#ALLDONE">ALLDONE</a>     ;IF NO ERRORS.
3E56:A9 10          234             LDA #IBWPER     ;DISK IS WRITE PROTECTED!!
3E58:B0 EE          235             BCS <a class="x" href="#HNDLERR">HNDLERR</a>     ;ALWAYS TAKEN
                    236 *
                    237 * THIS IS THE 'SEEK' ROUTINE
                    238 *  SEEKS TRACK 'N' IN SLOT #X/$10
                    239 * IF DRIVNO IS NEGATIVE, ON DRIVE 1
                    240 * IF DRIVNO IS POSITIVE, ON DRIVE 2
                    241 *
<hr>3E5A:48             242 <a class="x" name="MYSEEK"      >MYSEEK      </a>PHA             ; AND PRESERVE A-REGISTER       ; === Page <a class="page" name="page126">126</a> === Uhm, OK, Captain Obvious
                    243     LST OFF
                    244 
                    245 
                    246 
                    247 
                    248 
                    249 
                    250 
                    251 
                    252 
                    253 
                    254 
                    255 
                    256 
                    257 
                    258 
                    259 
                    260 
                    261 
                    262 
                    263 
                    264 
                    265 
                    266 
                    267 
                    268 
                    269 
                    270 
                    271 
                    272 
                    273 
                    274 
3E86:10 03          275             BPL <a class="x" href="#GOSEEK">GOSEEK</a>      ;ALWAYS TAKEN
3E88:99 78 04       276 <a class="f" name="ISDRV1"      >ISDRV1      </a>STA DRV1TRK,Y
3E8B:4C A0 B9       277 <a class="f" name="GOSEEK"      >GOSEEK      </a>JMP <a class="x" href="#SEEK">SEEK</a>        ;GO THERE!
3E8E:8A             278 <a class="f" name="XTOY"        >XTOY        </a>TXA
3E8F:4A             279             LSR A
3E90:4A             280             LSR A
3E91:4A             281             LSR A
3E92:4A             282             LSR A
3E93:A8             283             TAY
3E94:60             284             RTS
                    285 *
                    286 * THIS SUBROUTINE SETS THE SLOT DEPENDENT TRACK
                    287 * LOCATION.
                    288 *
3E95:48             289 <a class="f" name="SETTRK"     id="SETTRK"     >SETTRK      </a>PHA             ;PRESERVE DESTINATION TRACK
3E96:A0 02          290             LDY #$02                                        ; <a class='magic' name='_3E96'>magic number</a> IOB_OFFSET_DRIVE = $2
3E98:B1 48          291             LDA (IOBPL),Y
3E9A:6A             292             ROR A           ;GET DRIVE # INTO CARRY
3E9B:66 35          293             ROR DRIVNO      ;INTO (DRIVNO)
3E9D:20 8E 3E       294             JSR <a class="x" href="#XTOY">XTOY</a>        ;SET UP Y-REG
3EA0:68             295             PLA
3EA1:0A             296             ASL A           ;ASSUME TRACK IS HELD*2
3EA2:24 35          297 SETTRK2     BIT DRIVNO                                      ; unused label
3EA4:30 05          298             BMI <a class="x" href="#ONDRV1">ONDRV1</a>      ;IF ON DRIVE 1(1), DRIVNO MINUS
3EA6:99 F8 04       299             STA DRV2TRK,Y
3EA9:10 03          300             BPL <a class="x" href="#SETRTS">SETRTS</a>
3EAB:99 78 04       301 <a class="f" name="ONDRV1"     id="ONDRV1"    >ONDRV1      </a>STA DRV1TRK,Y
3EAE:60             302 <a class="f" name="SETRTS"     id="SETRTS"    >SETRTS      </a>RTS
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="FORMATR">FORMATR</a> - Format Disk, Page <a class='page' name='page82'>82</a> - 85, <a class='ts' href='#T0S8'>T0S8</a> @ $AF..  <a class='ts' href='#T0S9'>T0S9</a> @ $C7, $<span class='n'>BEAF</span> .. $<span class='n'>BFC7</span> ===<hr class='join'><hr></div>
<pre>
                    001                SBTL '16-SECTOR FORMATTER'
                    002 ****************************
                    003 *                          *
                    004 * FORMAT DISK AND RETURN   *
                    005 *                          *
                    006 ****************************
                    007 *
                    008 * EQUATES FOR FORMATTER
                    009 *
                    010 <a class="d" name="NSYNC"      >NSYNC       </a>EQU $45         ;NUM GAP SELF-SYNC NIBLS        ; No, not the 90's band
                    011 *
                    012             REP 40
                    013 <a class="f" name="DSKFORM"    >DSKFORM     </a>EQU *
                    <a class='line' name='FORMATR.014'>014</a>     DO <a class="do" href="#DIAGMOD">DIAGMOD</a>              ;ELIMINATE FMTR FROM DIAG ASSEMBLY<span class="macro">
                    015         LST OFF                                             </span>
                    016     ELSE
3EAF:A0 03          017             LDY #<span class='n'>3</span>                                          ; <a class='magic' name='_3EAF'>magic number</a> IOB_OFFSET_VOL = $3
3EB1:B1 48          018             STY (IOBPL),Y   VOLUME NUMBER IN IOB.
3EB3:85 41          019             STA NVOL        FOR FORMATTER.
3EB5:A9 AA          020             LDA #$<span class='n'>AA</span>        SET Z-PAG LOC TO $AA FOR
3EB7:85 3E          021             STA AA          TIME DEPENDENT REFERENCES.      ; *sigh* Because AA is _so_ descriptive ... WTF does <a class='v' href='#AA'>AA</a> stand for ?!?!
3EB9:A0 56          022             LDY #$<span class='n'>56</span>                                        ; <a class='magic' name='_????'>magic number</a>
3EBB:A9 00          023             LDA #<span class='n'>0</span>
3EBD:85 44          024             STA TRK         TRACK NUMBER, 0 TO 34
3EBF:99 FF BB       025 <a class='f' name='CLRNBUF2' >CLRNBUF2    </a>STA NBUF2-1,Y   CLEAR NBUFS TO WRITE
3EC2:88             026             DEY             ZERO SECTORS
                    027             BNE CLRNBUF2
                    028 <a class='f' name='CLRNBUF1' >CLRNBUF1    </a>STA NBUF1,Y
                    029             DEY
                    030             BNE CLRNBUF1                                    ;
                    031             LDA #$50                                        ; <a class='magic' name='_????'>magic number</a> <span class='todo'>TODO</span> <span class='code'>FORMAT_LAST_TRACK EQU 40*2   ; *2 = 2 phases/track</span>
                    032             JSR SETTRK      FAKE LIKE ON TRACK 80.
                    033             LDA #$28                                        ; <a class='magic' name='_????'>magic number</a> <span class='todo'>TODO</span> <span class='code'>FORMAT_SECTOR_GAP EQU 40</span>
                    034             STA NSYNC       BEGIN WITH 40 SELF-SYNC NIBLS.
                    035 <a class='f' name='FORMTRK'  >FORMTRK     </a>LDA TRK
                    036             JSR MYSEEK      GOTO NEXT TRACK.
                    037             JSR WTRACK16    WRITE AND VERIFY TRACK.
                    038 <a class='f' name='FORMERR1' >FORMERR1    </a>LDA #8          'UNABLE TO FORMAT' ERR CODE.    ; <a class='magic' name='_????'>magic number</a> <span class='todo'>TODO</span>
                    039             BCS FORMERR     CONTINUE IF NO ERROR.
                    040             LDA #$30        UP TO 48 SECTOR RETRIES         ; *sigh* <i>Why</i> _this_ value? <a class='magic' name='_????'>magic number</a> <span class='todo'>TODO</span> <span class='code'>FORMAT_MAX_RETRY EQU 48</span>
                    041             STA RETRYCNT    TO FIND SECTOR 0.               ;        Also, why not in <i>decimal</i>??
                    042 <a class='f' name='FINDS0'   >FINDS0      </a>STA ANTICIPATE  'UNABLE TO FORMAT'
                    043             DEC RETRYCNT    DONE 48 RETRIES?
                    044             BEQ FORMERR     IF SO, 'UNABLE TO FORMAT' ERR.
                    045             JSR RDADR16     ;READ ADR FIELD.                ; *sigh* Inconsistent comment meta character
                    046             BCS FINDS0      RETRY IF ERR.
                    047             LDA SECT        CHECK SECTOR THAT WAS READ.
                    048             BNE FINDS0      CONTINUE SEARCHING IF NOT SECT 0.
                    049             JSR READ16      ;NOW READ DATA FIELD.           ; *sigh* Make up your mother falcon mind! <b>Always</b> use <span class='code'>;</span> or not!
                    050             BCS FINDS0      CONTINUE SEARCH IF ERR.
                    051 * (NOW POSITIONED PROPERLY FOR NEXT TRACK)                  ; Unknown if leading space after '*' should be 1 space, 1 tab, etc??
                    052             INC TRK         INCREMENT TRACK NUMBER.         ; /sarcasm <i>Gee, George what does this do?</i>
                    053             LDA TRK
<hr>3EFD:C9 23          <a class='line' name='FORMATR.054'>054</a>             CMP #$23        CONTINUE IF LESS THEN 35        ; === Page <a class='page' name='page83'>83</a> === <a class='magic' name='_3EFE'>magic number</a> DISK_MAX_TRACK or at least <a class="v" href="#VNOTRK">VNOTRK</a>
3EFF:90 D3          055             BCC <a class="x" href="#FORMTRK">FORMTRK</a>                                     ; === <a class='ts' href='#T0S9'>T0S9</a> ===
3F01:18             056             CLC             CLEAR CARRY TO INDICATE 'NO ERR'<!--                                                               -->;[.. <span class='code'>JMP <a class='x' href='#ALLDONE'>ALLDONE</a></span>
3F02:90 05          057             BCC <a class="x" href="#FORMDONE">FORMDONE</a>    ELSE TURN OFF MOTOR AND RETURN <!--                             --> ; ..
3F04:A0 0D          058 <a class="f" name="FORMERR"    >FORMERR     </a>LDY #$0D                                       <!--                           --> ; .. <span class='code'>JMP <a class='x' href='#HNDLERR'>HNDLERR</a></span> <a class='magic' name='_3F05'>magic number</a> IOB_OFFSET_ERR = $D
3F06:91 48          059             STA (IOBPL),Y   RETURN ERROR CODE.             <!--                                                               --> ; .. <a class='mem' name='_3F0C'>wastes</a> remaining 6 bytes.
3F08:38             060             SEC             SET CARRY TO INDICATE ERR.     <!--                                                               --> ; .. We could invert the return value,
3F09:AD 88 C0       061 <a class="f" name="FORMDONE"   >FORMDONE    </a>LDA <a class="v" href="#MOTOROFF">MOTOROFF</a>,X  ; TURN MOTOR OFF.               ; .. but there is a better optimization
3F0C:60             062             RTS             ; AND RETURN.                  <!--                                                               --> ; .. using the two JMPs above to reach common code in <a class='file' href='#RWTSTWO'>RWTSTWO</a> ]
                    063             PAGE
                    064 ******************************
                    065 *                            *
                    066 *   WRITE TRACK SUBROUTINE   *
                    067 *                            *
                    068 ******************************
3F0D:A9 00          069 <a class="f" name="WTRACK16"    >WTRACK16    </a>LDA #0
3F0F:85 3F          070             STA NSECT       SECTOR NUMBER, 0 to 15.
3F11:A0 80          071             LDY #128        ;128 NIBS PRIOR SECTOR 0
3F13:D0 02          072             BNE WSECT0      ; TO INSURE NO BLANK SPOT BETW 15 &amp; 0
3F15:A4 45          073 <a class="f" name="WSECT"       >WSECT       </a>LDY NSYNC       CURRENT NUM OF GAP SELF-SYNC NIBLS.
                    074 <a class="f" name="WSET0"       >WSECT0      </a>EQU *
                    075             JSR WADR16      WRITE GAP AND ADR FIELD.
                    076             BCS WEXIT2      ERR IF WRITE PROTECTED.
                    077             JSR WRITE16     ;WRITE SECTOR FROM NBUF1, NBUF2
                    078             BCS WEXIT2      ERR IF WRITE PROTECTED.
                    079             INC NSECT       NEXT OF 16 SECTORS.
                    080             LDA NSECT
                    081             CMP #$<span class='n'>10</span>                                        ; What's the point of <a class="v" href="#VNOSEC">VNOSEC</a> in VTOC then?!?!
                    082             BCC WSECT       CONTINUE IF NOT DONE.
                    083             PAGE
                    084 *****************************
                    085 *                           *
                    086 *     VERIFY ROUTINE        *
                    087 *                           *
                    088 *  VERIFIES THAT THE FIRST  *
                    089 *  SECTOR ENCOUNTERED IS    *
                    090 *  SECTOR 0, AND THAT ALL   *
                    091 *  16 SECTORS ARE READABLE  *
                    092 *  WITH MINIMAL RETRIES.    *
                    093 *  (2 REVOLUTIONS MAXIMUM)  *
                    094 *                           *
                    095 *  IF FIRST SECTOR IS NOT   *
                    096 *  SECTOR 0 THEN THE        *
                    097 *  CURRENT NUMBER OF SELF-  *
                    098 *  SYNC NIBLS IS DECR'D BY  *
                    099 *  1 (IF ALREADY LESS THAN  *
                    100 *  16) OR BY 2. THEN SECTOR *
                    101 *  15 IS LOCATED SO AS TO   *
                    102 *  POSITION THE NEW TRACK   *
                    103 *  REWRITE.                 *
                    104 *                           *
                    105 *  IF UNABLE TO READ ANY    *
                    106 *  SECTOR THEN THE ENTIRE   *
                    107 *  TRACK IS REWRITTEN.      *
                    108 *                           *
                    109 *  AFTER VERIFYING TRACK 0, *
                    110 *  THE NUMBER OF SELF-SYNC  *
                    111 *  NIBLS, NSYNC, IS DECR'D  *
                    112 *  BY 2 (IF STILL 16 OR     *
                    113 *  GREATER).                *
                    114 *                           *
                    115 *****************************
<hr>                    116             PAGE                                            ; === Page <a class="page" name="page84">84</a> ===
                    117 
                    118 
                    119 
                    120 
                    121 
                    122 
                    123 
                    124 
                    125 
                    126 
                    127 
                    128 
                    129 
                    130 
                    131 
                    132 
                    133 
                    134 
                    135 
                    136 
                    137 
                    138 
                    139 
                    140 
                    141 
                    142 
                    143 
                    144 
                    145 
                    146 
                    147 
                    148 
                    149 
                    150 
                    151 
                    152 
                    153 
                    154 
                    155 
                    156 
                    157 
                    158 
                    159 
                    160 
                    161 
                    162 
                    163 
                    164 
                    165 
                    166 
                    167 
                    168 
                    169 
                    170 
                    171 
                    172 
                    173 
                    174 
                    175 
                    176 
                    177 
                    178 
<hr>                    179 ******************************                              ; === Page <a class='page' name='page85'>85</a> ===
                    180 <a class='d' name='AEC2'     >AEC2        </a>EQU *           ;TELL RELOCTR WHERE RWTS ENDS
                    181 ******************************
3FA8:00 00 00 00    182 <a class='d' name='FOUND'    >FOUND       </a>DFB 0,0,0,0     'SECTOR FOUND' TABLE            ; See: <a class='x' href='#SECTOK'>SECTOK</a>
3FAC:00 00 00 00    183         DFB 0,0,0,0                                         ; <span class='todo'>TODO</span> DOS 3.3 1980 has these as $FF
3FB0:00 00 00 00    184         DFB 0,0,0,0
3FB4:00 00 00 00    185         DFB 0,0,0,0
                    186     FIN                                                     ; Macro started waaay back on Line #<a class='line' href='#FORMATR.014'>014</a>, <a class="x" href="#DSKFORM">DSKFORM</a>
                    187     LST ON
                    188             REP 40
                    189 * THIS TABLE IS USED TO TRANSLATE
                    190 * LOGICAL (REQUESTED) SECTOR NUMBER
                    191 * TO PHYSICAL SECTOR NUMBER. THE
                    192 * DISKETTE IS FORMATTED WITH ALL
                    193 * SECTORS IN MONOTONICALLY INCREASING
                    194 * ORDER. THE TRANSLATION WILL ALLOW
                    195 * TIME BETWEEN SECTORS FOR READS.
                    196 *
                    197             REP 40
                    198 *
                    199 * NOTE: THE CURRENT IMPLEMENTATION OF DOS
                    200 *  USUALLY ACCESSES SECTORS IN DECREASING
                    201 *  ORDER ON A TRACK. THUS WE WILL
                    202 *  TRANSLATE IN REVERSE ORDER...
                    203 *
                    204 * THE INTERLEAVE IS THEN 9:1                                ; <span class="todo">TODO</span>: Verify this is optimal for reading
                    205 *                                                           ; sectors in normal F,E,D,..,2,1,0 access pattern order
                    206 * NOTE: WE MAP LOGICAL SECTOR 0
                    207 *  INTO PHYSICAL SECTOR 0 SO THAT
                    208 *  WRITING OF BOOT DURING 'INIT'
                    209 *  IS CORRECT FOR SECTOR ZERO.
                    210 *
                    211 <a class="d" name="INRLEAV"    >INTRLEAV    </a>EQU *                                           ; *sigh*
3FB8:00 0D 0B 09    212             DFB $00,$0D,$0B,$09                             ; /sarcasm Here's a novel concept ...
3FBC:07 05 03 01    213             DFB $07,$05,$03,$01                             ; How about *formatting* the sectors in the correct
3FC0:0E 0C 0A 08    214             DFB $0E,$0C,$0A,$08                             ; order on the disk in the first place so we don't even
3FC4:06 04 02 0F    215             DFB $06,$04,$02,$0F                             ; need to waste memory with this table at all !
</pre>

<div class='sticky'><hr><hr class='join'>=== <a class="file" name="DOSPTCH">DOSPTCH</a> - Revision B Patches, Page <a class="page" name="page52">52</a>, <a class='ts' href='#T0S9'>T0S9</a> @ $C8, $<span class='n'>BFC8</span> .. $<span class='n'>BFFF</span> ===<hr class='join'><hr></div>
<pre>
                    001             SBTL "DOS PATCHES"
                    002 ********************************
                    003 *
                    004 * DOS 3.2 PATCHES BY DICK HUSTON
                    005 *
                    006 ********************************
                    007 * AFTER THE FACT PATCHES
                    008 * CLRBYTE CALLED FROM DOS2 LABEL SOPTS +7 LINES
                    009 * CLRSTS1 CALLED FROM DOS3 LABEL ERROR +2 LINES
                    010 * ERROR9X CALLED FROM DOS5 LABEL ERROR9*
                    011 *
                    012 *
                    013             REP 40
                    014 *
                    015 * DOS 3.3 REVISION B PATCH
                    016 *
                    017             REP 40
                    018 *****************************
                    019 <a class="f" name="SDP1"       >SDP1        </a>EQU *                                           ; Start Dos Patch
                    020 <a class="f" name="RCPATCH"    >RCPATCH     </a>EQU *                                           ; "Called" from <a class="file" href="#BOOTLDR">BOOTLDR</a>, Func <a class="x" href="#DOSINT">DOSINT</a>, Line <a class='line' href='#BOOTLDR.295'>295</a>
3FC8:20 93 FE       021             JSR <a class="x" href="#SETVID">SETVID</a>
3FCB:AD 81 C0       022             LDA $<span class='n'>C081</span>                                       ; <a class='magic' name='_3FCB'>magic number</a> If only ROMIN = $C081 for Language Card (LC)
3FCE:AD 81 C0       023             LDA $<span class='n'>C081</span>                                       ; <a class='magic' name='_3FCE'>magic number</a> 1st read = read ROM, 2nd read = write enable LC Bank 2
3FD1:A9 00          024             LDA #<span class='n'>0</span>
3FD3:8D 00 E0       025             STA $<span class='n'>E000</span>                                       ; <a class='magic' name='_3FD3'>magic number</a> *sigh* Forces Language Card to reload
                    026     DO <a class="do" href="#DOS33B">DOS33B</a>
3FD6:20 76 3A       027             JSR <a class="x" href="#OFF80" >OFF80</a>                                       
3FD9:4C 44 37       <a class='line' name='DOSPTCH.028'>028</a>             JMP <a class="x" href="#RCBACK">RCBACK</a>                                      ; <a class='mem' name='_3FDA'>wastes</a> 2 bytes Why not RTS ???
                    029     ELSE<span class="macro">
                    030         JMP RCBACK                                          
                    031         DS  3,0                                             </span>
                    032     FIN
                    033 *****************************
3FDC:8D 63 2A       034 <a class="f" name="CLRBYTE"    >CLRBYTE     </a>STA <a class="v" href="#TEMP1A">TEMP1A</a>                                      ; Called from <a class="x" href="#SOPTS">SOPTS</a>, Page <a class="page" hre="#page18">18</a>, Line <a class='line' href='#CMDSCAN.176'>176</a>
3FDF:8D 70 2A       035             STA <a class="v" href="#CB">CB</a>          ;SET TYPE PARAM DEFAUTL=0       ; *spelling* DEFAULT
3FE2:8D 71 2A       036             STA <a class="v" href="#CB">CB</a>+1
3FE5:60             037             RTS
                    038             SKP 4
3FE6:20 5B 27       039 <a class="f" name="CLRSTS1"    >CLRSTS1     </a>JSR <a class="x" href="#CLRSTS">CLRSTS</a>                                      ; <span class="todo">TODO</span> Clear ???
3FE9:8C B7 2A       040             STY <a class="v" href="#RSTATE">RSTATE</a>      ;PREVENTS FOREVER 'FILE NOT FOUND'
3FEC:60             041             RTS             ; IN APPLESOFT
                    042 *****************************
3FED:20 7E 2E       043 <a class="f" name="ERROR9X"    >ERROR9X     </a>JSR <a class="x" href="#RTNFCB">RTNFCB</a>
3FF0:AE 9B 33       044             LDX <a class="v" href="#ENTSTK">ENTSTK</a>      ;GET STACK
3FF3:9A             045             TXS             ;MESSY MESSY MESSY
3FF4:20 16 23       046             JSR <a class="x" href="#CLALL">CLALL</a>       ;GO CLOSE EVERYBODY
3FF7:BA             047             TSX
3FF8:8E 9B 33       048             STX <a class="v" href="#ENTSTK">ENTSTK</a>      ;RESTORE SAVE STK
3FFB:A9 09          049             LDA #9                                          ; <a class='magic' name='_3FFB'>magic number</a> <span class="todo">TODO</span> What error??
3FFD:4C 85 33       050             JMP <a class="x" href="#ERRORA">ERRORA</a>      ;AND BACK
                    051 *****************************
                    052 <a class="d" name="ENDP1"      >ENDP1       </a>EQU *-1         ; END OF DOS PATCHES FOR RELOCTR
                    053 <a class="d" name="ENDOFDOS"   >ENDOFDOS    </a>EQU *
<hr>                    054     DO <a class="do" href="#ENDOFDOS">ENDOFDOS</a>-$4000                                       ; === Page <a class="page" name="page53">53</a> ===<span class="macro">
                    055         FAIL 2,'DOS LENGTH NOT CORRECT'                     </span>
                    056     FIN
<hr><hr><hr>
</pre>

<h1><a class='section' name='Symbols'     >3.0 Symbols</a></h1>

<div class='sticky'>
<h2><a class='section' name='Alphabetical'>3.1 Symbols (Alphabetical)</a></h2>
</div>
<pre>
<h3>A</h3>
    ASHM1       =   $73
    ASHM2       =   $6F

<h3>B</h3>

<h3>C</h3>
    COUT        =   $26

<h3>D</h3>
    DBVECT      = $1E51
    DELTA       = $1C7F

<h3>E</h3>
    EC1         = $2884
    EC2         = $3397
    EC3         = $37E0
    ERRORA      = $3F85
    EWADR1      = $3CDF
    EAT1        = $1D56

<h3>F</h3>

<h3>G</h3>

<h3>H</h3>

<h3>I</h3>
    IBVT        = $1D62

<h3>J</h3>

<h3>K</h3>

<h3>L</h3>

<h3>M</h3>

<h3>N</h3>
    NEPAGE      = $1C7D

<h3>O</h3>

<h3>P</h3>
    PRENIB16    = $B800

<h3>Q</h3>

<h3>R</h3>
    RUN         = $1D58
    RSPAGE      = $1C7A

<h3>S</h3>
    SAT1        = $1D00
    SC1         = $1D84
    SC2         = $2AFD
    SC3         = $365D
    SWADR1      = $3C56

<h3>T</h3>

<h3>U</h3>

<h3>W</h3>

<h3>X</h3>

<h3>Y</h3>

<h3>Z</h3>
    ZPGFCB      =   $42
    ZPGWRK      =   $40


</pre>

<h2><a class='section' name='Address'>3.2 Symbols (Address)</a></h2>

<pre>
</pre>



<h1><a class='section' name='ColorSrcFile'>Color-Coded Memory by Source File</a></h1>
<!--
    :%s/</\&lt;/g
    :%s/>/\&gt;/g
    :%s/\&[^[lg]t]/\&amp;/g
    hexdump8 dos33.bin 1B00 2
-->

<pre>
 <span class="c00" href="#RELOCTR">RELOCTR</span> ; $1B00 .. $1C80, T0SA - T0SB
 <span class="c01" href="#DOSINIT">DOSINIT</span> ; $1C81 .. $1E80, T0SB - T0SD
 <span class="c02" href="#DOSHOOK">DOSHOOK</span> ; $1E81 .. $1FCC, T0SD - T0SE
 <span class="c03" href="#CMDSCAN">CMDSCAN</span> ; $1FCD .. $2192, T0SE - T1S0
 <span class="c04" href="#XOPNCLS">XOPNCLS</span> ; $2193 .. $2330, T1S0 - T1S2
 <span class="c05" href="#XLODSAV">XLODSAV</span> ; $2331 .. $250F, T1S2 - T1S4
 <span class="c06" href="#XMISCMD">XMISCMD</span> ; $2510 .. $26A7, T1S4 - T1S5
 <span class="c07" href="#DOSGOER">DOSGOER</span> ; $26A8 .. $27D3, T1S5 - T1S6
 <span class="c08" href="#BLDFTAB">BLDFTAB</span> ; $27D4 .. $2883, T1S6 - T1S7
 <span class="c09" href="#CMDTBLS">CMDTBLS</span> ; $2884 .. $2A4E, T1S7 - T1S9
 <span class="c10" href="#FDOSENT">FDOSENT</span> ; $2A4F .. $2B21, T1S9 - T1SA
 <span class="c11" href="#FOPCLRW">FOPCLRW</span> ; $2B22 .. $2CEE, T1SA - T1SB
 <span class="c20" href="#FDELCAT">FDELCAT</span> ; $2CEF .. $2E8D, T1SB - T1SD
 <span class="c21" href="#FMTRWIO">FMTRWIO</span> ; $2E8E .. $2FF6, T1SD - T1SE
 <span class="c22" href="#FLOCNXB">FLOCNXB</span> ; $2FF7 .. $31C8, T1SE - T2S0
 <span class="c23" href="#FLOCSEC">FLOCSEC</span> ; $31C9 .. $3396, T2S0 - T2S2
 <span class="c24" href="#FVCBUFS">FVCBUFS</span> ; $3397 .. $35FD, T2S2 - T2S4
 <span class="c25" href="#BOOTLDR">BOOTLDR</span> ; $35FE .. $37FF, T0S0 - T0S1
 <span class="c26" href="#COREQUS">COREQUS</span> ; n/a
 <span class="c27" href="#PRENIBL">PRENIBL</span> ; $3800 .. $3829, T0S2
 <span class="c28" href="#WRITRTN">WRITRTN</span> ; $382A .. $38C1, T0S2
 <span class="c29" href="#POSTNRD">POSTNRD</span> ; $38C2 .. $3943, T0S2 - T0S3
 <span class="c30" href="#RDADSEK">RDADSEK</span> ; $3944 .. $39FC, T0S3
 <span class="c31" href="#MSWAITR">MSWAITR</span> ; $39FD .. $3C55, T0S3 - T0S6
 <span class="c40" href="#WRITADR">WRITADR</span> ; $3C56 .. $3CFF, T0S6
 <span class="c41" href="#RWTSONE">RWTSONE</span> ; $3D00 .. $3DAA, T0S7
 <span class="c42" href="#RWTSTWO">RWTSTWO</span> ; $3DAB .. $3EAE, T0S7 - T0S8
 <span class="c43" href="#FORMATR">FORMATR</span> ; $3EAF .. $3FC7, T0S8 - T0S9
 <span class="c44" href="#DOSPTCH">DOSPTCH</span> ; $3FC8 .. $3FFF, T0S9
</pre>

<img src="color_memory_usage_filename.png">

<h1><a class='section' name='ColorHexDump'>Color-Coded Hex Dump</a></h1>
<pre>
1B00:<span class="c00">4C 84 1D A9 BF 85 41 A2</span> |L..)?.A"| <a class='ts' name='T0SA'>T0SA</a>, RELOCTR, $1B00 .. $1CFF, T0SA - T0SB
1B08:<span class="c00">00 86 40 A0 00 A1 40 85</span> |..@ .!@.|
1B10:<span class="c00">26 98 45 26 85 26 98 41</span> |&amp;.E&amp;.&amp;.A|
1B18:<span class="c00">40 81 40 C5 26 D0 05 C8</span> |@.@E&amp;P.H|
1B20:<span class="c00">D0 EF F0 04 C6 41 D0 E3</span> |Pop.FAPc|
1B28:<span class="c00">A5 41 29 DF 85 43 86 42</span> |%A)_.C.B|
1B30:<span class="c00">A1 42 48 85 26 98 45 26</span> |!BH.&amp;.E&amp;|
1B38:<span class="c00">85 26 98 41 40 81 42 C5</span> |.&amp;.A@.BE|
1B40:<span class="c00">26 D0 09 C8 D0 EF A4 43</span> |&amp;P.HPo$C|
1B48:<span class="c00">68 4C 51 1B 68 81 42 A4</span> |hLQ.h.B$|
1B50:<span class="c00">41 C8 8C 7D 1C 38 98 ED</span> |AH.}.8.m|
1B58:<span class="c00">7E 1C 8D 7C 1C 38 ED 7A</span> |~..|.8mz|
1B60:<span class="c00">1C F0 9D 8D 7F 1C AD 7A</span> |.p....-z|
1B68:<span class="c00">1C 8D 0D 1D A9 1D 8D 49</span> |....)..I|
1B70:<span class="c00">37 A9 84 8D 48 37 A2 00</span> |7)..H7".|
1B78:<span class="c00">86 40 BD 29 1C A8 BD 2A</span> |.@=).(=*|
1B80:<span class="c00">1C 85 41 4C 93 1B 18 B1</span> |..AL...1|
1B88:<span class="c00">40 6D 7F 1C 91 40 C8 D0</span> |@m...@HP|
1B90:<span class="c00">02 E6 41 C8 D0 02 E6 41</span> |.fAHP.fA|
1B98:<span class="c00">A5 41 DD 2C 1C 90 E7 98</span> |%A],..g.|
1BA0:<span class="c00">DD 2B 1C 90 E1 8A 18 69</span> |]+..a..i|
1BA8:<span class="c00">04 AA EC 28 1C 90 CB A2</span> |.*l(..K"|
1BB0:<span class="c00">00 8E 9C 33 BD 5A 1C 85</span> |...3=Z..|
1BB8:<span class="c00">40 BD 5B 1C 85 41 A2 00</span> |@=[..A".|
1BC0:<span class="c00">A1 40 20 8E F8 A4 2F C0</span> |!@ .x$/@|
1BC8:<span class="c00">02 D0 11 B1 40 CD 7A 1C</span> |.P.1@Mz.|
1BD0:<span class="c00">90 0A CD 7B 1C B0 05 6D</span> |..M{.0.m|
1BD8:<span class="c00">7F 1C 91 40 38 A5 2F 65</span> |...@8%/e|
1BE0:<span class="c00">40 85 40 A9 00 65 41 85</span> |@.@).eA.|
1BE8:<span class="c00">41 AE 9C 33 DD 5D 1C 90</span> |A..3]]..|
1BF0:<span class="c00">CD A5 40 DD 5C 1C 90 C6</span> |M%@]\..F|
1BF8:<span class="c00">8A 18 69 04 AA EC 59 1C</span> |..i.*lY.|
1C00:<span class="c00">90 AF A9 3F 85 41 AC 7D</span> |./)?.A,}| <a class='ts' name='T0SB'>T0SB</a>
1C08:<span class="c00">1C 88 84 43 A9 00 85 40</span> |...C)..@|
1C10:<span class="c00">85 42 A8 B1 40 91 42 C8</span> |.B(1@.BH|
1C18:<span class="c00">D0 F9 CE 80 1C F0 06 C6</span> |PyN..p.F|
1C20:<span class="c00">41 C6 43 D0 EE 4C 54 1E</span> |AFCPnLT.|
1C28:<span class="c00">24 00 1D 56 1D 58 1D 5A</span> |$..V.X.Z|
1C30:<span class="c00">1D 64 1D 66 1D 6C 1D 70</span> |.d.f.l.p|
1C38:<span class="c00">1D 78 1D 7C 1D 7E 1D 80</span> |.x.|.~..|
1C40:<span class="c00">1D C1 2A FD 2A E4 37 E8</span> |.A*}*d7h|
1C48:<span class="c00">37 EE 37 F0 37 00 00 00</span> |7n7p7...|
1C50:<span class="c00">00 00 00 00 00 00 00 00</span> |........|
1C58:<span class="c00">00 20 84 1D 84 28 FD 2A</span> |. ...(}*|
1C60:<span class="c00">97 33 5D 36 E0 37 56 3C</span> |.3]6`7V&lt;|
1C68:<span class="c00">DF 3C 00 38 11 3A 69 3A</span> |_&lt;.8.:i:|
1C70:<span class="c00">84 3A 00 3D A8 3F C8 3F</span> |.:.=(?H?|
1C78:<span class="c00">FF 3F 1D 40 00 00 23 00</span> |.?.@..#.|
1C80:<span class="c00">23</span> <span class="c01">FC FC FC FC FC FC FD</span> |#||||||}| DOSINIT, $1C81 .. $1E80, T0SB - T0SD
1C88:<span class="c01">FC FC FF FC FD FC FC FF</span> |||.|}||.|
1C90:<span class="c01">FF FC FE FD FE FD FD FE</span> |.|~}~}}~|
1C98:<span class="c01">FF FC FE FF FD FE FF FD</span> |.|~.}~.}|
1CA0:<span class="c01">FC FD FD FC FD FE FD FF</span> ||}}|}~}.|
1CA8:<span class="c01">FC FE FC FC FC FC FC FC</span> ||~|||||||
1CB0:<span class="c01">FD FC FC FE FC FD FC FC</span> |}||~|}|||
1CB8:<span class="c01">FF FC FC FE FD FC FD FF</span> |.||~}|}.|
1CC0:<span class="c01">FC FF FD FE FF FD FF FC</span> ||.}~.}.||
1CC8:<span class="c01">FC FD FE FF FF FF FC FC</span> ||}~...|||
1CD0:<span class="c01">FF FF FC FE FD FC FD FD</span> |..|~}|}}|
1CD8:<span class="c01">FE FF FD FE FF FC FE FE</span> |~.}~.|~~|
1CE0:<span class="c01">FC FD FC FD FE FD FD FC</span> ||}|}~}}||
1CE8:<span class="c01">FD FC FF FD FC FF FC FC</span> |}|.}|.|||
1CF0:<span class="c01">FE FD FC FC FD FC FE FC</span> |~}||}|~||
1CF8:<span class="c01">FC FD FF FC FC FD FC FC</span> ||}.||}|||
1D00:<span class="c01">D3 1C 81 1E BD 1E 75 2A</span> |S...=.u*| <a class='ts' name='T0SC'>T0SC</a>
1D08:<span class="c01">93 2A 60 2A 00 1B BB 35</span> |.*`*..;5|
1D10:<span class="c01">EA 1E 11 1F 22 1F 2E 1F</span> |j..."...|
1D18:<span class="c01">51 1F 60 1F 70 1F 4E 25</span> |Q.`.p.N%|
1D20:<span class="c01">12 24 96 23 D0 24 EF 24</span> |.$.#P$o$|
1D28:<span class="c01">62 22 70 22 74 22 E9 22</span> |b"p"t"i"|
1D30:<span class="c01">1A 25 C5 25 0F 25 DC 25</span> |.%E%.%\%|
1D38:<span class="c01">A2 22 97 22 80 22 6D 25</span> |""."."m%|
1D40:<span class="c01">32 22 3C 22 28 22 2D 22</span> |2"&lt;"("-"|
1D48:<span class="c01">50 22 79 25 9D 25 30 23</span> |P"y%.%0#|
1D50:<span class="c01">5C 23 8D 23 7C 22 36 E8</span> |\#.#|"6h|
1D58:<span class="c01">E5 24 E3 E3 00 E0 03 E0</span> |e$cc.`.`|
1D60:<span class="c01">00 00 36 E8 E5 24 E3 E3</span> |..6he$cc|
1D68:<span class="c01">00 E0 03 E0 FC 24 FC 24</span> |.`.`|$|$|
1D70:<span class="c01">65 D8 00 E0 3C D4 F2 D4</span> |eX.`&lt;TrT|
1D78:<span class="c01">06 25 06 25 67 10 84 1D</span> |.%.%g...|
1D80:<span class="c01">3C 0C F2 0C AD E9 37 4A</span> |&lt;.r.-i7J|
1D88:<span class="c01">4A 4A 4A 8D 6A 2A AD EA</span> |JJJ.j*-j|
1D90:<span class="c01">37 8D 68 2A AD 00 E0 49</span> |7.h*-.`I|
1D98:<span class="c01">20 D0 11 8D B6 2A A2 0A</span> | P..6*".|
1DA0:<span class="c01">BD 61 1D 9D 55 1D CA D0</span> |=a..U.JP|
1DA8:<span class="c01">F7 4C BC 1D A9 40 8D B6</span> |wL&lt;.)@.6|
1DB0:<span class="c01">2A A2 0C BD 6B 1D 9D 55</span> |*".=k..U|
1DB8:<span class="c01">1D CA D0 F7 38 B0 12 AD</span> |.JPw80.-|
1DC0:<span class="c01">B6 2A D0 04 A9 20 D0 05</span> |6*P.) P.|
1DC8:<span class="c01">0A 10 05 A9 4C 20 B2 25</span> |...)L 2%|
1DD0:<span class="c01">18 08 20 51 28 A9 00 8D</span> |.. Q()..|
1DD8:<span class="c01">5E 2A 8D 52 2A 28 6A 8D</span> |^*.R*(j.|
1DE0:<span class="c01">51 2A 30 03 6C 5E 1D 6C</span> |Q*0.l^.l|
1DE8:<span class="c01">5C 1D 0A 10 19 8D B6 2A</span> |\.....6*|
1DF0:<span class="c01">A2 0C BD 77 1D 9D 55 1D</span> |".=w..U.|
1DF8:<span class="c01">CA D0 F7 A2 1D BD 93 2A</span> |JPw".=.*|
1E00:<span class="c01">9D 75 2A CA 10 F7 AD B1</span> |.u*J.w-1| <a class='ts' name='T0SD'>T0SD</a>
1E08:<span class="c01">2A 8D 57 2A 20 D4 27 AD</span> |*.W* T'-|
1E10:<span class="c01">B3 2A F0 09 48 20 9D 26</span> |3*p.H .&amp;|
1E18:<span class="c01">68 A0 00 91 40 20 5B 27</span> |h ..@ ['|
1E20:<span class="c01">AD 5F 2A D0 20 A2 2F BD</span> |-_*P "/=|
1E28:<span class="c01">51 1E 9D D0 03 CA 10 F7</span> |Q..P.J.w|
1E30:<span class="c01">AD 53 1E 8D F3 03 49 A5</span> |-S..s.I%|
1E38:<span class="c01">8D F4 03 AD 52 1E 8D F2</span> |.t.-R..r|
1E40:<span class="c01">03 A9 06 D0 05 AD 62 2A</span> |.).P.-b*|
1E48:<span class="c01">F0 06 8D 5F 2A 4C 80 21</span> |p.._*L.!|
1E50:<span class="c01">60 4C BF 1D 4C 84 1D 4C</span> |`L?.L..L|
1E58:<span class="c01">FD 2A 4C B5 37 AD 0F 1D</span> |}*L57-..|
1E60:<span class="c01">AC 0E 1D 60 AD C2 2A AC</span> |,..`-B*,|
1E68:<span class="c01">C1 2A 60 4C 51 28 EA EA</span> |A*`LQ(jj|
1E70:<span class="c01">4C 59 FA 4C 65 FF 4C 58</span> |LYzLe.LX|
1E78:<span class="c01">FF 4C 65 FF 4C 65 FF 65</span> |.Le.Le.e|
1E80:<span class="c01">FF</span> <span class="c02">20 D1 1E AD 51 2A F0</span> |. Q.-Q*p| DOSHOOK, $1E81 - $1FCC, T0SD - T0SE
1E88:<span class="c02">15 48 AD 5C 2A 91 28 68</span> |.H-\*.(h|
1E90:<span class="c02">30 03 4C 26 26 20 EA 1D</span> |0.L&amp;&amp; j.|
1E98:<span class="c02">A4 24 A9 60 91 28 AD B3</span> |$$)`.(-3|
1EA0:<span class="c02">2A F0 03 20 82 26 A9 03</span> |*p. .&amp;).|
1EA8:<span class="c02">8D 52 2A 20 BA 1F 20 BA</span> |.R* :. :|
1EB0:<span class="c02">1E 8D 5C 2A 8E 5A 2A 4C</span> |..\*.Z*L|
1EB8:<span class="c02">B3 1F 6C 38 00 20 D1 1E</span> |3.l8. Q.|
1EC0:<span class="c02">AD 52 2A 0A AA BD 11 1D</span> |-R*.*=..|
1EC8:<span class="c02">48 BD 10 1D 48 AD 5C 2A</span> |H=..H-\*|
1ED0:<span class="c02">60 8D 5C 2A 8E 5A 2A 8C</span> |`.\*.Z*.|
1ED8:<span class="c02">5B 2A BA E8 E8 8E 59 2A</span> |[*:hh.Y*|
1EE0:<span class="c02">A2 03 BD 53 2A 95 36 CA</span> |".=S*.6J|
1EE8:<span class="c02">10 F8 60 AE B7 2A F0 03</span> |.x`.7*p.|
1EF0:<span class="c02">4C 78 1F AE 51 2A F0 08</span> |Lx..Q*p.|
1EF8:<span class="c02">C9 BF F0 75 C5 33 F0 27</span> |I?puE3p'|
1F00:<span class="c02">A2 02 8E 52 2A CD B2 2A</span> |"..R*M2*| <a class='ts' name='T0SE'>T0SE</a>
1F08:<span class="c02">D0 19 CA 8E 52 2A CA 8E</span> |P.J.R*J.|
1F10:<span class="c02">5D 2A AE 5D 2A 9D 00 02</span> |]*.]*...|
1F18:<span class="c02">E8 8E 5D 2A C9 8D D0 75</span> |h.]*I.Pu|
1F20:<span class="c02">4C CD 1F C9 8D D0 7D A2</span> |LM.I.P}"|
1F28:<span class="c02">00 8E 52 2A 4C A4 1F A2</span> |..R*L$."|
1F30:<span class="c02">00 8E 52 2A C9 8D F0 07</span> |..R*I.p.|
1F38:<span class="c02">AD B3 2A F0 67 D0 5E 48</span> |-3*pgP^H|
1F40:<span class="c02">38 AD B3 2A D0 03 20 5E</span> |8-3*P. ^|
1F48:<span class="c02">26 68 90 EC AE 5A 2A 4C</span> |&amp;h.l.Z*L|
1F50:<span class="c02">15 1F C9 8D D0 05 A9 05</span> |..I.P.).|
1F58:<span class="c02">8D 52 2A 20 0E 26 4C 99</span> |.R* .&amp;L.|
1F60:<span class="c02">1F CD B2 2A F0 85 C9 8A</span> |.M2*p.I.|
1F68:<span class="c02">F0 F1 A2 04 8E 52 2A D0</span> |pq"..R*P|
1F70:<span class="c02">E1 A9 00 8D 52 2A F0 25</span> |a)..R*p%|
1F78:<span class="c02">A9 00 8D B7 2A 20 51 28</span> |)..7* Q(|
1F80:<span class="c02">4C DC 24 AD 00 02 CD B2</span> |L\$-..M2|
1F88:<span class="c02">2A F0 0A A9 8D 8D 00 02</span> |*p.)....|
1F90:<span class="c02">A2 00 8E 5A 2A A9 40 D0</span> |"..Z*)@P|
1F98:<span class="c02">06 A9 10 D0 02 A9 20 2D</span> |.).P.) -|
1FA0:<span class="c02">5E 2A F0 0F 20 BA 1F 20</span> |^*p. :. |
1FA8:<span class="c02">C5 1F 8D 5C 2A 8C 5B 2A</span> |E..\*.[*|
1FB0:<span class="c02">8E 5A 2A 20 51 28 AE 59</span> |.Z* Q(.Y|
1FB8:<span class="c02">2A 9A AD 5C 2A AC 5B 2A</span> |*.-\*,[*|
1FC0:<span class="c02">AE 5A 2A 38 60 6C 36 00</span> |.Z*8`l6.|
1FC8:<span class="c02">A9 8D 4C C5 1F</span> <span class="c03">A0 FF 8C</span> |).LE. ..| CMDSCAN, $1FCD .. $2192, T0SE - T1S0
1FD0:<span class="c03">5F 2A C8 8C 62 2A EE 5F</span> |_*H.b*n_|
1FD8:<span class="c03">2A A2 00 08 BD 00 02 CD</span> |*"..=..M|
1FE0:<span class="c03">B2 2A D0 01 E8 8E 5D 2A</span> |2*P.h.]*|
1FE8:<span class="c03">20 A4 21 29 7F 59 84 28</span> | $!).Y.(|
1FF0:<span class="c03">C8 0A F0 02 68 08 90 F0</span> |H.p.h..p|
1FF8:<span class="c03">28 F0 20 B9 84 28 D0 D6</span> |(p 9.(PV|
2000:<span class="c03">AD 00 02 CD B2 2A F0 03</span> |-..M2*p.| <a class='ts' name='T0SF'>T0SF</a>
2008:<span class="c03">4C A4 1F AD 01 02 C9 8D</span> |L$.-..I.|
2010:<span class="c03">D0 06 20 5B 27 4C 95 1F</span> |P. ['L..|
2018:<span class="c03">4C C4 26 0E 5F 2A AC 5F</span> |LD&amp;._*,_|
2020:<span class="c03">2A 20 5E 26 90 0C A9 02</span> |* ^&amp;..).|
2028:<span class="c03">39 09 29 F0 05 A9 0F 4C</span> |9.)p.).L|
2030:<span class="c03">D2 26 C0 06 D0 02 84 33</span> |R&amp;@.P..3|
2038:<span class="c03">A9 20 39 09 29 F0 61 20</span> |) 9.)pa |
2040:<span class="c03">95 20 08 20 A4 21 F0 1E</span> |. . $!p.|
2048:<span class="c03">0A 90 05 30 03 4C 00 20</span> |...0.L. |
2050:<span class="c03">6A 4C 59 20 20 93 21 F0</span> |jLY  .!p|
2058:<span class="c03">0D 99 75 2A C8 C0 3C 90</span> |..u*H@&lt;.|
2060:<span class="c03">F3 20 93 21 D0 FB 28 D0</span> |s .!P{(P|
2068:<span class="c03">0F AC 5F 2A A9 10 39 09</span> |.,_*).9.|
2070:<span class="c03">29 F0 0C A0 1E 08 D0 CB</span> |)p. ..PK|
2078:<span class="c03">AD 93 2A C9 A0 F0 13 AD</span> |-.*I p.-|
2080:<span class="c03">75 2A C9 A0 D0 4B AC 5F</span> |u*I PK,_|
2088:<span class="c03">2A A9 C0 39 09 29 F0 02</span> |*)@9.)p.|
2090:<span class="c03">10 3F 4C 00 20 A0 3C A9</span> |.?L.  &lt;)|
2098:<span class="c03">A0 99 74 2A 88 D0 FA 60</span> | .t*.Pz`|
20A0:<span class="c03">8D 75 2A A9 0C 39 09 29</span> |.u*).9.)|
20A8:<span class="c03">F0 27 20 B9 21 B0 1F A8</span> |p' 9!0.(|
20B0:<span class="c03">D0 17 E0 11 B0 13 AC 5F</span> |P.`.0.,_|
20B8:<span class="c03">2A A9 08 39 09 29 F0 06</span> |*).9.)p.|
20C0:<span class="c03">E0 08 B0 CE 90 0B 8A D0</span> |`.0N...P|
20C8:<span class="c03">08 A9 02 4C D2 26 4C C4</span> |.).LR&amp;LD|
20D0:<span class="c03">26 A9 00 8D 65 2A 8D 74</span> |&amp;)..e*.t|
20D8:<span class="c03">2A 8D 66 2A 8D 6C 2A 8D</span> |*.f*.l*.|
20E0:<span class="c03">6D 2A 20 DC 3F AD 5D 2A</span> |m* \?-]*|
20E8:<span class="c03">20 A4 21 D0 1F C9 8D D0</span> | $!P.I.P|
20F0:<span class="c03">F7 AE 5F 2A AD 65 2A 1D</span> |w._*-e*.|
20F8:<span class="c03">0A 29 5D 0A 29 D0 93 AE</span> |.)].)P..|
2100:<span class="c03">63 2A F0 76 8D 63 2A 8E</span> |c*pv.c*.| <a class='ts' name='T1S0'>T1S0</a>
2108:<span class="c03">5D 2A D0 DC A2 0A DD 40</span> |]*P\".]@|
2110:<span class="c03">29 F0 05 CA D0 F8 F0 B6</span> |)p.JPxp6|
2118:<span class="c03">BD 4A 29 30 47 0D 65 2A</span> |=J)0G.e*|
2120:<span class="c03">8D 65 2A CA 8E 64 2A 20</span> |.e*J.d* |
2128:<span class="c03">B9 21 B0 A2 AD 64 2A 0A</span> |9!0"-d*.|
2130:<span class="c03">0A A8 A5 45 D0 09 A5 44</span> |.(%EP.%D|
2138:<span class="c03">D9 55 29 90 8C A5 45 D9</span> |YU)..%EY|
2140:<span class="c03">58 29 90 0B D0 83 A5 44</span> |X)..P.%D|
2148:<span class="c03">D9 57 29 90 02 D0 F5 AD</span> |YW)..Pu-|
2150:<span class="c03">63 2A D0 94 98 4A A8 A5</span> |c*P..J(%|
2158:<span class="c03">45 99 67 2A A5 44 99 66</span> |E.g*%D.f|
2160:<span class="c03">2A 4C E8 20 48 A9 80 0D</span> |*Lh H)..|
2168:<span class="c03">65 2A 8D 65 2A 68 29 7F</span> |e*.e*h).|
2170:<span class="c03">0D 74 2A 8D 74 2A D0 E9</span> |.t*.t*Pi|
2178:<span class="c03">F0 9C 20 80 21 4C 83 1F</span> |p. .!L..|
2180:<span class="c03">20 5B 27 20 AE 21 AD 5F</span> | [' .!-_|
2188:<span class="c03">2A AA BD 1F 1D 48 BD 1E</span> |**=..H=.|
2190:<span class="c03">1D 48 60</span> <span class="c04">AE 5D 2A BD 00</span> |.H`.]*=.| XOPNCLS, $2193 .. $2330, T1S0 - T1S2
2198:<span class="c04">02 C9 8D F0 06 E8 8E 5D</span> |.I.p.h.]|
21A0:<span class="c04">2A C9 AC 60 20 93 21 F0</span> |*I,` .!p|
21A8:<span class="c04">FA C9 A0 F0 F7 60 A9 00</span> |zI pw`).|
21B0:<span class="c04">A0 16 99 BA 35 88 D0 FA</span> | ..:5.Pz|
21B8:<span class="c04">60 A9 00 85 44 85 45 20</span> |`)..D.E |
21C0:<span class="c04">A4 21 08 C9 A4 F0 3C 28</span> |$!.I$p&lt;(|
21C8:<span class="c04">4C CE 21 20 A4 21 D0 06</span> |LN! $!P.|
21D0:<span class="c04">A6 44 A5 45 18 60 38 E9</span> |&amp;D%E.`8i|
21D8:<span class="c04">B0 30 21 C9 0A B0 1D 20</span> |00!I.0. |
21E0:<span class="c04">FE 21 65 44 AA A9 00 65</span> |~!eD*).e|
21E8:<span class="c04">45 A8 20 FE 21 20 FE 21</span> |E( ~! ~!|
21F0:<span class="c04">8A 65 44 85 44 98 65 45</span> |.eD.D.eE|
21F8:<span class="c04">85 45 90 CF 38 60 06 44</span> |.E.O8`.D|
2200:<span class="c04">26 45 60 28 20 A4 21 F0</span> |&amp;E`( $!p| <a class='ts' name='T1S1'>T1S1</a>
2208:<span class="c04">C5 38 E9 B0 30 EE C9 0A</span> |E8i00nI.|
2210:<span class="c04">90 08 E9 07 30 E6 C9 10</span> |..i.0fI.|
2218:<span class="c04">B0 E2 A2 04 20 FE 21 CA</span> |0b". ~!J|
2220:<span class="c04">D0 FA 05 44 85 44 4C 04</span> |Pz.D.DL.|
2228:<span class="c04">22 A5 44 4C 95 FE A5 44</span> |"%DL.~%D|
2230:<span class="c04">4C 8B FE AD 5E 2A 0D 74</span> |L.~-^*.t|
2238:<span class="c04">2A 8D 5E 2A 60 2C 74 2A</span> |*.^*`,t*|
2240:<span class="c04">50 03 20 C8 1F A9 70 4D</span> |P. H.)pM|
2248:<span class="c04">74 2A 2D 5E 2A 8D 5E 2A</span> |t*-^*.^*|
2250:<span class="c04">60 A9 00 8D B3 2A A5 44</span> |`)..3*%D|
2258:<span class="c04">48 20 16 23 68 8D 57 2A</span> |H .#h.W*|
2260:<span class="c04">4C D4 27 A9 05 20 AA 22</span> |LT'). *"|
2268:<span class="c04">20 64 27 A0 00 98 91 40</span> | d' ...@|
2270:<span class="c04">60 A9 07 D0 02 A9 08 20</span> |`).P.). |
2278:<span class="c04">AA 22 4C EA 22 A9 0C D0</span> |*"Lj").P|
2280:<span class="c04">F6 AD 08 1D 8D BD 35 AD</span> |v-...=5-|
2288:<span class="c04">09 1D 8D BE 35 A9 09 8D</span> |...&gt;5)..|
2290:<span class="c04">63 2A 20 C8 22 4C EA 22</span> |c* H"Lj"|
2298:<span class="c04">20 A3 22 20 8C 26 D0 FB</span> | #" .&amp;P{|
22A0:<span class="c04">4C 71 36 A9 00 4C D5 23</span> |Lq6).LU#|
22A8:<span class="c04">A9 01 8D 63 2A AD 6C 2A</span> |)..c*-l*|
22B0:<span class="c04">D0 0A AD 6D 2A D0 05 A9</span> |P.-m*P.)|
22B8:<span class="c04">01 8D 6C 2A AD 6C 2A 8D</span> |..l*-l*.|
22C0:<span class="c04">BD 35 AD 6D 2A 8D BE 35</span> |=5-m*.&gt;5|
22C8:<span class="c04">20 EA 22 A5 45 D0 03 4C</span> | j"%EP.L|
22D0:<span class="c04">C8 26 85 41 A5 44 85 40</span> |H&amp;.A%D.@|
22D8:<span class="c04">20 43 27 20 4E 27 20 1A</span> | C' N' .|
22E0:<span class="c04">27 AD 63 2A 8D BB 35 4C</span> |'-c*.;5L|
22E8:<span class="c04">A8 26 AD 75 2A C9 A0 F0</span> |(&amp;-u*I p|
22F0:<span class="c04">25 20 64 27 B0 3A 20 FC</span> |% d'0: ||
22F8:<span class="c04">22 4C EA 22 20 AF 27 D0</span> |"Lj" /'P|
2300:<span class="c04">05 A9 00 8D B3 2A A0 00</span> |.)..3* .| <a class='ts' name='T1S2'>T1S2</a>
2308:<span class="c04">98 91 40 20 4E 27 A9 02</span> |..@ N').|
2310:<span class="c04">8D BB 35 4C A8 26 20 92</span> |.;5L(&amp; .|
2318:<span class="c04">27 D0 05 20 9A 27 F0 10</span> |'P. .'p.|
2320:<span class="c04">20 AF 27 F0 F6 20 AA 27</span> | /'pv *'|
2328:<span class="c04">F0 F1 20 FC 22 4C 16 23</span> |pq |"L.#|
2330:<span class="c04">60</span> <span class="c05">A9 09 2D 65 2A C9 09</span> |`).-e*I.| XLODSAV,  $2331 .. $250F, T1S2 - T1S4
2338:<span class="c05">F0 03 4C 00 20 A9 04 20</span> |p.L. ). |
2340:<span class="c05">D5 23 AD 73 2A AC 72 2A</span> |U#-s*,r*|
2348:<span class="c05">20 E0 23 AD 6D 2A AC 6C</span> | `#-m*,l|
2350:<span class="c05">2A 20 E0 23 AD 73 2A AC</span> |* `#-s*,|
2358:<span class="c05">72 2A 4C FF 23 20 A8 22</span> |r*L.# ("|
2360:<span class="c05">A9 7F 2D C2 35 C9 04 F0</span> |).-B5I.p|
2368:<span class="c05">03 4C D0 26 A9 04 20 D5</span> |.LP&amp;). U|
2370:<span class="c05">23 20 7A 24 AA AD 65 2A</span> |# z$*-e*|
2378:<span class="c05">29 01 D0 06 8E 72 2A 8C</span> |).P..r*.|
2380:<span class="c05">73 2A 20 7A 24 AE 72 2A</span> |s* z$.r*|
2388:<span class="c05">AC 73 2A 4C 71 24 20 5D</span> |,s*Lq$ ]|
2390:<span class="c05">23 20 51 28 6C 72 2A AD</span> |# Q(lr*-|
2398:<span class="c05">B6 2A F0 20 A5 D6 10 03</span> |6*p %V..|
23A0:<span class="c05">4C CC 26 A9 02 20 D5 23</span> |LL&amp;). U#|
23A8:<span class="c05">38 A5 AF E5 67 A8 A5 B0</span> |8%/eg(%0|
23B0:<span class="c05">E5 68 20 E0 23 A5 68 A4</span> |eh `#%h$|
23B8:<span class="c05">67 4C FF 23 A9 01 20 D5</span> |gL.#). U|
23C0:<span class="c05">23 38 A5 4C E5 CA A8 A5</span> |#8%LeJ(%|
23C8:<span class="c05">4D E5 CB 20 E0 23 A5 CB</span> |MeK `#%K|
23D0:<span class="c05">A4 CA 4C FF 23 8D C2 35</span> |$JL.#.B5|
23D8:<span class="c05">48 20 A8 22 68 4C C4 27</span> |H ("hLD'|
23E0:<span class="c05">8C C1 35 8C C3 35 8D C2</span> |.A5.C5.B|
23E8:<span class="c05">35 A9 04 8D BB 35 A9 01</span> |5)..;5).|
23F0:<span class="c05">8D BC 35 20 A8 26 AD C2</span> |.&lt;5 (&amp;-B|
23F8:<span class="c05">35 8D C3 35 4C A8 26 8C</span> |5.C5L(&amp;.|
2400:<span class="c05">C3 35 8D C4 35 A9 02 4C</span> |C5.D5).L| <a class='ts' name='T1S3'>T1S3</a>
2408:<span class="c05">86 36 20 A8 26 4C EA 22</span> |.6 (&amp;Lj"|
2410:<span class="c05">4C D0 26 20 16 23 20 A8</span> |LP&amp; .# (|
2418:<span class="c05">22 A9 23 2D C2 35 F0 F0</span> |")#-B5pp|
2420:<span class="c05">8D C2 35 AD B6 2A F0 28</span> |.B5-6*p(|
2428:<span class="c05">A9 02 20 B1 24 20 7A 24</span> |). 1$ z$|
2430:<span class="c05">18 65 67 AA 98 65 68 C5</span> |.eg*.ehE|
2438:<span class="c05">74 B0 70 85 B0 85 6A 86</span> |t0p.0.j.|
2440:<span class="c05">AF 86 69 A6 67 A4 68 20</span> |/.i&amp;g$h |
2448:<span class="c05">71 24 20 51 28 6C 60 1D</span> |q$ Q(l`.|
2450:<span class="c05">A9 01 20 B1 24 20 7A 24</span> |). 1$ z$|
2458:<span class="c05">38 A5 4C ED 60 2A AA A5</span> |8%Lm`**%|
2460:<span class="c05">4D ED 61 2A 90 45 A8 C4</span> |Mma*.E(D|
2468:<span class="c05">4B 90 40 F0 3E 84 CB 86</span> |K.@p&gt;.K.|
2470:<span class="c05">CA 8E C3 35 8C C4 35 4C</span> |J.C5.D5L|
2478:<span class="c05">0A 24 AD 0A 1D 8D C3 35</span> |.$-...C5|
2480:<span class="c05">AD 0B 1D 8D C4 35 A9 00</span> |-...D5).|
2488:<span class="c05">8D C2 35 A9 02 8D C1 35</span> |.B5)..A5|
2490:<span class="c05">A9 03 8D BB 35 A9 02 8D</span> |)..;5)..|
2498:<span class="c05">BC 35 20 A8 26 AD 61 2A</span> |&lt;5 (&amp;-a*|
24A0:<span class="c05">8D C2 35 A8 AD 60 2A 8D</span> |.B5(-`*.|
24A8:<span class="c05">C1 35 60 20 EA 22 4C CC</span> |A5` j"LL|
24B0:<span class="c05">26 CD C2 35 F0 1A AE 5F</span> |&amp;MB5p.._|
24B8:<span class="c05">2A 8E 62 2A 4A F0 03 4C</span> |*.b*Jp.L|
24C0:<span class="c05">9E 25 A2 1D BD 75 2A 9D</span> |.%".=u*.|
24C8:<span class="c05">93 2A CA 10 F7 4C 7A 25</span> |.*J.wLz%|
24D0:<span class="c05">60 AD B6 2A F0 03 8D B7</span> |`-6*p..7|
24D8:<span class="c05">2A 20 13 24 20 C8 1F 20</span> |* .$ H. |
24E0:<span class="c05">51 28 6C 58 1D A5 4A 85</span> |Q(lX.%J.|
24E8:<span class="c05">CC A5 4B 85 CD 6C 56 1D</span> |L%K.MlV.|
24F0:<span class="c05">20 16 24 20 C8 1F 20 51</span> | .$ H. Q|
24F8:<span class="c05">28 6C 56 1D 20 65 D6 85</span> |(lV. eV.|
2500:<span class="c05">33 85 D8 4C D2 D7 20 65</span> |3.XLRW e| <a class='ts' name='T1S4'>T1S4</a>
2508:<span class="c05">0E 85 33 85 D8 4C D4 0F</span> |..3.XLT.|
2510:<span class="c06">20 26 25 A9 05 8D 52 2A</span> | &amp;%)..R*| XMISCMD, $2510 .. $26A7, T1S4 - T1S5
2518:<span class="c06">4C 83 1F 20 26 25 A9 01</span> |L.. &amp;%).|
2520:<span class="c06">8D 51 2A 4C 83 1F 20 64</span> |.Q*L.. d|
2528:<span class="c06">27 90 06 20 A3 22 4C 34</span> |'.. #"L4|
2530:<span class="c06">25 20 4E 27 AD 65 2A 29</span> |% N'-e*)|
2538:<span class="c06">06 F0 13 A2 03 BD 6E 2A</span> |.p.".=n*|
2540:<span class="c06">9D BD 35 CA 10 F7 A9 0A</span> |.=5J.w).|
2548:<span class="c06">8D BB 35 20 A8 26 60 A9</span> |.;5 (&amp;`)|
2550:<span class="c06">40 2D 65 2A F0 05 AD 66</span> |@-e*p.-f|
2558:<span class="c06">2A D0 05 A9 FE 8D 66 2A</span> |*P.)~.f*|
2560:<span class="c06">AD 0D 1D 8D BC 35 A9 0B</span> |-...&lt;5).|
2568:<span class="c06">20 AA 22 4C 97 23 A9 06</span> | *"L.#).|
2570:<span class="c06">20 AA 22 AD BF 35 8D 66</span> | *"-?5.f|
2578:<span class="c06">2A 60 A9 4C 20 B2 25 F0</span> |*`)L 2%p|
2580:<span class="c06">2E A9 00 8D B6 2A A0 1E</span> |.)..6* .|
2588:<span class="c06">20 97 20 A2 09 BD B7 2A</span> | . ".=7*|
2590:<span class="c06">9D 74 2A CA D0 F7 A9 C0</span> |.t*JPw)@|
2598:<span class="c06">8D 51 2A 4C D1 24 A9 20</span> |.Q*LQ$) |
25A0:<span class="c06">20 B2 25 F0 05 A9 01 4C</span> | 2%p.).L|
25A8:<span class="c06">D2 26 A9 00 8D B7 2A 4C</span> |R&amp;)..7*L|
25B0:<span class="c06">84 1D CD 00 E0 F0 0E 8D</span> |..M.`p..|
25B8:<span class="c06">80 C0 CD 00 E0 F0 06 8D</span> |.@M.`p..|
25C0:<span class="c06">81 C0 CD 00 E0 60 20 A3</span> |.@M.`` #|
25C8:<span class="c06">22 AD 4F 2A 8D B4 2A AD</span> |"-O*.4*-|
25D0:<span class="c06">50 2A 8D B5 2A AD 75 2A</span> |P*.5*-u*|
25D8:<span class="c06">8D B3 2A D0 0E 20 64 27</span> |.3*P. d'|
25E0:<span class="c06">90 06 20 A3 22 4C EB 25</span> |.. #"Lk%|
25E8:<span class="c06">20 4E 27 AD 65 2A 29 04</span> | N'-e*).|
25F0:<span class="c06">F0 1B AD 6E 2A D0 08 AE</span> |p.-n*P..|
25F8:<span class="c06">6F 2A F0 11 CE 6F 2A CE</span> |o*p.No*N|
2600:<span class="c06">6E 2A 20 8C 26 F0 38 C9</span> |n* .&amp;p8I| <a class='ts' name='T1S5'>T1S5</a>
2608:<span class="c06">8D D0 F7 F0 E5 60 20 5E</span> |.Pwpe` ^|
2610:<span class="c06">26 B0 66 AD 5C 2A 8D C3</span> |&amp;0f-\*.C|
2618:<span class="c06">35 A9 04 8D BB 35 A9 01</span> |5)..;5).|
2620:<span class="c06">8D BC 35 4C A8 26 20 5E</span> |.&lt;5L(&amp; ^|
2628:<span class="c06">26 B0 4E A9 06 8D 52 2A</span> |&amp;0N)..R*|
2630:<span class="c06">20 8C 26 D0 0F 20 FC 22</span> | .&amp;P. |"|
2638:<span class="c06">A9 03 CD 52 2A F0 CE A9</span> |).MR*pN)|
2640:<span class="c06">05 4C D2 26 C9 E0 90 02</span> |.LR&amp;I`..|
2648:<span class="c06">29 7F 8D 5C 2A AE 5A 2A</span> |)..\*.Z*|
2650:<span class="c06">F0 09 CA BD 00 02 09 80</span> |p.J=....|
2658:<span class="c06">9D 00 02 4C B3 1F 48 AD</span> |...L3.H-|
2660:<span class="c06">B6 2A F0 0E A6 76 E8 F0</span> |6*p.&amp;vhp|
2668:<span class="c06">0D A6 33 E0 DD F0 07 68</span> |.&amp;3`]p.h|
2670:<span class="c06">18 60 A5 D9 30 F9 68 38</span> |.`%Y0yh8|
2678:<span class="c06">60 20 FC 22 20 5B 27 4C</span> |` |" ['L|
2680:<span class="c06">B3 1F 20 9D 26 20 4E 27</span> |3. .&amp; N'|
2688:<span class="c06">A9 03 D0 A1 A9 03 8D BB</span> |).P!)..;|
2690:<span class="c06">35 A9 01 8D BC 35 20 A8</span> |5)..&lt;5 (|
2698:<span class="c06">26 AD C3 35 60 AD B5 2A</span> |&amp;-C5`-5*|
26A0:<span class="c06">85 41 AD B4 2A 85 40 60</span> |.A-4*.@`|
26A8:<span class="c07">20 06 2B 90 16 AD C5 35</span> | .+..-E5| DOSGOER, $26A8 .. $27D3, T1S5 - T1S6
26B0:<span class="c07">C9 05 F0 03 4C 5E 36 4C</span> |I.p.L^6L|
26B8:<span class="c07">92 36 EA 20 69 3A A2 00</span> |.6j i:".|
26C0:<span class="c07">8E C3 35 60 A9 0B D0 0A</span> |.C5`).P.|
26C8:<span class="c07">A9 0C D0 06 A9 0E D0 02</span> |).P.).P.|
26D0:<span class="c07">A9 0D 8D 5C 2A 20 E6 3F</span> |)..\* f?|
26D8:<span class="c07">AD B6 2A F0 04 A5 D8 30</span> |-6*p.%X0|
26E0:<span class="c07">0E A2 00 20 02 27 AE 5C</span> |.". .'.\|
26E8:<span class="c07">2A 20 02 27 20 C8 1F 20</span> |* .' H. |
26F0:<span class="c07">51 28 20 5E 26 AE 5C 2A</span> |Q( ^&amp;.\*|
26F8:<span class="c07">A9 03 B0 03 6C 5A 1D 6C</span> |).0.lZ.l|
2700:<span class="c07">5E 1D BD 3F 2A AA 8E 63</span> |^.=?**.c| <a class='ts' name='T1S6'>T1S6</a>
2708:<span class="c07">2A BD 71 29 48 09 80 20</span> |*=q)H.. |
2710:<span class="c07">C5 1F AE 63 2A E8 68 10</span> |E..c*hh.|
2718:<span class="c07">ED 60 AD 66 2A 8D BF 35</span> |m`-f*.?5|
2720:<span class="c07">AD 68 2A 8D C0 35 AD 6A</span> |-h*.@5-j|
2728:<span class="c07">2A 8D C1 35 AD 06 1D 8D</span> |*.A5-...|
2730:<span class="c07">C3 35 AD 07 1D 8D C4 35</span> |C5-...D5|
2738:<span class="c07">A5 40 8D 4F 2A A5 41 8D</span> |%@.O*%A.|
2740:<span class="c07">50 2A 60 A0 1D B9 75 2A</span> |P*` .9u*|
2748:<span class="c07">91 40 88 10 F8 60 A0 1E</span> |.@..x` .|
2750:<span class="c07">B1 40 99 A9 35 C8 C0 26</span> |1@.)5H@&amp;|
2758:<span class="c07">D0 F6 60 A0 00 8C 51 2A</span> |Pv` ..Q*|
2760:<span class="c07">8C 52 2A 60 A9 00 85 45</span> |.R*`)..E|
2768:<span class="c07">20 92 27 4C 73 27 20 9A</span> | .'Ls' .|
2770:<span class="c07">27 F0 1D 20 AA 27 D0 0A</span> |'p. *'P.|
2778:<span class="c07">A5 40 85 44 A5 41 85 45</span> |%@.D%A.E|
2780:<span class="c07">D0 EC A0 1D B1 40 D9 75</span> |Pl .1@Yu|
2788:<span class="c07">2A D0 E3 88 10 F6 18 60</span> |*Pc..v.`|
2790:<span class="c07">38 60 AD 00 1D AE 01 1D</span> |8`-.....|
2798:<span class="c07">D0 0A A0 25 B1 40 F0 09</span> |P. %1@p.|
27A0:<span class="c07">AA 88 B1 40 86 41 85 40</span> |*.1@.A.@|
27A8:<span class="c07">8A 60 A0 00 B1 40 60 AD</span> |.` .1@`-|
27B0:<span class="c07">B3 2A F0 0E AD B4 2A C5</span> |3*p.-4*E|
27B8:<span class="c07">40 D0 08 AD B5 2A C5 41</span> |@P.-5*EA|
27C0:<span class="c07">F0 01 CA 60 4D C2 35 F0</span> |p.J`MB5p|
27C8:<span class="c07">0A 29 7F F0 06 20 EA 22</span> |.).p. j"|
27D0:<span class="c07">4C D0 26 60</span> <span class="c08">38 AD 00 1D</span> |LP&amp;`8-..| BLDFTAB, $27D4 .. $2883, T1S6 - T1S7
27D8:<span class="c08">85 40 AD 01 1D 85 41 AD</span> |.@-...A-|
27E0:<span class="c08">57 2A 8D 63 2A A0 00 98</span> |W*.c* ..|
27E8:<span class="c08">91 40 A0 1E 38 A5 40 E9</span> |.@ .8%@i|
27F0:<span class="c08">2D 91 40 48 A5 41 E9 00</span> |-.@H%Ai.|
27F8:<span class="c08">C8 91 40 AA CA 68 48 C8</span> |H.@*JhHH|
2800:<span class="c08">91 40 8A C8 91 40 AA CA</span> |.@.H.@*J| <a class='ts' name='T1S7'>T1S7</a>
2808:<span class="c08">68 48 C8 91 40 C8 8A 91</span> |hHH.@H..|
2810:<span class="c08">40 CE 63 2A F0 17 AA 68</span> |@Nc*p.*h|
2818:<span class="c08">38 E9 26 C8 91 40 48 8A</span> |8i&amp;H.@H.|
2820:<span class="c08">E9 00 C8 91 40 85 41 68</span> |i.H.@.Ah|
2828:<span class="c08">85 40 4C E5 27 48 A9 00</span> |.@Le'H).|
2830:<span class="c08">C8 91 40 C8 91 40 AD B6</span> |H.@H.@-6|
2838:<span class="c08">2A F0 0B 68 85 74 85 70</span> |*p.h.t.p|
2840:<span class="c08">68 85 73 85 6F 60 68 85</span> |h.s.o`h.|
2848:<span class="c08">4D 85 CB 68 85 4C 85 CA</span> |M.Kh.L.J|
2850:<span class="c08">60 A5 39 CD 03 1D F0 12</span> |`%9M..p.|
2858:<span class="c08">8D 56 2A A5 38 8D 55 2A</span> |.V*%8.U*|
2860:<span class="c08">AD 02 1D 85 38 AD 03 1D</span> |-...8-..|
2868:<span class="c08">85 39 A5 37 CD 05 1D F0</span> |.9%7M..p|
2870:<span class="c08">12 8D 54 2A A5 36 8D 53</span> |..T*%6.S|
2878:<span class="c08">2A AD 04 1D 85 36 AD 05</span> |*-...6-.|
2880:<span class="c08">1D 85 37 60</span> <span class="c09">49 4E 49 D4</span> |..7`INIT| CMDTBLS, $2884 .. $2A4E, T1S7 - T1S9
2888:<span class="c09">4C 4F 41 C4 53 41 56 C5</span> |LOADSAVE|
2890:<span class="c09">52 55 CE 43 48 41 49 CE</span> |RUNCHAIN|
2898:<span class="c09">44 45 4C 45 54 C5 4C 4F</span> |DELETELO|
28A0:<span class="c09">43 CB 55 4E 4C 4F 43 CB</span> |CKUNLOCK|
28A8:<span class="c09">43 4C 4F 53 C5 52 45 41</span> |CLOSEREA|
28B0:<span class="c09">C4 45 58 45 C3 57 52 49</span> |DEXECWRI|
28B8:<span class="c09">54 C5 50 4F 53 49 54 49</span> |TEPOSITI|
28C0:<span class="c09">4F CE 4F 50 45 CE 41 50</span> |ONOPENAP|
28C8:<span class="c09">50 45 4E C4 52 45 4E 41</span> |PENDRENA|
28D0:<span class="c09">4D C5 43 41 54 41 4C 4F</span> |MECATALO|
28D8:<span class="c09">C7 4D 4F CE 4E 4F 4D 4F</span> |GMONNOMO|
28E0:<span class="c09">CE 50 52 A3 49 4E A3 4D</span> |NPR#IN#M|
28E8:<span class="c09">41 58 46 49 4C 45 D3 46</span> |AXFILESF|
28F0:<span class="c09">D0 49 4E D4 42 53 41 56</span> |PINTBSAV|
28F8:<span class="c09">C5 42 4C 4F 41 C4 42 52</span> |EBLOADBR|
2900:<span class="c09">55 CE 56 45 52 49 46 D9</span> |UNVERIFY| <a class='ts' name='T1S8'>T1S8</a>
2908:<span class="c09">00 21 70 A0 70 A1 70 A0</span> |.!p p!p |
2910:<span class="c09">70 20 70 20 70 20 70 20</span> |p p p p |
2918:<span class="c09">70 60 00 22 06 20 74 22</span> |p`.". t"|
2920:<span class="c09">06 22 04 23 78 22 70 30</span> |.".#x"p0|
2928:<span class="c09">70 40 70 40 80 40 80 08</span> |p@p@.@..|
2930:<span class="c09">00 08 00 04 00 40 70 40</span> |.....@p@|
2938:<span class="c09">00 21 79 20 71 20 71 20</span> |.!y q q |
2940:<span class="c09">70 D6 C4 D3 CC D2 C2 C1</span> |pVDSLRBA|
2948:<span class="c09">C3 C9 CF 40 20 10 08 04</span> |CIO@ ...|
2950:<span class="c09">02 01 C0 A0 90 00 00 FE</span> |..@ ...~|
2958:<span class="c09">00 01 00 02 00 01 00 07</span> |........|
2960:<span class="c09">00 01 00 FF 7F 00 00 FF</span> |........|
2968:<span class="c09">7F 00 00 FF 7F 00 00 FF</span> |........|
2970:<span class="c09">FF 0D 07 8D 4C 41 4E 47</span> |....LANG|
2978:<span class="c09">55 41 47 45 20 4E 4F 54</span> |UAGE NOT|
2980:<span class="c09">20 41 56 41 49 4C 41 42</span> | AVAILAB|
2988:<span class="c09">4C C5 52 41 4E 47 45 20</span> |LERANGE |
2990:<span class="c09">45 52 52 4F D2 57 52 49</span> |ERRORWRI|
2998:<span class="c09">54 45 20 50 52 4F 54 45</span> |TE PROTE|
29A0:<span class="c09">43 54 45 C4 45 4E 44 20</span> |CTEDEND |
29A8:<span class="c09">4F 46 20 44 41 54 C1 46</span> |OF DATAF|
29B0:<span class="c09">49 4C 45 20 4E 4F 54 20</span> |ILE NOT |
29B8:<span class="c09">46 4F 55 4E C4 56 4F 4C</span> |FOUNDVOL|
29C0:<span class="c09">55 4D 45 20 4D 49 53 4D</span> |UME MISM|
29C8:<span class="c09">41 54 43 C8 49 2F 4F 20</span> |ATCHI/O |
29D0:<span class="c09">45 52 52 4F D2 44 49 53</span> |ERRORDIS|
29D8:<span class="c09">4B 20 46 55 4C CC 46 49</span> |K FULLFI|
29E0:<span class="c09">4C 45 20 4C 4F 43 4B 45</span> |LE LOCKE|
29E8:<span class="c09">C4 53 59 4E 54 41 58 20</span> |DSYNTAX |
29F0:<span class="c09">45 52 52 4F D2 4E 4F 20</span> |ERRORNO |
29F8:<span class="c09">42 55 46 46 45 52 53 20</span> |BUFFERS |
2A00:<span class="c09">41 56 41 49 4C 41 42 4C</span> |AVAILABL| <a class='ts' name='T1S9'>T1S9</a>
2A08:<span class="c09">C5 46 49 4C 45 20 54 59</span> |EFILE TY|
2A10:<span class="c09">50 45 20 4D 49 53 4D 41</span> |PE MISMA|
2A18:<span class="c09">54 43 C8 50 52 4F 47 52</span> |TCHPROGR|
2A20:<span class="c09">41 4D 20 54 4F 4F 20 4C</span> |AM TOO L|
2A28:<span class="c09">41 52 47 C5 4E 4F 54 20</span> |ARGENOT |
2A30:<span class="c09">44 49 52 45 43 54 20 43</span> |DIRECT C|
2A38:<span class="c09">4F 4D 4D 41 4E C4 8D 00</span> |OMMAND..|
2A40:<span class="c09">03 19 19 24 33 3E 4C 5B</span> |...$3&gt;L[|
2A48:<span class="c09">64 6D 78 84 98 AA BB</span> <span class="c10">00</span> |dmx..*;.| FDOSENT, $2A4F .. $2B21, T1S9 - T1SA
2A50:<span class="c10">00 00 00 00 00 00 00 00</span> |........|
2A58:<span class="c10">03 00 00 00 00 00 00 00</span> |........|
2A60:<span class="c10">00 00 00 00 00 00 00 00</span> |........|
2A68:<span class="c10">00 00 00 00 01 00 00 00</span> |........|
2A70:<span class="c10">00 00 00 00 00 C8 C5 CC</span> |.....HEL|
2A78:<span class="c10">CC CF A0 A0 A0 A0 A0 A0</span> |LO      |
2A80:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2A88:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2A90:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2A98:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2AA0:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2AA8:<span class="c10">A0 A0 A0 A0 A0 A0 A0 A0</span> |        |
2AB0:<span class="c10">A0 03 84 00 00 00 00 00</span> | .......|
2AB8:<span class="c10">C1 D0 D0 CC C5 D3 CF C6</span> |APPLESOF|
2AC0:<span class="c10">D4 E8 37 BB 33 BB 34 00</span> |Th7;3;4.|
2AC8:<span class="c10">40 7E 33 21 2B 05 2C 57</span> |@~3!+.,W|
2AD0:<span class="c10">2C 6F 2C 2A 2D 97 2D EE</span> |,o,*-.-n|
2AD8:<span class="c10">2C F5 2C 39 2C 11 2D 8D</span> |,u,9,.-.|
2AE0:<span class="c10">2E 17 2D 7E 33 7E 33 89</span> |..-~3~3.|
2AE8:<span class="c10">2C 95 2C 86 2C 92 2C 7E</span> |,.,.,.,~|
2AF0:<span class="c10">33 7E 33 BD 2C C9 2C BA</span> |3~3=,I,:|
2AF8:<span class="c10">2C C6 2C 7E 33 E0 00 F0</span> |,F,~3`.p|
2B00:<span class="c10">02 A2 02 8E 5F 2A BA 8E</span> |.".._*:.| <a class='ts' name='T1SA'>T1SA</a>
2B08:<span class="c10">9B 33 20 6A 2E AD BB 35</span> |.3 j.-;5|
2B10:<span class="c10">C9 0D B0 0B 0A AA BD CA</span> |I.0..*=J|
2B18:<span class="c10">2A 48 BD C9 2A 48 60 4C</span> |*H=I*H`L|
2B20:<span class="c10">63 33</span> <span class="c11">20 28 2B 4C 7F 33</span> |c3 (+L.3| FOPCLRW, $2B22 .. $2CEE, T1SA - T1SB
2B28:<span class="c11">20 DC 2B A9 01 8D E3 35</span> | \+)..c5|
2B30:<span class="c11">AE BE 35 AD BD 35 D0 05</span> |.&gt;5-=5P.|
2B38:<span class="c11">E0 00 D0 01 E8 8D E8 35</span> |`.P.h.h5|
2B40:<span class="c11">8E E9 35 20 C9 31 90 5E</span> |.i5 I1.^|
2B48:<span class="c11">8E 9C 33 AE 5F 2A BD 09</span> |..3._*=.|
2B50:<span class="c11">29 AE 9C 33 4A B0 0D AD</span> |)..3J0.-|
2B58:<span class="c11">51 2A C9 C0 D0 03 4C 5F</span> |Q*I@P.L_|
2B60:<span class="c11">33 4C 73 33 A9 00 9D E8</span> |3Ls3)..h|
2B68:<span class="c11">34 A9 01 9D E7 34 8E 9C</span> |4)..g4..|
2B70:<span class="c11">33 20 44 32 AE 9C 33 9D</span> |3 D2..3.|
2B78:<span class="c11">C7 34 8D D2 35 8D D4 35</span> |G4.R5.T5|
2B80:<span class="c11">AD F1 35 9D C6 34 8D D1</span> |-q5.F4.Q|
2B88:<span class="c11">35 8D D3 35 AD C2 35 9D</span> |5.S5-B5.|
2B90:<span class="c11">C8 34 20 37 30 20 0C 2F</span> |H4 70 ./|
2B98:<span class="c11">20 D6 37 20 3A 2F AE 9C</span> | V7 :/..|
2BA0:<span class="c11">33 A9 06 8D C5 35 BD C6</span> |3)..E5=F|
2BA8:<span class="c11">34 8D D1 35 BD C7 34 8D</span> |4.Q5=G4.|
2BB0:<span class="c11">D2 35 BD C8 34 8D C2 35</span> |R5=H4.B5|
2BB8:<span class="c11">8D F6 35 BD E7 34 8D EE</span> |.v5=g4.n|
2BC0:<span class="c11">35 BD E8 34 8D EF 35 8E</span> |5=h4.o5.|
2BC8:<span class="c11">D9 35 A9 FF 8D E0 35 8D</span> |Y5)..`5.|
2BD0:<span class="c11">E1 35 AD E2 33 8D DA 35</span> |a5-b3.Z5|
2BD8:<span class="c11">18 4C 5E 2F A9 00 AA 9D</span> |.L^/).*.|
2BE0:<span class="c11">D1 35 E8 E0 2D D0 F8 AD</span> |Q5h`-Px-|
2BE8:<span class="c11">BF 35 49 FF 8D F9 35 AD</span> |?5I..y5-|
2BF0:<span class="c11">C0 35 8D F8 35 AD C1 35</span> |@5.x5-A5|
2BF8:<span class="c11">0A 0A 0A 0A AA 8E F7 35</span> |....*.w5|
2C00:<span class="c11">A9 11 8D FA 35 60 20 1D</span> |)..z5` .| <a class='ts' name='T1SB'>T1SB</a>
2C08:<span class="c11">2F 20 34 2F 20 C3 32 A9</span> |/ 4/ C2)|
2C10:<span class="c11">02 2D D5 35 F0 21 20 F7</span> |.-U5p! w|
2C18:<span class="c11">2F A9 00 18 20 11 30 38</span> |/).. .08|
2C20:<span class="c11">CE D8 35 D0 F7 AE D9 35</span> |NX5Pw.Y5|
2C28:<span class="c11">AD EE 35 9D E7 34 AD EF</span> |-n5.g4-o|
2C30:<span class="c11">35 9D E8 34 20 37 30 4C</span> |5.h4 70L|
2C38:<span class="c11">7F 33 20 28 2B AD F6 35</span> |.3 (+-v5|
2C40:<span class="c11">30 2B AD BD 35 85 42 AD</span> |0+-=5.B-|
2C48:<span class="c11">BE 35 85 43 AE 9C 33 20</span> |&gt;5.C..3 |
2C50:<span class="c11">1C 32 20 37 30 4C 7F 33</span> |.2 70L.3|
2C58:<span class="c11">AD BC 35 C9 05 B0 0B 0A</span> |-&lt;5I.0..|
2C60:<span class="c11">AA BD E6 2A 48 BD E5 2A</span> |*=f*H=e*|
2C68:<span class="c11">48 60 4C 67 33 4C 7B 33</span> |H`Lg3L{3|
2C70:<span class="c11">AD F6 35 30 F8 AD BC 35</span> |-v50x-&lt;5|
2C78:<span class="c11">C9 05 B0 EE 0A AA BD F2</span> |I.0n.*=r|
2C80:<span class="c11">2A 48 BD F1 2A 48 60 20</span> |*H=q*H` |
2C88:<span class="c11">00 33 20 A8 2C 8D C3 35</span> |.3 (,.C5|
2C90:<span class="c11">4C 7F 33 20 00 33 20 B5</span> |L.3 .3 5|
2C98:<span class="c11">31 20 A8 2C 48 20 A2 31</span> |1 (,H "1|
2CA0:<span class="c11">A0 00 68 91 42 4C 96 2C</span> | .h.BL.,|
2CA8:<span class="c11">20 B6 30 B0 0B B1 42 48</span> | 600.1BH|
2CB0:<span class="c11">20 5B 31 20 94 31 68 60</span> | [1 .1h`|
2CB8:<span class="c11">4C 6F 33 20 00 33 AD C3</span> |Lo3 .3-C|
2CC0:<span class="c11">35 20 DA 2C 4C 7F 33 20</span> |5 Z,L.3 |
2CC8:<span class="c11">00 33 20 A2 31 A0 00 B1</span> |.3 "1 .1|
2CD0:<span class="c11">42 20 DA 2C 20 B5 31 4C</span> |B Z, 51L|
2CD8:<span class="c11">CA 2C 48 20 B6 30 68 91</span> |J,H 60h.|
2CE0:<span class="c11">42 A9 40 0D D5 35 8D D5</span> |B)@.U5.U|
2CE8:<span class="c11">35 20 5B 31 4C 94 31</span> <span class="c20">A9</span> |5 [1L.1)| FDELCAT, $2CEF .. $2E8D, T1SB - T1SD
2CF0:<span class="c20">80 8D 9E 33 D0 05 A9 00</span> |...3P.).|
2CF8:<span class="c20">8D 9E 33 20 28 2B AE 9C</span> |..3 (+..|
2D00:<span class="c20">33 BD C8 34 29 7F 0D 9E</span> |3=H4)...| <a class='ts' name='T1SC'>T1SC</a>
2D08:<span class="c20">33 9D C8 34 20 37 30 4C</span> |3.H4 70L|
2D10:<span class="c20">7F 33 20 00 33 4C 7F 33</span> |.3 .3L.3|
2D18:<span class="c20">20 28 2B 20 B6 30 B0 EF</span> | (+ 600o|
2D20:<span class="c20">EE E4 35 D0 F6 EE E5 35</span> |nd5Pvne5|
2D28:<span class="c20">4C 1B 2D 20 28 2B AE 9C</span> |L.- (+..|
2D30:<span class="c20">33 BD C8 34 10 03 4C 7B</span> |3=H4..L{|
2D38:<span class="c20">33 AE 9C 33 BD C6 34 8D</span> |3..3=F4.|
2D40:<span class="c20">D1 35 9D E6 34 A9 FF 9D</span> |Q5.f4)..|
2D48:<span class="c20">C6 34 BC C7 34 8C D2 35</span> |F4&lt;G4.R5|
2D50:<span class="c20">20 37 30 18 20 5E 2F B0</span> | 70. ^/0|
2D58:<span class="c20">2A 20 0C 2F A0 0C 8C 9C</span> |* ./ ...|
2D60:<span class="c20">33 B1 42 30 0B F0 09 48</span> |31B0.p.H|
2D68:<span class="c20">C8 B1 42 A8 68 20 89 2D</span> |H1B(h .-|
2D70:<span class="c20">AC 9C 33 C8 C8 D0 E7 AD</span> |,.3HHPg-|
2D78:<span class="c20">D3 35 AC D4 35 20 89 2D</span> |S5,T5 .-|
2D80:<span class="c20">38 B0 D1 20 FB 2F 4C 7F</span> |80Q {/L.|
2D88:<span class="c20">33 38 20 DD 32 A9 00 A2</span> |38 ]2)."|
2D90:<span class="c20">05 9D F0 35 CA 10 FA 60</span> |..p5J.z`|
2D98:<span class="c20">20 DC 2B A9 FF 8D F9 35</span> | \+)..y5|
2DA0:<span class="c20">20 F7 2F A9 16 8D 9D 33</span> | w/)...3|
2DA8:<span class="c20">20 2F 2E 20 2F 2E A2 0B</span> | /. /.".|
2DB0:<span class="c20">BD AF 33 20 ED FD CA 10</span> |=/3 m}J.|
2DB8:<span class="c20">F7 86 45 AD F6 37 85 44</span> |w.E-v7.D|
2DC0:<span class="c20">20 42 2E 20 2F 2E 20 2F</span> | B. /. /|
2DC8:<span class="c20">2E 18 20 11 30 B0 5D A2</span> |.. .00]"|
2DD0:<span class="c20">00 8E 9C 33 BD C6 34 F0</span> |...3=F4p|
2DD8:<span class="c20">53 30 4A A0 A0 BD C8 34</span> |S0J  =H4|
2DE0:<span class="c20">10 02 A0 AA 98 20 ED FD</span> |.. *. m}|
2DE8:<span class="c20">BD C8 34 29 7F A0 07 0A</span> |=H4). ..|
2DF0:<span class="c20">0A B0 03 88 D0 FA B9 A7</span> |.0..Pz9'|
2DF8:<span class="c20">33 20 ED FD A9 A0 20 ED</span> |3 m})  m|
2E00:<span class="c20">FD BD E7 34 85 44 BD E8</span> |}=g4.D=h| <a class='ts' name='T1SD'>T1SD</a>
2E08:<span class="c20">34 85 45 20 42 2E A9 A0</span> |4.E B.) |
2E10:<span class="c20">20 ED FD E8 E8 E8 A0 1D</span> | m}hhh .|
2E18:<span class="c20">BD C6 34 20 ED FD E8 88</span> |=F4 m}h.|
2E20:<span class="c20">10 F6 20 2F 2E 20 30 32</span> |.v /. 02|
2E28:<span class="c20">90 A7 B0 9E 4C 7F 33 A9</span> |.'0.L.3)|
2E30:<span class="c20">8D 20 ED FD CE 9D 33 D0</span> |. m}N.3P|
2E38:<span class="c20">08 20 0C FD A9 15 8D 9D</span> |. .})...|
2E40:<span class="c20">33 60 A0 02 A9 00 48 A5</span> |3` .).H%|
2E48:<span class="c20">44 D9 A4 33 90 12 F9 A4</span> |DY$3..y$|
2E50:<span class="c20">33 85 44 A5 45 E9 00 85</span> |3.D%Ei..|
2E58:<span class="c20">45 68 69 00 48 4C 47 2E</span> |Ehi.HLG.|
2E60:<span class="c20">68 09 B0 20 ED FD 88 10</span> |h.0 m}..|
2E68:<span class="c20">DB 60 20 08 2F A0 00 8C</span> |[` ./ ..|
2E70:<span class="c20">C5 35 B1 42 99 D1 35 C8</span> |E51B.Q5H|
2E78:<span class="c20">C0 2D D0 F6 18 60 20 08</span> |@-Pv.` .|
2E80:<span class="c20">2F A0 00 B9 D1 35 91 42</span> |/ .9Q5.B|
2E88:<span class="c20">C8 C0 2D D0 F6 60</span> <span class="c21">20 DC</span> |H@-Pv` \| FMTRWIO, $2E8E .. $2FF6, T1SD - T1SE
2E90:<span class="c21">2B A9 04 20 58 30 AD F9</span> |+). X0-y|
2E98:<span class="c21">35 49 FF 8D C1 33 A9 11</span> |5I..A3).|
2EA0:<span class="c21">8D EB 33 A9 01 8D EC 33</span> |.k3)..l3|
2EA8:<span class="c21">A2 38 A9 00 9D BB 33 E8</span> |"8)..;3h|
2EB0:<span class="c21">D0 FA A2 0C E0 8C F0 14</span> |Pz".`.p.|
2EB8:<span class="c21">A0 03 B9 A0 33 9D F3 33</span> | .9 3.s3|
2EC0:<span class="c21">E8 88 10 F6 E0 44 D0 EC</span> |h..v`DPl|
2EC8:<span class="c21">A2 48 D0 E8 20 FB 2F A2</span> |"HPh {/"|
2ED0:<span class="c21">00 8A 9D BB 34 E8 D0 FA</span> |...;4hPz|
2ED8:<span class="c21">20 45 30 A9 11 AC F0 33</span> | E0).,p3|
2EE0:<span class="c21">88 88 8D EC 37 8D BC 34</span> |...l7.&lt;4|
2EE8:<span class="c21">8C BD 34 C8 8C ED 37 A9</span> |.=4H.m7)|
2EF0:<span class="c21">02 20 58 30 AC BD 34 88</span> |. X0,=4.|
2EF8:<span class="c21">30 05 D0 EC 98 F0 E6 20</span> |0.Pl.pf |
2F00:<span class="c21">C2 37 20 4A 37 4C 7F 33</span> |B7 J7L.3| <a class='ts' name='T1SE'>T1SE</a>
2F08:<span class="c21">A2 00 F0 06 A2 02 D0 02</span> |".p.".P.|
2F10:<span class="c21">A2 04 BD C7 35 85 42 BD</span> |".=G5.B=|
2F18:<span class="c21">C8 35 85 43 60 2C D5 35</span> |H5.C`,U5|
2F20:<span class="c21">70 01 60 20 E4 2F A9 02</span> |p.` d/).|
2F28:<span class="c21">20 52 30 A9 BF 2D D5 35</span> | R0)?-U5|
2F30:<span class="c21">8D D5 35 60 AD D5 35 30</span> |.U5`-U50|
2F38:<span class="c21">01 60 20 4B 2F A9 02 20</span> |.` K/). |
2F40:<span class="c21">52 30 A9 7F 2D D5 35 8D</span> |R0).-U5.|
2F48:<span class="c21">D5 35 60 AD C9 35 8D F0</span> |U5`-I5.p|
2F50:<span class="c21">37 AD CA 35 8D F1 37 AE</span> |7-J5.q7.|
2F58:<span class="c21">D3 35 AC D4 35 60 08 20</span> |S5,T5`. |
2F60:<span class="c21">34 2F 20 4B 2F 20 0C 2F</span> |4/ K/ ./|
2F68:<span class="c21">28 B0 09 AE D1 35 AC D2</span> |(0..Q5,R|
2F70:<span class="c21">35 4C B5 2F A0 01 B1 42</span> |5L5/ .1B|
2F78:<span class="c21">F0 08 AA C8 B1 42 A8 4C</span> |p.*H1B(L|
2F80:<span class="c21">B5 2F AD BB 35 C9 04 F0</span> |5/-;5I.p|
2F88:<span class="c21">02 38 60 20 44 32 A0 02</span> |.8` D2 .|
2F90:<span class="c21">91 42 48 88 AD F1 35 91</span> |.BH.-q5.|
2F98:<span class="c21">42 48 20 3A 2F 20 D6 37</span> |BH :/ V7|
2FA0:<span class="c21">A0 05 AD DE 35 91 42 C8</span> | .-^5.BH|
2FA8:<span class="c21">AD DF 35 91 42 68 AA 68</span> |-_5.Bh*h|
2FB0:<span class="c21">A8 A9 02 D0 02 A9 01 8E</span> |().P.)..|
2FB8:<span class="c21">D3 35 8C D4 35 20 52 30</span> |S5.T5 R0|
2FC0:<span class="c21">A0 05 B1 42 8D DC 35 18</span> | .1B.\5.|
2FC8:<span class="c21">6D DA 35 8D DE 35 C8 B1</span> |mZ5.^5H1|
2FD0:<span class="c21">42 8D DD 35 6D DB 35 8D</span> |B.]5m[5.|
2FD8:<span class="c21">DF 35 18 60 20 E4 2F A9</span> |_5.` d/)|
2FE0:<span class="c21">01 4C 52 30 AC CB 35 AD</span> |.LR0,K5-|
2FE8:<span class="c21">CC 35 8C F0 37 8D F1 37</span> |L5.p7.q7|
2FF0:<span class="c21">AE D6 35 AC D7 35 60</span> <span class="c22">A9</span> |.V5,W5`)| FLOCNXB, T1SE - T2S0, $2FF7 .. $31C8
2FF8:<span class="c22">01 D0 02 A9 02 AC C3 2A</span> |.P.).,C*|
3000:<span class="c22">8C F0 37 AC C4 2A 8C F1</span> |.p7,D*.q| <a class='ts' name='T1SF'>T1SF</a>
3008:<span class="c22">37 AE FA 35 A0 00 4C 52</span> |7.z5 .LR|
3010:<span class="c22">30 08 20 45 30 28 B0 08</span> |0. E0(0.|
3018:<span class="c22">AC BD 33 AE BC 33 D0 0A</span> |,=3.&lt;3P.|
3020:<span class="c22">AE BC 34 D0 02 38 60 AC</span> |.&lt;4P.8`,|
3028:<span class="c22">BD 34 8E 97 33 8C 98 33</span> |=4..3..3|
3030:<span class="c22">A9 01 20 52 30 18 60 20</span> |). R0.` |
3038:<span class="c22">45 30 AE 97 33 AC 98 33</span> |E0..3,.3|
3040:<span class="c22">A9 02 4C 52 30 AD C5 2A</span> |).LR0-E*|
3048:<span class="c22">8D F0 37 AD C6 2A 8D F1</span> |.p7-F*.q|
3050:<span class="c22">37 60 8E EC 37 8C ED 37</span> |7`.l7.m7|
3058:<span class="c22">8D F4 37 C9 02 D0 06 0D</span> |.t7I.P..|
3060:<span class="c22">D5 35 8D D5 35 AD F9 35</span> |U5.U5-y5|
3068:<span class="c22">49 FF 8D EB 37 AD F7 35</span> |I..k7-w5|
3070:<span class="c22">8D E9 37 AD F8 35 8D EA</span> |.i7-x5.j|
3078:<span class="c22">37 AD E2 35 8D F2 37 AD</span> |7-b5.r7-|
3080:<span class="c22">E3 35 8D F3 37 A9 01 8D</span> |c5.s7)..|
3088:<span class="c22">E8 37 AC C1 2A AD C2 2A</span> |h7,A*-B*|
3090:<span class="c22">20 B5 37 AD F6 37 8D BF</span> | 57-v7.?|
3098:<span class="c22">35 A9 FF 8D EB 37 B0 01</span> |5)..k70.|
30A0:<span class="c22">60 AD F5 37 A0 07 C9 20</span> |`-u7 .I |
30A8:<span class="c22">F0 08 A0 04 C9 10 F0 02</span> |p. .I.p.|
30B0:<span class="c22">A0 08 98 4C 85 33 AD E4</span> | ..L.3-d|
30B8:<span class="c22">35 CD E0 35 D0 08 AD E5</span> |5M`5P.-e|
30C0:<span class="c22">35 CD E1 35 F0 66 20 1D</span> |5Ma5pf .|
30C8:<span class="c22">2F AD E5 35 CD DD 35 90</span> |/-e5M]5.|
30D0:<span class="c22">1C D0 08 AD E4 35 CD DC</span> |.P.-d5M\|
30D8:<span class="c22">35 90 12 AD E5 35 CD DF</span> |5..-e5M_|
30E0:<span class="c22">35 90 10 D0 08 AD E4 35</span> |5..P.-d5|
30E8:<span class="c22">CD DE 35 90 06 20 5E 2F</span> |M^5.. ^/|
30F0:<span class="c22">90 D7 60 38 AD E4 35 ED</span> |.W`8-d5m|
30F8:<span class="c22">DC 35 0A 69 0C A8 20 0C</span> |\5.i.( .|
3100:<span class="c22">2F B1 42 D0 0F AD BB 35</span> |/1BP.-;5| <a class='ts' name='T2S0'>T2S0</a>
3108:<span class="c22">C9 04 F0 02 38 60 20 34</span> |I.p.8` 4|
3110:<span class="c22">31 4C 20 31 8D D6 35 C8</span> |1L 1.V5H|
3118:<span class="c22">B1 42 8D D7 35 20 DC 2F</span> |1B.W5 \/|
3120:<span class="c22">AD E4 35 8D E0 35 AD E5</span> |-d5.`5-e|
3128:<span class="c22">35 8D E1 35 20 10 2F AC</span> |5.a5 ./,|
3130:<span class="c22">E6 35 18 60 8C 9D 33 20</span> |f5.`..3 |
3138:<span class="c22">44 32 AC 9D 33 C8 91 42</span> |D2,.3H.B|
3140:<span class="c22">8D D7 35 88 AD F1 35 91</span> |.W5.-q5.|
3148:<span class="c22">42 8D D6 35 20 10 2F 20</span> |B.V5 ./ |
3150:<span class="c22">D6 37 A9 C0 0D D5 35 8D</span> |V7)@.U5.|
3158:<span class="c22">D5 35 60 AE EA 35 8E BD</span> |U5`.j5.=|
3160:<span class="c22">35 AE EB 35 8E BE 35 AE</span> |5.k5.&gt;5.|
3168:<span class="c22">EC 35 AC ED 35 8E BF 35</span> |l5,m5.?5|
3170:<span class="c22">8C C0 35 E8 D0 01 C8 CC</span> |.@5hP.HL|
3178:<span class="c22">E9 35 D0 11 EC E8 35 D0</span> |i5P.lh5P|
3180:<span class="c22">0C A2 00 A0 00 EE EA 35</span> |.". .nj5|
3188:<span class="c22">D0 03 EE EB 35 8E EC 35</span> |P.nk5.l5|
3190:<span class="c22">8C ED 35 60 EE E6 35 D0</span> |.m5`nf5P|
3198:<span class="c22">08 EE E4 35 D0 03 EE E5</span> |.nd5P.ne|
31A0:<span class="c22">35 60 AC C3 35 AE C4 35</span> |5`,C5.D5|
31A8:<span class="c22">84 42 86 43 EE C3 35 D0</span> |.B.CnC5P|
31B0:<span class="c22">03 EE C4 35 60 AC C1 35</span> |.nD5`,A5|
31B8:<span class="c22">D0 08 AE C2 35 F0 07 CE</span> |P..B5p.N|
31C0:<span class="c22">C2 35 CE C1 35 60 4C 7F</span> |B5NA5`L.|
31C8:<span class="c22">33</span> <span class="c23">20 F7 2F AD C3 35 85</span> |3 w/-C5.| FLOCSEC, T2S0 - T2S2, $31C9 .. $3396 ($B1C9 .. $B396)
31D0:<span class="c23">42 AD C4 35 85 43 A9 01</span> |B-D5.C).|
31D8:<span class="c23">8D 9D 33 A9 00 8D D8 35</span> |..3)..X5|
31E0:<span class="c23">18 EE D8 35 20 11 30 B0</span> |.nX5 .00|
31E8:<span class="c23">51 A2 00 8E 9C 33 BD C6</span> |Q"...3=F|
31F0:<span class="c23">34 F0 1F 30 22 A0 00 E8</span> |4p.0" .h|
31F8:<span class="c23">E8 E8 B1 42 DD C6 34 D0</span> |hh1B]F4P|
3200:<span class="c23">0A C8 C0 1E D0 F3 AE 9C</span> |.H@.Ps..| <a class='ts' name='T2S1'>T2S1</a>
3208:<span class="c23">33 18 60 20 30 32 90 DB</span> |3.` 02.[|
3210:<span class="c23">B0 CF AC 9D 33 D0 C1 AC</span> |0O,.3PA,|
3218:<span class="c23">9D 33 D0 EF A0 00 E8 E8</span> |.3Po .hh|
3220:<span class="c23">E8 B1 42 9D C6 34 C8 C0</span> |h1B.F4H@|
3228:<span class="c23">1E D0 F5 AE 9C 33 38 60</span> |.Pu..38`|
3230:<span class="c23">18 AD 9C 33 69 23 AA E0</span> |.-.3i#*`|
3238:<span class="c23">F5 60 A9 00 AC 9D 33 D0</span> |u`).,.3P|
3240:<span class="c23">97 4C 77 33 AD F1 35 F0</span> |.Lw3-q5p|
3248:<span class="c23">21 CE F0 35 30 17 18 A2</span> |!Np50.."|
3250:<span class="c23">04 3E F1 35 CA D0 FA 90</span> |.&gt;q5JPz.|
3258:<span class="c23">F0 EE EE 35 D0 03 EE EF</span> |pnn5P.no|
3260:<span class="c23">35 AD F0 35 60 A9 00 8D</span> |5-p5`)..|
3268:<span class="c23">F1 35 A9 00 8D 9E 33 20</span> |q5)...3 |
3270:<span class="c23">F7 2F 18 AD EB 33 6D EC</span> |w/.-k3ml|
3278:<span class="c23">33 F0 09 CD EF 33 90 14</span> |3p.Mo3..|
3280:<span class="c23">A9 FF D0 0A AD 9E 33 D0</span> |).P.-.3P|
3288:<span class="c23">37 A9 01 8D 9E 33 8D EC</span> |7)...3.l|
3290:<span class="c23">33 18 69 11 8D EB 33 8D</span> |3.i..k3.|
3298:<span class="c23">F1 35 A8 0A 0A A8 A2 04</span> |q5(..(".|
32A0:<span class="c23">18 B9 F6 33 9D F1 35 F0</span> |.9v3.q5p|
32A8:<span class="c23">06 38 A9 00 99 F6 33 88</span> |.8)..v3.|
32B0:<span class="c23">CA D0 EE 90 BD 20 FB 2F</span> |JPn.= {/|
32B8:<span class="c23">AD F0 33 8D F0 35 D0 89</span> |-p3.p5P.|
32C0:<span class="c23">4C 77 33 AD F1 35 D0 01</span> |Lw3-q5P.|
32C8:<span class="c23">60 48 20 F7 2F AC F0 35</span> |`H w/,p5|
32D0:<span class="c23">68 18 20 DD 32 A9 00 8D</span> |h. ]2)..|
32D8:<span class="c23">F1 35 4C FB 2F A2 FC 7E</span> |q5L{/"|~|
32E0:<span class="c23">F6 34 E8 D0 FA C8 CC F0</span> |v4hPzHLp|
32E8:<span class="c23">33 D0 F2 0A 0A A8 F0 0F</span> |3Pr..(p.|
32F0:<span class="c23">A2 04 BD F1 35 19 F6 33</span> |".=q5.v3|
32F8:<span class="c23">99 F6 33 88 CA D0 F3 60</span> |.v3.JPs`|
3300:<span class="c23">AD BD 35 8D E6 35 8D EA</span> |-=5.f5.j| <a class='ts' name='T2S2'>T2S2</a>
3308:<span class="c23">35 AD BE 35 8D E4 35 8D</span> |5-&gt;5.d5.|
3310:<span class="c23">EB 35 A9 00 8D E5 35 A0</span> |k5)..e5 |
3318:<span class="c23">10 AA AD E6 35 4A B0 03</span> |.*-f5J0.|
3320:<span class="c23">8A 90 0E 18 AD E5 35 6D</span> |....-e5m|
3328:<span class="c23">E8 35 8D E5 35 8A 6D E9</span> |h5.e5.mi|
3330:<span class="c23">35 6A 6E E5 35 6E E4 35</span> |5jne5nd5|
3338:<span class="c23">6E E6 35 88 D0 DB 18 AD</span> |nf5.P[.-|
3340:<span class="c23">BF 35 8D EC 35 6D E6 35</span> |?5.l5mf5|
3348:<span class="c23">8D E6 35 AD C0 35 8D ED</span> |.f5-@5.m|
3350:<span class="c23">35 6D E4 35 8D E4 35 90</span> |5md5.d5.|
3358:<span class="c23">03 EE E5 35 60 00 00 A9</span> |.ne5`..)|
3360:<span class="c23">01 D0 22 A9 02 D0 1E A9</span> |.P").P.)|
3368:<span class="c23">03 D0 1A A9 04 D0 16 A9</span> |.P.).P.)|
3370:<span class="c23">05 D0 12 A9 06 D0 0E 4C</span> |.P.).P.L|
3378:<span class="c23">ED 3F EA A9 0A D0 06 AD</span> |m?j).P.-|
3380:<span class="c23">C5 35 18 90 01 38 08 8D</span> |E5...8..|
3388:<span class="c23">C5 35 A9 00 85 48 20 7E</span> |E5)..H ~|
3390:<span class="c23">2E 28 AE 9B 33 9A 60</span> <span class="c24">00</span> |.(..3.`.| FVCBUFS, T2S2 - T2S4, $3397 .. $35FD ($B397 .. $B5FD)
3398:<span class="c24">00 00 00 00 00 00 00 00</span> |........|
33A0:<span class="c24">00 00 FF FF 01 0A 64 D4</span> |......dT|
33A8:<span class="c24">C9 C1 C2 D3 D2 C1 C2 A0</span> |IABSRAB |
33B0:<span class="c24">C5 CD D5 CC CF D6 A0 CB</span> |EMULOV K|
33B8:<span class="c24">D3 C9 C4 04 11 0F 04 00</span> |SID.....|
33C0:<span class="c24">00 FE FC FD FF FC FF FC</span> |.~|}.|.||
33C8:<span class="c24">FC FE FF FC FD FF FE FF</span> ||~.|}.~.|
33D0:<span class="c24">FD FE FF FD FD FD FF FE</span> |}~.}}}.~|
33D8:<span class="c24">FD FF FC FF FF FD FD FC</span> |}.|..}}||
33E0:<span class="c24">FE FE 7A FE FD FF FD FE</span> |~~z~}.}~|
33E8:<span class="c24">FE FF FC 11 01 00 00 23</span> |~.|....#|
33F0:<span class="c24">10 00 01 FF FC FC FD FC</span> |....||}||
33F8:<span class="c24">FE FC FC FD FD FE FC FC</span> |~||}}~|||
3400:<span class="c24">FF FC FC FD FC FD FD FC</span> |.||}|}}|| <a class='ts' name='T2S3'>T2S3</a>
3408:<span class="c24">FF FE FC FC FC FC FE FE</span> |.~||||~~|
3410:<span class="c24">FC FD FC FC FC FE FC FD</span> ||}|||~|}|
3418:<span class="c24">FC FC FE FC FC FC FE FC</span> |||~|||~||
3420:<span class="c24">FC FF FC FC FC FC FD FD</span> ||.||||}}|
3428:<span class="c24">FC FF FF FC FE FD FE FD</span> ||..|~}~}|
3430:<span class="c24">FE FC FF FC FE FF FD FC</span> |~|.|~.}||
3438:<span class="c24">FF FC FC FC FD FE FD FE</span> |.|||}~}~|
3440:<span class="c24">FC FC FC FF FE FC FC FD</span> ||||.~||}|
3448:<span class="c24">FC FD FF FC FC FC FC FE</span> ||}.||||~|
3450:<span class="c24">FD FC FD FC FC FC FD FC</span> |}|}|||}||
3458:<span class="c24">FD FF FC FE FD FC FC FD</span> |}.|~}||}|
3460:<span class="c24">FC FC FC FC FC FC FF FF</span> |||||||..|
3468:<span class="c24">FE FC FF FC FD FF FE FF</span> |~|.|}.~.|
3470:<span class="c24">FE FE FC FC FD FC FC FC</span> |~~||}||||
3478:<span class="c24">FE FE FE FD FE FD FC FE</span> |~~~}~}|~|
3480:<span class="c24">FD FD FC FC FE FE FC FC</span> |}}||~~|||
3488:<span class="c24">FD FC FC FE FC FC FD FC</span> |}||~||}||
3490:<span class="c24">FE FE FC FD FC FC FC FC</span> |~~|}|||||
3498:<span class="c24">FC FD FD FC FE FD FC FC</span> ||}}|~}|||
34A0:<span class="c24">FE FC FC FC FC FC FE FC</span> |~|||||~||
34A8:<span class="c24">FD FD FC FF FD FC FE FE</span> |}}|.}|~~|
34B0:<span class="c24">FC FD FD FE FF FD FE FF</span> ||}}~.}~.|
34B8:<span class="c24">FE FF FC 02 FC FD FC FC</span> |~.|.|}||| &larr; entire sector wasted for unreferenced 1 byte @ $(34)BB !!
34C0:<span class="c24">FC FE FE FE FD FE FF FE</span> ||~~~}~.~|
34C8:<span class="c24">FC FC FC FC FC FE FC FD</span> ||||||~|}|
34D0:<span class="c24">FC FC FF FD FC FE FC FC</span> |||.}|~|||
34D8:<span class="c24">FD FE FE FF FC FE FF FD</span> |}~~.|~.}|
34E0:<span class="c24">FF FE FC FC FE FE FD FF</span> |.~||~~}.|
34E8:<span class="c24">FE FF FF FD FC FE FF FC</span> |~..}|~.||
34F0:<span class="c24">FE FD FE FC FE FC FF FE</span> |~}~|~|.~|
34F8:<span class="c24">FE FE FC FD FD FE FF FC</span> |~~|}}~.||
3500:<span class="c24">FC FC FC FC FC FE FC FD</span> ||||||~|}| <a class='ts' name='T2S4'>T2S4</a>
3508:<span class="c24">FD FC FF FD FC FE FE FC</span> |}|.}|~~||
3510:<span class="c24">FE FD FC FF FF FC FC FE</span> |~}|..||~|
3518:<span class="c24">FE FD FE FD FE FE FC FC</span> |~}~}~~|||
3520:<span class="c24">FE FD FD FC FE FD FC FC</span> |~}}|~}|||
3528:<span class="c24">FE FC FC FE FC FC FD FC</span> |~||~||}||
3530:<span class="c24">FD FD FC FF FD FC FE FD</span> |}}|.}|~}|
3538:<span class="c24">FC FD FF FC FE FC FC FC</span> ||}.|~||||
3540:<span class="c24">FC FC FC FD FC FC FE FC</span> ||||}||~||
3548:<span class="c24">FD FC FC FF FC FC FE FD</span> |}||.||~}|
3550:<span class="c24">FC FD FF FC FF FD FE FF</span> ||}.|.}~.|
3558:<span class="c24">FD FF FE FC FD FF FF FF</span> |}.~|}...|
3560:<span class="c24">FC FC FE FC FC FF FF FC</span> |||~||..||
3568:<span class="c24">FC FD FC FE FC FC FC FC</span> ||}|~|||||
3570:<span class="c24">FC FE FC FC FD FD FC FC</span> ||~||}}|||
3578:<span class="c24">FE FC FD FC FC FE FE FC</span> |~|}||~~||
3580:<span class="c24">FC FC FC FC FF FC FC FC</span> |||||.||||
3588:<span class="c24">FC FD FD FC FF FC FC FE</span> ||}}|.||~|
3590:<span class="c24">FF FC FD FF FC FF FD FE</span> |.|}.|.}~|
3598:<span class="c24">FF FD FD FD FF FE FD FF</span> |.}}}.~}.|
35A0:<span class="c24">FC FF FD FD FD FC FE FC</span> ||.}}}|~||
35A8:<span class="c24">FC FF FE FC FC FE FC FC</span> ||.~||~|||
35B0:<span class="c24">FE FC FD FD FC FF FD FC</span> |~|}}|.}||
35B8:<span class="c24">FE FC FC FF FF FC FC FD</span> |~||..||}|
35C0:<span class="c24">FC FE FE FE FC FF FC FF</span> ||~~~|.|.|
35C8:<span class="c24">FC FF FF FE FC FE FC FD</span> ||..~|~|}|
35D0:<span class="c24">FF FF FD FD FE FC FC FC</span> |..}}~||||
35D8:<span class="c24">FC FC FE FD FD FF FE FC</span> |||~}}.~||
35E0:<span class="c24">FE FC FC FC FF FC FC FE</span> |~|||.||~|
35E8:<span class="c24">FE FC FE FC FC FC FF FC</span> |~|~|||.||
35F0:<span class="c24">FC FC FE FC FC FF FD FE</span> |||~||.}~|
35F8:<span class="c24">FC FC FD FC FC FF</span> <span class="c25">FD FC</span> |||}||.}|| BOOTLDR, $35FE .. $37FF, T0S0 - T0S1
3600:<span class="c25">01 A5 27 C9 09 D0 18 A5</span> |.%'I.P.%| <a class='ts' name='T0S0'>T0S0</a>
3608:<span class="c25">2B 4A 4A 4A 4A 09 C0 85</span> |+JJJJ.@.|
3610:<span class="c25">3F A9 5C 85 3E 18 AD FE</span> |?)\.&gt;.-~|
3618:<span class="c25">08 6D FF 08 8D FE 08 AE</span> |.m...~..|
3620:<span class="c25">FF 08 30 15 BD 4D 08 85</span> |..0.=M..|
3628:<span class="c25">3D CE FF 08 AD FE 08 85</span> |=N..-~..|
3630:<span class="c25">27 CE FE 08 A6 2B 6C 3E</span> |'N~.&amp;+l&gt;|
3638:<span class="c25">00 EE FE 08 EE FE 08 20</span> |.n~.n~. |
3640:<span class="c25">89 FE 20 93 FE 20 2F FB</span> |.~ .~ /{|
3648:<span class="c25">A6 2B 6C FD 08 00 0D 0B</span> |&amp;+l}....|
3650:<span class="c25">09 07 05 03 01 0E 0C 0A</span> |........|
3658:<span class="c25">08 06 04 02 0F 00 20 64</span> |...... d|
3660:<span class="c25">27 B0 08 A9 00 A8 8D 5D</span> |'0.).(.]|
3668:<span class="c25">36 91 40 AD C5 35 4C D2</span> |6.@-E5LR|
3670:<span class="c25">26 AD 5D 36 F0 08 EE BD</span> |&amp;-]6p.n=|
3678:<span class="c25">35 D0 03 EE BE 35 A9 00</span> |5P.n&gt;5).|
3680:<span class="c25">8D 5D 36 4C B3 36 8D BC</span> |.]6L36.&lt;|
3688:<span class="c25">35 20 A8 26 20 EA 22 4C</span> |5 (&amp; j"L|
3690:<span class="c25">7D 22 A0 13 B1 42 D0 14</span> |}" .1BP.|
3698:<span class="c25">C8 C0 17 D0 F7 A0 19 B1</span> |H@.Pw .1|
36A0:<span class="c25">42 99 A4 35 C8 C0 1D D0</span> |B.$5H@.P|
36A8:<span class="c25">F6 4C BB 26 A2 FF 8E 5D</span> |vL;&amp;"..]|
36B0:<span class="c25">36 D0 F6 AD BD 35 8D E6</span> |6Pv-=5.f|
36B8:<span class="c25">35 8D EA 35 AD BE 35 8D</span> |5.j5-&gt;5.|
36C0:<span class="c25">E7 35 8D EB 35 8D E4 35</span> |g5.k5.d5|
36C8:<span class="c25">BA 8E 9B 33 4C 7F 33 00</span> |:..3L.3.|
36D0:<span class="c25">00 00 00 00 00 00 00 00</span> |........|
36D8:<span class="c25">00 00 00 00 00 00 00 00</span> |........|
36E0:<span class="c25">00 00 00 00 00 00 00 00</span> |........|
36E8:<span class="c25">00 00 00 00 00 00 00 00</span> |........|
36F0:<span class="c25">00 00 00 00 00 00 00 00</span> |........|
36F8:<span class="c25">00 00 00 00 00 00 36 09</span> |......6.|
3700:<span class="c25">8E E9 37 8E F7 37 A9 01</span> |.i7.w7).| <a class='ts' name='T1S6'>T0S1</a>
3708:<span class="c25">8D F8 37 8D EA 37 AD E0</span> |.x7.j7-`|
3710:<span class="c25">37 8D E1 37 A9 02 8D EC</span> |7.a7)..l|
3718:<span class="c25">37 A9 04 8D ED 37 AC E7</span> |7)..m7,g|
3720:<span class="c25">37 88 8C F1 37 A9 01 8D</span> |7..q7)..|
3728:<span class="c25">F4 37 8A 4A 4A 4A 4A AA</span> |t7.JJJJ*|
3730:<span class="c25">A9 00 9D F8 04 9D 78 04</span> |)..x..x.|
3738:<span class="c25">20 93 37 A2 FF 9A 8E EB</span> | .7"...k|
3740:<span class="c25">37 4C C8 3F 20 89 FE 4C</span> |7LH? .~L|
3748:<span class="c25">03 1B AD E7 37 38 ED F1</span> |..-g78mq|
3750:<span class="c25">37 8D E1 37 AD E7 37 8D</span> |7.a7-g7.|
3758:<span class="c25">F1 37 CE F1 37 A9 02 8D</span> |q7Nq7)..|
3760:<span class="c25">EC 37 A9 04 8D ED 37 A9</span> |l7)..m7)|
3768:<span class="c25">02 8D F4 37 20 93 37 AD</span> |..t7 .7-|
3770:<span class="c25">E7 37 8D FE 36 18 69 09</span> |g7.~6.i.|
3778:<span class="c25">8D F1 37 A9 0A 8D E1 37</span> |.q7)..a7|
3780:<span class="c25">38 E9 01 8D FF 36 8D ED</span> |8i...6.m|
3788:<span class="c25">37 20 93 37 60 00 00 00</span> |7 .7`...|
3790:<span class="c25">00 00 00 AD E5 37 AC E4</span> |...-e7,d|
3798:<span class="c25">37 20 B5 37 AC ED 37 88</span> |7 57,m7.|
37A0:<span class="c25">10 07 A0 0F EA EA CE EC</span> |.. .jjNl|
37A8:<span class="c25">37 8C ED 37 CE F1 37 CE</span> |7.m7Nq7N|
37B0:<span class="c25">E1 37 D0 DF 60 08 78 20</span> |a7P_`.x |
37B8:<span class="c25">00 3D B0 03 28 18 60 28</span> |.=0.(.`(|
37C0:<span class="c25">38 60 AD BC 35 8D F1 37</span> |8`-&lt;5.q7|
37C8:<span class="c25">A9 00 8D F0 37 AD F9 35</span> |)..p7-y5|
37D0:<span class="c25">49 FF 8D EB 37 60 A9 00</span> |I..k7`).|
37D8:<span class="c25">A8 91 42 C8 D0 FB 60 00</span> |(.BHP{`.|
37E0:<span class="c25">1B 00 0A 1B E8 37 00 36</span> |....h7.6|
37E8:<span class="c25">01 60 01 00 00 00 FB 37</span> |.`....{7|
37F0:<span class="c25">00 00 00 01 00 00 00 60</span> |.......`|
37F8:<span class="c25">01 00 00 00 01 EF D8 00</span> |.....oX.|
3800:<span class="c27">A2 00 A0 02 88 B1 3E 4A</span> |". ..1&gt;J| <a class='ts' name='T0S2'>T0S2</a>, PRENIBL, $3800 .. $3829, T0S2
3808:<span class="c27">3E 00 3C 4A 3E 00 3C 99</span> |&gt;.&lt;J&gt;.&lt;.|
3810:<span class="c27">00 3B E8 E0 56 90 ED A2</span> |.;h`V.m"|
3818:<span class="c27">00 98 D0 E8 A2 55 BD 00</span> |..Ph"U=.|
3820:<span class="c27">3C 29 3F 9D 00 3C CA 10</span> |&lt;)?..&lt;J.|
3828:<span class="c27">F5 60</span> <span class="c28">38 86 27 8E 78 06</span> |u`8.'.x.| WRITRTN, $382A .. $38C1, T0S2
3830:<span class="c28">BD 8D C0 BD 8E C0 30 7C</span> |=.@=.@0||
3838:<span class="c28">AD 00 3C 85 26 A9 FF 9D</span> |-.&lt;.&amp;)..|
3840:<span class="c28">8F C0 1D 8C C0 48 68 EA</span> |.@..@Hhj|
3848:<span class="c28">A0 04 48 68 20 B9 38 88</span> | .Hh 98.|
3850:<span class="c28">D0 F8 A9 D5 20 B8 38 A9</span> |Px)U 88)|
3858:<span class="c28">AA 20 B8 38 A9 AD 20 B8</span> |* 88)- 8|
3860:<span class="c28">38 98 A0 56 D0 03 B9 00</span> |8. VP.9.|
3868:<span class="c28">3C 59 FF 3B AA BD 29 3A</span> |&lt;Y.;*=):|
3870:<span class="c28">A6 27 9D 8D C0 BD 8C C0</span> |&amp;'..@=.@|
3878:<span class="c28">88 D0 EB A5 26 EA 59 00</span> |.Pk%&amp;jY.|
3880:<span class="c28">3B AA BD 29 3A AE 78 06</span> |;*=):.x.|
3888:<span class="c28">9D 8D C0 BD 8C C0 B9 00</span> |..@=.@9.|
3890:<span class="c28">3B C8 D0 EA AA BD 29 3A</span> |;HPj*=):|
3898:<span class="c28">A6 27 20 BB 38 A9 DE 20</span> |&amp;' ;8)^ |
38A0:<span class="c28">B8 38 A9 AA 20 B8 38 A9</span> |88)* 88)|
38A8:<span class="c28">EB 20 B8 38 A9 FF 20 B8</span> |k 88). 8|
38B0:<span class="c28">38 BD 8E C0 BD 8C C0 60</span> |8=.@=.@`|
38B8:<span class="c28">18 48 68 9D 8D C0 1D 8C</span> |.Hh..@..|
38C0:<span class="c28">C0 60</span> <span class="c29">A0 00 A2 56 CA 30</span> |@` ."VJ0| POSTNRD, $38C2 .. $3943, T0S2 - T0S3
38C8:<span class="c29">FB B9 00 3B 5E 00 3C 2A</span> |{9.;^.&lt;*|
38D0:<span class="c29">5E 00 3C 2A 91 3E C8 C4</span> |^.&lt;*.&gt;HD|
38D8:<span class="c29">26 D0 EB 60 A0 20 88 F0</span> |&amp;Pk`  .p|
38E0:<span class="c29">61 BD 8C C0 10 FB 49 D5</span> |a=.@.{IU|
38E8:<span class="c29">D0 F4 EA BD 8C C0 10 FB</span> |Ptj=.@.{|
38F0:<span class="c29">C9 AA D0 F2 A0 56 BD 8C</span> |I*Pr V=.|
38F8:<span class="c29">C0 10 FB C9 AD D0 E7 A9</span> |@.{I-Pg)|
3900:<span class="c29">00 88 84 26 BC 8C C0 10</span> |...&amp;&lt;.@.| <a class='ts' name='T0S3'>T0S3</a>
3908:<span class="c29">FB 59 00 3A A4 26 99 00</span> |{Y.:$&amp;..|
3910:<span class="c29">3C D0 EE 84 26 BC 8C C0</span> |&lt;Pn.&amp;&lt;.@|
3918:<span class="c29">10 FB 59 00 3A A4 26 99</span> |.{Y.:$&amp;.|
3920:<span class="c29">00 3B C8 D0 EE BC 8C C0</span> |.;HPn&lt;.@|
3928:<span class="c29">10 FB D9 00 3A D0 13 BD</span> |.{Y.:P.=|
3930:<span class="c29">8C C0 10 FB C9 DE D0 0A</span> |.@.{I^P.|
3938:<span class="c29">EA BD 8C C0 10 FB C9 AA</span> |j=.@.{I*|
3940:<span class="c29">F0 5C 38 60</span> <span class="c30">A0 FC 84 26</span> |p\8` |.&amp;| RDADSEK, $3944 .. $39FC, T0S3
3948:<span class="c30">C8 D0 04 E6 26 F0 F3 BD</span> |HP.f&amp;ps=|
3950:<span class="c30">8C C0 10 FB C9 D5 D0 F0</span> |.@.{IUPp|
3958:<span class="c30">EA BD 8C C0 10 FB C9 AA</span> |j=.@.{I*|
3960:<span class="c30">D0 F2 A0 03 BD 8C C0 10</span> |Pr .=.@.|
3968:<span class="c30">FB C9 96 D0 E7 A9 00 85</span> |{I.Pg)..|
3970:<span class="c30">27 BD 8C C0 10 FB 2A 85</span> |'=.@.{*.|
3978:<span class="c30">26 BD 8C C0 10 FB 25 26</span> |&amp;=.@.{%&amp;|
3980:<span class="c30">99 2C 00 45 27 88 10 E7</span> |.,.E'..g|
3988:<span class="c30">A8 D0 B7 BD 8C C0 10 FB</span> |(P7=.@.{|
3990:<span class="c30">C9 DE D0 AE EA BD 8C C0</span> |I^P.j=.@|
3998:<span class="c30">10 FB C9 AA D0 A4 18 60</span> |.{I*P$.`|
39A0:<span class="c30">86 2B 85 2A CD 78 04 F0</span> |.+.*Mx.p|
39A8:<span class="c30">53 A9 00 85 26 AD 78 04</span> |S)..&amp;-x.|
39B0:<span class="c30">85 27 38 E5 2A F0 33 B0</span> |.'8e*p30|
39B8:<span class="c30">07 49 FF EE 78 04 90 05</span> |.I.nx...|
39C0:<span class="c30">69 FE CE 78 04 C5 26 90</span> |i~Nx.E&amp;.|
39C8:<span class="c30">02 A5 26 C9 0C B0 01 A8</span> |.%&amp;I.0.(|
39D0:<span class="c30">38 20 EE 39 B9 11 3A 20</span> |8 n99.: |
39D8:<span class="c30">00 3A A5 27 18 20 F1 39</span> |.:%'. q9|
39E0:<span class="c30">B9 1D 3A 20 00 3A E6 26</span> |9.: .:f&amp;|
39E8:<span class="c30">D0 C3 20 00 3A 18 AD 78</span> |PC .:.-x|
39F0:<span class="c30">04 29 03 2A 05 2B AA BD</span> |.).*.+*=|
39F8:<span class="c30">80 C0 A6 2B 60</span> <span class="c31">00 00 00</span> |.@&amp;+`...| MSWAITR, $39FD .. $3C55, T0S3 - T0S6
3A00:<span class="c31">A2 11 CA D0 FD E6 46 D0</span> |".JP}fFP| <a class='ts' name='T0S4'>T0S4</a>
3A08:<span class="c31">02 E6 47 38 E9 01 D0 F0</span> |.fG8i.Pp|
3A10:<span class="c31">60 01 30 28 24 20 1E 1D</span> |`.0($ ..|
3A18:<span class="c31">1C 1C 1C 1C 1C 70 2C 26</span> |.....p,&amp;|
3A20:<span class="c31">22 1F 1E 1D 1C 1C 1C 1C</span> |".......|
3A28:<span class="c31">1C 96 97 9A 9B 9D 9E 9F</span> |........|
3A30:<span class="c31">A6 A7 AB AC AD AE AF B2</span> |&amp;'+,-./2|
3A38:<span class="c31">B3 B4 B5 B6 B7 B9 BA BB</span> |345679:;|
3A40:<span class="c31">BC BD BE BF CB CD CE CF</span> |&lt;=&gt;?KMNO|
3A48:<span class="c31">D3 D6 D7 D9 DA DB DC DD</span> |SVWYZ[\]|
3A50:<span class="c31">DE DF E5 E6 E7 E9 EA EB</span> |^_efgijk|
3A58:<span class="c31">EC ED EE EF F2 F3 F4 F5</span> |lmnorstu|
3A60:<span class="c31">F6 F7 F9 FA FB FC FD FE</span> |vwyz{|}~|
3A68:<span class="c31">FF AE 5F 2A E0 1C F0 05</span> |.._*`.p.|
3A70:<span class="c31">A2 00 8E 5D 36 60 A9 FF</span> |"..]6`).|
3A78:<span class="c31">8D FB 04 8D 0C C0 8D 0E</span> |.{...@..|
3A80:<span class="c31">C0 4C 2F FB 00 00 00 00</span> |@L/{....|
3A88:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3A90:<span class="c31">00 00 00 00 00 00 00 01</span> |........|
3A98:<span class="c31">98 99 02 03 9C 04 05 06</span> |........|
3AA0:<span class="c31">A0 A1 A2 A3 A4 A5 07 08</span> | !"#$%..|
3AA8:<span class="c31">A8 A9 AA 09 0A 0B 0C 0D</span> |()*.....|
3AB0:<span class="c31">B0 B1 0E 0F 10 11 12 13</span> |01......|
3AB8:<span class="c31">B8 14 15 16 17 18 19 1A</span> |8.......|
3AC0:<span class="c31">C0 C1 C2 C3 C4 C5 C6 C7</span> |@ABCDEFG|
3AC8:<span class="c31">C8 C9 CA 1B CC 1C 1D 1E</span> |HIJ.L...|
3AD0:<span class="c31">D0 D1 D2 1F D4 D5 20 21</span> |PQR.TU !|
3AD8:<span class="c31">D8 22 23 24 25 26 27 28</span> |X"#$%&amp;'(|
3AE0:<span class="c31">E0 E1 E2 E3 E4 29 2A 2B</span> |`abcd)*+|
3AE8:<span class="c31">E8 2C 2D 2E 2F 30 31 32</span> |h,-./012|
3AF0:<span class="c31">F0 F1 33 34 35 36 37 38</span> |pq345678|
3AF8:<span class="c31">F8 39 3A 3B 3C 3D 3E 3F</span> |x9:;&lt;=&gt;?|
3B00:<span class="c31">00 00 00 00 00 00 00 00</span> |........| <a class='ts' name='T0S5'>T0S5</a>
3B08:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B10:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B18:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B20:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B28:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B30:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B38:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B40:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B48:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B50:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B58:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B60:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B68:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B70:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B78:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B80:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B88:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B90:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3B98:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BA0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BA8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BB0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BB8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BC0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BC8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BD0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BD8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BE0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BE8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BF0:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3BF8:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C00:<span class="c31">00 00 00 00 00 00 00 00</span> |........| <a class='ts' name='T0S6'>T0S6</a>
3C08:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C10:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C18:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C20:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C28:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C30:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C38:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C40:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C48:<span class="c31">00 00 00 00 00 00 00 00</span> |........|
3C50:<span class="c31">00 00 00 00 00 00</span> <span class="c40">38 BD</span> |......8=| WRITADR, $3C56 .. $3CFF, T0S6
3C58:<span class="c40">8D C0 BD 8E C0 30 5E A9</span> |.@=.@0^)|
3C60:<span class="c40">FF 9D 8F C0 DD 8C C0 48</span> |...@].@H|
3C68:<span class="c40">68 20 C3 3C 20 C3 3C 9D</span> |h C&lt; C&lt;.|
3C70:<span class="c40">8D C0 DD 8C C0 EA 88 D0</span> |.@].@j.P|
3C78:<span class="c40">F0 A9 D5 20 D5 3C A9 AA</span> |p)U U&lt;)*|
3C80:<span class="c40">20 D5 3C A9 96 20 D5 3C</span> | U&lt;). U&lt;|
3C88:<span class="c40">A5 41 20 C4 3C A5 44 20</span> |%A D&lt;%D |
3C90:<span class="c40">C4 3C A5 3F 20 C4 3C A5</span> |D&lt;%? D&lt;%|
3C98:<span class="c40">41 45 44 45 3F 48 4A 05</span> |AEDE?HJ.|
3CA0:<span class="c40">3E 9D 8D C0 BD 8C C0 68</span> |&gt;..@=.@h|
3CA8:<span class="c40">09 AA 20 D4 3C A9 DE 20</span> |.* T&lt;)^ |
3CB0:<span class="c40">D5 3C A9 AA 20 D5 3C A9</span> |U&lt;)* U&lt;)|
3CB8:<span class="c40">EB 20 D5 3C 18 BD 8E C0</span> |k U&lt;.=.@|
3CC0:<span class="c40">BD 8C C0 60 48 4A 05 3E</span> |=.@`HJ.&gt;|
3CC8:<span class="c40">9D 8D C0 DD 8C C0 68 EA</span> |..@].@hj|
3CD0:<span class="c40">EA EA 09 AA EA EA 48 68</span> |jj.*jjHh|
3CD8:<span class="c40">9D 8D C0 DD 8C C0 60 00</span> |..@].@`.|
3CE0:<span class="c40">00 00 00 00 00 00 00 00</span> |........|
3CE8:<span class="c40">00 00 00 00 00 00 00 00</span> |........|
3CF0:<span class="c40">00 00 00 00 00 00 00 00</span> |........|
3CF8:<span class="c40">00 00 00 00 00 00 00 00</span> |........|
3D00:<span class="c41">84 48 85 49 A0 02 8C F8</span> |.H.I ..x| <a class='ts' name='T0S7'>T0S7</a>, RWTSONE, $3D00 .. $3DAA, T0S7
3D08:<span class="c41">06 A0 04 8C F8 04 A0 01</span> |. ..x. .|
3D10:<span class="c41">B1 48 AA A0 0F D1 48 F0</span> |1H* .QHp|
3D18:<span class="c41">1B 8A 48 B1 48 AA 68 48</span> |..H1H*hH|
3D20:<span class="c41">91 48 BD 8E C0 A0 08 BD</span> |.H=.@ .=|
3D28:<span class="c41">8C C0 DD 8C C0 D0 F6 88</span> |.@].@Pv.|
3D30:<span class="c41">D0 F8 68 AA BD 8E C0 BD</span> |Pxh*=.@=|
3D38:<span class="c41">8C C0 A0 08 BD 8C C0 48</span> |.@ .=.@H|
3D40:<span class="c41">68 48 68 8E F8 05 DD 8C</span> |hHh.x.].|
3D48:<span class="c41">C0 D0 03 88 D0 EE 08 BD</span> |@P..Pn.=|
3D50:<span class="c41">89 C0 A0 06 B1 48 99 36</span> |.@ .1H.6|
3D58:<span class="c41">00 C8 C0 0A D0 F6 A0 03</span> |.H@.Pv .|
3D60:<span class="c41">B1 3C 85 47 A0 02 B1 48</span> |1&lt;.G .1H|
3D68:<span class="c41">A0 10 D1 48 F0 06 91 48</span> | .QHp..H|
3D70:<span class="c41">28 A0 00 08 6A 90 05 BD</span> |( ..j..=|
3D78:<span class="c41">8A C0 B0 03 BD 8B C0 66</span> |.@0.=.@f|
3D80:<span class="c41">35 28 08 D0 0B A0 07 20</span> |5(.P. . |
3D88:<span class="c41">00 3A 88 D0 FA AE F8 05</span> |.:.Pz.x.|
3D90:<span class="c41">A0 04 B1 48 20 5A 3E 28</span> | .1H Z&gt;(|
3D98:<span class="c41">D0 11 A4 47 10 0D A0 12</span> |P.$G.. .|
3DA0:<span class="c41">88 D0 FD E6 46 D0 F7 E6</span> |.P}fFPwf|
3DA8:<span class="c41">47 D0 F3</span> <span class="c42">A0 0C B1 48 F0</span> |GPs .1Hp| RWTSTWO, T0S7 - T0S8, $3DAB .. $3EAE ($BDAB .. $BEAE)
3DB0:<span class="c42">5A C9 04 F0 58 6A 08 B0</span> |ZI.pXj.0|
3DB8:<span class="c42">03 20 00 38 A0 30 8C 78</span> |. .8 0.x|
3DC0:<span class="c42">05 AE F8 05 20 44 39 90</span> |..x. D9.|
3DC8:<span class="c42">24 CE 78 05 10 F3 AD 78</span> |$Nx..s-x|
3DD0:<span class="c42">04 48 A9 60 20 95 3E CE</span> |.H)` .&gt;N|
3DD8:<span class="c42">F8 06 F0 28 A9 04 8D F8</span> |x.p()..x|
3DE0:<span class="c42">04 A9 00 20 5A 3E 68 20</span> |.). Z&gt;h |
3DE8:<span class="c42">5A 3E 4C BC 3D A4 2E CC</span> |Z&gt;L&lt;=$.L|
3DF0:<span class="c42">78 04 F0 1C AD 78 04 48</span> |x.p.-x.H|
3DF8:<span class="c42">98 20 95 3E 68 CE F8 04</span> |. .&gt;hNx.|
3E00:<span class="c42">D0 E5 F0 CA 68 A9 40 28</span> |PepJh)@(| <a class='ts' name='T0S8'>T0S8</a>
3E08:<span class="c42">4C 48 3E F0 39 4C AF 3E</span> |LH&gt;p9L/&gt;|
3E10:<span class="c42">A0 03 B1 48 48 A5 2F A0</span> | .1HH%/ |
3E18:<span class="c42">0E 91 48 68 F0 08 C5 2F</span> |..Hhp.E/|
3E20:<span class="c42">F0 04 A9 20 D0 E1 A0 05</span> |p.) Pa .|
3E28:<span class="c42">B1 48 A8 B9 B8 3F C5 2D</span> |1H(98?E-|
3E30:<span class="c42">D0 97 28 90 1C 20 DC 38</span> |P.(.. \8|
3E38:<span class="c42">08 B0 8E 28 A2 00 86 26</span> |.0.("..&amp;|
3E40:<span class="c42">20 C2 38 AE F8 05 18 24</span> | B8.x..$|
3E48:<span class="c42">38 A0 0D 91 48 BD 88 C0</span> |8 ..H=.@|
3E50:<span class="c42">60 20 2A 38 90 F0 A9 10</span> |` *8.p).|
3E58:<span class="c42">B0 EE 48 A0 01 B1 3C 6A</span> |0nH .1&lt;j|
3E60:<span class="c42">68 90 08 0A 20 6B 3E 4E</span> |h... k&gt;N|
3E68:<span class="c42">78 04 60 85 2A 20 8E 3E</span> |x.`.* .&gt;|
3E70:<span class="c42">B9 78 04 24 35 30 03 B9</span> |9x.$50.9|
3E78:<span class="c42">F8 04 8D 78 04 A5 2A 24</span> |x..x.%*$|
3E80:<span class="c42">35 30 05 99 F8 04 10 03</span> |50..x...|
3E88:<span class="c42">99 78 04 4C A0 39 8A 4A</span> |.x.L 9.J|
3E90:<span class="c42">4A 4A 4A A8 60 48 A0 02</span> |JJJ(`H .|
3E98:<span class="c42">B1 48 6A 66 35 20 8E 3E</span> |1Hjf5 .&gt;|
3EA0:<span class="c42">68 0A 24 35 30 05 99 F8</span> |h.$50..x|
3EA8:<span class="c42">04 10 03 99 78 04 60</span> <span class="c43">A0</span> |....x.` | FORMATR, T0S8 - T0S9, $3EAF .. $3FC7 ($BEAF .. $BFC7)
3EB0:<span class="c43">03 B1 48 85 41 A9 AA 85</span> |.1H.A)*.|
3EB8:<span class="c43">3E A0 56 A9 00 85 44 99</span> |&gt; V)..D.|
3EC0:<span class="c43">FF 3B 88 D0 FA 99 00 3B</span> |.;.Pz..;|
3EC8:<span class="c43">88 D0 FA A9 50 20 95 3E</span> |.Pz)P .&gt;|
3ED0:<span class="c43">A9 28 85 45 A5 44 20 5A</span> |)(.E%D Z|
3ED8:<span class="c43">3E 20 0D 3F A9 08 B0 24</span> |&gt; .?).0$|
3EE0:<span class="c43">A9 30 8D 78 05 38 CE 78</span> |)0.x.8Nx|
3EE8:<span class="c43">05 F0 19 20 44 39 B0 F5</span> |.p. D90u|
3EF0:<span class="c43">A5 2D D0 F1 20 DC 38 B0</span> |%-Pq \80|
3EF8:<span class="c43">EC E6 44 A5 44 C9 23 90</span> |lfD%DI#.|
3F00:<span class="c43">D3 18 90 05 A0 0D 91 48</span> |S... ..H| <a class='ts' name='T0S9'>T0S9</a>
3F08:<span class="c43">38 BD 88 C0 60 A9 00 85</span> |8=.@`)..|
3F10:<span class="c43">3F A0 80 D0 02 A4 45 20</span> |? .P.$E |
3F18:<span class="c43">56 3C B0 6B 20 2A 38 B0</span> |V&lt;0k *80|
3F20:<span class="c43">66 E6 3F A5 3F C9 10 90</span> |ff?%?I..|
3F28:<span class="c43">EC A0 0F 84 3F A9 30 8D</span> |l ..?)0.|
3F30:<span class="c43">78 05 99 A8 3F 88 10 FA</span> |x..(?..z|
3F38:<span class="c43">A4 45 20 87 3F 20 87 3F</span> |$E .? .?|
3F40:<span class="c43">20 87 3F 48 68 EA 88 D0</span> | .?Hhj.P|
3F48:<span class="c43">F1 20 44 39 B0 23 A5 2D</span> |q D90#%-|
3F50:<span class="c43">F0 15 A9 10 C5 45 A5 45</span> |p.).EE%E|
3F58:<span class="c43">E9 01 85 45 C9 05 B0 11</span> |i..EI.0.|
3F60:<span class="c43">38 60 20 44 39 B0 05 20</span> |8` D90. |
3F68:<span class="c43">DC 38 90 1C CE 78 05 D0</span> |\8..Nx.P|
3F70:<span class="c43">F1 20 44 39 B0 0B A5 2D</span> |q D90.%-|
3F78:<span class="c43">C9 0F D0 05 20 DC 38 90</span> |I.P. \8.|
3F80:<span class="c43">8C CE 78 05 D0 EB 38 60</span> |.Nx.Pk8`|
3F88:<span class="c43">A4 2D B9 A8 3F 30 DD A9</span> |$-9(?0])|
3F90:<span class="c43">FF 99 A8 3F C6 3F 10 CA</span> |..(?F?.J|
3F98:<span class="c43">A5 44 D0 0A A5 45 C9 10</span> |%DP.%EI.|
3FA0:<span class="c43">90 E5 C6 45 C6 45 18 60</span> |.eFEFE.`|
3FA8:<span class="c43">00 00 00 00 00 00 00 00</span> |........|
3FB0:<span class="c43">00 00 00 00 00 00 00 00</span> |........|
3FB8:<span class="c43">00 0D 0B 09 07 05 03 01</span> |........|
3FC0:<span class="c43">0E 0C 0A 08 06 04 02 0F</span> |........|
3FC8:<span class="c44">20 93 FE AD 81 C0 AD 81</span> | .~-.@-.| DOSPTCH, T0S9, $3FC8 .. $3FFF ($BFC8 .. $BFFF)
3FD0:<span class="c44">C0 A9 00 8D 00 E0 20 76</span> |@)...` v|
3FD8:<span class="c44">3A 4C 44 37 8D 63 2A 8D</span> |:LD7.c*.|
3FE0:<span class="c44">70 2A 8D 71 2A 60 20 5B</span> |p*.q*` [|
3FE8:<span class="c44">27 8C B7 2A 60 20 7E 2E</span> |'.7*` ~.|
3FF0:<span class="c44">AE 9B 33 9A 20 16 23 BA</span> |..3. .#:|
3FF8:<span class="c44">8E 9B 33 A9 09 4C 85 33</span> |..3).L.3|
</pre>

<a class='section' name='Waste'></a>
<h1><a class='section' name='Inefficiencies'>3.0 Inefficiencies</a></h1>
<p>
There are several locations where memory and disk space are wasted.
<p>

<h2><a class='section' name='WastedMemory'>3.1 Wasted Memory</a></h2>
<p>
I've annotated <a class='mem'>*wastes*</a> locations in the listing where memory is wasted.
<p>
<div style="padding-left:5%">
    <font style="font-family: monospace;">
        <table class="borders">
            <tr><th>T/S </th><th>Range         </th><th>File                                       </th> <th>Func/Var                                </th>  <th>Line                                       </th> <th align="right">Bytes</th><th>Description                                                            </th></tr>
            <tr><td>T0S0</td><td>$36B3..$36FD  </td><td><a class="file" href="#BOOTLDR">BOOTLDR</a></td> <td>n/a                                     </td>  <td></td> <td align="right">   75</td><td><a class="d" href="#"           >     </a>  Padding for boot sector    </td></tr>
            <tr><td>T0S1</td><td>$37FF         </td><td><a class="file" href="#BOOTLDR">BOOTLDR</a></td> <td>n/a                                     </td>  <td></td> <td align="right">    1</td><td><a class="d" href="#"           >     </a>  Unused slack at end        </td></tr>
            <tr><td>T0S3</td><td>$FD..$FF      </td><td><a class="file" href="#MSWAITR">MSWAITR</a></td> <td>n/a                                     </td>  <td></td> <td align="right">    3</td><td>Line #<a class='line' href='#MSWAITR.030'>30</a> page align <a class="x" href="#MSWAIT" >MSWAIT </a></td></tr>
            <tr><td>T0S6</td><td>$00..$55      </td><td><a class="file" href="#MSWAITR">MSWAITR</a></td> <td><a class="v" href="#NBUF2"  >NBUF2  </a></td>  <td></td> <td align="right">   86</td><td>While we need <i>run-time</i> memory for NBUF2 there is need to waste <i>disk</i> space.<br>Data should always be AFTER code</td></tr>
            <tr><td>T0S9</td><td>$<a class='n' href='#_3FDA'>3FDA</a> .. $3FDB</td><td><a class="file" href="#DOSPTCH">DOSPTCH</a></td> <td><a class="x" href="#RCPATCH">RCPATCH</a></td>  <td><a class='line' href='#DOSPTCH.028'>028</a></td> <td align="right">    2</td><td>JMP <a class="x" href="#RCBACK">RCBACK</a> instead of RTS</td></tr>
            <tr><td>T0SA</td><td>$<a class='n' href='#_1B49'>1B49</a> .. $1B49</td><td><a class="file" href="#RELOCTR">RELOCTR</a></td> <td><a class="x" href="#DR2A"   >DR2A   </a></td>  <td><a class='line' href='#RELOCTR.153'>153</a></td> <td align="right">    1</td><td><a class="v"    href="#ZPGFCB">ZPGFCB</a> can never point to page 0. We can switch the order:
<br>From:
<br>&nbsp; &nbsp; &nbsp; LDY ZPGFCB+1
<br>&nbsp; &nbsp; &nbsp; PLA
<br>&nbsp; &nbsp; &nbsp; JMP DR2C
<br>To:
<br>&nbsp; &nbsp; &nbsp; PLA
<br>&nbsp; &nbsp; &nbsp; LDY ZPGFCB+1
<br>&nbsp; &nbsp; &nbsp; BNE DR2C
</td></tr>
            <tr><td>T0SB</td><td>$<a class='n' href='#_1B7D'>1B7D</a> .. $1B7D</td><td><a class="file" href="#RELOCTR">RELOCTR</a></td> <td><a class="x" href='#DR3'   >DR3   </a> </td> <td><a class='line' href='#RELOCTR.181'>181</a></td> <td align='right'>    1</td><td>Useless TAY when LDY would suffice
<br>From:
<br>&nbsp; &nbsp; &nbsp; LDA ADRTAB+1,X
<br>&nbsp; &nbsp; &nbsp; TAY
<br>To:
<br>&nbsp; &nbsp; &nbsp; LDY ADRTAB+1,X
</td></tr>
            <tr><td>T0SB</td><td>$<a class="n" href='#_1B83'>1B83</a> .. $1B83</td><td><a class="file" href="#RELOCTR">RELOCTR</a></td> <td><a class="x" href='#DR3'   >DR3   </a> </td> <td><a class='line' href='#RELOCTR.184'>184</a></td> <td align='right'>    1</td><td>Start Address (+2) in ADRTAB is never on page 0;
<br>Change (absolute) JMP to (relative) BNE:
<br>From:
<br>&nbsp; &nbsp; &nbsp; LDA ADRTAB+2,X
<br>&nbsp; &nbsp; &nbsp; STA ZPGWRK+1
<br>&nbsp; &nbsp; &nbsp; JMP DR5
<br>To:
<br>&nbsp; &nbsp; &nbsp; LDA ADRTAB+2,X
<br>&nbsp; &nbsp; &nbsp; STA ZPGWRK+1
<br>&nbsp; &nbsp; &nbsp; BNE DR5
</td></tr>
            <tr><td>T0SB</td><td>$<a class='n' href='#_1C12'>1C12</a> .. $1C12</td><td><a class='file' href='#RELOCTR'>RELOCTR</a></td> <td><a class='x' href='#DR9'   >DR9   </a> </td> <td><a class='line' href='#RELOCTR.273'>273</a></td> <td align='right'>    1</td><td>Useless TAY when LDY and STY would suffice
<br>From:
<br>&nbsp; &nbsp; &nbsp; LDA #0
<br>&nbsp; &nbsp; &nbsp; STA ZPGWRK
<br>&nbsp; &nbsp; &nbsp; STA ZPGFCB
<br>&nbsp; &nbsp; &nbsp; TAY
<br>To:
<br>&nbsp; &nbsp; &nbsp; LDY #0
<br>&nbsp; &nbsp; &nbsp; STY ZPGWRK
<br>&nbsp; &nbsp; &nbsp; STY ZPGFCB
</td</tr>
            <tr><td>T0SB</td><td>$<a class='n' href='#_1C4D'>1C4D</a> .. $1C58</td><td><a class="file" href="#RELOCTR">RELOCTR</a></td> <td><a class='v' href='#ADRTAB'>ADRTAB</a> </td> <td><a class='line' href='#RELOCTR.306'>306</a></td> <td align="right">   11</td><td>Unreferenced data after <a class='v' href='#ADRTAB'>ADRTAB</a> </td></tr>
            <tr><td>T0SB</td><td>$<a class='n' href='#_1C81'>1C81</a> .. $1CFF</td><td><a class="file" href="#DOSINIT">DOSINIT</a></td> <td><a class='v' href='#START' >START </a> </td> <td><a class='line' href='#DOSINIT.003'>003</a></td> <td align="right">  127</td><td>Padding so <a class='v' href='#START'>START</a> is aligned on a new memory page
<br>Technically, only 82 bytes.  See note at address.</td></tr>
            <tr><td>T0SC</td><td>$<a class='n' href='#_1D78'>1D78</a> .. $1D83</td><td><a class="file" href="#DOSINIT">DOSINIT</a></td> <td><a class="v" href="#AS2VT" >AS2VT </a> </td> <td><a class='line' href='#DOSINIT.103'>103</a></td> <td align="right">   10</td><td>Dead data: <a class='v' href="#_1D78" >Applesoft in RAM vector table </a></td></tr>
            <tr><td>T2S2</td><td>$<a class='n' href='#_33BB'>33BB</a> .. $33BB</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>                                       </td> <td><a class="line" href="#FVCBUFS.023">023</a></td> <td align="right">    1</td><td>Unused <a class="v" href="#_33BB">sector type 4</a> = VTOC</a></td></tr>
            <tr><td>T2S2</td><td>$33A0 .. $33A3</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td><a class="v" href="#_33A0" >ALC10S</a> </td> <td></td> <td align="right">    4</td><td>32 sectors/track allocation bitmap mask                       </td></tr>
            <tr><td>T2S2</td><td>$33BF .. $33BF</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>n/a                                    </td> <td></td> <td align="right">    1</td><td>VTOC <a class="v" href="#_33BF" >spare</a> shenanigans        </td></tr>
            <tr><td>T2S2</td><td>$33C0 .. $33C0</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>n/a                                    </td> <td></td> <td align="right">    1</td><td>VTOC <a class="v" href="#_33C0" >spare</a> shenanigans        </td></tr>
            <tr><td>T2S2</td><td>$33C2 .. $33E1</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>n/a                                    </td> <td></td> <td align="right">   32</td><td>VTOC <a class="v" href="#_33C2" >spare</a> shenanigans        </td></tr>
            <tr><td>T2S2</td><td>$33E3 .. $33EA</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>n/a                                    </td> <td></td> <td align="right">    8</td><td>VTOC <a class="v" href="#_33E3" >spare</a> shenanigans        </td></tr>
            <tr><td>T2S2</td><td>$33ED .. $33ED</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td><a class="v" href="#VALCA3">VALCA3</a> </td> <td></td> <td align="right">    1</td><td>VTOC <a class="v" href="#_#3ED">Track Allocation</a> byte 3   </td></tr>
            <tr><td>T2S2</td><td>$33EE .. $33EE</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td><a class="v" href="#VALCA4">VALCA4</a> </td> <td></td> <td align="right">    1</td><td>VTOC <a class="v" href="#_#3ED">Track Allocation</a> byte 4   </td></tr>
            <tr><td>T2S2</td><td>$33F3 .. $    </td><td><a class="file" href="#"       >       </a></td> <td>                                       </td> <td></td> <td align="right">    ?</td><td>                                                              </td></tr>
            <tr><td>T2S2</td><td>$3497 .. $34BA</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td>n/a                                    </td> <td></td> <td align="right">   40</td><td>VTOC <a class="v" href="#_3497">tracks 41 - 50</a> sector bitmaps</td></tr>
            <tr><td>T2S2</td><td>$34BB .. $34BB</td><td><a class="file" href="#FVCBUFS">FVCBUFS</a></td> <td><a class="v" href="#VDTCDE">VDTCDE</a> </td> <td></td> <td align="right">    1</td><td>CAT Unused <a class="v" href="#_34BB">sector type 2</a> = CATALOG</a></td></tr>
            <tr><td>T0SC       </td><td>DOSINIT</td><td>Wastes  12 bytes for <a   class='dumb' href='#_1D56'>Applesoft/Integer Func Pointers</a> -- <a class='v' href='#IBASVT'>IBASVT</a></td></tr>
            <tr class="macro"><td>Total</td><td>---           </td><td>---                               <td>---                                    </td> <td></td> <td align="right">  160</td><td> </td></tr>
        </table>
    </font>
</div>
<p>

<h2><a class='section' name='WastedDisk'>3.2 Wasted Disk Space</a></h2>
<p>
There are <i>two</i> types of <b>data</b> that reside in both memory and on disk:
<p>
<ul>
<li>initialized, and</li>
<li>uninitialized.</li>
</ul>
<p>
There is no need store the <i>uninitialized</i> ones on disk IF they are placed after code.
 (<b>Note</b>: This may cause slightly more code, say copying a block of data that has both initialized and uninitialized parts,
 since the initialized and uninitialized data will no longer be <i>contiguous</i>.
 Usually uninitialized data are "large", say &gt; 16 bytes, such as an array or buffer.)
 Even the EDASM manual states on Page 45 (my emphasis added):
<div class='indent5'>
<pre>
This means that if you accidently enter a DS with an expression that
comes up with a value of, say 48K bytes, you will suddenly get a very
large output file. The expression is most often used as a relatively
small constant, for small data areas, since <span class="todo">large buffers and work</span>
<span class="todo">areas should <b>not</b> be part of an object</span> program, (<i>unless of course you
have disk space burning a hole in your diskette).</i>
</pre>
</div>
Apparently the authors of DOS 3.3 never got the memo -- see the section <a class='link' href="#WastedSectors">Wasted Sectors</a> below.
<p>
For example, <b>DOS does dumb shit like this</b>: Interleaving code and data bloating the program stored on disk.
<p><b>Example 1:</b>
<div class='indent5'>
<pre>
            ORG $2000
WRK         EQU $40
COUT        EQU $FDED
PRNTYX      EQU $F940

; --- begin code ---
MAIN        EQU *           ;=12 $2000
            JSR FUNC1       ;  +3
            JSR FUNC2       ;  +3
            LDY #&gt;END       ;  +2 hi byte of addr
            LDX #&lt;END       ;  +2 lo byte of addr
            JMP PRNTYX      ;  +2

; Pade to end of page to page align BUF1
; $200D .. $20FF = wasted bytes when clearly have room for FUNC1 and FUNC2
HEREL       EQU &lt;*          ; lo byte ca65, merlin; EDASM &gt;*
REMDR       EQU 256-HEREL   ; pad to end of page
            ORG *+REMDR
                            ;   $2100
BUF1        DS  256,0       ;+256 initialized

FNAME       EQU *           ;   $2200
FNAME1      ASC "HELLO_________________________" ; +30 filename
FNAME1LEN   EQU *-FNAME

FUNC1       EQU *           ;=14 $221E
            LDX #0          ;  +2
PUTCHAR
            LDA FNAME,X     ;  +3
            JSR COUT        ;  +3
            INX             ;  +1
            CPX #FNAME1LEN  ;  +2
            BNE PUTCHAR     ;  +2
            RTS             ;  +1

FCB         EQU *           ;=4  $222C
FCB_SLOT    DS 1            ;  +1
FCB_DRIVE   DS 1            ;  +1
FCB_TRACK   DS 1            ;  +1
FCB_SECTOR  DS 1            ;  +1
FCB_LEN     EQU *-FCB       ;

FUNC2       EQU *           ;=7  $2230
            LDA #6          ;  +2
            STA FCB_SLOT    ;  +3
            RTS             ;  +1

VTOC        EQU *           ;    $2236 uninitialized
            ORG VTOC+256    ;+256

END         EQU *           ;=822 $2336 bytes on disk
</pre>
</div>
<p>
Which takes up a whopping total of 822 bytes ($336) in memory or (822 + 255)/256) = <b>4 sectors</b> on disk!
<p>
Instead if we grouped all the code first, followed by all initialized data, and then all uninitialized data at the end "pre-allocating" them we will use significantly less disk space.
<p>
The only thing left to do is to add short "<i>zero uninitialized data</i>" stub at the beginning of our programs.
<p>
<b>Example 2:</b>
<div class='indent5'>
<pre>
            ORG $2000
WRK         EQU $40
COUT        EQU $FDED
PRNTYX      EQU $F940

; --- begin zero uninitialized data (similiar to init bss) ---
; Zero memory from DATA_START .. DATA_END
; in 2 stages:
;
;     DATA_START       .. page of DATA_END
;     page of DATA_END .. DATA_END
;
; +---------------+-------------+
; | 00 ..      00 | 00 ..    00 |
; +---------------+-------------|
; ^               ^             ^
; DATA_START      DataEndPage   DATA_END
; $2100           $2400         $2403
;
INIT                            ;=33 $2000
            LDY #&lt;DATA_START    ; +2 lo byte of addr: ca65, merlin; EDASM #&gt;
            LDX #&gt;DATA_START    ; +2 hi byte of addr: ca65, merlin; EDASM #&lt;
            STY WRK+0           ; +2
            STX WRK+1           ; +2
            LDA #0              ; +2
CHECK_PAGE
            LDX WRK+1           ; +2
            CPX #&gt;DATA_END      ; +2 hi byte of addr
            BCS CHECK_PART      ; +2 src &gt;= end ?
CLEAR_PAGE
            STA (WRK),Y         ; +2
            INY                 ; +1
            BNE CLEAR_PAGE      ; +2
            INC WRK+1           ; +2
            BNE CHECK_PAGE      ; +2

; Zero from start of memory page of DATA_END .. DATA_END
CHECK_PART
            LDX #&lt;DATA_END      ; +2 lo byte of addr; ca65, merlin; EDASM #&gt;
CLEAR_PART
            STA (WRK),Y         ; +2
            INY                 ; +1
            DEX                 ; +1
            BNE CLEAR_PART      ; +2
; --- end clear stub ---        ;Sub-Total 33 bytes header code

; --- begin code ---
MAIN        EQU *           ;=12 $2021
            JSR FUNC1       ;  +3
            JSR FUNC2       ;  +3
            LDY #&gt;END       ;  +2 hi byte of addr
            LDX #&lt;END       ;  +2 lo byte of addr
            JMP PRNTYX      ;  +2

FUNC1       EQU *           ;=14 $202E
            LDX #0          ;  +2
PUTCHAR
            LDA FNAME,X     ;  +3
            JSR COUT        ;  +3
            INX             ;  +1
            CPX #FNAME1LEN  ;  +2
            BNE PUTCHAR     ;  +2
            RTS             ;  +1

FUNC2       EQU *           ;=6
            LDA #6          ;  +2
            STA FCB_SLOT    ;  +3
            RTS             ;  +1
;--- end code ---           ;Sub-Total 27 bytes program code

; All data grouped together
; There are 2 types of data:
;    initialized
;    uninitialized
; Only the initialized data needs to be stored on disk

; --- begin data --- Initialized data
FNAME       EQU *           ;=30 $2042
FNAME1      ASC "HELLO_________________________" ; +30 filename
FNAME1LEN   EQU *-FNAME

FCB         EQU *           ; $2060
FCB_SLOT    DS 1
FCB_DRIVE   DS 1
FCB_TRACK   DS 1
FCB_SECTOR  DS 1
FCB_LEN     EQU *-FCB
; --- end data ---
END         EQU *           ; $2064

; Pad to end of page to page align BUF1
HEREL       EQU &lt;*          ; lo byte ca65, merlin; EDASM &gt;*
REMDR       EQU 256-HEREL   ; pad to end of page
            ORG *+REMDR

; === begin data === Uninitialized data
DATA_START  EQU *
BUF1        EQU *           ; $2100
            ORG *+256

VTOC        EQU *           ; $2200
            ORG *+256

DATA_END    EQU *           ; $2300
; === end data ===
</pre>
</div>

In contradistinction to the previous example, our new code plus initialized data only takes up 100 bytes ($64) in memory; This is only <b>1 sector</b> on disk <i>even though it uses the same Total run-time memory data bytes as Example 1 !</i>
<p>

<h2><a class='section' name='WastedSectors'>3.3 Wasted Sectors</a></h2>
<div style="padding-left:5%">
    <font style="font-family: monospace;">
        <table class='borders'>
            <tr><th>Track/Sector</th><th>File   </th><th>Description                             </th></tr>
            <tr><td>T0S5        </td><td>MSWAITR</td><td>Wastes 256 bytes for <a class="disk" href="#NBUF1">NBUF1</a> - entire sector is zero!                                           </td></tr>
            <tr><td>T0SB        </td><td>DOSINIT</td><td>Wastes 127 bytes for <a class='disk' href='#_1C81'>padding</a> to page align <a class='v' href='#START'>START</a> DOS Vectors    </td></tr>
            <tr><td>T2S3        </td><td>FCVBUFS</td><td>Wastes 255 bytes for <a class="disk" href="#_3400">VTOC</a> and an <b>unused</b> single byte of the start of the CATALOG ($02) @ $BB !                          </td></tr>
            <tr><td>T2S4        </td><td>FCVBUFS</td><td>Wastes 256 bytes for <a class="disk" href="#_34BC">CATALOG</a> remaining bytes since it spans two sectors                       </td></tr>
            <tr><td>T2S5 - T2SF </td><td>n/a    </td><td>Rest of Track 2 is reserved. See: <a class="dumb" href="#HNTDAFS4">HNTDAFS #4</a> and <span class="todo">TODO</span>              </td></tr>
        </table>
    </font>
</div>
<p>
<b>Total sectors wasted</b>: 14 !
<p>
<h2><a class='section' name='BufferBloat'>3.4 Buffer Bloat</a></h2>
<p>
Why is DOS 3.3 so slow loading files when faster DOS's such as DiversiDOS, Pronto DOS, FastDOS, are able to load significantly faster?
<p>
When DOS has finished reading the raw disk nibbles into a buffer, it must "decode" the 342 nibbles into 256 bytes.
 Then it must copy the sector back to the caller's address space.
 This doesn't leave a whole lot of time.
 While there is sector interleaving DOS to help alleviate the lack of time this it isn't enough due to excessing buffering.
 DOS has significant overhead where it copies data from/to 3 buffers. <span class='todo'>TODO: citation</span>
 In modern terminology this is known as <a class='link' href=''>buffer bloat</a>.
<p>
Let's trace the BLOAD command to see what happens.
<p>
First, prepare a new blank disk that we'll use for testing.
<p>
<ul>
    <li>1. Boot DOS 3.3</li>
    <li>2. Eject the DOS 3.3 master from the drive</li>
    <li>3. Insert a new blank disk</li>
    <li>4. Initialize it and prepare a binary file</li>
</ul>
<pre>
<span class='macro'>
    NEW                                  
    1 ? CHR$(4);"CATALOG"                
    2 END                                
    3 HGR                                
    4 FOR C=0 TO 7                       
    5 HCOLOR=C:X=C*14:Z=(C+1)*14-1       
    6 FOR Y=0 TO 16:HPLOT X,Y TO Z,Y:NEXT
    7 NEXT                               
    INIT HELLO                           
    RUN 3                                
    BSAVE TEST,A$2000,L$1FF8             
</span>
</pre>
<p>
    We've created a binary graphics file on track $13, sector $F .. track $14, sector $0. (Remember, DOS start at sector $F and works "down" sector $0.)
<p>
Here is the corresponding Track / Sector <b>usage</b>:
<pre>
    T13S0 $2EFC .. $2FFB
    T13S1 $2DFC .. $2EFB
    T13S2 $2CFC .. $2DFB
    T13S3 $2BFC .. $2CFB
    T13S4 $2AFC .. $2BFB
    T13S5 $29FC .. $2AFB
    T13S6 $28FC .. $29FB
    T13S7 $27FC .. $28FB
    T13S8 $26FC .. $27FB
    T13S9 $25FC .. $26FB
    T13SA $24FC .. $25FB
    T13SB $23FC .. $24FB
    T13SC $22FC .. $23FB
    T13SD $21FC .. $22FB
    T13SE $20FC .. $21FB
    T13SE $2000 .. $20FB
    T13SF Array of sectors for file TEST

    T14S0 $3EFB .. $3FF7
    T14S1 $3DFB .. $3EFB
    T14S2 $3CFB .. $3DFB
    T14S3 $3BFB .. $3CFB
    T14S4 $3AFB .. $3BFB
    T14S5 $39FB .. $3AFB
    T14S6 $38FB .. $39FB
    T14S7 $37FB .. $38FB
    T14S8 $36FC .. $37FB
    T14S9 $35FC .. $36FB
    T14SA $34FC .. $35FB
    T14SB $33FC .. $34FB
    T14SC $32FC .. $33FB
    T14SD $31FC .. $32FB
    T14SE $30FC .. $31FB
    T14SF $2FFC .. $30FB
</pre>
<p>
And the corresponding Track / Sector <b>disk map</b>
<pre>
     T00000000000000001111111111111111222
     T0123456789ABCDEF0123456789ABCDEF012
    0.DDD..............V.BB..............
    1.DDD..............C.BB..............
    2.DDD..............C.BB..............
    3.DDD..............C.BB..............
    4.DDD..............C.BB..............
    5.DD...............C.BB..............
    6.DD...............C.BB..............
    7.DD...............C.BB..............
    8.DD...............C.BB..............
    9.DD...............C.BB..............
    A.DD...............C.BB..............
    B.DD...............C.BB..............
    C.DD...............C.BB..............
    D.DD...............C.BB..............
    E.DD...............CABB..............
    F.DD...............CabB..............
     T00000000000000001111111111111111222
     T0123456789ABCDEF0123456789ABCDEF012

    Legend:
        a = Track/Sector List: HELLO
        A = Applesoft program: HELLO
        b = Track/Sector list of: TEST
        B = Binary graphics file: TEST
        C = Catalog
        D = DOS 3.3 Boot
        V = VTOC (Volume Table of Contents -- Free/Used sectors bitmap)
</pre>

<h1>Miscellaneous Information</a>
<h2><a class='section' name='Stats'>Statistics</a></h2>
<p>
<table class='borders'>
    <tr><td>Total Spelling mistakes:             </td><td> 13</td></tr> <!-- :%s/\*spelling\*//gn -->
    <tr><td>Total Functions:                     </td><td> 99</td></tr> <!-- :%s/class="f"//gn -->
    <tr><td>Total Variables:                     </td><td>102</td></tr> <!-- :%s/class="d"//gn -->
    <tr><td>Total Magic Numbers:                 </td><td> 38</td></tr>
    <tr><td>Total Wasted bytes (run-time memory):</td><td>160</td></tr>
    <tr><td>Total Wasted sectors:                </td><td> 14</td></tr>
</table>
<p>

<h1><a class='section' name='Acknowledgements'>4.0 Acknowledgements</a></h1>
<p>
A special Thank-You to:
<ul>
    <li>Apple Computer, Inc., for releasing the DOS 3.3C Source Code</li>
    <li>Brutal Deluxe for mirroring the DOS 3.3 Source Code PDF</li>
    <li>Usenet: <a class='link' href="https://groups.google.com/forum/#!forum/comp.sys.apple2">comp.sys.apple2</a></li>
    <li>Bob SanderCleff for his amazing Applesoft Disassembly</li>
    <li><a class='link' href="http://jamtronix.com/files/applesoft.html">Jamtronix Applesoft Listing</a> -- Your clean HTML was a starting point for this HTML file!</li>
</ul>

<p>
Apple ][ Forever!
</body>
</html>

<!--

Well aren't you a curious hacker(*) !

Here's a trick to boot from Drive 2 :-)
NOTE: You'll need a DOS that isn't brain dead.
Look for an upcoming announcement in 2017 in c.s.a2

; Apple //e
9600<C600.C6FFM
9636:8B
9600G

; Apple //c
9600<C600.C6FFM
96xx: TODO
9600G

; Laser 128
9600<C600.C6FFM
96xx: TODO
9600G

(*) Using the original positive meaning 'benign curiosity probing for the sake of learning', before it got hijacked to mean a negative connotation: 'destructive entry.'

-->
